# åŒIPåŸŸåæ¶æ„é…ç½®æŠ¥å‘Š

## ğŸ“‹ æ¦‚è¿°

æœ¬æŠ¥å‘Šè¯¦ç»†è®°å½•äº†åŒIPåŸŸåæ¶æ„çš„é…ç½®è¿‡ç¨‹å’Œå½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬ç»Ÿä¸€ç§Ÿæˆ·ç³»ç»Ÿå’Œå¹¼å„¿å›­ä¸šåŠ¡ç³»ç»Ÿçš„ç«¯å£é…ç½®ã€åŸŸåæ˜ å°„å’ŒéªŒè¯ç»“æœã€‚

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### åŸŸåä¸IPæ˜ å°„

| åŸŸå | IPåœ°å€ | ç³»ç»Ÿ | ç«¯å£ | çŠ¶æ€ |
|------|--------|------|------|------|
| rent.yyup.cc | 47.94.82.59 | ç»Ÿä¸€ç§Ÿæˆ·ç®¡ç†ç³»ç»Ÿ | 4001 | âœ… è¿è¡Œä¸­ |
| k.yyup.cc | 47.94.82.59 | å¹¼å„¿å›­ä¸šåŠ¡ç³»ç»Ÿ | 3000 | âœ… è¿è¡Œä¸­ |
| k001.yyup.cc | 47.94.82.59 | å¹¼å„¿å›­ä¸šåŠ¡ç³»ç»Ÿï¼ˆç§Ÿæˆ·å®ä¾‹ï¼‰ | 3000 | âœ… è¿è¡Œä¸­ |

> **æ³¨æ„**: æ–°ç§Ÿæˆ·å¼€é€šæ—¶ï¼Œå­åŸŸåï¼ˆå¦‚ k002.yyup.ccï¼‰éœ€è¦æ·»åŠ  A è®°å½•æŒ‡å‘ `47.94.82.59`

### ç½‘ç»œç»‘å®šé…ç½®

- **ç»‘å®šåœ°å€**: `0.0.0.0` (ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£)
- **ä¼˜åŠ¿**: æ”¯æŒåŒIPé…ç½®ï¼Œé€šè¿‡åŸŸåæ­£ç¡®è·¯ç”±åˆ°å¯¹åº”ç³»ç»Ÿ

## ğŸ› ï¸ é…ç½®è¿‡ç¨‹

### Phase 1: TypeScriptç¼–è¯‘é”™è¯¯ä¿®å¤

#### 1.1 adminIntegrationServiceå¯¼å‡ºä¿®å¤
**æ–‡ä»¶**: `/home/zhgue/kyyupgame/k.yyup.com/server/src/middlewares/auth.middleware.ts`
```typescript
// ç¬¬1408è¡Œæ·»åŠ å¯¼å‡º
export { adminIntegrationService };
```

#### 1.2 LoginDtoæ¥å£æ›´æ–°
**æ–‡ä»¶**: `/home/zhgue/kyyupgame/unified-tenant-system/server/src/types/auth.ts`
```typescript
export interface LoginDto {
  phone: string;        // ä» username/email æ”¹ä¸º phone
  password: string;
}
```

#### 1.3 å˜é‡å¼•ç”¨é”™è¯¯ä¿®å¤
**æ–‡ä»¶**: `/home/zhgue/kyyupgame/unified-tenant-system/server/src/controllers/auth.controller.ts`
```typescript
// ç¬¬129è¡Œä¿®å¤
console.log('è´¦å·å·²ç¦ç”¨:', user.username || user.phone);
```

### Phase 2: ç«¯å£é…ç½®ä¿®å¤

#### 2.1 ç¯å¢ƒå˜é‡é…ç½®
**æ–‡ä»¶**: `/home/zhgue/kyyupgame/unified-tenant-system/server/.env`
```bash
PORT=4001                    # æ·»åŠ PORTé…ç½®
DEFAULT_TENANT_CODE=k001     # æ·»åŠ ç§Ÿæˆ·ä»£ç é…ç½®
```

#### 2.2 npmè„šæœ¬æ›´æ–°
**æ–‡ä»¶**: `/home/zhgue/kyyupgame/unified-tenant-system/server/package.json`
```json
{
  "scripts": {
    "dev": "node scripts/kill-ports.js && cross-env NODE_ENV=development PORT=4001 ...",
    "dev:bash": "... PORT=4001 ...",
    "dev:debug": "... PORT=4001 ..."
    // æ‰€æœ‰è„šæœ¬çš„ PORT: 3001 â†’ 4001
  }
}
```

### Phase 3: æœåŠ¡å™¨å¯åŠ¨ä¸éªŒè¯

#### 3.1 æœåŠ¡å™¨çŠ¶æ€æ£€æŸ¥

**ç»Ÿä¸€ç§Ÿæˆ·ç³»ç»Ÿ (unified-tenant-system)**:
```bash
ç«¯å£4001çŠ¶æ€: âœ… ç›‘å¬ä¸­
PID: 1427026
ç»‘å®šåœ°å€: 0.0.0.0:4001
```

**å¹¼å„¿å›­ä¸šåŠ¡ç³»ç»Ÿ (k.yyup.com)**:
```bash
ç«¯å£3000çŠ¶æ€: âœ… ç›‘å¬ä¸­
PID: 1433088
ç»‘å®šåœ°å€: 0.0.0.0:3000
```

#### 3.2 ç»Ÿä¸€è®¤è¯ç³»ç»Ÿæµ‹è¯•

**éªŒè¯ç å‘é€æµ‹è¯•**:
```bash
è¯·æ±‚: POST http://localhost:4001/api/auth/send-code
å‚æ•°: {"phone":"18611141133","type":"register"}
å“åº”: {"success":true,"message":"éªŒè¯ç å‘é€æˆåŠŸ","data":{"code":"548838"}}
çŠ¶æ€: âœ… æˆåŠŸ
```

## ğŸ“Š å®Œæ•´ç«¯å£é…ç½®å¯¹æ¯”

| é¡¹ç›® | package.jsonè„šæœ¬ç«¯å£ | app.tsé»˜è®¤ç«¯å£ | å®é™…è¿è¡Œç«¯å£ | ç»‘å®šåœ°å€ |
|------|---------------------|----------------|--------------|----------|
| unified-tenant-system | 4001 | 3000 | 4001 | 0.0.0.0 |
| k.yyup.com | 3000 | 3000 | 3000 | 0.0.0.0 |

## ğŸ” æµ‹è¯•è´¦å·ä¿¡æ¯

**æµ‹è¯•å·ç **: 18611141133
**ç”¨é€”**: éªŒè¯ç ç™»å½•ã€è‡ªåŠ¨æ³¨å†ŒåŠŸèƒ½æµ‹è¯•
**æ”¯æŒçš„æµ‹è¯•è§’è‰²**: parent, teacher, admin

### æµ‹è¯•ç¤ºä¾‹
```bash
# å‘é€éªŒè¯ç 
curl -X POST http://localhost:4001/api/auth/send-code \
  -H "Content-Type: application/json" \
  -d '{"phone": "18611141133", "type": "register"}'

# éªŒè¯ç ç™»å½•ï¼ˆè‡ªåŠ¨æ³¨å†Œï¼‰
curl -X POST http://localhost:4001/api/auth/login-with-code \
  -H "Content-Type: application/json" \
  -d '{"phone": "18611141133", "code": "548838", "password": "123456", "role": "parent"}'
```

## ğŸ“ å…³é”®æ–‡ä»¶ä¿®æ”¹è®°å½•

### æ ¸å¿ƒé…ç½®æ–‡ä»¶
1. **k.yyup.com/server/src/middlewares/auth.middleware.ts** - æ·»åŠ adminIntegrationServiceå¯¼å‡º
2. **unified-tenant-system/server/src/types/auth.ts** - æ›´æ–°LoginDtoæ¥å£ä¸ºphoneæ¨¡å¼
3. **unified-tenant-system/server/src/controllers/auth.controller.ts** - ä¿®å¤å˜é‡å¼•ç”¨é”™è¯¯
4. **unified-tenant-system/server/.env** - æ·»åŠ PORT=4001å’Œç§Ÿæˆ·é…ç½®
5. **unified-tenant-system/server/package.json** - æ›´æ–°æ‰€æœ‰devè„šæœ¬ç«¯å£ä¸º4001

### æ–‡æ¡£æ–‡ä»¶
6. **unified-tenant-system/CLAUDE.md** - æ·»åŠ æµ‹è¯•è´¦å·ä¿¡æ¯å’Œæ•°æ®åº“åˆ‡æ¢æœºåˆ¶è¯´æ˜

## ğŸš€ è¿è¡ŒçŠ¶æ€

### å½“å‰è¿è¡Œçš„æœåŠ¡
```bash
âœ… unified-tenant-system (PID 1427026)
   - ç«¯å£: 4001
   - ç»‘å®š: 0.0.0.0:4001
   - åŠŸèƒ½: ç»Ÿä¸€ç§Ÿæˆ·ç®¡ç†ã€è®¤è¯æœåŠ¡

âœ… k.yyup.com/server (PID 1433088)
   - ç«¯å£: 3000
   - ç»‘å®š: 0.0.0.0:3000
   - åŠŸèƒ½: å¹¼å„¿å›­ä¸šåŠ¡ç³»ç»Ÿ

âœ… k.yyup.com/client (PID 1425280)
   - ç«¯å£: 5173
   - ç»‘å®š: 0.0.0.0:5173
   - åŠŸèƒ½: å‰ç«¯å¼€å‘æœåŠ¡å™¨
```

### éªŒè¯ç»“æœ
- âœ… TypeScriptç¼–è¯‘é”™è¯¯å…¨éƒ¨ä¿®å¤
- âœ… ç«¯å£é…ç½®æ­£ç¡®
- âœ… æœåŠ¡å™¨æˆåŠŸå¯åŠ¨å¹¶ç›‘å¬
- âœ… ç»Ÿä¸€è®¤è¯ç³»ç»Ÿæ­£å¸¸å·¥ä½œ
- âœ… åŒIPåŸŸåæ¶æ„é…ç½®å®Œæˆ

## ğŸ“ˆ ä¼˜åŠ¿ä¸ç‰¹ç‚¹

1. **å¤šç½‘å¡æ”¯æŒ**: æœåŠ¡å™¨ç»‘å®šåˆ°0.0.0.0ï¼Œæ”¯æŒåŒIPé…ç½®
2. **åŸŸåè·¯ç”±**: é€šè¿‡åŸŸåæ­£ç¡®è¯†åˆ«ç§Ÿæˆ·ç³»ç»Ÿ
3. **ç«¯å£éš”ç¦»**: 4001ç«¯å£ç§Ÿæˆ·ç®¡ç†ï¼Œ3000ç«¯å£ä¸šåŠ¡ç³»ç»Ÿ
4. **ç»Ÿä¸€è®¤è¯**: rent.yyup.ccæä¾›ç»Ÿä¸€è®¤è¯æœåŠ¡
5. **ç§Ÿæˆ·éš”ç¦»**: k.yyup.ccå’Œk001.yyup.ccå…±äº«ä¸šåŠ¡ç³»ç»Ÿï¼Œé€šè¿‡ç§Ÿæˆ·ä»£ç éš”ç¦»

## ğŸ”® åç»­ä¼˜åŒ–å»ºè®®

1. **SSLè¯ä¹¦é…ç½®**: ä¸ºç”Ÿäº§ç¯å¢ƒé…ç½®HTTPSè¯ä¹¦
2. **è´Ÿè½½å‡è¡¡**: è€ƒè™‘Nginxåå‘ä»£ç†é…ç½®
3. **ç›‘æ§å‘Šè­¦**: æ·»åŠ æœåŠ¡å¥åº·æ£€æŸ¥å’Œå‘Šè­¦æœºåˆ¶
4. **æ—¥å¿—èšåˆ**: ç»Ÿä¸€æ—¥å¿—ç®¡ç†å’Œåˆ†æç³»ç»Ÿ

## ğŸ“ è”ç³»ä¿¡æ¯

å¦‚æœ‰é…ç½®é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™é…ç½®
2. åŸŸåDNSè§£æè®¾ç½®
3. æœåŠ¡å™¨è¿›ç¨‹çŠ¶æ€
4. æ—¥å¿—æ–‡ä»¶è¯Šæ–­

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-28
**é…ç½®ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: âœ… é…ç½®å®Œæˆï¼ŒéªŒè¯é€šè¿‡
