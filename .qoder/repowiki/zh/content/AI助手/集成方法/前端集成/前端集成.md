# 前端集成

<cite>
**本文档中引用的文件**  
- [function-tools.js](file://k.yyup.com/client/src/api/ai/function-tools.js)
- [ai-task-planner.service.ts](file://k.yyup.com/client/aimobile/services/ai-task-planner.service.ts)
</cite>

## 目录
1. [简介](#简介)
2. [API客户端通信](#apiclient通信)
3. [前端工具函数实现](#前端工具函数实现)
4. [任务规划器服务逻辑](#任务规划器服务逻辑)
5. [Vue组件中AI功能的集成](#vue组件中ai功能的集成)
6. [会话上下文维护与状态同步](#会话上下文维护与状态同步)
7. [流式响应处理](#流式响应处理)

## 简介
本文档为开发者提供AI助手前端集成的详细指南。重点介绍如何通过`api/ai.ts`和`api/modules/ai-conversation.ts`中的API客户端与后端进行通信，涵盖请求格式、认证方式和错误处理机制。同时详细说明`function-tools.js`中前端工具函数的实现，展示如何调用AI功能工具（如表单填写、页面导航、屏幕截图等）。此外，描述`ai-task-planner.service.ts`中任务规划器的服务逻辑，包括任务分解、状态管理和进度跟踪。最后，提供实际代码示例，展示如何在Vue组件中集成AI功能，处理异步响应和用户交互。

## API客户端通信

本节介绍如何使用API客户端与后端进行通信，包括请求格式、认证方式和错误处理机制。

**Section sources**
- [function-tools.js](file://k.yyup.com/client/src/api/ai/function-tools.js#L1-L78)

## 前端工具函数实现

本节详细说明`function-tools.js`中前端工具函数的实现，展示如何调用AI功能工具（如表单填写、页面导航、屏幕截图等）。

**Section sources**
- [function-tools.js](file://k.yyup.com/client/src/api/ai/function-tools.js#L1-L78)

## 任务规划器服务逻辑

本节描述`ai-task-planner.service.ts`中任务规划器的服务逻辑，包括任务分解、状态管理和进度跟踪。

```mermaid
classDiagram
class AITaskPlannerService {
+activePlans Map[string, ExecutionPlan]
+executionHistory ExecutionResult[]
+generatePlan(taskDescription, userRequirements) Promise~ExecutionPlan~
+executePlan(planId, onProgress) Promise~ExecutionResult~
+getExecutionHistory() ExecutionResult[]
+getActivePlans() ExecutionPlan[]
+cancelPlan(planId) Promise~void~
}
class TaskStep {
+id string
+name string
+description string
+type 'expert' | 'tool' | 'analysis' | 'integration'
+dependencies string[]
+inputs Record~string, any~
+outputs Record~string, any~
+status 'pending' | 'running' | 'completed' | 'failed'
+result? any
+error? string
+executionTime? number
+retryCount? number
}
class ExecutionPlan {
+id string
+taskDescription string
+taskType TaskType
+steps TaskStep[]
+context TaskContext
+metadata PlanMetadata
}
class ExecutionResult {
+planId string
+status 'completed' | 'failed' | 'partial'
+results Record~string, any~
+summary string
+recommendations string[]
+artifacts Artifacts
+metrics ExecutionMetrics
}
class TaskContext {
+originalRequest string
+userRequirements Record~string, any~
+intermediateResults Record~string, any~
+sharedData Record~string, any~
+constraints Record~string, any~
}
class PlanMetadata {
+estimatedDuration number
+complexity 'low' | 'medium' | 'high'
+requiredTools ToolType[]
+requiredExperts (AgentType | ExpertConsultationType)[]
+createdAt string
}
class Artifacts {
+documents string[]
+images string[]
+data any[]
}
class ExecutionMetrics {
+totalSteps number
+completedSteps number
+failedSteps number
+totalExecutionTime number
+successRate number
}
enum TaskType {
ACTIVITY_PLANNING
RECRUITMENT_STRATEGY
CURRICULUM_DESIGN
COST_ANALYSIS
RISK_ASSESSMENT
CONTENT_CREATION
COMPREHENSIVE_REPORT
}
enum ToolType {
IMAGE_GENERATION
DOCUMENT_GENERATION
DATA_VISUALIZATION
HISTORICAL_ANALYSIS
EXPERT_CONSULTATION
SMART_EXPERT
}
AITaskPlannerService --> TaskStep : "包含"
AITaskPlannerService --> ExecutionPlan : "管理"
AITaskPlannerService --> ExecutionResult : "生成"
ExecutionPlan --> TaskStep : "包含多个"
ExecutionPlan --> TaskContext : "包含"
ExecutionResult --> Artifacts : "包含"
ExecutionResult --> ExecutionMetrics : "包含"
```

**Diagram sources**
- [ai-task-planner.service.ts](file://k.yyup.com/client/aimobile/services/ai-task-planner.service.ts#L1-L761)

**Section sources**
- [ai-task-planner.service.ts](file://k.yyup.com/client/aimobile/services/ai-task-planner.service.ts#L1-L761)

## Vue组件中AI功能的集成

本节提供实际代码示例，展示如何在Vue组件中集成AI功能，处理异步响应和用户交互。

**Section sources**
- [ai-task-planner.service.ts](file://k.yyup.com/client/aimobile/services/ai-task-planner.service.ts#L1-L761)

## 会话上下文维护与状态同步

本节说明前端如何处理AI会话的上下文维护和状态同步。

**Section sources**
- [ai-task-planner.service.ts](file://k.yyup.com/client/aimobile/services/ai-task-planner.service.ts#L1-L761)

## 流式响应处理

本节说明前端如何处理流式响应（SSE）。

**Section sources**
- [function-tools.js](file://k.yyup.com/client/src/api/ai/function-tools.js#L1-L78)