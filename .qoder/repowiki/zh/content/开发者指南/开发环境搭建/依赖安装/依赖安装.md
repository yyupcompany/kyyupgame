# 依赖安装

<cite>
**本文档中引用的文件**  
- [k.yyup.com/package.json](file://k.yyup.com/package.json)
- [unified-tenant-system/package.json](file://unified-tenant-system/package.json)
- [k.yyup.com/Dockerfile](file://k.yyup.com/Dockerfile)
- [unified-tenant-system/Dockerfile](file://unified-tenant-system/Dockerfile)
- [k.yyup.com/tsconfig.json](file://k.yyup.com/tsconfig.json)
- [unified-tenant-system/tsconfig.json](file://unified-tenant-system/tsconfig.json)
- [k.yyup.com/.env](file://k.yyup.com/.env)
- [k.yyup.com/.env.development](file://k.yyup.com/.env.development)
- [k.yyup.com/.env.production](file://k.yyup.com/.env.production)
</cite>

## 目录
1. [项目概述](#项目概述)
2. [核心依赖版本要求](#核心依赖版本要求)
3. [Node.js环境配置](#nodejs环境配置)
4. [前端依赖安装（Vue3）](#前端依赖安装vue3)
5. [后端依赖安装（Express、Sequelize）](#后端依赖安装expresssequelize)
6. [依赖管理脚本说明](#依赖管理脚本说明)
7. [跨平台安装注意事项](#跨平台安装注意事项)
8. [依赖安装验证方法](#依赖安装验证方法)
9. [常见问题与解决方案](#常见问题与解决方案)
10. [最佳实践建议](#最佳实践建议)

## 项目概述

k.yyupgame项目是一个基于Vue3和Express的幼儿园管理系统，采用TypeScript进行开发，支持多租户架构。项目包含两个主要子系统：k.yyup.com和unified-tenant-system，均使用npm作为包管理工具，并通过Docker实现容器化部署。本指南将详细介绍如何正确安装和管理项目所需的核心依赖。

**Section sources**
- [k.yyup.com/package.json](file://k.yyup.com/package.json)
- [unified-tenant-system/package.json](file://unified-tenant-system/package.json)

## 核心依赖版本要求

根据项目package.json文件分析，k.yyupgame项目对核心依赖有明确的版本要求：

| 依赖名称 | 版本要求 | 用途说明 |
|---------|--------|--------|
| Node.js | 18.x | 运行时环境（基于Dockerfile指定） |
| npm | 任意兼容版本 | 包管理工具 |
| Vue | ^3.5.14 | 前端框架 |
| TypeScript | ^5.0.0（通过@types/node推断） | 类型系统 |
| Express | ^5.1.0 | 后端Web框架 |
| Sequelize | ^6.37.7 | ORM数据库操作 |
| Vite | ^4.5.14 | 前端构建工具 |
| Pinia | ^3.0.2 | 状态管理 |
| Element Plus | ^2.3.1 | UI组件库 |

这些版本要求确保了项目的稳定性和功能完整性。

**Section sources**
- [k.yyup.com/package.json](file://k.yyup.com/package.json)
- [unified-tenant-system/package.json](file://unified-tenant-system/package.json)

## Node.js环境配置

### 推荐版本
项目Dockerfile明确指定使用`node:18-alpine`作为基础镜像，因此推荐使用Node.js 18.x版本进行本地开发。

### 安装步骤
1. **Windows/macOS用户**：
   - 访问[Node.js官网](https://nodejs.org/)
   - 下载并安装Node.js 18.x LTS版本
   - 安装完成后验证：`node --version` 和 `npm --version`

2. **Linux用户**：
```bash
# 使用nvm安装Node.js 18
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 18
nvm use 18
```

3. **配置npm镜像源**（提高下载速度）：
```bash
npm config set registry https://registry.npmmirror.com/
```

此配置与Dockerfile中的设置保持一致。

**Section sources**
- [k.yyup.com/Dockerfile](file://k.yyup.com/Dockerfile)
- [unified-tenant-system/Dockerfile](file://unified-tenant-system/Dockerfile)

## 前端依赖安装（Vue3）

### 安装流程
前端依赖位于`client`目录下，使用Vue3 + Vite技术栈。

```bash
# 进入项目根目录
cd k.yyup.com

# 安装前端依赖（推荐使用npm）
npm run install:client

# 或手动进入client目录安装
cd client
npm install
```

### 核心前端依赖
- **Vue 3.5.14+**：采用Composition API进行组件开发
- **Vite 4.5.14+**：提供快速的开发服务器和构建能力
- **Pinia 3.0.2+**：状态管理解决方案
- **Element Plus 2.3.1+**：UI组件库，包含大量现成组件
- **Vue Router 4.5.1+**：路由管理

### 开发服务器启动
```bash
npm run start:frontend
# 或
cd client && npm run dev
```

**Section sources**
- [k.yyup.com/package.json](file://k.yyup.com/package.json)
- [k.yyup.com/tsconfig.json](file://k.yyup.com/tsconfig.json)

## 后端依赖安装（Express、Sequelize）

### 安装流程
后端服务基于Express框架，使用Sequelize进行数据库操作。

```bash
# 安装后端依赖
npm run install:server

# 或手动进入server目录安装
cd server
npm install
```

### 核心后端依赖
- **Express 5.1.0+**：轻量级Web应用框架
- **Sequelize 6.37.7+**：支持MySQL、PostgreSQL等多种数据库的ORM
- **MySQL2 3.15.3+**：MySQL数据库驱动
- **TypeScript**：后端代码使用TypeScript编写
- **ts-node**：支持直接运行TypeScript文件

### 数据库配置
项目通过环境变量配置数据库连接，支持多种数据库类型（MySQL、PostgreSQL等）。

**Section sources**
- [k.yyup.com/package.json](file://k.yyup.com/package.json)
- [unified-tenant-system/package.json](file://unified-tenant-system/package.json)

## 依赖管理脚本说明

项目提供了完善的npm脚本用于依赖管理：

```json
"scripts": {
  "install:all": "npm run install:server && npm run install:client",
  "install:server": "cd server && npm install",
  "install:client": "cd client && npm install",
  "build": "npm run build:backend && npm run build:frontend",
  "start:all": "concurrently \"npm run start:backend\" \"npm run start:frontend\""
}
```

### 常用命令
| 命令 | 说明 |
|------|------|
| `npm run install:all` | 同时安装前后端所有依赖 |
| `npm run install:server` | 仅安装后端依赖 |
| `npm run install:client` | 仅安装前端依赖 |
| `npm run start:all` | 同时启动前后端服务 |

这些脚本简化了开发环境的搭建过程。

**Section sources**
- [k.yyup.com/package.json](file://k.yyup.com/package.json)
- [unified-tenant-system/package.json](file://unified-tenant-system/package.json)

## 跨平台安装注意事项

### Windows系统
- 确保Git Bash或WSL环境可用
- 注意路径分隔符问题，建议使用WSL2进行开发
- 安装Python 2.7+（某些原生模块编译需要）

### Linux/macOS系统
- 确保有足够权限执行安装命令
- 建议使用nvm管理Node.js版本
- 注意文件权限设置

### Docker统一环境
为避免环境差异，推荐使用Docker进行开发：

```bash
# 构建镜像
docker build -t kyyupgame .

# 运行容器
docker run -p 80:80 kyyupgame
```

Dockerfile确保了Node.js 18环境的一致性。

**Section sources**
- [k.yyup.com/Dockerfile](file://k.yyup.com/Dockerfile)
- [unified-tenant-system/Dockerfile](file://unified-tenant-system/Dockerfile)

## 依赖安装验证方法

### 验证Node.js和npm
```bash
node --version  # 应显示v18.x.x
npm --version   # 应显示兼容版本
```

### 验证前端依赖
```bash
cd client
npm run dev
# 应能成功启动Vite开发服务器
```

### 验证后端依赖
```bash
cd server
npm run dev
# 应能成功启动Express服务器
```

### 完整系统验证
```bash
npm run start:all
# 前后端服务均应正常启动
```

### 检查依赖完整性
```bash
npm ls vue      # 检查Vue版本
npm ls express  # 检查Express版本
npm ls sequelize # 检查Sequelize版本
```

**Section sources**
- [k.yyup.com/package.json](file://k.yyup.com/package.json)

## 常见问题与解决方案

### 1. 依赖安装缓慢
**原因**：默认npm源在国内访问较慢  
**解决方案**：
```bash
npm config set registry https://registry.npmmirror.com/
```

### 2. 权限错误
**原因**：npm全局安装权限问题  
**解决方案**：
```bash
# 方法1：使用--prefix
npm install --prefix ./node_modules

# 方法2：修复npm权限
sudo chown -R $(whoami) ~/.npm
```

### 3. node-gyp编译失败
**原因**：缺少编译工具链  
**解决方案**：
```bash
# Windows
npm install --global windows-build-tools

# macOS
xcode-select --install

# Linux
sudo apt-get install build-essential
```

### 4. 依赖冲突
**解决方案**：
```bash
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
```

### 5. TypeScript类型错误
**原因**：类型定义不匹配  
**解决方案**：
```bash
npm install --save-dev @types/express @types/node
```

**Section sources**
- [k.yyup.com/package.json](file://k.yyup.com/package.json)
- [unified-tenant-system/package.json](file://unified-tenant-system/package.json)

## 最佳实践建议

### 1. 环境一致性
- 统一使用Node.js 18.x版本
- 所有开发者配置相同的npm镜像源
- 使用Docker确保生产环境一致性

### 2. 依赖管理
- 使用`npm ci`而非`npm install`进行CI/CD构建
- 定期更新依赖版本，但需充分测试
- 分离开发依赖和生产依赖

### 3. 性能优化
- 使用`npm ci`进行快速、可重现的安装
- 在Docker构建中分层安装依赖以利用缓存
- 定期清理npm缓存：`npm cache clean --force`

### 4. 安全考虑
- 定期审计依赖：`npm audit`
- 锁定依赖版本：使用package-lock.json
- 避免全局安装不必要的包

### 5. 开发流程
```bash
# 标准开发环境搭建流程
git clone <repository>
npm run install:all
npm run start:all
```

遵循这些最佳实践可确保项目依赖管理的稳定性和可维护性。

**Section sources**
- [k.yyup.com/package.json](file://k.yyup.com/package.json)
- [k.yyup.com/Dockerfile](file://k.yyup.com/Dockerfile)
- [k.yyup.com/.env.development](file://k.yyup.com/.env.development)