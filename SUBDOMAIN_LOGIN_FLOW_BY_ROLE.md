# å­åŸŸåç™»å½•æµç¨‹åˆ†æ - é‡æ–°è®¾è®¡ç‰ˆ

## ğŸ¯ æ ¸å¿ƒæ¶æ„åŸåˆ™

### ç”¨æˆ·æ„ŸçŸ¥ vs æŠ€æœ¯å®ç°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ç”¨æˆ·æ„ŸçŸ¥å±‚                                      â”‚
â”‚                                                                         â”‚
â”‚   ç”¨æˆ·åªçœ‹åˆ° k001.yyup.cc                                               â”‚
â”‚   â”œâ”€ ç™»å½•é¡µé¢: k001.yyup.cc/login                                       â”‚
â”‚   â”œâ”€ æ³¨å†Œé¡µé¢: k001.yyup.cc/register                                    â”‚
â”‚   â””â”€ æ‰€æœ‰æ“ä½œéƒ½åœ¨ k001.yyup.cc å®Œæˆï¼Œæ— é¡µé¢è·³è½¬                          â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          æŠ€æœ¯å®ç°å±‚                                      â”‚
â”‚                                                                         â”‚
â”‚   å‰ç«¯ (k001.yyup.cc)                                                   â”‚
â”‚       â†“ APIè°ƒç”¨                                                         â”‚
â”‚   ç§Ÿæˆ·åç«¯ (k001.yyup.cc/api)                                           â”‚
â”‚       â†“ å†…éƒ¨è°ƒç”¨                                                        â”‚
â”‚   ç»Ÿä¸€è®¤è¯API (rent.yyup.cc/api) â† ç”¨æˆ·æ— æ„ŸçŸ¥                            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å·²å®ç°çš„æ³¨å†Œæ¶æ„ âœ…

| å±‚çº§ | ç»„ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| å‰ç«¯ | æ³¨å†Œé¡µé¢ | `k.yyup.com/client/src/pages/Register.vue` | è§’è‰²é€‰æ‹©+è¡¨å• |
| å‰ç«¯ | ç™»å½•é¡µé¢ | `k.yyup.com/client/src/pages/Login/index.vue` | æ‰‹æœºå·+å¯†ç  |
| åç«¯ | æ³¨å†Œæ§åˆ¶å™¨ | `k.yyup.com/server/src/controllers/auth-register.controller.ts` | åŒå†™é€»è¾‘ |
| åç«¯ | è®¤è¯ä¸­é—´ä»¶ | `k.yyup.com/server/src/middlewares/auth.middleware.ts` | è°ƒç”¨ç»Ÿä¸€è®¤è¯ |
| ç»Ÿä¸€è®¤è¯ | API | `unified-tenant-system/server/` | ç”¨æˆ·æ— æ„ŸçŸ¥ |

### æ³¨å†Œæµç¨‹è¯¦è§£ï¼ˆå·²å®ç°ï¼‰

```
ç”¨æˆ·è®¿é—® k001.yyup.cc/register
    â†“
å‰ç«¯è¡¨å•ï¼šé€‰æ‹©è§’è‰² + å¡«å†™ä¿¡æ¯ + æ‰‹æœºå· + å¯†ç 
    â†“
POST k001.yyup.cc/api/auth/register
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç§Ÿæˆ·åç«¯ auth-register.controller.ts                         â”‚
â”‚                                                              â”‚
â”‚ Step 1: è°ƒç”¨ rent.yyup.cc/api/auth/register (ç”¨æˆ·æ— æ„ŸçŸ¥)     â”‚
â”‚         â†’ åˆ›å»º global_users è®°å½•                             â”‚
â”‚         â†’ è¿”å› globalUserId                                  â”‚
â”‚                                                              â”‚
â”‚ Step 2: åœ¨å­æ•°æ®åº“åˆ›å»º users è®°å½•                             â”‚
â”‚         â†’ å…³è” global_user_id                                â”‚
â”‚         â†’ password å­—æ®µä¸ºç©ºï¼ˆè®¤è¯åœ¨ç»Ÿä¸€ç³»ç»Ÿï¼‰                  â”‚
â”‚                                                              â”‚
â”‚ Step 3: å¦‚æœæ˜¯æ•™å¸ˆï¼Œåˆ›å»º TeacherApproval è®°å½•                 â”‚
â”‚                                                              â”‚
â”‚ Step 4: è°ƒç”¨ rent.yyup.cc/api/v1/tenants/bind (ç»‘å®šç§Ÿæˆ·)     â”‚
â”‚         â†’ åˆ›å»º user_tenant_relations è®°å½•                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¿”å›æ³¨å†ŒæˆåŠŸ â†’ å‰ç«¯è·³è½¬ç™»å½•é¡µ
```

---

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

æ ¹æ®ä½ çš„æ¾„æ¸…ï¼Œæˆ‘é‡æ–°ç†è§£äº†æ•´ä½“æ¶æ„ï¼š

### ğŸ—ï¸ æ ¸å¿ƒæ¶æ„ç†è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ (rent.yyup.cc)                      â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    global_users    â”‚  â”‚ user_tenant_      â”‚  â”‚      tenants       â”‚   â”‚
â”‚  â”‚    (å…¨å±€ç”¨æˆ·)       â”‚  â”‚ relations         â”‚  â”‚     (ç§Ÿæˆ·è¡¨)       â”‚   â”‚
â”‚  â”‚                    â”‚  â”‚ (ç”¨æˆ·-ç§Ÿæˆ·å…³è”)    â”‚  â”‚                    â”‚   â”‚
â”‚  â”‚  â€¢ id (UUID)       â”‚  â”‚ â€¢ global_user_id  â”‚  â”‚  â€¢ tenant_code     â”‚   â”‚
â”‚  â”‚  â€¢ phone (å”¯ä¸€)    â”‚â”€â”€â”‚ â€¢ tenant_code     â”‚â”€â”€â”‚  â€¢ domain          â”‚   â”‚
â”‚  â”‚  â€¢ password_hash   â”‚  â”‚ â€¢ role_in_tenant  â”‚  â”‚  â€¢ database_name   â”‚   â”‚
â”‚  â”‚  â€¢ real_name       â”‚  â”‚ â€¢ status          â”‚  â”‚  â€¢ oss_config      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  âœ… èŒè´£ï¼šåªåšè®¤è¯ï¼ˆç™»å½•ã€æ³¨å†Œã€éªŒè¯ã€ç»‘å®šç§Ÿæˆ·ï¼‰                          â”‚
â”‚  âŒ ä¸åšï¼šä¸šåŠ¡é€»è¾‘ã€æƒé™å®¡æ‰¹                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚        æ³¨å†Œæ—¶åŒå†™            â”‚
                     â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Demoç³»ç»Ÿ (k.yyup.cc)      â”‚    â”‚   ç§Ÿæˆ·ç³»ç»Ÿ (k001.yyup.cc)   â”‚
â”‚                             â”‚    â”‚                             â”‚
â”‚   æ•°æ®åº“: kardersales       â”‚    â”‚   æ•°æ®åº“: tenant_k001       â”‚
â”‚   è®¤è¯: æœ¬åœ°è®¤è¯            â”‚    â”‚   è®¤è¯: ç»Ÿä¸€è®¤è¯            â”‚
â”‚   æ³¨å†Œ: ä¸éœ€è¦              â”‚    â”‚   æ³¨å†Œ: éœ€è¦åŒå†™            â”‚
â”‚   å®¡æ‰¹: ä¸éœ€è¦              â”‚    â”‚   å®¡æ‰¹: åœ¨å­æ•°æ®åº“          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”‘ å…³é”®è®¾è®¡ç‚¹

| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **å®¶é•¿å¤šç§Ÿæˆ·** | ä¸€ä¸ªæ‰‹æœºå·å¯ä»¥å…³è”å¤šä¸ªå¹¼å„¿å›­ (é€šè¿‡ `user_tenant_relations` è¡¨) |
| **æ³¨å†ŒåŒå†™** | ç»Ÿä¸€è®¤è¯åˆ›å»ºå…¨å±€ç”¨æˆ· + å­æ•°æ®åº“åˆ›å»ºä¸šåŠ¡ç”¨æˆ· |
| **è®¤è¯é›†ä¸­** | æ‰€æœ‰å¯†ç éªŒè¯åœ¨ç»Ÿä¸€è®¤è¯ä¸­å¿ƒå®Œæˆ |
| **å®¡æ‰¹åˆ†ç¦»** | æƒé™å®¡æ‰¹åœ¨å­æ•°æ®åº“ï¼ˆå­ç³»ç»Ÿä¸šåŠ¡é€»è¾‘ï¼‰ |
| **OSSåˆ†ç¦»** | æ¯ä¸ªç§Ÿæˆ·æœ‰ç‹¬ç«‹çš„OSSç©ºé—´ |

---

## ğŸ”„ æ­£ç¡®çš„ç™»å½•æµç¨‹ï¼ˆå­åŸŸå k001.yyup.ccï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·è®¿é—® k001.yyup.cc                             â”‚
â”‚                                  â†“                                        â”‚
â”‚                          è¾“å…¥æ‰‹æœºå· + å¯†ç                                 â”‚
â”‚                                  â†“                                        â”‚
â”‚                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                â”‚ å­ç³»ç»Ÿåç«¯è°ƒç”¨ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ            â”‚                    â”‚
â”‚                â”‚ POST rent.yyup.cc/api/auth/login    â”‚                    â”‚
â”‚                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                  â†“                                        â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚                          â”‚ æ‰‹æœºå·å­˜åœ¨?  â”‚ â† åœ¨ global_users è¡¨æŸ¥è¯¢         â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                 â”‚                                         â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚        â”‚                                                 â”‚                â”‚
â”‚        â–¼                                                 â–¼                â”‚
â”‚  âŒ æ‰‹æœºå·ä¸å­˜åœ¨                                   âœ… æ‰‹æœºå·å­˜åœ¨           â”‚
â”‚        â”‚                                                 â”‚                â”‚
â”‚        â–¼                                                 â–¼                â”‚
â”‚  è¿”å›: ç”¨æˆ·æœªæ³¨å†Œ                                  éªŒè¯å¯†ç                 â”‚
â”‚  needsGlobalRegistration=true                            â”‚                â”‚
â”‚        â”‚                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚        â”‚                                    â”‚                         â”‚   â”‚
â”‚        â–¼                                    â–¼                         â–¼   â”‚
â”‚  ã€å¼•å¯¼æ³¨å†Œæµç¨‹ã€‘                      âŒ å¯†ç é”™è¯¯               âœ… å¯†ç æ­£ç¡® â”‚
â”‚  (åœ¨ç»Ÿä¸€è®¤è¯æ³¨å†Œ)                       è¿”å›é”™è¯¯                      â”‚   â”‚
â”‚                                                                       â”‚   â”‚
â”‚                                                                       â–¼   â”‚
â”‚                                              æŸ¥è¯¢ user_tenant_relations   â”‚
â”‚                                              æ˜¯å¦å·²ç»‘å®šæ­¤ç§Ÿæˆ· (k001)?      â”‚
â”‚                                                         â”‚                 â”‚
â”‚                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                             â”‚                                           â”‚ â”‚
â”‚                             â–¼                                           â–¼ â”‚
â”‚                      å·²ç»‘å®šæ­¤ç§Ÿæˆ·                               æœªç»‘å®šæ­¤ç§Ÿæˆ·â”‚
â”‚                             â”‚                                           â”‚ â”‚
â”‚                             â–¼                                           â–¼ â”‚
â”‚                  æŸ¥è¯¢å­æ•°æ®åº“ç”¨æˆ·è¡¨                       è¿”å›: éœ€è¦æ³¨å†Œ    â”‚
â”‚                  (tenant_k001.users)                  needsRegistration   â”‚
â”‚                             â”‚                               =true          â”‚
â”‚                             â–¼                                    â”‚        â”‚
â”‚                       ç”¨æˆ·å­˜åœ¨?                                  â–¼        â”‚
â”‚                             â”‚                          ã€å¼•å¯¼æ³¨å†Œæµç¨‹ã€‘    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            (åŒå†™æ³¨å†Œ)        â”‚
â”‚              â”‚                             â”‚                              â”‚
â”‚              â–¼                             â–¼                              â”‚
â”‚          ç”¨æˆ·å­˜åœ¨                      ç”¨æˆ·ä¸å­˜åœ¨                          â”‚
â”‚              â”‚                        (æ•°æ®ä¸ä¸€è‡´)                         â”‚
â”‚              â–¼                             â”‚                              â”‚
â”‚         æ£€æŸ¥å®¡æ ¸çŠ¶æ€                        â–¼                              â”‚
â”‚              â”‚                      è‡ªåŠ¨åŒæ­¥åˆ›å»º                           â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚                              â”‚
â”‚    â”‚                   â”‚                   â”‚                              â”‚
â”‚    â–¼                   â–¼                   â”‚                              â”‚
â”‚  å·²å®¡æ ¸              æœªå®¡æ ¸                 â”‚                              â”‚
â”‚    â”‚                   â”‚                   â”‚                              â”‚
â”‚    â–¼                   â–¼                   â–¼                              â”‚
â”‚  âœ… ç™»å½•æˆåŠŸ        â³ ç™»å½•æˆåŠŸ           âœ… ç™»å½•æˆåŠŸ                       â”‚
â”‚  æ˜¾ç¤ºå®Œæ•´æ•°æ®       æ˜¾ç¤º0æ•°æ®             (å¾…å®¡æ ¸çŠ¶æ€)                      â”‚
â”‚                     +å®¡æ ¸æç¤º                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æœªæ³¨å†Œç”¨æˆ·çš„å¤„ç†æµç¨‹

### âš ï¸ æ ¸å¿ƒåŸåˆ™ï¼šæ‰€æœ‰æ“ä½œåœ¨ç§Ÿæˆ·ç³»ç»Ÿå®Œæˆï¼Œä¸è·³è½¬é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ é”™è¯¯æ–¹å¼ï¼šè·³è½¬åˆ°ç»Ÿä¸€è®¤è¯ç³»ç»Ÿæ³¨å†Œ                                      â”‚
â”‚     ç”¨æˆ·åœ¨ k001.yyup.cc ç™»å½• â†’ è·³è½¬ rent.yyup.cc/register â†’ æ··ä¹±        â”‚
â”‚                                                                         â”‚
â”‚  âœ… æ­£ç¡®æ–¹å¼ï¼šåœ¨ç§Ÿæˆ·ç³»ç»Ÿå†…å®Œæˆæ³¨å†Œ                                        â”‚
â”‚     ç”¨æˆ·åœ¨ k001.yyup.cc ç™»å½• â†’ å¼¹çª—/è·³è½¬ k001.yyup.cc/register          â”‚
â”‚     åç«¯é€æ˜è°ƒç”¨ç»Ÿä¸€è®¤è¯APIï¼Œç”¨æˆ·æ— æ„ŸçŸ¥                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµç¨‹å›¾ï¼šä»ç™»å½•åˆ°æ³¨å†Œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                æœªæ³¨å†Œç”¨æˆ·ç™»å½•æµç¨‹ï¼ˆå…¨éƒ¨åœ¨ k001.yyup.cc å®Œæˆï¼‰              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ã€æƒ…å†µAã€‘æ‰‹æœºå·åœ¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿä¸å­˜åœ¨                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚  ç”¨æˆ·åœ¨ k001.yyup.cc/login è¾“å…¥æ‰‹æœºå·+å¯†ç                                â”‚
â”‚       â†“                                                                 â”‚
â”‚  k001åç«¯è°ƒç”¨ç»Ÿä¸€è®¤è¯ â†’ è¿”å›: ç”¨æˆ·ä¸å­˜åœ¨                                  â”‚
â”‚       â†“                                                                 â”‚
â”‚  k001åç«¯è¿”å›å‰ç«¯: { needsGlobalRegistration: true }                     â”‚
â”‚       â†“                                                                 â”‚
â”‚  å‰ç«¯æ˜¾ç¤º: "æ‚¨çš„æ‰‹æœºå·å°šæœªæ³¨å†Œ"                                          â”‚
â”‚       â†“                                                                 â”‚
â”‚  [ç‚¹å‡»æ³¨å†Œ] â†’ è·³è½¬åˆ° k001.yyup.cc/registerï¼ˆä¸æ˜¯ç»Ÿä¸€è®¤è¯ï¼ï¼‰              â”‚
â”‚       â†“                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“² æ³¨å†Œæµç¨‹ (åœ¨ k001.yyup.cc/register é¡µé¢å®Œæˆ)                   â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  é¡µé¢ï¼šk001.yyup.cc/register                                      â”‚   â”‚
â”‚  â”‚  åç«¯ï¼šk001.yyup.cc/api/auth/register                             â”‚   â”‚
â”‚  â”‚  åç«¯å†…éƒ¨è°ƒç”¨ï¼šrent.yyup.cc/api/auth/register (ç”¨æˆ·æ— æ„ŸçŸ¥)         â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  1. é€‰æ‹©è§’è‰²: å›­é•¿ / è€å¸ˆ / å®¶é•¿                                  â”‚   â”‚
â”‚  â”‚  2. å¡«å†™è§’è‰²ä¿¡æ¯                                                  â”‚   â”‚
â”‚  â”‚  3. è¾“å…¥æ‰‹æœºå· + éªŒè¯ç  + è®¾ç½®å¯†ç                                 â”‚   â”‚
â”‚  â”‚  4. æäº¤æ³¨å†Œ                                                      â”‚   â”‚
â”‚  â”‚       â†“                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ç§Ÿæˆ·åç«¯åŒå†™æ“ä½œ (auth-register.controller.ts)            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Step1: è°ƒç”¨ rent.yyup.cc/api/auth/register              â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Step2: å­æ•°æ®åº“åˆ›å»º users è®°å½•                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Step3: å­æ•°æ®åº“åˆ›å»ºå®¡æ ¸è®°å½• (TeacherApprovalç­‰)         â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Step4: è°ƒç”¨ rent.yyup.cc/api/v1/tenants/bind            â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚       â†“                                                           â”‚   â”‚
â”‚  â”‚  âœ… æ³¨å†ŒæˆåŠŸï¼Œè·³è½¬ k001.yyup.cc/login ç™»å½•                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  ã€æƒ…å†µBã€‘æ‰‹æœºå·å·²åœ¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿï¼Œä½†æœªç»‘å®šæ­¤ç§Ÿæˆ·ï¼ˆå®¶é•¿å¤šå›­æ‰€åœºæ™¯ï¼‰          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚
â”‚  ç”¨æˆ·åœ¨ k001.yyup.cc/login è¾“å…¥æ‰‹æœºå·+å¯†ç                                â”‚
â”‚       â†“                                                                 â”‚
â”‚  k001åç«¯è°ƒç”¨ç»Ÿä¸€è®¤è¯ â†’ å¯†ç æ­£ç¡®ï¼Œä½† user_tenant_relations æ—  k001       â”‚
â”‚       â†“                                                                 â”‚
â”‚  k001åç«¯è¿”å›å‰ç«¯: { needsRegistration: true, globalUserId: xxx }        â”‚
â”‚       â†“                                                                 â”‚
â”‚  å‰ç«¯æ˜¾ç¤ºå¼¹çª—: "æ‚¨å·²æ³¨å†Œï¼Œä½†å°šæœªåœ¨ã€XXå¹¼å„¿å›­ã€‘ç»‘å®š"                        â”‚
â”‚       â†“                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ”— ç»‘å®šæµç¨‹ (åœ¨ç™»å½•é¡µå¼¹çª—å®Œæˆï¼Œä¸è·³è½¬é¡µé¢)                        â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  1. é€‰æ‹©è§’è‰²: å›­é•¿ / è€å¸ˆ / å®¶é•¿                                  â”‚   â”‚
â”‚  â”‚  2. å¡«å†™è§’è‰²ä¿¡æ¯                                                  â”‚   â”‚
â”‚  â”‚  3. æäº¤ç»‘å®šï¼ˆä¸éœ€è¦çŸ­ä¿¡éªŒè¯ï¼Œå·²éªŒè¯èº«ä»½ï¼‰                        â”‚   â”‚
â”‚  â”‚       â†“                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚ ç§Ÿæˆ·åç«¯åŒå†™æ“ä½œ                                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Step1: è°ƒç”¨ rent.yyup.cc/api/v1/tenants/bind            â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Step2: å­æ•°æ®åº“åˆ›å»º users è®°å½•                          â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Step3: å­æ•°æ®åº“åˆ›å»ºå®¡æ ¸è®°å½•                              â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚       â†“                                                           â”‚   â”‚
â”‚  â”‚  âœ… ç»‘å®šæˆåŠŸï¼Œè‡ªåŠ¨ç™»å½•ï¼ˆå¾…å®¡æ ¸çŠ¶æ€ï¼‰                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘¨â€ğŸ’¼ å›­é•¿ (Principal) ç™»å½•æµç¨‹

### åœºæ™¯è¯´æ˜

**å›­é•¿çš„ç‰¹æ®Šæ€§**: å›­é•¿é€šå¸¸æ˜¯ç§Ÿæˆ·å¼€é€šæ—¶ç”±å¹³å°ç®¡ç†å‘˜åˆ›å»ºçš„ï¼Œä¸éœ€è¦è‡ªä¸»æ³¨å†Œã€‚ä½†æˆ‘ä»¬ä¹Ÿæ”¯æŒå›­é•¿è‡ªä¸»ç”³è¯·ã€‚

### åœºæ™¯1: å›­é•¿ç”±ç§Ÿæˆ·å¼€é€šæ—¶åˆ›å»ºï¼ˆé»˜è®¤è·¯å¾„ï¼‰
```
å¹³å°ç®¡ç†å‘˜å¼€é€šç§Ÿæˆ· k001
    â†“
è‡ªåŠ¨åˆ›å»ºå›­é•¿ç”¨æˆ·ï¼ˆåŒæ—¶åŒå†™ï¼‰
    â†“
å›­é•¿æ”¶åˆ°å¼€é€šé€šçŸ¥ï¼Œä½¿ç”¨æ‰‹æœºå·+åˆå§‹å¯†ç ç™»å½•
    â†“
ç»Ÿä¸€è®¤è¯æˆåŠŸ â†’ ç§Ÿæˆ·ç”¨æˆ·å­˜åœ¨ â†’ é»˜è®¤å·²å®¡æ ¸ â†’ âœ… æ˜¾ç¤ºå®Œæ•´æ•°æ®
```

**çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆç§Ÿæˆ·å¼€é€šæµç¨‹ï¼‰

### åœºæ™¯2: å›­é•¿è‡ªä¸»ç”³è¯·ï¼ˆéé»˜è®¤è·¯å¾„ï¼‰
```
ç”¨æˆ·ç™»å½• k001.yyup.ccï¼Œæ‰‹æœºå·æœªæ³¨å†Œ
    â†“
ã€å®Œæ•´æ³¨å†Œæµç¨‹ã€‘é€‰æ‹©"å›­é•¿"è§’è‰²
    â†“
å¡«å†™å›­é•¿ä¿¡æ¯ï¼ˆå§“åã€èµ„è´¨è¯æ˜ç­‰ï¼‰
    â†“
åˆ›å»ºç”¨æˆ· + åˆ›å»º PrincipalApproval è®°å½•ï¼ˆçŠ¶æ€ï¼špendingï¼‰
    â†“
â³ ç­‰å¾…å¹³å°ç®¡ç†å‘˜å®¡æ ¸
    â†“
ç™»å½•å¯è¿›å…¥ï¼Œä½†æ˜¾ç¤º0æ•°æ®
```

**çŠ¶æ€**: ğŸ”´ éœ€è¦å¼€å‘ï¼ˆPrincipalApproval è¡¨å’ŒæœåŠ¡ï¼‰

---

## ğŸ‘©â€ğŸ« è€å¸ˆ (Teacher) ç™»å½•æµç¨‹

### åœºæ™¯1: è€å¸ˆå·²æ³¨å†Œä¸”å·²å®¡æ ¸
```
ç”¨æˆ·è¾“å…¥æ‰‹æœºå·+å¯†ç  â†’ ç»Ÿä¸€è®¤è¯æˆåŠŸ â†’ ç§Ÿæˆ·ç”¨æˆ·å­˜åœ¨ â†’ TeacherApprovalçŠ¶æ€=approved â†’ âœ… æ˜¾ç¤ºå®Œæ•´æ•°æ®
```

**çŠ¶æ€**: âœ… å·²å®ç°

**å…³é”®ä»£ç **: `TeacherApprovalService.checkTeacherPermission()` è¿”å› `dataAccessLevel: 'full'`

### åœºæ™¯2: è€å¸ˆå·²æ³¨å†Œä½†å¾…å®¡æ ¸
```
ç”¨æˆ·è¾“å…¥æ‰‹æœºå·+å¯†ç  â†’ ç»Ÿä¸€è®¤è¯æˆåŠŸ â†’ ç§Ÿæˆ·ç”¨æˆ·å­˜åœ¨ â†’ TeacherApprovalçŠ¶æ€=pending â†’ â³ ç™»å½•æˆåŠŸä½†æ˜¾ç¤º0æ•°æ®
```

**çŠ¶æ€**: âœ… å·²å®ç°

**å…³é”®ä»£ç **: `TeacherApprovalService.filterDataForTeacher()` è¿‡æ»¤æ•°æ®

### åœºæ™¯3: è€å¸ˆæœªæ³¨å†Œï¼ˆæ‰‹æœºå·ä¸å­˜åœ¨ï¼‰
```
ç”¨æˆ·ç™»å½• k001.yyup.ccï¼Œæ‰‹æœºå·æœªåœ¨ç»Ÿä¸€è®¤è¯æ³¨å†Œ
    â†“
ã€å®Œæ•´æ³¨å†Œæµç¨‹ã€‘
    â†“
é€‰æ‹©"è€å¸ˆ"è§’è‰²
    â†“
æ˜¾ç¤ºæ•™å¸ˆä¸“ç”¨è¡¨å•ï¼š
  - é€‰æ‹©å¹¼å„¿å›­
  - é€‰æ‹©ç­çº§
  - æ•™å¸ˆèŒç§°ï¼ˆå¯é€‰ï¼‰
  - æ•™å­¦ç§‘ç›®ï¼ˆå¯é€‰ï¼‰
    â†“
çŸ­ä¿¡éªŒè¯ï¼ˆç»Ÿä¸€è®¤è¯å‘é€ï¼‰
    â†“
ã€åŒå†™æ“ä½œã€‘
  â€¢ ç»Ÿä¸€è®¤è¯: global_users + user_tenant_relations
  â€¢ å­æ•°æ®åº“: users + TeacherApproval(status=pending)
    â†“
âœ… æ³¨å†ŒæˆåŠŸï¼Œè‡ªåŠ¨ç™»å½•
    â†“
â³ æ˜¾ç¤º0æ•°æ®ï¼Œæç¤º"ç­‰å¾…å›­é•¿å®¡æ ¸"
```

**å·²æœ‰ä»£ç **:
- âœ… æ³¨å†Œè¡¨å• (`Register.vue` æœ‰æ•™å¸ˆä¸“ç”¨å­—æ®µ)
- âœ… TeacherApproval åˆ›å»º (`auth-register.controller.ts` ç¬¬169-195è¡Œ)
- âœ… æ•°æ®è¿‡æ»¤æœåŠ¡

**éœ€è¦å¼€å‘**:
- ğŸ”´ ç™»å½•æ—¶è¯†åˆ«"æœªç»‘å®šæ­¤ç§Ÿæˆ·"å¹¶è§¦å‘æ³¨å†Œ/ç»‘å®šå¼¹çª—
- ğŸ”´ å‰ç«¯æ³¨å†Œå¼¹çª—ç»„ä»¶

### åœºæ™¯4: è€å¸ˆå·²æœ‰å…¨å±€è´¦å·ï¼Œä½†æœªç»‘å®šæ­¤ç§Ÿæˆ·ï¼ˆå®¶é•¿å˜è€å¸ˆï¼‰
```
å®¶é•¿ç”¨æˆ·ï¼ˆå·²åœ¨å…¶ä»–ç§Ÿæˆ·æ³¨å†Œï¼‰è®¿é—® k001.yyup.cc
    â†“
ç»Ÿä¸€è®¤è¯æˆåŠŸï¼Œä½† user_tenant_relations ä¸­æ—  k001 è®°å½•
    â†“
è¿”å›: { needsRegistration: true, globalUserId: xxx }
    â†“
å‰ç«¯å¼¹å‡ºã€ç»‘å®šå¼¹çª—ã€‘ï¼ˆä¸éœ€è¦çŸ­ä¿¡éªŒè¯ï¼‰
    â†“
é€‰æ‹©"è€å¸ˆ"è§’è‰²ï¼Œå¡«å†™ä¿¡æ¯
    â†“
ã€åŒå†™æ“ä½œã€‘
  â€¢ ç»Ÿä¸€è®¤è¯: user_tenant_relations (æ–°å¢ k001 å…³è”)
  â€¢ å­æ•°æ®åº“: users + TeacherApproval
    â†“
â³ ç»‘å®šæˆåŠŸï¼Œç­‰å¾…å®¡æ ¸
```

**çŠ¶æ€**: ğŸ”´ éœ€è¦å¼€å‘

---

## ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ å®¶é•¿ (Parent) ç™»å½•æµç¨‹

### ç‰¹æ®Šè¯´æ˜ï¼šå®¶é•¿å¤šç§Ÿæˆ·æ”¯æŒ

**å…³é”®è®¾è®¡**: ä¸€ä¸ªå®¶é•¿å¯ä»¥æœ‰å¤šä¸ªå­©å­åœ¨ä¸åŒå¹¼å„¿å›­ï¼Œæ‰€ä»¥å®¶é•¿è´¦å·éœ€è¦æ”¯æŒå…³è”å¤šä¸ªç§Ÿæˆ·ã€‚

```
å®¶é•¿æ‰‹æœºå·: 138****8000
    â”‚
    â”œâ”€â”€ å…³è”ç§Ÿæˆ· k001 (å­å¥³A åœ¨ é˜³å…‰å¹¼å„¿å›­)
    â”‚      â””â”€â”€ è§’è‰²: parent, çŠ¶æ€: approved
    â”‚
    â”œâ”€â”€ å…³è”ç§Ÿæˆ· k002 (å­å¥³B åœ¨ æ˜Ÿæ˜Ÿå¹¼å„¿å›­)
    â”‚      â””â”€â”€ è§’è‰²: parent, çŠ¶æ€: pending
    â”‚
    â””â”€â”€ å…³è”ç§Ÿæˆ· k003 (å­å¥³C åœ¨ æœˆäº®å¹¼å„¿å›­)
           â””â”€â”€ è§’è‰²: parent, çŠ¶æ€: approved
```

### åœºæ™¯1: å®¶é•¿é¦–æ¬¡æ³¨å†Œ
```
ç”¨æˆ·è®¿é—® k001.yyup.ccï¼Œæ‰‹æœºå·æœªåœ¨ç»Ÿä¸€è®¤è¯æ³¨å†Œ
    â†“
ã€å®Œæ•´æ³¨å†Œæµç¨‹ã€‘
    â†“
é€‰æ‹©"å®¶é•¿"è§’è‰²
    â†“
æ˜¾ç¤ºå®¶é•¿ä¸“ç”¨è¡¨å•ï¼š
  - å®¶é•¿å§“å
  - ä¸å­©å­å…³ç³»ï¼ˆçˆ¶äº²/æ¯äº²/å…¶ä»–ï¼‰
  - ï¼ˆå¯é€‰ï¼‰å­©å­ä¿¡æ¯
    â†“
çŸ­ä¿¡éªŒè¯
    â†“
ã€åŒå†™æ“ä½œã€‘
  â€¢ ç»Ÿä¸€è®¤è¯: global_users + user_tenant_relations(k001)
  â€¢ å­æ•°æ®åº“: users + ParentApproval(status=pending)
    â†“
âœ… æ³¨å†ŒæˆåŠŸï¼Œè‡ªåŠ¨ç™»å½•
    â†“
â³ æ˜¾ç¤º0æ•°æ®ï¼Œæç¤º"ç­‰å¾…è€å¸ˆ/ç®¡ç†å‘˜å®¡æ ¸"
    â†“
è€å¸ˆå®¡æ ¸é€šè¿‡å
    â†“
âœ… æ˜¾ç¤ºå­©å­ç›¸å…³æ•°æ®
```

**çŠ¶æ€**:
- ğŸŸ¢ æ³¨å†Œè¡¨å•åŸºç¡€å·²å®ç°
- ğŸ”´ ParentApproval è¡¨éœ€è¦åˆ›å»º
- ğŸ”´ ParentApprovalService éœ€è¦å¼€å‘

### åœºæ™¯2: å®¶é•¿æ·»åŠ ç¬¬äºŒä¸ªå­©å­çš„å¹¼å„¿å›­ï¼ˆå¤šç§Ÿæˆ·ç»‘å®šï¼‰
```
å®¶é•¿å·²åœ¨ k001 æ³¨å†Œï¼Œç°åœ¨è®¿é—® k002.yyup.cc
    â†“
ç»Ÿä¸€è®¤è¯æˆåŠŸï¼ˆglobal_users å­˜åœ¨ï¼‰
    â†“
æ£€æŸ¥ user_tenant_relations: k002 ä¸å­˜åœ¨
    â†“
è¿”å›: { needsRegistration: true, globalUserId: xxx, isExistingUser: true }
    â†“
å‰ç«¯å¼¹å‡ºã€ç»‘å®šå¼¹çª—ã€‘ï¼ˆä¸éœ€è¦çŸ­ä¿¡éªŒè¯ï¼Œå·²éªŒè¯èº«ä»½ï¼‰
    â†“
é€‰æ‹©"å®¶é•¿"è§’è‰²ï¼Œå¡«å†™ä¿¡æ¯
    â†“
ã€åŒå†™æ“ä½œã€‘
  â€¢ ç»Ÿä¸€è®¤è¯: user_tenant_relations æ–°å¢ k002 å…³è”
  â€¢ å­æ•°æ®åº“: tenant_k002.users + ParentApproval
    â†“
â³ ç»‘å®šæˆåŠŸï¼Œç­‰å¾…å®¡æ ¸
```

**çŠ¶æ€**: ğŸ”´ éœ€è¦å¼€å‘

### åœºæ™¯3: å®¶é•¿åˆ‡æ¢ç§Ÿæˆ·
```
å®¶é•¿å·²å…³è” k001, k002 ä¸¤ä¸ªç§Ÿæˆ·
    â†“
è®¿é—® k001.yyup.cc æ—¶ï¼Œæ˜¾ç¤ºå­©å­Açš„æ•°æ®
è®¿é—® k002.yyup.cc æ—¶ï¼Œæ˜¾ç¤ºå­©å­Bçš„æ•°æ®
    â†“
ï¼ˆæ ¹æ®åŸŸåè‡ªåŠ¨åˆ‡æ¢ï¼Œæ— éœ€æ‰‹åŠ¨é€‰æ‹©ï¼‰
```

**çŠ¶æ€**: âœ… å·²å®ç°ï¼ˆé€šè¿‡åŸŸåè¯†åˆ«ç§Ÿæˆ·ï¼‰

---

## ğŸ“Š åŠŸèƒ½å®ç°çŠ¶æ€æ€»ç»“ï¼ˆæ›´æ–°ç‰ˆï¼‰

### æŒ‰æ¨¡å—åˆ†ç±»

#### 1ï¸âƒ£ ç»Ÿä¸€è®¤è¯ä¸­å¿ƒ (rent.yyup.cc)

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| æ‰‹æœºå·+å¯†ç è®¤è¯ | âœ… | `unified-auth.service.ts` |
| çŸ­ä¿¡éªŒè¯ç å‘é€ | âœ… | `sms-verification.service.ts` (å¼€å‘ç¯å¢ƒæ¨¡æ‹Ÿ) |
| çŸ­ä¿¡éªŒè¯ç éªŒè¯ | âœ… | å¼€å‘ç¯å¢ƒä½¿ç”¨ `123456` |
| å…¨å±€ç”¨æˆ·æ³¨å†Œ | âœ… | åˆ›å»º `global_users` è®°å½• |
| ç”¨æˆ·ç§Ÿæˆ·ç»‘å®š | âœ… | åˆ›å»º `user_tenant_relations` è®°å½• |
| æŸ¥è¯¢ç”¨æˆ·å…³è”ç§Ÿæˆ· | âœ… | `findUserTenants` API |
| æ£€æŸ¥æ˜¯å¦å·²ç»‘å®šç§Ÿæˆ· | ğŸ”´ | ç™»å½•æ—¶è¿”å› `needsRegistration` |

#### 2ï¸âƒ£ å­ç³»ç»Ÿç™»å½•ä¸­é—´ä»¶ (k.yyup.com)

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| è°ƒç”¨ç»Ÿä¸€è®¤è¯éªŒè¯ | âœ… | `auth.middleware.ts` |
| æŸ¥è¯¢å­æ•°æ®åº“ç”¨æˆ· | âœ… | ç¬¬232-242è¡Œ |
| ç”¨æˆ·ä¸å­˜åœ¨è‡ªåŠ¨åˆ›å»º | âŒ | å½“å‰å®ç°ï¼ˆéœ€è¦æ”¹ä¸ºè¿”å›æ³¨å†ŒçŠ¶æ€ï¼‰ |
| ç”¨æˆ·ä¸å­˜åœ¨è¿”å›çŠ¶æ€ | ğŸ”´ | éœ€è¦ä¿®æ”¹è¿”å› `needsRegistration` |
| Demoç³»ç»Ÿæœ¬åœ°è®¤è¯ | ğŸ”´ | k.yyup.cc åº”ä½¿ç”¨æœ¬åœ°è®¤è¯ |

#### 3ï¸âƒ£ æ³¨å†ŒåŒå†™é€»è¾‘ (k.yyup.com)

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| è°ƒç”¨ç»Ÿä¸€è®¤è¯æ³¨å†ŒAPI | âœ… | `auth-register.controller.ts` ç¬¬62è¡Œ |
| å­æ•°æ®åº“åˆ›å»ºç”¨æˆ· | âœ… | ç¬¬134-150è¡Œ |
| ç»‘å®šç”¨æˆ·åˆ°ç§Ÿæˆ· | âœ… | ç¬¬205-230è¡Œ |
| æ•™å¸ˆåˆ›å»ºå®¡æ ¸è®°å½• | âœ… | ç¬¬169-195è¡Œ |
| å®¶é•¿åˆ›å»ºå®¡æ ¸è®°å½• | ğŸ”´ | éœ€è¦å¼€å‘ |
| å›­é•¿åˆ›å»ºå®¡æ ¸è®°å½• | ğŸ”´ | éœ€è¦å¼€å‘ï¼ˆè‡ªä¸»ç”³è¯·åœºæ™¯ï¼‰ |

#### 4ï¸âƒ£ å®¡æ ¸æœåŠ¡

| è§’è‰² | å®¡æ ¸è¡¨ | å®¡æ ¸æœåŠ¡ | æ•°æ®è¿‡æ»¤ |
|------|-------|---------|---------|
| è€å¸ˆ | âœ… TeacherApproval | âœ… TeacherApprovalService | âœ… filterDataForTeacher |
| å®¶é•¿ | ğŸ”´ ParentApproval | ğŸ”´ ParentApprovalService | ğŸ”´ filterDataForParent |
| å›­é•¿ | ğŸ”´ PrincipalApproval | ğŸ”´ PrincipalApprovalService | ğŸ”´ (é€šå¸¸ç”±å¹³å°ç®¡ç†å‘˜å®¡æ ¸) |

#### 5ï¸âƒ£ å‰ç«¯

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| ç™»å½•é¡µé¢ | âœ… | `Login/index.vue` |
| æ³¨å†Œé¡µé¢ | âœ… | `Register.vue` |
| è§’è‰²é€‰æ‹©UI | âœ… | å·²æœ‰ |
| æ•™å¸ˆä¸“ç”¨è¡¨å• | âœ… | å¹¼å„¿å›­/ç­çº§é€‰æ‹© |
| ç™»å½•æ—¶æ³¨å†Œå¼¹çª— | ğŸ”´ | å¤„ç† `needsRegistration` å“åº” |
| ç»‘å®šå¼¹çª—ï¼ˆå·²æœ‰å…¨å±€è´¦å·ï¼‰ | ğŸ”´ | ä¸éœ€è¦çŸ­ä¿¡éªŒè¯ |
| å®¡æ ¸çŠ¶æ€æç¤º | ğŸ”´ | é¡¶éƒ¨Banneræç¤º |
| æœªå®¡æ ¸æ•°æ®è¿‡æ»¤ | ğŸ”´ | å„æ•°æ®ç»„ä»¶ |

**å›¾ä¾‹**: âœ… å·²å®ç° | ğŸ”´ éœ€è¦å¼€å‘ | âŒ éœ€è¦ä¿®æ”¹ï¼ˆå½“å‰å®ç°ä¸æ­£ç¡®ï¼‰

---

## ğŸ¨ æœªæ³¨å†Œç”¨æˆ·äº¤äº’æµç¨‹è¯¦è§£

### å‰ç«¯äº¤äº’æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç™»å½•é¡µé¢ (Login.vue)                           â”‚
â”‚                                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“± æ‰‹æœºå·: [______________]                                      â”‚  â”‚
â”‚  â”‚  ğŸ”’ å¯†ç :   [______________]                                      â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚  [      ç™»  å½•      ]                                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â†“                                     â”‚
â”‚                        ç‚¹å‡»ç™»å½•æŒ‰é’®                                    â”‚
â”‚                                  â†“                                     â”‚
â”‚                    åç«¯è¿”å› needsRegistration=true                     â”‚
â”‚                                  â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    ğŸ“‹ æ³¨å†Œå¼¹çª— (Modal)                            â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   æ‚¨çš„æ‰‹æœºå·å·²åœ¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿæ³¨å†Œï¼Œ                                 â”‚  â”‚
â”‚  â”‚   ä½†å°šæœªåœ¨ã€XXå¹¼å„¿å›­ã€‘æ³¨å†Œã€‚                                       â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   è¯·é€‰æ‹©æ‚¨çš„èº«ä»½å®Œæˆæ³¨å†Œï¼š                                        â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚  â”‚
â”‚  â”‚   â”‚  ğŸ‘¨â€ğŸ’¼    â”‚  â”‚  ğŸ‘©â€ğŸ«    â”‚  â”‚  ğŸ‘¨â€ğŸ‘©â€ğŸ‘§   â”‚                          â”‚  â”‚
â”‚  â”‚   â”‚  å›­é•¿   â”‚  â”‚  è€å¸ˆ   â”‚  â”‚  å®¶é•¿   â”‚                          â”‚  â”‚
â”‚  â”‚   â”‚         â”‚  â”‚         â”‚  â”‚         â”‚                          â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   [    ä¸‹ä¸€æ­¥    ]                                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â†“                                     â”‚
â”‚                         é€‰æ‹©è§’è‰²å                                     â”‚
â”‚                                  â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   ğŸ“ è§’è‰²ä¿¡æ¯å¡«å†™ (æ ¹æ®è§’è‰²ä¸åŒ)                   â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   ã€è€å¸ˆè§’è‰²ã€‘                                                     â”‚  â”‚
â”‚  â”‚   å¹¼å„¿å›­: [â–¼ é€‰æ‹©å¹¼å„¿å›­]                                          â”‚  â”‚
â”‚  â”‚   ç­çº§:   [â–¼ é€‰æ‹©ç­çº§  ]                                          â”‚  â”‚
â”‚  â”‚   èŒç§°:   [______________] (å¯é€‰)                                 â”‚  â”‚
â”‚  â”‚   ç§‘ç›®:   [â–¼ é€‰æ‹©ç§‘ç›®  ] (å¯é€‰/å¤šé€‰)                              â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   ã€å®¶é•¿è§’è‰²ã€‘                                                     â”‚  â”‚
â”‚  â”‚   å§“å:   [______________]                                        â”‚  â”‚
â”‚  â”‚   å…³ç³»:   [â–¼ çˆ¶äº²/æ¯äº²/å…¶ä»–]                                      â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   ã€å›­é•¿è§’è‰²ã€‘                                                     â”‚  â”‚
â”‚  â”‚   å§“å:   [______________]                                        â”‚  â”‚
â”‚  â”‚   èŒåŠ¡:   [______________]                                        â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     ğŸ“² çŸ­ä¿¡éªŒè¯                                    â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   æˆ‘ä»¬å°†å‘ 138****8000 å‘é€éªŒè¯ç                                  â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   éªŒè¯ç : [______]   [å‘é€éªŒè¯ç ]                                 â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   [    å®Œæˆæ³¨å†Œ    ]                                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     âœ… æ³¨å†ŒæˆåŠŸæç¤º                                â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   ğŸ‰ æ³¨å†ŒæˆåŠŸï¼                                                   â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   æ‚¨çš„è´¦æˆ·å·²åˆ›å»ºï¼Œä½†éœ€è¦ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ã€‚                           â”‚  â”‚
â”‚  â”‚   å®¡æ ¸é€šè¿‡å‰ï¼Œæ‚¨å¯ä»¥ç™»å½•æŸ¥çœ‹åŠŸèƒ½ï¼Œä½†æ— æ³•æŸ¥çœ‹æ•°æ®ã€‚                 â”‚  â”‚
â”‚  â”‚                                                                   â”‚  â”‚
â”‚  â”‚   [    çŸ¥é“äº†ï¼Œå»ç™»å½•    ]                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ å¼€å‘ä»»åŠ¡æ¸…å•ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰

### ğŸš¨ P0 - æ ¸å¿ƒæµç¨‹ä¿®æ”¹ï¼ˆå¿…é¡»å…ˆå®Œæˆï¼‰

#### 1. ä¿®æ”¹ç™»å½•ä¸­é—´ä»¶è¿”å›"ç”¨æˆ·ä¸å­˜åœ¨"çŠ¶æ€

**æ–‡ä»¶**: `k.yyup.com/server/src/middlewares/auth.middleware.ts`

**å½“å‰ä»£ç ** (ç¬¬247-275è¡Œ):
```typescript
if (userRows.length > 0) {
  tenantUser = userRows[0];
} else {
  // âŒ å½“å‰ï¼šè‡ªåŠ¨åˆ›å»ºç”¨æˆ·
  const [insertResult] = await sequelizeInstance.query(`
    INSERT INTO ${tenantDatabaseName}.users ...
  `);
}
```

**ä¿®æ”¹ä¸º**:
```typescript
if (userRows.length > 0) {
  tenantUser = userRows[0];
} else {
  // âœ… è¿”å›éœ€è¦æ³¨å†Œçš„çŠ¶æ€
  return res.json({
    success: true,
    message: 'ç”¨æˆ·å·²é€šè¿‡ç»Ÿä¸€è®¤è¯ï¼Œä½†å°šæœªåœ¨æ­¤ç§Ÿæˆ·æ³¨å†Œ',
    data: {
      needsRegistration: true,
      globalUserId: globalUser.id,
      phone: globalUser.phone,
      realName: globalUser.realName,
      tenantCode: tenantCode,
      tenantName: 'XXå¹¼å„¿å›­', // ä»ç§Ÿæˆ·é…ç½®è·å–
      availableRoles: ['principal', 'teacher', 'parent']
    }
  });
}
```

#### 2. Demoç³»ç»Ÿæœ¬åœ°è®¤è¯

**æ–‡ä»¶**: `k.yyup.com/server/src/middlewares/tenant-resolver.middleware.ts`

**æ·»åŠ **: è¯†åˆ« `k.yyup.cc` ä¸ºDemoç³»ç»Ÿï¼Œä½¿ç”¨ `kardersales` æ•°æ®åº“ï¼Œè·³è¿‡ç»Ÿä¸€è®¤è¯

```typescript
// åœ¨ tenantResolverMiddleware ä¸­æ·»åŠ 
const isDemoSystem = domain === 'k.yyup.cc' || domain.includes('localhost');

if (isDemoSystem) {
  req.isDemoSystem = true;
  req.tenantDatabase = 'kardersales';
  // Demoç³»ç»Ÿä½¿ç”¨æœ¬åœ°è®¤è¯
}
```

#### 3. ç»Ÿä¸€è®¤è¯æ·»åŠ "æ£€æŸ¥ç§Ÿæˆ·ç»‘å®š"é€»è¾‘

**æ–‡ä»¶**: `unified-tenant-system/server/src/services/unified-auth.service.ts`

**åœ¨ç™»å½•éªŒè¯æˆåŠŸåæ·»åŠ **:
```typescript
// éªŒè¯æˆåŠŸåï¼Œæ£€æŸ¥æ˜¯å¦ç»‘å®šäº†è¯·æ±‚çš„ç§Ÿæˆ·
async checkTenantBinding(globalUserId: string, tenantCode: string): Promise<boolean> {
  const [relations] = await sequelize.query(`
    SELECT id FROM user_tenant_relations
    WHERE global_user_id = ? AND tenant_code = ? AND status = 'active'
  `, { replacements: [globalUserId, tenantCode] });

  return relations.length > 0;
}
```

### ï¿½ P0-4: æ–°å¢ç»‘å®šç§Ÿæˆ·æ¥å£ï¼ˆæƒ…å†µBä¸“ç”¨ï¼‰

**æ–‡ä»¶**: `k.yyup.com/server/src/controllers/auth-bind-tenant.controller.ts` (æ–°å»º)

**åœºæ™¯**: ç”¨æˆ·å·²æœ‰å…¨å±€è´¦å·ï¼Œç™»å½•æ—¶å‘ç°æœªç»‘å®šå½“å‰ç§Ÿæˆ·

**æ¥å£è®¾è®¡**:
```typescript
// POST /api/auth/bind-tenant
// ä¸éœ€è¦çŸ­ä¿¡éªŒè¯ï¼ˆç”¨æˆ·å·²é€šè¿‡å¯†ç éªŒè¯ï¼‰
interface BindTenantRequest {
  globalUserId: string;     // æ¥è‡ªç™»å½•å“åº”
  role: 'principal' | 'teacher' | 'parent';
  // è§’è‰²ç›¸å…³ä¿¡æ¯
  kindergartenId?: number;  // æ•™å¸ˆå¿…å¡«
  classId?: number;         // æ•™å¸ˆå¿…å¡«
  relationship?: string;    // å®¶é•¿å¡«å†™
}

interface BindTenantResponse {
  success: boolean;
  data: {
    userId: number;         // å­æ•°æ®åº“ç”¨æˆ·ID
    approvalStatus: 'pending' | 'approved';
    token: string;          // ç™»å½•token
  }
}
```

**å®ç°é€»è¾‘**:
```typescript
export const bindTenant = async (req: Request, res: Response) => {
  const { globalUserId, role, kindergartenId, classId, relationship } = req.body;
  const tenantCode = req.tenant?.code;

  // Step 1: è°ƒç”¨ç»Ÿä¸€è®¤è¯ç»‘å®šç§Ÿæˆ·
  await axios.post(`${UNIFIED_AUTH_URL}/api/v1/tenants/bind`, {
    globalUserId, tenantCode, role
  });

  // Step 2: åœ¨å­æ•°æ®åº“åˆ›å»ºç”¨æˆ·
  const newUser = await User.create({ global_user_id: globalUserId, ... });

  // Step 3: åˆ›å»ºå®¡æ ¸è®°å½•
  if (role === 'teacher') {
    await TeacherApprovalService.createTeacherRequest({...});
  } else if (role === 'parent') {
    await ParentApprovalService.createParentRequest({...});
  }

  // Step 4: è¿”å›ç™»å½•token
  return res.json({ success: true, data: { userId: newUser.id, token } });
};
```

---

### ï¿½ğŸ”¶ P1 - å®¶é•¿å®¡æ ¸ç³»ç»Ÿ

#### 5. åˆ›å»ºå®¶é•¿å®¡æ ¸è¡¨

**æ–°å»ºæ–‡ä»¶**: `k.yyup.com/server/src/models/parent-approval.model.ts`

```typescript
// å‚è€ƒ teacher-approval.model.ts ç»“æ„
export interface ParentApprovalAttributes {
  id: number;
  parentId: number;           // å…³è” users è¡¨
  studentId?: number;         // å…³è”çš„å­¦ç”Ÿï¼ˆå¯é€‰ï¼Œåç»­ç»‘å®šï¼‰
  kindergartenId: number;
  status: 'pending' | 'approved' | 'rejected';
  relationship: string;       // ä¸å­©å­å…³ç³»
  approvedBy?: number;
  approvedAt?: Date;
  createdAt: Date;
  updatedAt: Date;
}
```

#### 5. åˆ›å»ºå®¶é•¿å®¡æ ¸æœåŠ¡

**æ–°å»ºæ–‡ä»¶**: `k.yyup.com/server/src/services/parent-approval.service.ts`

```typescript
export class ParentApprovalService {
  static async createParentRequest(params: {...}): Promise<ParentApproval>
  static async checkParentPermission(parentId: number): Promise<{hasFullAccess: boolean}>
  static async approveParent(approvalId: number, approvedBy: number): Promise<void>
  static async filterDataForParent<T>(parentId: number, data: T[]): Promise<T[]>
}
```

#### 6. ä¿®æ”¹æ³¨å†Œæ§åˆ¶å™¨

**æ–‡ä»¶**: `k.yyup.com/server/src/controllers/auth-register.controller.ts`

**åœ¨ç¬¬195è¡Œåæ·»åŠ **:
```typescript
// å¦‚æœæ˜¯å®¶é•¿æ³¨å†Œï¼Œåˆ›å»ºå®¶é•¿å®¡æ ¸ç”³è¯·
if (role === 'parent') {
  await ParentApprovalService.createParentRequest({
    parentId: newUser.id,
    kindergartenId: kindergartenId,
    relationship: relationship || 'å®¶é•¿',
    // studentId åç»­ç»‘å®š
  });
  console.log('[ç”¨æˆ·æ³¨å†Œ] å®¶é•¿å®¡æ ¸ç”³è¯·åˆ›å»ºæˆåŠŸ');
}
```

### ğŸ”· P2 - å‰ç«¯äº¤äº’

#### 7. ç™»å½•é¡µé¢å¤„ç† needsRegistration

**æ–‡ä»¶**: `k.yyup.com/client/src/pages/Login/index.vue`

```typescript
const handleLoginResponse = async (response) => {
  if (response.data?.needsRegistration) {
    // ä¿å­˜å…¨å±€ç”¨æˆ·ä¿¡æ¯
    pendingRegistration.value = {
      globalUserId: response.data.globalUserId,
      phone: response.data.phone,
      realName: response.data.realName,
      tenantCode: response.data.tenantCode,
      tenantName: response.data.tenantName,
    };
    // æ˜¾ç¤ºè§’è‰²é€‰æ‹©å¼¹çª—
    showRoleSelectionModal.value = true;
    return;
  }
  // ... æ­£å¸¸ç™»å½•æµç¨‹
};
```

#### 8. æ–°å»ºè§’è‰²é€‰æ‹©å¼¹çª—ç»„ä»¶

**æ–°å»ºæ–‡ä»¶**: `k.yyup.com/client/src/components/RoleSelectionModal.vue`

#### 9. æ–°å»ºç»‘å®šè¡¨å•ç»„ä»¶

**æ–°å»ºæ–‡ä»¶**: `k.yyup.com/client/src/components/TenantBindingForm.vue`

### ğŸ”¹ P3 - å®Œå–„åŠŸèƒ½

#### 10. å®¡æ ¸çŠ¶æ€æç¤ºç»„ä»¶

**æ–°å»ºæ–‡ä»¶**: `k.yyup.com/client/src/components/ApprovalStatusBanner.vue`

#### 11. å›­é•¿å®¡æ ¸æœåŠ¡ï¼ˆè‡ªä¸»ç”³è¯·åœºæ™¯ï¼‰

**æ–°å»ºæ–‡ä»¶**: `k.yyup.com/server/src/services/principal-approval.service.ts`

---

---

## ğŸ“± ç§»åŠ¨ç«¯æ³¨å†ŒéªŒè¯é€»è¾‘

### ç§»åŠ¨ç«¯ä»£ç ç»“æ„

| ä½ç½® | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| `k.yyup.com/client/aimobile/pages/MobileLogin.vue` | ç§»åŠ¨ç«¯ç™»å½•é¡µ | âœ… å·²æœ‰ |
| `k.yyup.com/client/aimobile/api/unified-auth.ts` | ç»Ÿä¸€è®¤è¯API | âœ… å·²æœ‰ |
| `k.yyup.com/client/aimobile/stores/unified-auth.ts` | è®¤è¯çŠ¶æ€ç®¡ç† | âœ… å·²æœ‰ |
| `k.yyup.com/client/aimobile/router/mobile.routes.ts` | ç§»åŠ¨ç«¯è·¯ç”± | âœ… å·²æœ‰ |
| `k.yyup.com/client/aimobile/pages/MobileRegister.vue` | ç§»åŠ¨ç«¯æ³¨å†Œé¡µ | ğŸ”´ å¾…å¼€å‘ |

### ç§»åŠ¨ç«¯å·²æœ‰åŠŸèƒ½

1. **ç»Ÿä¸€è®¤è¯API** (`unified-auth.ts`)
   - `register()` - ç”¨æˆ·æ³¨å†Œ
   - `findUserTenants()` - æŸ¥æ‰¾ç”¨æˆ·å…³è”ç§Ÿæˆ·
   - `bindUserToTenant()` - ç»‘å®šç”¨æˆ·åˆ°ç§Ÿæˆ·
   - `loginWithCode()` - éªŒè¯ç ç™»å½•

2. **ç™»å½•é¡µé¢** (`MobileLogin.vue`)
   - ç”¨æˆ·åå¯†ç ç™»å½•
   - å¿«é€Ÿç™»å½•æŒ‰é’®ï¼ˆå›­é•¿/æ•™å¸ˆ/å®¶é•¿ï¼‰
   - ç™»å½•æˆåŠŸåä¿å­˜token

### ç§»åŠ¨ç«¯å¾…å¼€å‘åŠŸèƒ½

#### ğŸ”´ M-1: æ–°å»ºç§»åŠ¨ç«¯æ³¨å†Œé¡µé¢

**æ–‡ä»¶**: `k.yyup.com/client/aimobile/pages/MobileRegister.vue`

```vue
<template>
  <div class="mobile-register-container">
    <!-- è§’è‰²é€‰æ‹© -->
    <div class="role-selection" v-if="step === 'role'">
      <h2>è¯·é€‰æ‹©æ‚¨çš„èº«ä»½</h2>
      <div class="role-cards">
        <div class="role-card" @click="selectRole('principal')">
          <span class="role-icon">ğŸ‘¨â€ğŸ’¼</span>
          <span class="role-name">å›­é•¿</span>
        </div>
        <div class="role-card" @click="selectRole('teacher')">
          <span class="role-icon">ğŸ“š</span>
          <span class="role-name">æ•™å¸ˆ</span>
        </div>
        <div class="role-card" @click="selectRole('parent')">
          <span class="role-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
          <span class="role-name">å®¶é•¿</span>
        </div>
      </div>
    </div>

    <!-- æ³¨å†Œè¡¨å• -->
    <div class="register-form" v-if="step === 'form'">
      <!-- æ‰‹æœºå·è¾“å…¥ -->
      <!-- çŸ­ä¿¡éªŒè¯ç  -->
      <!-- å¯†ç è®¾ç½® -->
      <!-- è§’è‰²ç›¸å…³ä¿¡æ¯(æ•™å¸ˆ:ç­çº§é€‰æ‹©, å®¶é•¿:å­©å­å…³ç³») -->
    </div>
  </div>
</template>
```

#### ğŸ”´ M-2: ä¿®æ”¹ç§»åŠ¨ç«¯ç™»å½•å¤„ç† needsRegistration

**æ–‡ä»¶**: `k.yyup.com/client/aimobile/pages/MobileLogin.vue`

```typescript
// åœ¨ handleLogin å‡½æ•°ä¸­å¤„ç† needsRegistration
const handleLogin = async () => {
  // ... ç°æœ‰ä»£ç 

  if (response.success && response.data) {
    // ğŸ”´ æ–°å¢: æ£€æŸ¥æ˜¯å¦éœ€è¦æ³¨å†Œ
    if (response.data.needsRegistration) {
      // ä¿å­˜å…¨å±€ç”¨æˆ·ä¿¡æ¯ç”¨äºåç»­ç»‘å®š
      sessionStorage.setItem('pending_registration', JSON.stringify({
        globalUserId: response.data.globalUserId,
        phone: response.data.phone,
        realName: response.data.realName,
        tenantCode: response.data.tenantCode
      }))
      // è·³è½¬åˆ°æ³¨å†Œé¡µé¢
      router.push('/mobile/register')
      return
    }

    // æ£€æŸ¥å®¡æ ¸çŠ¶æ€
    if (response.data.approvalStatus === 'pending') {
      // æ˜¾ç¤ºå®¡æ ¸ä¸­æç¤º
      showApprovalPendingTip()
    }

    await processLoginSuccess(response.data)
  }
}
```

#### ğŸ”´ M-3: æ·»åŠ ç§»åŠ¨ç«¯æ³¨å†Œè·¯ç”±

**æ–‡ä»¶**: `k.yyup.com/client/aimobile/router/mobile.routes.ts`

```typescript
// æ·»åŠ æ³¨å†Œè·¯ç”±
{
  path: '/mobile/register',
  name: 'MobileRegister',
  component: () => import('../pages/MobileRegister.vue'),
  meta: {
    title: 'ç”¨æˆ·æ³¨å†Œ',
    requiresAuth: false,
    hideHeader: true,
    hideTabbar: true
  }
}
```

#### ğŸ”´ M-4: æ·»åŠ è§’è‰²é€‰æ‹©å¼¹çª—ç»„ä»¶

**æ–‡ä»¶**: `k.yyup.com/client/aimobile/components/RoleSelectionSheet.vue`

```vue
<!-- åº•éƒ¨å¼¹å‡ºçš„è§’è‰²é€‰æ‹©ç»„ä»¶ -->
<template>
  <van-action-sheet
    v-model:show="visible"
    title="è¯·é€‰æ‹©æ‚¨çš„èº«ä»½"
    :closeable="false"
    :close-on-click-overlay="false"
  >
    <div class="role-options">
      <div v-for="role in roles" :key="role.key" @click="selectRole(role.key)">
        <!-- è§’è‰²å¡ç‰‡ -->
      </div>
    </div>
  </van-action-sheet>
</template>
```

### ç§»åŠ¨ç«¯å¼€å‘å·¥æ—¶

| ä»»åŠ¡ | å·¥æ—¶ |
|------|------|
| M-1: ç§»åŠ¨ç«¯æ³¨å†Œé¡µé¢ | 6h |
| M-2: ç™»å½•å¤„ç† needsRegistration | 2h |
| M-3: æ·»åŠ æ³¨å†Œè·¯ç”± | 0.5h |
| M-4: è§’è‰²é€‰æ‹©å¼¹çª—ç»„ä»¶ | 3h |
| M-5: ç»‘å®šå·²æœ‰è´¦å·è¡¨å• | 3h |
| **ç§»åŠ¨ç«¯å°è®¡** | **14.5h** |

---

## â±ï¸ å¼€å‘å·¥æ—¶ä¼°ç®—ï¼ˆæ›´æ–°ç‰ˆï¼‰

### PCç«¯ä»»åŠ¡

| é˜¶æ®µ | ä»»åŠ¡ | å·¥æ—¶ | ä¾èµ– |
|------|------|------|------|
| **P0-1** | ä¿®æ”¹ auth.middleware.ts è¿”å› needsRegistration | 2h | æ—  |
| **P0-2** | Demoç³»ç»Ÿæœ¬åœ°è®¤è¯ | 2h | æ—  |
| **P0-3** | ç»Ÿä¸€è®¤è¯æ£€æŸ¥ç§Ÿæˆ·ç»‘å®š | 1h | æ—  |
| **P0-4** | æ–°å¢ç»‘å®šç§Ÿæˆ·æ¥å£ `/api/auth/bind-tenant` | 2h | P0-1 |
| **P1-1** | ParentApproval è¡¨å’Œæ¨¡å‹ | 2h | æ—  |
| **P1-2** | ParentApprovalService | 3h | P1-1 |
| **P1-3** | ä¿®æ”¹æ³¨å†Œæ§åˆ¶å™¨ï¼ˆå®¶é•¿å®¡æ ¸ï¼‰ | 1h | P1-2 |
| **P2-1** | PCå‰ç«¯å¤„ç† needsRegistration | 2h | P0-1 |
| **P2-2** | è§’è‰²é€‰æ‹©å¼¹çª—ç»„ä»¶ | 4h | P2-1 |
| **P2-3** | ç»‘å®šè¡¨å•ç»„ä»¶ | 3h | P2-2 |
| **P3-1** | å®¡æ ¸çŠ¶æ€æç¤ºç»„ä»¶ | 2h | P1-2 |
| **PCç«¯å°è®¡** | | **24h** | |

### ç§»åŠ¨ç«¯ä»»åŠ¡

| é˜¶æ®µ | ä»»åŠ¡ | å·¥æ—¶ | ä¾èµ– |
|------|------|------|------|
| **M-1** | ç§»åŠ¨ç«¯æ³¨å†Œé¡µé¢ `MobileRegister.vue` | 6h | P0-1 |
| **M-2** | ç§»åŠ¨ç«¯ç™»å½•å¤„ç† needsRegistration | 2h | P0-1 |
| **M-3** | æ·»åŠ ç§»åŠ¨ç«¯æ³¨å†Œè·¯ç”± | 0.5h | M-1 |
| **M-4** | è§’è‰²é€‰æ‹©å¼¹çª—ç»„ä»¶ `RoleSelectionSheet.vue` | 3h | M-1 |
| **M-5** | ç»‘å®šå·²æœ‰è´¦å·è¡¨å• | 3h | M-4 |
| **ç§»åŠ¨ç«¯å°è®¡** | | **14.5h** | |

### æµ‹è¯•ä»»åŠ¡

| é˜¶æ®µ | ä»»åŠ¡ | å·¥æ—¶ | ä¾èµ– |
|------|------|------|------|
| **T-1** | PCç«¯å…¨æµç¨‹æµ‹è¯• | 2h | PCç«¯å…¨éƒ¨ |
| **T-2** | ç§»åŠ¨ç«¯å…¨æµç¨‹æµ‹è¯• | 2h | ç§»åŠ¨ç«¯å…¨éƒ¨ |
| **T-3** | è·¨ç«¯ä¸€è‡´æ€§æµ‹è¯• | 2h | T-1, T-2 |
| **æµ‹è¯•å°è®¡** | | **6h** | |

### æ€»è®¡

| ç±»åˆ« | å·¥æ—¶ |
|------|------|
| PCç«¯ | 24h |
| ç§»åŠ¨ç«¯ | 14.5h |
| æµ‹è¯• | 6h |
| **æ€»è®¡** | **44.5h** |

---

## ğŸ“ å·²æœ‰ä»£ç å¯å¤ç”¨éƒ¨åˆ†

### 1. æ³¨å†Œè¡¨å• (å·²æœ‰)
**ä½ç½®**: `k.yyup.com/client/src/pages/Register.vue`

å·²æœ‰è§’è‰²é€‰æ‹©å’Œæ•™å¸ˆä¸“ç”¨å­—æ®µï¼Œå¯ä»¥ç›´æ¥å¤ç”¨åˆ°å¼¹çª—ç»„ä»¶ã€‚

### 2. æ•™å¸ˆå®¡æ ¸æœåŠ¡ (å·²æœ‰)
**ä½ç½®**: `k.yyup.com/server/src/services/teacher-approval.service.ts`

å¯ä»¥ä½œä¸º ParentApprovalService çš„æ¨¡æ¿ã€‚

### 3. æ³¨å†Œæ§åˆ¶å™¨åŒå†™é€»è¾‘ (å·²æœ‰)
**ä½ç½®**: `k.yyup.com/server/src/controllers/auth-register.controller.ts`

å®Œæ•´çš„åŒå†™æµç¨‹å·²å®ç°ï¼Œåªéœ€æ·»åŠ å®¶é•¿å®¡æ ¸è®°å½•åˆ›å»ºã€‚

### 4. çŸ­ä¿¡éªŒè¯æœåŠ¡ (å·²æœ‰)
**ä½ç½®**: `unified-tenant-system/server/src/services/sms-verification.service.ts`

å¼€å‘ç¯å¢ƒä½¿ç”¨ `123456` ä½œä¸ºæµ‹è¯•éªŒè¯ç ã€‚

### 5. ç»Ÿä¸€è®¤è¯ç”¨æˆ·ç»‘å®šç§Ÿæˆ· (å·²æœ‰)
**ä½ç½®**: `unified-tenant-system/server/src/services/unified-auth.service.ts`

`bindUserToTenant` æ–¹æ³•å·²å®ç°ã€‚

---

## ğŸ¯ å¼€å‘å»ºè®®

### å»ºè®®çš„å¼€å‘é¡ºåº

```
ç¬¬1å¤© (P0):
â”œâ”€â”€ ä¿®æ”¹ auth.middleware.ts è¿”å› needsRegistration
â”œâ”€â”€ æ·»åŠ  Demo ç³»ç»Ÿæœ¬åœ°è®¤è¯
â””â”€â”€ æµ‹è¯•ç™»å½•è¿”å›çŠ¶æ€

ç¬¬2å¤© (P1-åç«¯):
â”œâ”€â”€ åˆ›å»º ParentApproval æ¨¡å‹
â”œâ”€â”€ åˆ›å»º ParentApprovalService
â””â”€â”€ ä¿®æ”¹æ³¨å†Œæ§åˆ¶å™¨

ç¬¬3å¤© (P2-å‰ç«¯):
â”œâ”€â”€ å‰ç«¯å¤„ç† needsRegistration å“åº”
â”œâ”€â”€ åˆ›å»ºè§’è‰²é€‰æ‹©å¼¹çª—ç»„ä»¶
â””â”€â”€ åˆ›å»ºç»‘å®šè¡¨å•ç»„ä»¶

ç¬¬4å¤© (P3+æµ‹è¯•):
â”œâ”€â”€ å®¡æ ¸çŠ¶æ€æç¤ºç»„ä»¶
â”œâ”€â”€ å…¨æµç¨‹æµ‹è¯•
â””â”€â”€ ä¿®å¤é—®é¢˜
```

### å…³é”®æ³¨æ„äº‹é¡¹

1. **ä¸è¦ç ´åç°æœ‰ç™»å½•æµç¨‹** - åªåœ¨ç”¨æˆ·ä¸å­˜åœ¨æ—¶è¿”å› needsRegistration
2. **ä¿æŒåŒå†™ä¸€è‡´æ€§** - ç»Ÿä¸€è®¤è¯å’Œå­æ•°æ®åº“å¿…é¡»åŒæ—¶æˆåŠŸ
3. **çŸ­ä¿¡éªŒè¯åœ¨ç»Ÿä¸€è®¤è¯** - ä¸è¦åœ¨å­ç³»ç»Ÿé‡å¤å®ç°
4. **å®¡æ ¸åœ¨å­æ•°æ®åº“** - ä¸šåŠ¡é€»è¾‘ä¸è®¤è¯åˆ†ç¦»

---

## ğŸ“‹ æœ€ç»ˆç¡®è®¤æ¸…å•

åœ¨å¼€å§‹å¼€å‘å‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹ç†è§£æ˜¯å¦æ­£ç¡®ï¼š

| ç¡®è®¤é¡¹ | ç†è§£ | çŠ¶æ€ |
|--------|------|------|
| Demoç³»ç»ŸåŸŸå | `k.yyup.cc` ä½¿ç”¨æœ¬åœ°è®¤è¯ï¼Œæ•°æ®åº“ `kardersales` | â“ |
| ç§Ÿæˆ·ç³»ç»ŸåŸŸå | `k001.yyup.cc` ç­‰ä½¿ç”¨ç»Ÿä¸€è®¤è¯ | â“ |
| æ³¨å†ŒåŒå†™ | ç»Ÿä¸€è®¤è¯ + å­æ•°æ®åº“åŒæ—¶åˆ›å»ºè®°å½• | âœ… |
| çŸ­ä¿¡éªŒè¯ | åœ¨ç»Ÿä¸€è®¤è¯ä¸­å¿ƒå®Œæˆ | âœ… |
| å®¡æ ¸æµç¨‹ | åœ¨å­æ•°æ®åº“å®Œæˆï¼Œè€å¸ˆå·²æœ‰ï¼Œå®¶é•¿éœ€å¼€å‘ | âœ… |
| å®¶é•¿å¤šç§Ÿæˆ· | ä¸€ä¸ªæ‰‹æœºå·å¯å…³è”å¤šä¸ªå¹¼å„¿å›­ | âœ… |
| ç”¨æˆ·ä¸å­˜åœ¨ | è¿”å› needsRegistration è€Œéè‡ªåŠ¨åˆ›å»º | âœ… |

**è¯·ç¡®è®¤åï¼Œæˆ‘å¯ä»¥å¼€å§‹æŒ‰ä¼˜å…ˆçº§å®ç°è¿™äº›ä¿®æ”¹ã€‚**
