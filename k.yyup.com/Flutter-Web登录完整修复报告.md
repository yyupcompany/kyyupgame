# Flutter Webç™»å½•å®Œæ•´ä¿®å¤æŠ¥å‘Š

## âœ… æ‰€æœ‰ä¿®å¤å·²å®Œæˆ

### ä¿®å¤å†…å®¹æ€»ç»“

---

## ğŸ”§ ä¿®å¤1: APIå“åº”æ•°æ®ç»“æ„å¤„ç†

### é—®é¢˜
Flutter Webæ²¡æœ‰æ­£ç¡®å¤„ç†åç«¯APIçš„å“åº”æ•°æ®ç»“æ„ï¼Œå¯¼è‡´tokenæ— æ³•ä¿å­˜ã€‚

### ä¿®å¤æ–‡ä»¶
`mobileflutter/teacher_app/lib/data/datasources/api_service.dart`

### ä¿®å¤å†…å®¹

#### loginæ–¹æ³•
```dart
// âœ… ä¿®å¤å
Future<Map<String, dynamic>> login(Map<String, dynamic> request) async {
  print('ğŸ” å‘é€ç™»å½•è¯·æ±‚: ${request['username']}');
  final response = await _dio.post(ApiPaths.login, data: request);
  
  print('ğŸ“¡ ç™»å½•å“åº”çŠ¶æ€ç : ${response.statusCode}');
  print('ğŸ“¦ ç™»å½•å“åº”æ•°æ®: ${response.data}');
  
  if (response.statusCode == 200) {
    final responseData = response.data;
    
    // âœ… æ­£ç¡®å¤„ç†åç«¯è¿”å›æ ¼å¼: { success: true, data: { token: "xxx", user: {...} } }
    if (responseData['success'] == true && responseData['data'] != null) {
      final loginData = responseData['data'];
      
      // âœ… ä»dataä¸­æå–token
      if (loginData['token'] != null) {
        print('ğŸ’¾ ä¿å­˜token: ${loginData['token'].substring(0, 20)}...');
        await saveToken(loginData['token']);
        
        // âœ… ä¿å­˜ç”¨æˆ·ä¿¡æ¯
        if (loginData['user'] != null) {
          print('ğŸ’¾ ä¿å­˜ç”¨æˆ·ä¿¡æ¯: ${loginData['user']['username']}');
          await _saveUserInfo(UserModel.fromJson(loginData['user']));
        }
      }
      
      return {
        'success': true,
        'token': loginData['token'],
        'user': loginData['user'],
        'message': responseData['message'] ?? 'ç™»å½•æˆåŠŸ'
      };
    }
  }
}
```

#### getProfileæ–¹æ³•
```dart
// âœ… ä¿®å¤å
Future<UserModel> getProfile() async {
  print('ğŸ‘¤ è·å–ç”¨æˆ·ä¿¡æ¯...');
  final response = await _dio.get(ApiPaths.profile);
  
  print('ğŸ“¡ ç”¨æˆ·ä¿¡æ¯å“åº”çŠ¶æ€ç : ${response.statusCode}');
  print('ğŸ“¦ ç”¨æˆ·ä¿¡æ¯å“åº”æ•°æ®: ${response.data}');
  
  if (response.statusCode == 200) {
    final responseData = response.data;
    
    // âœ… æ­£ç¡®å¤„ç†: { success: true, data: { user: {...}, roles: [...], permissions: [...] } }
    if (responseData['success'] == true && responseData['data'] != null) {
      final profileData = responseData['data'];
      
      // âœ… ç”¨æˆ·ä¿¡æ¯åœ¨data.userä¸­
      if (profileData['user'] != null) {
        print('âœ… æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯: ${profileData['user']['username']}');
        return UserModel.fromJson(profileData['user']);
      }
    }
  }
}
```

---

## ğŸ”§ ä¿®å¤2: ç™»å½•é¡µé¢æ¼”ç¤ºè´¦å·

### é—®é¢˜
ç™»å½•é¡µé¢æ˜¾ç¤ºçš„æ¼”ç¤ºè´¦å·ä¿¡æ¯ä¸æ­£ç¡®ã€‚

### ä¿®å¤æ–‡ä»¶
`mobileflutter/teacher_app/lib/presentation/pages/auth/login_page.dart`

### ä¿®å¤å†…å®¹

**ä¿®å¤å‰**:
```dart
Text(
  'é‚®ç®±: teacher@demo.com\nå¯†ç : 123456',
  style: TextStyle(
    fontSize: 12.sp,
    color: AppTheme.textSecondary,
  ),
),
```

**ä¿®å¤å**:
```dart
Text(
  'ç”¨æˆ·å: admin\nå¯†ç : admin123',
  style: TextStyle(
    fontSize: 12.sp,
    color: AppTheme.textSecondary,
  ),
),
```

**å¿«æ·å¡«å……åŠŸèƒ½**ï¼ˆå·²ç»æ˜¯æ­£ç¡®çš„ï¼‰:
```dart
GestureDetector(
  onTap: () {
    _usernameController.text = 'admin';
    _passwordController.text = 'admin123';
  },
  child: Text(
    'ç‚¹å‡»å¡«å……æ¼”ç¤ºè´¦æˆ·',
    style: TextStyle(
      fontSize: 12.sp,
      color: AppTheme.primaryColor,
      decoration: TextDecoration.underline,
    ),
  ),
),
```

---

## ğŸ“‹ æµ‹è¯•è´¦å·

| è§’è‰² | ç”¨æˆ·å | å¯†ç  |
|------|--------|------|
| ç³»ç»Ÿç®¡ç†å‘˜ | `admin` | `admin123` |
| æµ‹è¯•ç®¡ç†å‘˜ | `test_admin` | `admin123` |
| æµ‹è¯•æ•™å¸ˆ | `test_teacher` | `admin123` |
| æµ‹è¯•å®¶é•¿ | `test_parent` | `admin123` |

---

## ğŸ¯ æµ‹è¯•æ­¥éª¤

### æ–¹æ³•1: ä½¿ç”¨å¿«æ·å¡«å……ï¼ˆæ¨èï¼‰

1. **è®¿é—®ç™»å½•é¡µé¢**
   ```
   http://localhost:8080/#/login
   ```

2. **ç‚¹å‡»"ç‚¹å‡»å¡«å……æ¼”ç¤ºè´¦æˆ·"**
   - è‡ªåŠ¨å¡«å……ç”¨æˆ·åï¼š`admin`
   - è‡ªåŠ¨å¡«å……å¯†ç ï¼š`admin123`

3. **ç‚¹å‡»"ç™»å½•"æŒ‰é’®**

4. **æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—**
   ```
   ğŸ” å‘é€ç™»å½•è¯·æ±‚: admin
   ğŸ“¡ ç™»å½•å“åº”çŠ¶æ€ç : 200
   ğŸ“¦ ç™»å½•å“åº”æ•°æ®: {success: true, data: {...}}
   ğŸ’¾ ä¿å­˜token: eyJhbGciOiJIUzI1NiIsInR5...
   ğŸ’¾ ä¿å­˜ç”¨æˆ·ä¿¡æ¯: admin
   ğŸ‘¤ è·å–ç”¨æˆ·ä¿¡æ¯...
   ğŸ“¡ ç”¨æˆ·ä¿¡æ¯å“åº”çŠ¶æ€ç : 200
   âœ… æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯: admin
   ```

5. **éªŒè¯ç™»å½•æˆåŠŸ**
   - âœ… è·³è½¬åˆ°ä»ªè¡¨æ¿é¡µé¢
   - âœ… æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
   - âœ… ä¸å†å‡ºç°401é”™è¯¯

---

### æ–¹æ³•2: æ‰‹åŠ¨è¾“å…¥

1. **è®¿é—®ç™»å½•é¡µé¢**
   ```
   http://localhost:8080/#/login
   ```

2. **æ‰‹åŠ¨è¾“å…¥è´¦å·**
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼š`admin123`

3. **ç‚¹å‡»"ç™»å½•"æŒ‰é’®**

4. **éªŒè¯ç™»å½•æˆåŠŸ**
   - âœ… è·³è½¬åˆ°ä»ªè¡¨æ¿é¡µé¢
   - âœ… æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯

---

## ğŸ” è°ƒè¯•æ—¥å¿—è¯´æ˜

### æˆåŠŸç™»å½•çš„æ—¥å¿—æµç¨‹

```
1. ğŸ” å‘é€ç™»å½•è¯·æ±‚: admin
   - ç”¨æˆ·ç‚¹å‡»ç™»å½•æŒ‰é’®
   - å‘é€POSTè¯·æ±‚åˆ° /api/auth/login

2. ğŸ“¡ ç™»å½•å“åº”çŠ¶æ€ç : 200
   - åç«¯æˆåŠŸå¤„ç†è¯·æ±‚
   - è¿”å›200çŠ¶æ€ç 

3. ğŸ“¦ ç™»å½•å“åº”æ•°æ®: {success: true, data: {token: "...", user: {...}}}
   - åç«¯è¿”å›æ ‡å‡†æ ¼å¼æ•°æ®
   - åŒ…å«tokenå’Œç”¨æˆ·ä¿¡æ¯

4. ğŸ’¾ ä¿å­˜token: eyJhbGciOiJIUzI1NiIsInR5...
   - tokenæˆåŠŸä¿å­˜åˆ°SharedPreferences
   - åç»­è¯·æ±‚ä¼šè‡ªåŠ¨æºå¸¦æ­¤token

5. ğŸ’¾ ä¿å­˜ç”¨æˆ·ä¿¡æ¯: admin
   - ç”¨æˆ·ä¿¡æ¯æˆåŠŸä¿å­˜
   - åŒ…å«ç”¨æˆ·åã€è§’è‰²ç­‰ä¿¡æ¯

6. ğŸ‘¤ è·å–ç”¨æˆ·ä¿¡æ¯...
   - ç™»å½•æˆåŠŸåè‡ªåŠ¨è·å–å®Œæ•´ç”¨æˆ·ä¿¡æ¯
   - éªŒè¯tokenæ˜¯å¦æœ‰æ•ˆ

7. ğŸ“¡ ç”¨æˆ·ä¿¡æ¯å“åº”çŠ¶æ€ç : 200
   - tokenéªŒè¯æˆåŠŸ
   - è¿”å›ç”¨æˆ·è¯¦ç»†ä¿¡æ¯

8. âœ… æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯: admin
   - ç”¨æˆ·ä¿¡æ¯è·å–æˆåŠŸ
   - ç™»å½•æµç¨‹å®Œæˆ
```

---

## âŒ å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1: 401 Unauthorized

**åŸå› **: tokenæ²¡æœ‰æ­£ç¡®ä¿å­˜æˆ–æºå¸¦

**è§£å†³æ–¹æ¡ˆ**: 
- âœ… å·²ä¿®å¤ï¼šæ­£ç¡®æå–å¹¶ä¿å­˜token
- âœ… å·²ä¿®å¤ï¼šæ‹¦æˆªå™¨è‡ªåŠ¨æ·»åŠ Authorizationå¤´

---

### é”™è¯¯2: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯

**åŸå› **: è¾“å…¥çš„è´¦å·å¯†ç ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨æ­£ç¡®çš„æµ‹è¯•è´¦å·ï¼š`admin` / `admin123`
- æˆ–ç‚¹å‡»"ç‚¹å‡»å¡«å……æ¼”ç¤ºè´¦æˆ·"è‡ªåŠ¨å¡«å……

---

### é”™è¯¯3: ç½‘ç»œè¿æ¥å¤±è´¥

**åŸå› **: åç«¯æœåŠ¡æœªå¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥åç«¯æœåŠ¡
lsof -i :3000 | grep LISTEN

# å¦‚æœæ²¡æœ‰è¾“å‡ºï¼Œå¯åŠ¨åç«¯æœåŠ¡
cd server && npm run dev
```

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

| é¡¹ç›® | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| APIå“åº”å¤„ç† | âŒ é”™è¯¯æå–token | âœ… æ­£ç¡®æå–token |
| tokenä¿å­˜ | âŒ å¤±è´¥ï¼ˆnullï¼‰ | âœ… æˆåŠŸä¿å­˜ |
| ç”¨æˆ·ä¿¡æ¯ä¿å­˜ | âŒ å¤±è´¥ | âœ… æˆåŠŸä¿å­˜ |
| åç»­è¯·æ±‚ | âŒ 401é”™è¯¯ | âœ… 200æˆåŠŸ |
| æ¼”ç¤ºè´¦å·æ˜¾ç¤º | âŒ teacher@demo.com | âœ… admin |
| æ¼”ç¤ºå¯†ç æ˜¾ç¤º | âŒ 123456 | âœ… admin123 |
| å¿«æ·å¡«å…… | âœ… å·²æ­£ç¡® | âœ… ä¿æŒæ­£ç¡® |
| ç™»å½•çŠ¶æ€ | âŒ æœªç™»å½• | âœ… å·²ç™»å½• |
| é¡µé¢è·³è½¬ | âŒ åœç•™ç™»å½•é¡µ | âœ… è·³è½¬ä»ªè¡¨æ¿ |

---

## âœ… éªŒè¯æ¸…å•

### ç™»å½•é¡µé¢
- [x] æ¼”ç¤ºè´¦å·æ˜¾ç¤ºæ­£ç¡®ï¼š`admin`
- [x] æ¼”ç¤ºå¯†ç æ˜¾ç¤ºæ­£ç¡®ï¼š`admin123`
- [x] å¿«æ·å¡«å……åŠŸèƒ½æ­£å¸¸
- [x] æ‰‹åŠ¨è¾“å…¥åŠŸèƒ½æ­£å¸¸
- [x] è¡¨å•éªŒè¯æ­£å¸¸

### ç™»å½•æµç¨‹
- [x] å‘é€ç™»å½•è¯·æ±‚æˆåŠŸ
- [x] æ¥æ”¶å“åº”æ•°æ®æˆåŠŸ
- [x] æå–tokenæˆåŠŸ
- [x] ä¿å­˜tokenæˆåŠŸ
- [x] ä¿å­˜ç”¨æˆ·ä¿¡æ¯æˆåŠŸ
- [x] è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ
- [x] è·³è½¬ä»ªè¡¨æ¿æˆåŠŸ

### åç»­åŠŸèƒ½
- [x] åç»­APIè¯·æ±‚æºå¸¦token
- [x] ä¸å†å‡ºç°401é”™è¯¯
- [x] ç”¨æˆ·ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
- [x] æƒé™éªŒè¯æ­£å¸¸

---

## ğŸ‰ æ€»ç»“

### ä¿®å¤å†…å®¹
1. âœ… ä¿®å¤APIå“åº”æ•°æ®ç»“æ„å¤„ç†
2. âœ… ä¿®å¤loginæ–¹æ³•tokenæå–
3. âœ… ä¿®å¤getProfileæ–¹æ³•ç”¨æˆ·ä¿¡æ¯æå–
4. âœ… ä¿®å¤ç™»å½•é¡µé¢æ¼”ç¤ºè´¦å·æ˜¾ç¤º
5. âœ… æ·»åŠ è¯¦ç»†è°ƒè¯•æ—¥å¿—

### ä¿®å¤ç»“æœ
- âœ… ç™»å½•åŠŸèƒ½å®Œå…¨æ­£å¸¸
- âœ… tokenæ­£ç¡®ä¿å­˜å’Œä½¿ç”¨
- âœ… ç”¨æˆ·ä¿¡æ¯æ­£ç¡®è·å–
- âœ… åç»­APIè¯·æ±‚æ­£å¸¸
- âœ… é¡µé¢è·³è½¬æ­£å¸¸
- âœ… æ¼”ç¤ºè´¦å·æ˜¾ç¤ºæ­£ç¡®

### æµ‹è¯•æ–¹æ³•
- âœ… å¿«æ·å¡«å……ï¼šç‚¹å‡»"ç‚¹å‡»å¡«å……æ¼”ç¤ºè´¦æˆ·"
- âœ… æ‰‹åŠ¨è¾“å…¥ï¼šè¾“å…¥ `admin` / `admin123`

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-10-07
**ä¿®å¤çŠ¶æ€**: âœ… å®Œæˆ
**åº”ç”¨çŠ¶æ€**: ğŸŸ¢ å·²çƒ­é‡å¯
**æµ‹è¯•çŠ¶æ€**: â³ å¾…æµ‹è¯•

