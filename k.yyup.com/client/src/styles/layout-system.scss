/**
 * 统一布局系统
 * Unified Layout System
 * 
 * 解决 MainLayout、Sidebar 和内容页面之间的布局问题
 */

/* ==================== 布局变量统一定义 ==================== */
:root {
  /* 侧边栏尺寸 */
  --sidebar-width: 240px;
  --sidebar-width-collapsed: 64px;
  --sidebar-header-height: 80px;
  
  /* 导航栏尺寸 */
  --navbar-height: 64px;
  
  /* 内容区域 - 不限制最大宽度，让内容自适应 */
  --content-max-width: none;  /* 移除固定宽度限制 */
  --content-padding: var(--spacing-lg);
  --content-padding-mobile: 16px;
  
  /* 响应式断点（统一） */
  --breakpoint-xs: 480px;
  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;
  --breakpoint-2xl: 1536px;
  
  /* 间距系统（统一） */
  --gap-xs: 8px;
  --gap-sm: 12px;
  --gap-md: 16px;
  --gap-lg: 24px;
  --gap-xl: 32px;
  
  /* Z-index 层级（统一） */
  --z-sidebar: 1001;
  --z-navbar: 100;
  --z-mobile-overlay: 1040;
  --z-content: 1;
}

/* ==================== 主容器布局 ==================== */
.app-container {
  display: flex;
  height: 100vh;
  overflow: hidden;
  background: var(--bg-secondary, #f5f7fa);
  position: relative;
  
  /* 确保子元素正确布局 */
  * {
    box-sizing: border-box;
  }
}

/* ==================== 侧边栏布局规范 ==================== */
.sidebar {
  position: fixed;
  // ✅ 修复：侧边栏从头部下方开始，避免 header 覆盖导致点击被拦截
  top: var(--header-height, 64px);
  left: 0;
  bottom: 0;
  width: var(--sidebar-width);
  height: calc(100vh - var(--header-height, 64px));
  background: var(--sidebar-bg, #ffffff);
  border-right: 1px solid var(--border-color, #e5e7eb);
  z-index: var(--z-sidebar);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow-y: auto;
  overflow-x: hidden;
  
  /* 收起状态 */
  &.collapsed {
    width: var(--sidebar-width-collapsed);
    
    .sidebar-header {
      padding: var(--spacing-lg) 8px;
    }
    
    .logo-text,
    .nav-content,
    .user-details {
      display: none;
    }
  }
  
  /* 侧边栏头部 */
  .sidebar-header {
    height: var(--sidebar-header-height);
    padding: var(--spacing-lg) 16px;
    border-bottom: 1px solid var(--border-color, #e5e7eb);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: padding 0.3s ease;
  }
  
  /* 导航区域 */
  .sidebar-nav {
    flex: 1;
    padding: var(--gap-sm);
    overflow-y: auto;
    overflow-x: hidden;
    
    /* 统一导航项样式 */
    .nav-item,
    .center-item {
      display: flex;
      align-items: center;
      gap: var(--gap-sm);
      padding: 10px 12px;
      margin: var(--spacing-xs) 0;
      border-radius: 8px;
      transition: all 0.2s ease;
      text-decoration: none;
      color: var(--text-secondary, #6b7280);
      
      &:hover {
        background: var(--bg-hover, rgba(124, 127, 245, 0.08));
        color: var(--primary-color, #7c7ff5);
        transform: translateX(2px);
      }
      
      &.active {
        background: var(--primary-color, #7c7ff5);
        color: white;
        box-shadow: 0 2px 8px rgba(124, 127, 245, 0.25);
      }
    }
  }
  
  /* 用户信息区域 */
  .user-section {
    padding: var(--gap-md);
    border-top: 1px solid var(--border-color, #e5e7eb);
    margin-top: auto;
  }
}

/* ==================== 主内容区域布局规范 ==================== */
.main-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  margin-left: var(--sidebar-width);
  min-height: 100vh;
  background: var(--bg-secondary, #f5f7fa);
  transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;
  
  /* 侧边栏收起时 */
  &.main-expanded {
    margin-left: var(--sidebar-width-collapsed);
  }
  
  /* 导航栏 */
  .navbar {
    height: var(--navbar-height);
    background: var(--bg-color, #ffffff);
    border-bottom: 1px solid var(--border-color-lighter, #ebeef5);
    padding: 0 var(--content-padding);
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: var(--z-navbar);
    flex-shrink: 0;
  }
  
  /* 页面内容容器 */
  .page-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    background: var(--bg-secondary, #f5f7fa);
    
    /* 使用全局极细滚动条样式 */
  }
}

/* ==================== 内容页面布局规范 ==================== */

/* 所有内容页面的统一容器 */
.page-container,
.center-page,
.dashboard-center,
.center-content {
  width: 100%;
  /* 移除 max-width 限制，让内容充满整个可用区域 */
  margin: 0 auto;
  padding: var(--content-padding);
  
  /* 页面头部 */
  .page-header {
    margin-bottom: var(--gap-lg);
    padding: var(--gap-lg);
    background: var(--bg-color, #ffffff);
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .welcome-section {
    margin-bottom: var(--gap-lg);
    /* 使用CSS变量控制内边距，可以通过工具调节 */
    padding: var(--welcome-section-padding-y, var(--gap-lg)) var(--welcome-section-padding-x, var(--gap-lg));
    background: var(--bg-color, #ffffff);
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }
  
  /* 统计卡片网格 */
  .stats-overview,
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--gap-lg);
    margin-bottom: var(--gap-xl);
  }
  
  /* 内容区块 */
  .content-section,
  .quick-navigation,
  .system-status {
    margin-bottom: var(--gap-xl);
    padding: var(--gap-lg);
    background: var(--bg-color, #ffffff);
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    
    h3 {
      margin-bottom: var(--gap-md);
      font-size: var(--text-lg);
      font-weight: 600;
      color: var(--text-primary);
    }
  }
  
  /* 导航网格 */
  .nav-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--gap-md);
  }
}

/* ==================== 响应式布局（统一断点） ==================== */

/* 大屏幕 */
@media (min-width: 1536px) {
  .page-container,
  .center-page,
  .dashboard-center,
  .center-content {
    /* 移除 max-width 限制，让内容自适应屏幕宽度 */
    max-width: none;
    padding: var(--gap-xl);
  }
}

/* 中等屏幕 */
@media (max-width: var(--breakpoint-xl)) {
  .page-container,
  .center-page,
  .dashboard-center,
  .center-content {
    max-width: none;
    padding: var(--gap-lg);
  }

  .stats-overview,
  .stats-grid {
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  }
}

/* 平板设备 */
@media (max-width: var(--breakpoint-lg)) {
  :root {
    --sidebar-width: 260px;
    --content-padding: var(--spacing-lg);
  }
  
  .main-container {
    margin-left: var(--sidebar-width);
    
    &.main-expanded {
      margin-left: var(--sidebar-width-collapsed);
    }
  }
  
  .nav-grid {
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  }
}

/* 移动设备 */
@media (max-width: var(--breakpoint-md)) {
  /* 侧边栏覆盖模式 */
  .sidebar {
    transform: translateX(-100%);
    
    &.sidebar-open,
    &.show {
      transform: translateX(0);
    }
  }
  
  /* 主容器全宽 */
  .main-container {
    margin-left: 0 !important;
    
    .navbar {
      padding: 0 var(--content-padding-mobile);
    }
  }
  
  /* 内容区域调整 */
  .page-container,
  .center-page,
  .dashboard-center,
  .center-content {
    padding: var(--content-padding-mobile);
    
    .stats-overview,
    .stats-grid {
      grid-template-columns: 1fr;
      gap: var(--gap-md);
    }
    
    .nav-grid {
      grid-template-columns: 1fr;
    }
  }
  
  /* 移动端遮罩 */
  .mobile-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: var(--z-mobile-overlay);
    display: block;
    
    &:not(.show) {
      display: none;
    }
  }
}

/* 小屏幕手机 */
@media (max-width: var(--breakpoint-xs)) {
  :root {
    --content-padding-mobile: 12px;
    --gap-lg: 16px;
    --gap-md: 12px;
  }
  
  .sidebar {
    width: 100vw;
  }
  
  .page-header,
  .welcome-section {
    padding: var(--gap-md);
    margin-bottom: var(--gap-md);
  }
}

/* ==================== 布局工具类 ==================== */

/* Flexbox 布局 */
.flex-container {
  display: flex;
  gap: var(--gap-md);
  
  &.flex-wrap {
    flex-wrap: wrap;
  }
  
  &.flex-center {
    align-items: center;
    justify-content: center;
  }
  
  &.flex-between {
    justify-content: space-between;
  }
}

/* Grid 布局 */
.grid-container {
  display: grid;
  gap: var(--gap-md);
  
  &.grid-2 {
    grid-template-columns: repeat(2, 1fr);
  }
  
  &.grid-3 {
    grid-template-columns: repeat(3, 1fr);
  }
  
  &.grid-4 {
    grid-template-columns: repeat(4, 1fr);
  }
  
  /* 响应式网格 */
  &.grid-responsive {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  }
}

/* 内容居中 */
.content-centered {
  /* 移除 max-width 限制 */
  margin: 0 auto;
  padding: 0 var(--content-padding);
}

/* ==================== 主题适配 ==================== */

/* 暗色主题 */
.theme-dark,
[data-theme="dark"] {
  .sidebar {
    background: var(--bg-primary, #1d1e1f);
    border-right-color: var(--border-color, #414243);
  }
  
  .main-container {
    background: var(--bg-secondary, #141414);
    
    .navbar {
      background: var(--bg-color, #1d1e1f);
      border-bottom-color: var(--border-color, #414243);
    }
  }
  
  .page-container,
  .center-page,
  .dashboard-center {
    .page-header,
    .content-section {
      background: var(--bg-card, #262727);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    }
  }
}

/* ==================== 性能优化 ==================== */

/* 减少重绘 */
.will-change-transform {
  will-change: transform;
}

/* GPU 加速 */
.gpu-accelerated {
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* 包含布局 */
.contain-layout {
  contain: layout;
}

/* 减少动画 */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}