/**
 * 移动端无障碍性样式
 * Mobile Accessibility Styles
 *
 * 提供符合 WCAG 2.1 AA 标准的无障碍性支持
 */

/* ==================== 基础无障碍性增强 ==================== */

/* 跳转到主内容链接 */
.skip-to-main {
  position: absolute;
  top: -40px;
  left: 6px;
  background: var(--primary-color);
  color: white;
  padding: var(--spacing-sm);
  text-decoration: none;
  border-radius: var(--mobile-radius-sm);
  z-index: var(--z-maximum);
  font-weight: var(--font-medium);
  @include mobile-fluid-font(14px, 16px, 320px, 768px);

  &:focus {
    top: 6px;
  }
}

/* 焦点指示器 */
.focus-visible {
  &:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
    border-radius: var(--mobile-radius-sm);
  }
}

/* 高对比度模式支持 */
@media (prefers-contrast: high) {
  .focus-visible {
    &:focus {
      outline-width: 3px;
      outline-color: var(--text-primary);
    }
  }

  /* 增强按钮对比度 */
  .van-button {
    border-width: 2px !important;
    font-weight: var(--font-semibold) !important;
  }

  /* 增强输入框对比度 */
  .van-field__control {
    border: 2px solid var(--text-primary) !important;
  }
}

/* 减少动画偏好支持 */
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  .van-loading,
  .van-swipe-item,
  .van-popup,
  .van-dialog {
    transition: none !important;
  }
}

/* ==================== 屏幕阅读器支持 ==================== */

/* 仅屏幕阅读器可见的内容 */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* 在获得焦点时可见 */
.sr-only-focusable {
  &:focus,
  &:active {
    position: static;
    width: auto;
    height: auto;
    padding: inherit;
    margin: inherit;
    overflow: visible;
    clip: auto;
    white-space: inherit;
  }
}

/* 语义化状态描述 */
.aria-label {
  &:not([aria-label]):not([aria-labelledby]) {
    &:before {
      content: attr(data-aria-label);
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
    }
  }
}

/* ==================== Vant 组件无障碍性增强 ==================== */

// 按钮组件增强
:deep(.van-button) {
  // 确保最小触摸目标 44px
  min-height: 44px;
  min-width: 44px;
  padding: var(--mobile-gap-sm) var(--mobile-gap);

  // 焦点样式
  &:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
  }

  // 禁用状态的无障碍性
  &.van-button--disabled {
    opacity: 0.6;
    cursor: not-allowed;

    &:focus {
      outline: 2px solid var(--text-tertiary);
    }
  }

  // 加载状态
  &.van-button--loading {
    position: relative;

    .van-loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .van-button__text {
      opacity: 0;
    }
  }
}

// 输入框组件增强
:deep(.van-field) {
  .van-field__control {
    // 增大触摸目标
    min-height: 44px;
    padding: var(--mobile-gap-sm) 0;
    font-size: var(--mobile-text-base);
    line-height: 1.4;

    // 焦点样式
    &:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
      border-radius: var(--mobile-radius-sm);
    }

    // 错误状态
    &.is-error {
      border: 2px solid var(--danger-color);
    }
  }

  // 标签增强
  .van-field__label {
    font-weight: var(--font-medium);
    color: var(--text-primary);

    .van-field__required {
      color: var(--danger-color);
      font-weight: var(--font-bold);
    }
  }

  // 错误信息增强
  .van-field__error-message {
    color: var(--danger-color);
    font-size: var(--mobile-text-sm);
    font-weight: var(--font-medium);
    background: rgba(245, 108, 108, 0.1);
    padding: var(--mobile-gap-xs);
    border-radius: var(--mobile-radius-sm);
    margin-top: var(--mobile-gap-xs);
  }
}

// 复选框和单选框增强
:deep(.van-checkbox),
:deep(.van-radio) {
  // 增大触摸目标
  .van-checkbox__icon,
  .van-radio__icon {
    min-width: 24px;
    min-height: 24px;
    font-size: var(--text-lg);

    &:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
      border-radius: var(--mobile-radius-sm);
    }
  }

  .van-checkbox__label,
  .van-radio__label {
    font-size: var(--mobile-text-base);
    line-height: 1.4;
    padding: var(--mobile-gap-xs);
    min-height: 44px;
    display: flex;
    align-items: center;
  }
}

// 开关组件增强
:deep(.van-switch) {
  min-width: 51px; // 增大默认尺寸
  min-height: 31px;

  &:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
    border-radius: var(--mobile-radius-full);
  }
}

// 列表组件增强
:deep(.van-cell) {
  // 确保触摸目标足够大
  min-height: 48px;
  padding: var(--mobile-gap);

  &:focus {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
  }

  // 可点击的单元格
  &.van-cell--clickable {
    &:focus {
      background-color: var(--bg-color-light);
    }

    &:active {
      background-color: var(--bg-color-page);
      transform: scale(0.98);
    }
  }

  // 图标增强
  .van-icon {
    font-size: var(--text-lg);
    min-width: 18px;
    min-height: 18px;
  }
}

// 标签页组件增强
:deep(.van-tabs) {
  .van-tabs__wrap {
    .van-tabs__nav {
      .van-tab {
        min-height: 44px;
        padding: var(--mobile-gap) var(--mobile-gap-lg);
        font-weight: var(--font-medium);

        &:focus {
          outline: 2px solid var(--primary-color);
          outline-offset: -2px;
        }

        &.van-tab--active {
          color: var(--primary-color);
          font-weight: var(--font-semibold);
        }
      }
    }
  }

  // 滑动指示器增强
  .van-tabs__line {
    background: var(--primary-color);
    height: 3px;
    border-radius: var(--mobile-radius-sm);
  }
}

// 步进器组件增强
:deep(.van-stepper) {
  .van-stepper__input {
    min-height: 44px;
    font-size: var(--mobile-text-base);
    text-align: center;
    font-weight: var(--font-medium);

    &:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
      border-radius: var(--mobile-radius-sm);
    }
  }

  .van-stepper__minus,
  .van-stepper__plus {
    min-width: 44px;
    min-height: 44px;

    &:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
      border-radius: var(--mobile-radius-sm);
    }

    &:active {
      transform: scale(0.95);
    }
  }
}

// 上传组件增强
:deep(.van-uploader) {
  .van-uploader__upload {
    min-width: 80px;
    min-height: 80px;
    border: 2px dashed var(--border-color);
    border-radius: var(--mobile-radius-md);

    &:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    &:active {
      border-color: var(--primary-color);
      background: var(--bg-color-light);
    }

    .van-uploader__upload-icon {
      font-size: var(--text-2xl);
      color: var(--text-secondary);
    }

    .van-uploader__upload-text {
      font-size: var(--mobile-text-xs);
      color: var(--text-tertiary);
    }
  }

  .van-uploader__preview {
    border-radius: var(--mobile-radius-md);
    overflow: hidden;

    &:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    .van-uploader__preview-image {
      border-radius: var(--mobile-radius-md);
    }

    .van-uploader__preview-delete {
      width: 22px;
      height: 22px;
      background: var(--danger-color);
      border-radius: 50%;

      &:focus {
        outline: 2px solid white;
        outline-offset: 2px;
      }
    }
  }
}

// 评分组件增强
:deep(.van-rate) {
  .van-rate__item {
    margin: 0 2px;

    .van-rate__icon {
      font-size: var(--text-2xl);
      min-width: 24px;
      min-height: 24px;

      &:focus {
        outline: 2px solid var(--primary-color);
        outline-offset: 2px;
        border-radius: 50%;
      }
    }
  }
}

// 滑块组件增强
:deep(.van-slider) {
  margin: var(--mobile-gap-lg) 0;

  .van-slider__bar {
    height: 6px;
    background: var(--bg-color-light);
    border-radius: var(--mobile-radius-full);
  }

  .van-slider__button {
    width: 24px;
    height: 24px;
    border: 3px solid var(--primary-color);
    background: white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);

    &:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    &:active {
      transform: scale(1.1);
    }
  }
}

// 通知组件增强
:deep(.van-notify) {
  font-size: var(--mobile-text-base);
  font-weight: var(--font-medium);
  padding: var(--mobile-gap) var(--mobile-gap-lg);
  border-radius: var(--mobile-radius-lg);
  min-height: 44px;

  &[role="alert"] {
    // 确保屏幕阅读器能正确读取
    &::before {
      content: attr(aria-label);
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
    }
  }
}

// 对话框组件增强
:deep(.van-dialog) {
  .van-dialog__header {
    font-size: var(--mobile-text-lg);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    padding: var(--mobile-gap-lg) var(--mobile-gap) var(--mobile-gap);
  }

  .van-dialog__content {
    font-size: var(--mobile-text-base);
    line-height: 1.5;
    color: var(--text-primary);
    padding: 0 var(--mobile-gap);
  }

  .van-dialog__footer {
    padding: var(--mobile-gap-sm) var(--mobile-gap) var(--mobile-gap-lg);

    .van-button {
      min-height: 44px;
      font-weight: var(--font-medium);
    }
  }

  // 焦点管理
  .van-dialog__confirm,
  .van-dialog__cancel {
    &:focus {
      z-index: 1;
    }
  }
}

// 弹出层组件增强
:deep(.van-popup) {
  .van-popup__close-icon {
    width: 32px;
    height: 32px;
    font-size: var(--text-lg);
    color: var(--text-secondary);

    &:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
      border-radius: 50%;
      background: var(--bg-color-light);
    }
  }
}

// 加载组件增强
:deep(.van-loading) {
  .van-loading__spinner,
  .van-loading__circular {
    width: 24px;
    height: 24px;
    color: var(--primary-color);
  }

  .van-loading__text {
    font-size: var(--mobile-text-sm);
    color: var(--text-secondary);
    margin-top: var(--mobile-gap-xs);
  }

  // 为屏幕阅读器添加描述
  &[aria-label] {
    &::before {
      content: attr(aria-label);
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
    }
  }
}

// 空状态组件增强
:deep(.van-empty) {
  padding: var(--mobile-gap-xl);

  .van-empty__image {
    width: 80px;
    height: 80px;
  }

  .van-empty__description {
    font-size: var(--mobile-text-base);
    color: var(--text-secondary);
    margin-top: var(--mobile-gap);
    font-weight: var(--font-medium);
  }
}

/* ==================== 响应式无障碍性适配 ==================== */

// 小屏幕设备 (≤374px)
@media (max-width: 374px) {
  :deep(.van-button) {
    min-height: 48px; // 在小屏幕上增大触摸目标
    padding: var(--mobile-gap) var(--mobile-gap-lg);
    font-size: var(--mobile-text-base);
  }

  :deep(.van-field) {
    .van-field__control {
      min-height: 48px;
      font-size: var(--mobile-text-base);
    }
  }

  :deep(.van-cell) {
    min-height: 52px;
    padding: var(--mobile-gap-sm) var(--mobile-gap);
  }
}

// 横屏模式
@media (orientation: landscape) and (max-height: 600px) {
  :deep(.van-dialog) {
    .van-dialog__header {
      padding: var(--mobile-gap) var(--mobile-gap) var(--mobile-gap-sm);
    }

    .van-dialog__footer {
      padding: var(--mobile-gap-xs) var(--mobile-gap) var(--mobile-gap);
    }
  }
}

/* ==================== 触摸设备增强 ==================== */

// 增大触摸目标
.touch-enhanced {
  min-width: 44px;
  min-height: 44px;
  padding: var(--mobile-gap-sm);
  position: relative;

  &:after {
    content: '';
    position: absolute;
    top: -10px;
    left: -10px;
    right: -10px;
    bottom: -10px;
    z-index: 1;
  }
}

// 触摸反馈
.touch-feedback {
  transition: transform 0.1s ease-out;

  &:active {
    transform: scale(0.95);
  }
}

/* ==================== 键盘导航支持 ==================== */

// 焦点陷阱
.focus-trap {
  &:focus-within {
    outline: 2px solid var(--primary-color);
    border-radius: var(--mobile-radius-md);
  }
}

// 跳转链接增强
.skip-link {
  position: absolute;
  top: -40px;
  left: 0;
  background: var(--primary-color);
  color: white;
  padding: var(--spacing-sm) 16px;
  text-decoration: none;
  border-radius: var(--mobile-radius-sm);
  z-index: var(--z-maximum);
  font-weight: var(--font-medium);
  transition: top 0.2s ease;

  &:focus {
    top: 0;
  }
}

/* ==================== 暗黑模式无障碍性 ==================== */

:global([data-theme="dark"]) {
  .focus-visible {
    &:focus {
      outline-color: var(--primary-color-dark);
    }
  }

  :deep(.van-button) {
    &.van-button--disabled {
      &:focus {
        outline-color: var(--text-secondary-dark);
      }
    }
  }

  :deep(.van-field) {
    .van-field__control {
      &.is-error {
        border-color: var(--danger-color-dark);
      }
    }

    .van-field__error-message {
      background: rgba(245, 108, 108, 0.2);
      color: var(--danger-color-dark);
    }
  }
}

/* ==================== 打印样式支持 ==================== */

@media print {
  .no-print {
    display: none !important;
  }

  .van-dialog,
  .van-popup,
  .van-loading {
    display: none !important;
  }

  .van-button {
    background: white !important;
    color: black !important;
    border: 1px solid black !important;
  }

  a {
    text-decoration: underline;
  }

  // 确保链接可见
  a[href^="http"]:after {
    content: " (" attr(href) ")";
    font-size: 0.8em;
    color: #666;
  }
}