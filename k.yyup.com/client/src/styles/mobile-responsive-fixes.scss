/**
 * 移动端响应式设计修复
 * Mobile Responsive Design Fixes
 * 
 * 针对移动端特殊需求的CSS修复和优化
 */

/* ==================== 移动端基础修复 ==================== */

/* 确保移动端按钮和触摸目标大小符合标准（最小44px） */
@media (max-width: var(--breakpoint-md)) {
  
  /* 通用按钮触摸优化 */
  .el-button,
  button:not(.el-button),
  .header-action-btn,
  .mobile-menu-btn,
  .nav-item {
    min-height: 44px !important;
    min-width: 44px !important;
    touch-action: manipulation; /* 优化触摸响应 */
  }
  
  /* 导航菜单项移动端优化 */
  .nav-item {
    padding: var(--spacing-md) 16px !important;
    margin: var(--spacing-xs) 0 !important;
    
    .nav-icon {
      width: 24px !important;
      height: 24px !important;
    }
    
    .nav-text {
      font-size: var(--text-base) !important; /* 移动端推荐最小文字大小 */
      line-height: 1.5;
    }
  }
  
  /* 表单输入框移动端优化 */
  .el-input__inner,
  .el-textarea__inner,
  .el-select .el-input__inner {
    min-height: 44px !important;
    font-size: var(--text-base) !important; /* 防止iOS Safari缩放 */
    padding: var(--spacing-md) 16px !important;
  }
  
  /* AI助手移动端适配 */
  .ai-assistant {
    /* 移动端全屏显示 */
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100% !important;
    max-width: none !important;
    z-index: 2000 !important;
    border-radius: 0 !important;
    
    .resize-handle {
      display: none !important; /* 移动端隐藏调整手柄 */
    }
    
    .ai-header {
      padding: var(--spacing-md) !important;
      
      .ai-actions .el-button {
        min-width: 44px !important;
        min-height: 44px !important;
      }
    }
    
    .chat-area {
      /* 确保聊天区域占满剩余空间 */
      flex: 1 !important;
      height: auto !important;
      padding: 0 16px !important;
    }
    
    .input-area {
      padding: var(--spacing-md) !important;
      
      .el-input textarea {
        font-size: var(--unified-font-size, 16px) !important; /* 使用统一字体大小，防止iOS Safari缩放 */
        min-height: 88px !important; /* 两行文字的高度 */
      }
      
      .send-btn {
        min-width: 60px !important;
        min-height: 44px !important;
      }
    }
  }
  
  /* 侧边栏移动端优化 */
  .sidebar {
    /* 移动端侧边栏覆盖显示 */
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    height: 100vh !important;
    z-index: 1050 !important;
    transform: translateX(-100%) !important;
    transition: transform 0.3s ease !important;
    
    &.show,
    &:not(.collapsed) {
      transform: translateX(0) !important;
    }
    
    .nav-item {
      padding: var(--spacing-md) 20px !important;
      
      .nav-content {
        .nav-text {
          font-size: var(--unified-font-size, 16px) !important;
        }

        .nav-desc {
          font-size: var(--unified-font-size-small, 14px) !important;
        }
      }
    }
  }
  
  /* 顶部导航栏移动端优化 */
  .navbar {
    padding: 0 16px !important;
    min-height: 60px !important;
    
    .mobile-menu-btn {
      margin-right: 12px !important;
    }
    
    .navbar-right {
      gap: var(--spacing-sm) !important;
      
      .header-action-btn {
        width: 44px !important;
        height: 44px !important;
      }
    }
    
    /* 移动端隐藏部分导航信息 */
    .el-breadcrumb {
      font-size: var(--text-sm) !important;
    }
    
    .user-info {
      .user-name,
      .user-role {
        display: none !important;
      }
      
      .user-avatar {
        width: 36px !important;
        height: 36px !important;
      }
    }
  }
  
  /* 页面内容移动端优化 */
  .page-content {
    padding: var(--spacing-md) !important;
    
    /* 卡片在移动端的间距优化 */
    .card {
      margin-bottom: 12px !important;
      
      .card-header,
      .card-body,
      .card-footer {
        padding: var(--spacing-md) 12px !important;
      }
    }
    
    /* 表格移动端适配 */
    .el-table {
      font-size: var(--text-sm) !important;
      
      .el-table__cell {
        padding: var(--spacing-md) 8px !important;
      }
    }
  }
  
  /* 移动端滚动优化 */
  .page-content,
  .chat-area {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }
  
  /* 移动端遮罩层 */
  .mobile-overlay {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    background: rgba(0, 0, 0, 0.5) !important;
    z-index: 1040 !important;
    backdrop-filter: blur(4px);
  }
}

/* ==================== 小屏幕设备额外优化 ==================== */

@media (max-width: var(--breakpoint-xs)) {
  
  /* 超小屏幕设备的特殊处理 */
  .navbar {
    .logo-text {
      font-size: var(--text-sm) !important;
    }
  }
  
  .ai-assistant {
    .ai-header .ai-title {
      .title-text {
        font-size: var(--text-base) !important;
      }
    }
    
    .input-area {
      .input-wrapper {
        flex-direction: column !important;
        gap: var(--spacing-md) !important;
        
        .el-input {
          width: 100% !important;
        }
        
        .send-btn {
          width: 100% !important;
        }
      }
    }
  }
  
  /* 卡片在超小屏幕上的优化 */
  .card {
    .card-header,
    .card-body,
    .card-footer {
      padding: var(--spacing-md) 8px !important;
    }
    
    .card-title {
      font-size: var(--text-base) !important;
    }
  }
}

/* ==================== 触摸设备优化 ==================== */

/* 针对触摸设备的特殊样式 */
@media (hover: none) and (pointer: coarse) {
  
  /* 禁用hover效果，避免触摸设备的粘性hover */
  .card:hover,
  .nav-item:hover,
  .el-button:hover,
  button:hover {
    transform: none !important;
  }
  
  /* 为触摸设备提供更明显的点击反馈 */
  .nav-item:active,
  .el-button:active,
  button:active {
    transform: scale(0.95) !important;
    transition: transform 0.1s ease !important;
  }
  
  /* 优化滚动性能 */
  .page-content,
  .chat-area,
  .message-list {
    -webkit-overflow-scrolling: touch;
    transform: translateZ(0); /* 启用硬件加速 */
  }
}

/* ==================== 安全区域适配 ==================== */

/* 支持iPhone X等有刘海屏的设备 */
@supports (padding: max(0px)) {
  
  @media (max-width: var(--breakpoint-md)) {
    
    .navbar {
      padding-left: max(16px, env(safe-area-inset-left)) !important;
      padding-right: max(16px, env(safe-area-inset-right)) !important;
      padding-top: max(0px, env(safe-area-inset-top)) !important;
    }
    
    .sidebar {
      padding-left: max(0px, env(safe-area-inset-left)) !important;
    }
    
    .ai-assistant {
      padding-top: max(0px, env(safe-area-inset-top)) !important;
      padding-bottom: max(0px, env(safe-area-inset-bottom)) !important;
      padding-left: max(0px, env(safe-area-inset-left)) !important;
      padding-right: max(0px, env(safe-area-inset-right)) !important;
    }
  }
}

/* ==================== 无障碍支持 ==================== */

/* 确保触摸目标有足够的间距 */
@media (max-width: var(--breakpoint-md)) {
  
  .nav-item + .nav-item,
  .el-button + .el-button {
    margin-top: 4px !important;
  }
  
  /* 为屏幕阅读器提供更好的支持 */
  .mobile-menu-btn,
  .header-action-btn {
    &:focus-visible {
      outline: 2px solid var(--primary-color) !important;
      outline-offset: 2px !important;
    }
  }
}