/**
 * 统一布局修复方案
 * 解决侧边栏与内容区域的布局问题
 */

// ==================== 布局基础修复 ====================
.app-container {
  display: flex;
  height: 100vh;
  overflow: hidden;
  position: relative;
  background-color: var(--bg-secondary, #f5f7fa);
}

// ==================== 侧边栏修复 ====================
.sidebar {
  position: fixed;
  // ✅ 修复：避免被固定头部覆盖导致“顶部菜单点不到”
  top: var(--header-height, 64px);
  left: 0;
  height: calc(100vh - var(--header-height, 64px));
  width: var(--sidebar-width, 240px);
  background: var(--sidebar-bg, #ffffff);
  border-right: 1px solid var(--border-color, #e5e7eb);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1001;
  overflow-y: auto;
  overflow-x: hidden;
  
  // 收起状态
  &.collapsed {
    width: var(--sidebar-width-collapsed, 64px);
    
    .logo-text,
    .nav-content,
    .user-details {
      display: none;
    }
    
    .nav-item {
      justify-content: center;
      padding: var(--spacing-md);
      
      .nav-icon {
        margin: 0;
      }
    }
  }
  
  // 使用全局滚动条样式
}

// ==================== 主内容区域修复 ====================
.main-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  margin-left: var(--sidebar-width, 240px);
  transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  min-height: 100vh;
  background: var(--bg-secondary, #f5f7fa);
  position: relative;
  overflow: hidden;
  
  // 侧边栏收起时
  &.main-expanded {
    margin-left: var(--sidebar-width-collapsed, 64px);
  }
  
  // 导航栏
  .navbar {
    height: var(--header-height, 64px);
    background: var(--bg-color, #ffffff);
    border-bottom: 1px solid var(--border-color-lighter, #ebeef5);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
    position: sticky;
    top: 0;
    z-index: 100;
    flex-shrink: 0;
  }
  
  // 页面内容区域优化
  .page-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    background: var(--bg-secondary, #f5f7fa);
    position: relative;
    
    // 内容容器优化
    > * {
      max-width: var(--container-2xl, 1536px);
      margin: 0 auto;
      padding: var(--spacing-lg);
      width: 100%;
      
      // 针对不同类型的页面调整
      &.page-container,
      &.center-page {
        padding: var(--spacing-lg);
      }
      
      // 卡片间距优化
      .el-card {
        margin-bottom: 20px;
        
        &:last-child {
          margin-bottom: 0;
        }
      }
    }
    
    // 使用全局滚动条样式
  }
}

// ==================== 响应式布局修复 ====================
@media screen and (max-width: 1280px) {
  .main-container {
    .page-content > * {
      max-width: 100%;
      padding: var(--spacing-lg);
    }
  }
}

@media screen and (max-width: 1024px) {
  .sidebar {
    width: var(--sidebar-width, 260px);
    
    &.collapsed {
      width: var(--sidebar-width-collapsed, 64px);
    }
  }
  
  .main-container {
    margin-left: var(--sidebar-width, 260px);
    
    &.main-expanded {
      margin-left: var(--sidebar-width-collapsed, 64px);
    }
    
    .navbar {
      padding: 0 20px;
    }
    
    .page-content > * {
      padding: var(--spacing-md);
    }
  }
}

@media screen and (max-width: 768px) {
  // 移动端：侧边栏覆盖显示
  .sidebar {
    position: fixed;
    transform: translateX(-100%);
    z-index: 1050;
    width: var(--sidebar-width, 240px) !important;
    
    &.sidebar-open,
    &.show {
      transform: translateX(0);
    }
    
    &.collapsed {
      transform: translateX(-100%);
    }
  }
  
  .main-container {
    margin-left: 0 !important;
    
    &.main-expanded {
      margin-left: 0 !important;
    }
    
    .navbar {
      padding: 0 16px;
    }
    
    .page-content > * {
      padding: var(--spacing-md);
      max-width: 100%;
    }
  }
  
  // 移动端遮罩层
  .mobile-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1040;
    display: block;
  }
}

// ==================== 特殊页面布局优化 ====================

// 中心页面布局
.center-page {
  display: flex;
  flex-direction: column;
  height: 100%;
  
  .center-header {
    flex-shrink: 0;
    padding: var(--spacing-lg) 24px;
    background: var(--bg-color, #ffffff);
    border-bottom: 1px solid var(--border-color-lighter, #ebeef5);
  }
  
  .center-content {
    flex: 1;
    overflow-y: auto;
    padding: var(--spacing-lg);
    
    // 网格布局优化
    .grid-container {
      display: grid;
      gap: var(--spacing-lg);
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      
      @media (max-width: var(--breakpoint-md)) {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
      }
    }
  }
}

// Dashboard页面优化
.dashboard-container {
  .stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-lg);
    margin-bottom: 24px;
    
    @media (max-width: var(--breakpoint-md)) {
      grid-template-columns: 1fr;
      gap: var(--spacing-md);
    }
  }
  
  .charts-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: var(--spacing-lg);
    
    @media (max-width: var(--breakpoint-md)) {
      grid-template-columns: 1fr;
    }
  }
}

// ==================== 主题适配修复 ====================

// 暗色主题适配
.theme-dark,
[data-theme="dark"] {
  .sidebar {
    background: var(--bg-primary, #1d1e1f);
    border-right-color: var(--border-color, #414243);
    
    // 使用全局滚动条样式
  }
  
  .main-container {
    background: var(--bg-secondary, #141414);
    
    .navbar {
      background: var(--bg-color, #1d1e1f);
      border-bottom-color: var(--border-color, #414243);
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
    }
    
    .page-content {
      background: var(--bg-secondary, #141414);
      
      // 使用全局滚动条样式
    }
  }
}

// ==================== 工具类 ====================

// 防止内容溢出
.overflow-guard {
  max-width: 100%;
  overflow-x: hidden;
  word-wrap: break-word;
}

// 内容居中
.content-center {
  max-width: var(--container-xl, 1280px);
  margin: 0 auto;
  padding: 0 24px;
  
  @media (max-width: var(--breakpoint-md)) {
    padding: 0 16px;
  }
}

// 全宽容器
.container-fluid {
  width: 100%;
  padding: 0 24px;
  
  @media (max-width: var(--breakpoint-md)) {
    padding: 0 16px;
  }
}

// ==================== 动画优化 ====================

// 平滑过渡
.smooth-transition {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

// 禁用动画（性能优化）
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

// ==================== Z-index层级管理 ====================
.z-index-management {
  --z-dropdown: 1000;
  --z-sticky: 1020;
  --z-fixed: 1030;
  --z-modal-backdrop: 1040;
  --z-sidebar: 1050;
  --z-modal: 1060;
  --z-popover: 1070;
  --z-tooltip: 1080;
  --z-notification: 1090;
}