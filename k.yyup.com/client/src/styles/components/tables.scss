/**
 * 表格组件样式
 * Tables Component Styles
 *
 * 通用表格样式，适用于所有页面的表格元素，包括Element Plus表格覆盖
 * Universal table styles for all table elements, including Element Plus table overrides
 */

@use '../design-tokens.scss' as *;
@use '../mixins/responsive.scss' as *;

/* ==================== 基础表格样式 ==================== */
/* Base Table Styles */

.table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: var(--spacing-lg);
  border-radius: var(--radius-lg);
  overflow: hidden;
  background: var(--bg-card);
  box-shadow: var(--shadow-sm);

  /* 表格头部 */
  thead {
    background: var(--bg-tertiary);

    th {
      padding: var(--spacing-md) var(--spacing-lg);
      text-align: left;
      font-weight: var(--font-semibold);
      color: var(--text-primary);
      border-bottom: 2px solid var(--border-color-light);
      white-space: nowrap;
      font-size: var(--text-sm);
      line-height: var(--leading-tight);

      /* 排序列样式 */
      &.sortable {
        cursor: pointer;
        user-select: none;
        transition: color var(--transition-base);

        &:hover {
          color: var(--primary-color);
        }

        &.sorted {
          color: var(--primary-color);

          &::after {
            content: '↑';
            margin-left: var(--spacing-xs);
          }

          &.desc::after {
            content: '↓';
          }
        }
      }

      @include mobile {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: var(--text-xs);
      }
    }
  }

  /* 表格主体 */
  tbody {
    tr {
      transition: background-color var(--transition-base);

      &:hover {
        background: var(--bg-tertiary);
      }

      &:not(:last-child) {
        border-bottom: 1px solid var(--border-color-lighter);
      }

      /* 选中状态 */
      &.selected {
        background: var(--primary-extra-light);

        &:hover {
          background: var(--primary-lighter);
        }
      }

      /* 禁用状态 */
      &.disabled {
        opacity: 0.5;
        pointer-events: none;
      }
    }

    td {
      padding: var(--spacing-md) var(--spacing-lg);
      color: var(--text-primary);
      font-size: var(--text-sm);
      line-height: var(--leading-normal);
      vertical-align: middle;

      @include mobile {
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: var(--text-xs);
      }
    }
  }

  /* 响应式调整 */
  @include mobile {
    border-radius: var(--radius-md);
  }
}

/* ==================== 表格变体 ==================== */
/* Table Variants */

/* 紧凑表格 */
.table--compact {
  thead th,
  tbody td {
    padding: var(--spacing-sm) var(--spacing-md);

    @include mobile {
      padding: var(--spacing-xs) var(--spacing-sm);
    }
  }
}

/* 大型表格 */
.table--large {
  thead th,
  tbody td {
    padding: var(--spacing-lg) var(--spacing-xl);

    @include mobile {
      padding: var(--spacing-md) var(--spacing-lg);
    }
  }
}

/* 边框表格 */
.table--bordered {
  border: 1px solid var(--border-color-light);

  th, td {
    border-right: 1px solid var(--border-color-lighter);

    &:last-child {
      border-right: none;
    }
  }
}

/* 条纹表格 */
.table--striped {
  tbody tr:nth-child(odd) {
    background: var(--bg-light);

    &:hover {
      background: var(--bg-tertiary);
    }

    &.selected {
      background: var(--primary-extra-light);

      &:hover {
        background: var(--primary-lighter);
      }
    }
  }
}

/* 无边框表格 */
.table--borderless {
  thead th {
    border-bottom: none;
  }

  tbody tr {
    border-bottom: none;
  }
}

/* ==================== 表格容器 ==================== */
/* Table Container */

.table-container {
  width: 100%;
  overflow-x: auto;
  margin-bottom: var(--spacing-lg);
  border-radius: var(--radius-lg);

  /* 使用全局极细滚动条样式 */

  .table {
    margin-bottom: 0;
    min-width: 600px; /* 最小宽度确保表格可读性 */
  }
}

/* ==================== 表格工具类 ==================== */
/* Table Utilities */

/* 列宽工具类 */
.w-5 { width: 5%; }
.w-10 { width: 10%; }
.w-15 { width: 15%; }
.w-20 { width: 20%; }
.w-25 { width: 25%; }
.w-30 { width: 30%; }
.w-35 { width: 35%; }
.w-40 { width: 40%; }
.w-45 { width: 45%; }
.w-50 { width: 50%; }
.w-auto { width: auto; }
.w-fit { width: fit-content; }

/* 文本对齐 */
.text-left { text-align: left; }
.text-center { text-align: center; }
.text-right { text-align: right; }

/* 表格操作列 */
.table-actions,
.action-buttons {
  @include flex-center-y;
  gap: var(--spacing-xs);
  justify-content: flex-start;
  flex-wrap: nowrap;
  min-width: fit-content;

  .el-button {
    margin: 0;
    min-width: 48px;
  }

  @include mobile {
    gap: 2px;
    flex-direction: column;
    align-items: stretch;

    .el-button {
      margin: 0;
      width: 100%;
      min-width: unset;
    }
  }
}

/* ==================== 状态标签 ==================== */
/* Status Tags */

.table-status {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: var(--spacing-xs) var(--spacing-sm);
  border-radius: var(--radius-full);
  font-size: var(--text-xs);
  font-weight: var(--font-medium);
  line-height: 1;
  white-space: nowrap;

  /* 状态指示器 */
  &::before {
    content: '';
    width: 6px;
    height: 6px;
    border-radius: var(--radius-full);
    flex-shrink: 0;
  }

  /* 成功状态 */
  &--success {
    background: var(--success-extra-light);
    color: var(--success-color);

    &::before {
      background: var(--success-color);
    }
  }

  /* 警告状态 */
  &--warning {
    background: var(--warning-extra-light);
    color: var(--warning-color);

    &::before {
      background: var(--warning-color);
    }
  }

  /* 危险状态 */
  &--danger {
    background: var(--danger-extra-light);
    color: var(--danger-color);

    &::before {
      background: var(--danger-color);
    }
  }

  /* 信息状态 */
  &--info {
    background: var(--info-extra-light);
    color: var(--info-color);

    &::before {
      background: var(--info-color);
    }
  }

  /* 主要状态 */
  &--primary {
    background: var(--primary-extra-light);
    color: var(--primary-color);

    &::before {
      background: var(--primary-color);
    }
  }

  /* 默认状态 */
  &--default {
    background: var(--bg-light);
    color: var(--text-secondary);

    &::before {
      background: var(--text-placeholder);
    }
  }
}

/* ==================== Element Plus表格覆盖 ==================== */
/* Element Plus Table Overrides */

.el-table {
  border-radius: var(--radius-lg);
  overflow: hidden;
  border: 1px solid var(--border-color-light);

  /* 表格头部样式 */
  .el-table__header {
    background: var(--bg-tertiary);

    th {
      background: transparent;
      border-bottom: 2px solid var(--border-color-light);
      color: var(--text-primary);
      font-weight: var(--font-semibold);
      font-size: var(--text-sm);

      .cell {
        padding: 0 var(--spacing-md);
        line-height: var(--leading-tight);
      }
    }
  }

  /* 表格主体样式 */
  .el-table__body {
    tr {
      &:hover {
        background: var(--bg-tertiary);
      }
    }

    td {
      border-bottom: 1px solid var(--border-color-lighter);
      color: var(--text-primary);
      font-size: var(--text-sm);

      .cell {
        padding: 0 var(--spacing-md);
        line-height: var(--leading-normal);
      }
    }
  }

  /* 操作列与按钮自适应：避免被 .cell 裁剪，允许按钮换行但按钮文字不换行 */
  .el-table__body td .cell:has(.activity-actions, .table-actions, .action-buttons, .el-button) {
    overflow: visible;         /* 解除 Element Plus 默认的裁剪 */
    white-space: normal;       /* 允许容器根据需要换行 */
  }

  /* 按钮容器保持水平排列 */
  .el-table__body td .cell .activity-actions,
  .el-table__body td .cell .table-actions,
  .el-table__body td .cell .action-buttons {
    display: flex;
    gap: var(--spacing-xs);
    flex-wrap: nowrap;
    align-items: center;
    justify-content: flex-start;
  }

  /* 按钮文本保持单行，避免文字被压缩换行 */
  .el-table__body td .cell .el-button {
    white-space: nowrap;
    flex-shrink: 0;
  }


  /* 空状态 */
  .el-table__empty-block {
    background: var(--bg-card);

    .el-table__empty-text {
      color: var(--text-placeholder);
    }
  }

  /* 固定列阴影 */
  .el-table__fixed,
  .el-table__fixed-right {
    box-shadow: var(--shadow-md);
  }

  /* 响应式优化 */
  @include mobile {
    border-radius: var(--radius-md);

    .el-table__header th .cell,
    .el-table__body td .cell {
      padding: 0 var(--spacing-sm);
      font-size: var(--text-xs);
    }
  }
}

/* 分页组件样式覆盖 */
.el-pagination {
  @include flex-center;
  padding: var(--spacing-lg) 0;
  background: var(--bg-card);
  border-radius: var(--radius-md);
  margin-top: var(--spacing-md);

  .el-pagination__total {
    color: var(--text-secondary);
    font-size: var(--text-sm);
  }

  .el-pager li {
    background: transparent;
    border-radius: var(--radius-sm);
    margin: 0 2px;
    transition: all var(--transition-base);

    &:hover {
      background: var(--bg-tertiary);
    }

    &.is-active {
      background: var(--primary-color);
      color: white;
    }
  }

  .btn-prev,
  .btn-next {
    background: transparent;
    border-radius: var(--radius-sm);

    &:hover {
      background: var(--bg-tertiary);
    }

    &:disabled {
      color: var(--text-disabled);
    }
  }

  @include mobile {
    padding: var(--spacing-md) 0;

    .el-pagination__total,
    .el-pagination__sizes {
      display: none;
    }
  }
}

/* ==================== 无障碍支持 ==================== */
/* Accessibility Support */

.table {
  /* 键盘导航支持 */
  tbody tr {
    &:focus {
      outline: 2px solid var(--primary-color);
      outline-offset: -2px;
    }

    &:focus:not(:focus-visible) {
      outline: none;
    }
  }
}

/* 高对比度模式 */
@media (prefers-contrast: high) {
  .table {
    border: 2px solid var(--text-primary);

    th, td {
      border-color: var(--text-primary);
    }
  }

  .table-status {
    border: 1px solid currentColor;
  }
}

/* 减少动画模式 */
@media (prefers-reduced-motion: reduce) {
  .table tbody tr,
  .el-table .el-table__body tr,
  .el-pagination .el-pager li {
    transition: none;
  }
}