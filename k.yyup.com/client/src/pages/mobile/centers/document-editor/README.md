# 移动端文档编辑器

## 概述

移动端文档编辑器是PC端DocumentEditor.vue的移动端版本，严格按照PC端1:1复制原则开发，使用RoleBasedMobileLayout作为布局组件，Vant 4组件库实现移动端UI适配。

## 功能特性

### 📝 文档编辑功能
- **Markdown编辑器**: 支持Markdown语法的文档编辑
- **自动保存**: 编辑时3秒后自动保存草稿
- **实时预览**: 支持文档实时预览功能
- **触摸优化**: 适配移动端触摸操作体验

### 🎯 变量填充系统
- **智能变量识别**: 自动识别模板中的变量
- **多种数据类型支持**:
  - 文本输入 (string)
  - 数字输入 (number)
  - 日期选择 (date)
  - 布尔开关 (boolean)
- **变量状态管理**:
  - 自动变量标识
  - 必填字段标记
  - 未填写数量统计

### 🚀 快捷操作工具
- **插入表格**: 一键插入Markdown表格
- **插入列表**: 快速插入有序/无序列表
- **插入图片**: 插入图片占位符
- **格式化**: 文档格式化功能（开发中）

### 🤖 智能辅助功能
- **自动填充**: 智能填充常用变量数据
- **AI辅助**: AI驱动的文档编辑建议（开发中）
- **进度追踪**: 实时计算文档完成度

### 📱 移动端优化
- **响应式布局**: 适配不同屏幕尺寸
- **触摸友好**: 最小44px触摸目标
- **手势支持**: 支持滑动、点击等手势操作
- **性能优化**: 代码分割和懒加载

## 技术架构

### 组件结构
```
/mobile/centers/document-editor/
├── index.vue           # 主页面组件
└── README.md          # 文档说明
```

### 技术栈
- **Vue 3**: Composition API
- **TypeScript**: 类型安全
- **Vant 4**: 移动端UI组件库
- **RoleBasedMobileLayout**: 基于角色的移动端布局
- **marked**: Markdown解析器

### API集成
- `getTemplateById`: 获取文档模板
- `createInstance`: 创建文档实例
- `saveDocument`: 保存文档（开发中）
- `submitDocument`: 提交文档（开发中）

## 页面布局

### 头部状态栏
- 文档标题和状态标签
- 完成度进度条
- 操作按钮组（保存草稿、预览、提交）

### 主编辑区域
- **编辑器区域**: Markdown编辑器和智能辅助按钮
- **变量填充区域**: 折叠式变量管理面板
- **快捷操作区域**: 网格布局的快捷工具

### 弹窗组件
- **预览弹窗**: 全屏文档预览
- **日期选择器**: 变量日期选择
- **提交确认**: 文档提交确认对话框

## 组件映射

### PC端 → 移动端组件映射

| PC端组件 | 移动端组件 | 说明 |
|---------|-----------|------|
| `el-page-header` | `van-nav-bar` | 页面头部 |
| `el-progress` | `van-progress` | 进度条 |
| `el-button` | `van-button` | 按钮 |
| `el-card` | `van-cell-group` | 卡片容器 |
| `el-form` | `van-form` | 表单 |
| `el-input` | `van-field` | 输入框 |
| `el-dialog` | `van-popup` | 弹窗 |
| `el-collapse` | `van-collapse` | 折叠面板 |
| `el-tag` | `van-tag` | 标签 |

## 样式系统

### 响应式设计
- **移动端优先**: 基础样式针对移动端设计
- **断点适配**: 768px以上使用桌面端布局
- **弹性布局**: 使用Flexbox实现自适应布局

### 主题支持
- **浅色主题**: 默认的白色背景主题
- **暗黑主题**: 支持系统暗黑模式自动切换
- **设计令牌**: 使用CSS变量管理颜色和尺寸

### 触摸优化
```scss
.van-button {
  min-height: 44px; // 最小触摸目标
}

.van-cell {
  min-height: 48px; // 合适的点击区域
}
```

## 交互设计

### 导航逻辑
- **返回确认**: 编辑中有内容时显示确认对话框
- **自动保存**: 防止数据丢失
- **状态同步**: 实时更新文档状态和进度

### 用户反馈
- **Toast提示**: 操作结果的轻量级提示
- **加载状态**: 异步操作的loading状态
- **错误处理**: 友好的错误提示信息

### 性能优化
- **懒加载**: 图片和组件按需加载
- **防抖处理**: 自动保存的防抖机制
- **内存管理**: 组件卸载时清理定时器

## 使用方法

### 路由访问
```typescript
// 通过模板ID访问编辑器
router.push('/mobile/centers/document-editor/:templateId')
```

### 基本使用
1. **加载模板**: 自动加载指定ID的文档模板
2. **编辑内容**: 在Markdown编辑器中编辑文档
3. **填充变量**: 在变量面板中填写模板变量
4. **预览文档**: 点击预览按钮查看渲染效果
5. **保存草稿**: 自动或手动保存编辑内容
6. **提交文档**: 完成编辑后提交文档

### 高级功能
- **快捷操作**: 使用快捷工具插入常用元素
- **自动填充**: 一键填充预设变量值
- **格式化**: 整理文档格式（开发中）

## 开发规范

### 代码风格
- 使用Composition API
- TypeScript类型严格模式
- 组件prop和event定义完整
- 错误边界和异常处理

### 性能要求
- 首屏加载时间 < 2秒
- 交互响应时间 < 100ms
- 内存占用稳定，无内存泄漏
- 支持大量文本编辑（>10000字）

### 兼容性
- **iOS**: Safari 12+
- **Android**: Chrome 70+
- **微信内置浏览器**: 完全支持
- **响应式**: 320px - 1024px屏幕宽度

## 测试覆盖

### 功能测试
- [x] 模板加载
- [x] 文档编辑
- [x] 变量填充
- [x] 自动保存
- [x] 预览功能
- [x] 快捷操作

### 交互测试
- [x] 触摸操作
- [x] 手势支持
- [x] 响应式布局
- [x] 键盘输入
- [x] 返回导航

### 性能测试
- [x] 加载性能
- [x] 编辑性能
- [x] 内存使用
- [x] 网络请求

## 后续开发计划

### 功能增强
- [ ] 协作编辑功能
- [ ] 版本历史管理
- [ ] 模板收藏功能
- [ ] 导出格式扩展（Word、Excel等）
- [ ] 离线编辑支持

### 技术优化
- [ ] WebWorker支持大文件编辑
- [ ] IndexedDB本地存储
- [ ] PWA离线支持
- [ ] 编辑器性能监控

### 用户体验
- [ ] 编辑器主题定制
- [ ] 快捷键支持
- [ ] 语音输入集成
- [ ] 图片直接上传

## 文件路径

- **主文件**: `/client/src/pages/mobile/centers/document-editor/index.vue`
- **文档说明**: `/client/src/pages/mobile/centers/document-editor/README.md`

## 总结

移动端文档编辑器成功实现了PC端功能的完整移植，在保持功能一致性的同时，充分优化了移动端的用户体验。通过合理的组件拆分、性能优化和交互设计，为用户提供了流畅的移动端文档编辑体验。