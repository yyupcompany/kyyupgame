# çœŸå®ç¯å¢ƒé›†æˆæµ‹è¯•ç³»ç»Ÿ

## ğŸ“– æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„çœŸå®ç¯å¢ƒé›†æˆæµ‹è¯•ç³»ç»Ÿï¼Œä¸“ä¸ºå¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿè®¾è®¡ï¼Œç¡®ä¿åº”ç”¨åœ¨çœŸå®åœºæ™¯ä¸‹çš„ç¨³å®šæ€§ã€ä¸€è‡´æ€§å’Œæ€§èƒ½è¡¨ç°ã€‚

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### 1. çœŸå®ç¯å¢ƒAPIé›†æˆæµ‹è¯•
- **æ–‡ä»¶**: `tests/integration/real-backend.test.ts`
- **è¦†ç›–èŒƒå›´**:
  - ç”¨æˆ·è®¤è¯APIçœŸå®æ€§éªŒè¯
  - ç”¨æˆ·ç®¡ç†å·¥ä½œæµæµ‹è¯•
  - ç­çº§ç®¡ç†APIçœŸå®æ€§éªŒè¯
  - å­¦ç”Ÿç®¡ç†APIçœŸå®æ€§éªŒè¯
  - APIå“åº”æ•°æ®ç»“æ„éªŒè¯
  - APIæ€§èƒ½éªŒè¯

### 2. æ•°æ®åº“äº‹åŠ¡å®Œæ•´æ€§æµ‹è¯•
- **æ–‡ä»¶**: `tests/integration/database-transaction.test.ts`
- **è¦†ç›–èŒƒå›´**:
  - ç­çº§å­¦ç”Ÿåˆ†é…äº‹åŠ¡å®Œæ•´æ€§
  - æ´»åŠ¨ç®¡ç†äº‹åŠ¡å®Œæ•´æ€§
  - ç”¨æˆ·è§’è‰²æƒé™äº‹åŠ¡å®Œæ•´æ€§
  - æ•°æ®å…³è”å®Œæ•´æ€§éªŒè¯
  - å¹¶å‘æ“ä½œäº‹åŠ¡éš”ç¦»

### 3. å®Œæ•´ç”¨æˆ·æ“ä½œæµç¨‹æµ‹è¯•
- **æ–‡ä»¶**: `tests/integration/user-workflow.test.ts`
- **è¦†ç›–èŒƒå›´**:
  - æ•™å¸ˆå®Œæ•´å·¥ä½œæµç¨‹
  - å®¶é•¿å®Œæ•´æ“ä½œæµç¨‹
  - ç®¡ç†å‘˜å®Œæ•´å·¥ä½œæµç¨‹
  - è·¨è§’è‰²åä½œæµç¨‹
  - å®Œæ•´æ‹›ç”Ÿå·¥ä½œæµç¨‹

### 4. å¤šç”¨æˆ·å¹¶å‘åœºæ™¯æµ‹è¯•
- **æ–‡ä»¶**: `tests/integration/multi-user-concurrent.test.ts`
- **è¦†ç›–èŒƒå›´**:
  - å¹¶å‘ç”¨æˆ·è®¤è¯æµ‹è¯•
  - å¹¶å‘æ•°æ®æ“ä½œæµ‹è¯•
  - å¹¶å‘è¯»å–æ“ä½œæµ‹è¯•
  - å¹¶å‘å†™å…¥å†²çªæµ‹è¯•
  - æ··åˆå¹¶å‘æ“ä½œæµ‹è¯•
  - èµ„æºç«äº‰æµ‹è¯•

### 5. æ€§èƒ½é›†æˆæµ‹è¯•
- **æ–‡ä»¶**: `tests/integration/performance-integration.test.ts`
- **è¦†ç›–èŒƒå›´**:
  - åŸºç¡€APIæ€§èƒ½æµ‹è¯•
  - å¤§æ•°æ®é‡æ€§èƒ½æµ‹è¯•
  - å¹¶å‘è´Ÿè½½æ€§èƒ½æµ‹è¯•
  - å†…å­˜å’Œèµ„æºä½¿ç”¨æµ‹è¯•
  - æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–æµ‹è¯•
  - ç¼“å­˜æ€§èƒ½æµ‹è¯•
  - å‹åŠ›æµ‹è¯•å’Œæé™æµ‹è¯•

### 6. ç¯å¢ƒä¸€è‡´æ€§éªŒè¯æµ‹è¯•
- **æ–‡ä»¶**: `tests/environment/production-consistency.test.ts`
- **è¦†ç›–èŒƒå›´**:
  - APIå¥‘çº¦ä¸€è‡´æ€§éªŒè¯
  - ç¯å¢ƒé…ç½®ä¸€è‡´æ€§éªŒè¯
  - è·¨ç¯å¢ƒæ•°æ®ä¸€è‡´æ€§éªŒè¯
  - é…ç½®éªŒè¯æµ‹è¯•
  - æ€§èƒ½åŸºå‡†ä¸€è‡´æ€§éªŒè¯
  - å®‰å…¨é…ç½®ä¸€è‡´æ€§éªŒè¯

### 7. E2EçœŸå®åœºæ™¯æµ‹è¯•
- **æ–‡ä»¶**: `tests/e2e/real-world-scenarios.test.ts`
- **è¦†ç›–èŒƒå›´**:
  - æ•™å¸ˆæ—¥å¸¸å·¥ä½œæµç¨‹
  - å®¶é•¿å®Œæ•´æ“ä½œæµç¨‹
  - ç®¡ç†å‘˜ç®¡ç†å·¥ä½œæµç¨‹
  - è·¨è®¾å¤‡å“åº”å¼æµ‹è¯•
  - é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶æµ‹è¯•
  - æ€§èƒ½å’ŒåŠ è½½æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

1. **ç¡®ä¿æœåŠ¡è¿è¡Œ**:
   ```bash
   # å¯åŠ¨æ‰€æœ‰æœåŠ¡
   npm run start:all

   # æˆ–è€…åˆ†åˆ«å¯åŠ¨
   npm run start:frontend  # http://localhost:5173
   npm run start:backend   # http://localhost:3000
   ```

2. **æ•°æ®åº“åˆå§‹åŒ–**:
   ```bash
   npm run seed-data:complete
   ```

3. **ç¯å¢ƒå˜é‡é…ç½®**:
   ```bash
   # æ£€æŸ¥å¿…è¦çš„ç¯å¢ƒå˜é‡
   NODE_ENV=test
   DB_HOST=localhost
   DB_DATABASE=kindergarten_test
   JWT_SECRET=your-test-secret
   ```

### è¿è¡Œæµ‹è¯•

#### æ–¹æ³•1: ä½¿ç”¨ä¸“ç”¨è¿è¡Œè„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# è¿è¡Œæ‰€æœ‰çœŸå®ç¯å¢ƒé›†æˆæµ‹è¯•
node tests/run-real-integration-tests.js
```

#### æ–¹æ³•2: åˆ†åˆ«è¿è¡Œå„ä¸ªæµ‹è¯•å¥—ä»¶
```bash
# è¿è¡ŒçœŸå®ç¯å¢ƒAPIé›†æˆæµ‹è¯•
npm run test -- --run tests/integration/real-backend.test.ts

# è¿è¡Œæ•°æ®åº“äº‹åŠ¡å®Œæ•´æ€§æµ‹è¯•
npm run test -- --run tests/integration/database-transaction.test.ts

# è¿è¡Œå®Œæ•´ç”¨æˆ·æ“ä½œæµç¨‹æµ‹è¯•
npm run test -- --run tests/integration/user-workflow.test.ts

# è¿è¡Œå¤šç”¨æˆ·å¹¶å‘åœºæ™¯æµ‹è¯•
npm run test -- --run tests/integration/multi-user-concurrent.test.ts

# è¿è¡Œæ€§èƒ½é›†æˆæµ‹è¯•
npm run test -- --run tests/integration/performance-integration.test.ts

# è¿è¡Œç¯å¢ƒä¸€è‡´æ€§éªŒè¯æµ‹è¯•
npm run test -- --run tests/environment/production-consistency.test.ts

# è¿è¡ŒE2EçœŸå®åœºæ™¯æµ‹è¯•
npm run test:e2e -- tests/e2e/real-world-scenarios.test.ts
```

#### æ–¹æ³•3: æŒ‰ç±»åˆ«è¿è¡Œ
```bash
# è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
npm run test:integration

# è¿è¡Œæ‰€æœ‰E2Eæµ‹è¯•
npm run test:e2e

# è¿è¡Œæ‰€æœ‰ç¯å¢ƒæµ‹è¯•
npm run test:environment

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

## ğŸ“Š æµ‹è¯•é…ç½®

### æ€§èƒ½åŸºå‡†é…ç½®
```typescript
// tests/utils/test-config.ts
PERFORMANCE_BENCHMARKS: {
  API_RESPONSE_TIME: {
    FAST: 500,      // å¿«é€Ÿå“åº”
    NORMAL: 1500,   // æ­£å¸¸å“åº”
    SLOW: 3000      // æ…¢é€Ÿå“åº”
  },
  PAGE_LOAD_TIME: {
    FAST: 2000,     // å¿«é€ŸåŠ è½½
    NORMAL: 5000,   // æ­£å¸¸åŠ è½½
    SLOW: 10000     // æ…¢é€ŸåŠ è½½
  }
}
```

### è¦†ç›–ç‡é˜ˆå€¼é…ç½®
```javascript
// tests/run-real-integration-tests.js
COVERAGE_THRESHOLDS: {
  statements: 90,  // è¯­å¥è¦†ç›–ç‡ â‰¥ 90%
  branches: 85,    // åˆ†æ”¯è¦†ç›–ç‡ â‰¥ 85%
  functions: 90,   // å‡½æ•°è¦†ç›–ç‡ â‰¥ 90%
  lines: 90        // è¡Œè¦†ç›–ç‡ â‰¥ 90%
}
```

## ğŸ”§ è‡ªå®šä¹‰æµ‹è¯•é…ç½®

### ä¿®æ”¹æµ‹è¯•ç”¨æˆ·
åœ¨ `tests/utils/test-config.ts` ä¸­ä¿®æ”¹æµ‹è¯•ç”¨æˆ·é…ç½®:
```typescript
TEST_USERS: {
  ADMIN: {
    username: 'your_admin_username',
    password: 'your_admin_password'
  },
  TEACHER: {
    username: 'your_teacher_username',
    password: 'your_teacher_password'
  },
  PARENT: {
    username: 'your_parent_username',
    password: 'your_parent_password'
  }
}
```

### è‡ªå®šä¹‰æ€§èƒ½åŸºå‡†
```typescript
// åœ¨æµ‹è¯•æ–‡ä»¶ä¸­ä¿®æ”¹æ€§èƒ½æœŸæœ›
expect(responseTime).toBeLessThan(2000); // 2ç§’å†…å“åº”
expect(successRate).toBeGreaterThan(95);  // 95%æˆåŠŸç‡
```

### æ·»åŠ æ–°çš„æµ‹è¯•åœºæ™¯
```typescript
// ä½¿ç”¨æä¾›çš„å·¥å…·å‡½æ•°
import { TestDataGenerator, APIValidator } from '../utils/test-config';

// ç”Ÿæˆæµ‹è¯•æ•°æ®
const testUser = TestDataGenerator.generateUserData({
  role: 'teacher'
});

// éªŒè¯APIå“åº”
APIValidator.validateSuccessResponse(response, expectedData);
APIValidator.validateRequiredFields(data, ['id', 'username', 'email']);
```

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

### è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š
è¿è¡Œå®Œæ•´æµ‹è¯•åï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹æŠ¥å‘Šï¼š

1. **JSONæ ¼å¼æŠ¥å‘Š**: `tests/real-integration-test-report.json`
2. **æ§åˆ¶å°è¾“å‡º**: å®æ—¶æ˜¾ç¤ºæµ‹è¯•è¿›åº¦å’Œç»“æœ
3. **è¦†ç›–ç‡æŠ¥å‘Š**: `coverage/lcov-report/index.html`

### æŠ¥å‘Šå†…å®¹åŒ…æ‹¬
- æ€»ä½“æµ‹è¯•ç»Ÿè®¡
- å„æµ‹è¯•å¥—ä»¶æ‰§è¡Œç»“æœ
- æµ‹è¯•è¦†ç›–ç‡åˆ†æ
- æ€§èƒ½åŸºå‡†å¯¹æ¯”
- é”™è¯¯è¯¦æƒ…å’Œå †æ ˆä¿¡æ¯

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æœåŠ¡è¿æ¥å¤±è´¥
```bash
âŒ å‰ç«¯æœåŠ¡æœªè¿è¡Œ (localhost:5173)
â„¹ï¸ è¯·å…ˆå¯åŠ¨å‰ç«¯æœåŠ¡: npm run start:frontend

âŒ åç«¯æœåŠ¡æœªè¿è¡Œ (localhost:3000)
â„¹ï¸ è¯·å…ˆå¯åŠ¨åç«¯æœåŠ¡: npm run start:backend
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
npm run start:all
# æˆ–åˆ†åˆ«å¯åŠ¨
npm run start:frontend
npm run start:backend
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
âŒ Database connection failed
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥æ•°æ®åº“é…ç½®
cat server/.env

# åˆå§‹åŒ–æ•°æ®åº“
cd server && npm run db:migrate
npm run seed-data:complete
```

#### 3. æµ‹è¯•ç”¨æˆ·ä¸å­˜åœ¨
```bash
âŒ ç”¨æˆ·ç™»å½•å¤±è´¥
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°åˆå§‹åŒ–æµ‹è¯•æ•°æ®
npm run seed-data:complete
```

#### 4. æƒé™é”™è¯¯
```bash
âŒ æƒé™ä¸è¶³
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥ç”¨æˆ·è§’è‰²åˆ†é…
# ç¡®ä¿æµ‹è¯•ç”¨æˆ·æœ‰æ­£ç¡®çš„æƒé™
```

#### 5. è¶…æ—¶é”™è¯¯
```bash
âŒ è¯·æ±‚è¶…æ—¶
```

**è§£å†³æ–¹æ¡ˆ**:
```typescript
// åœ¨æµ‹è¯•é…ç½®ä¸­è°ƒæ•´è¶…æ—¶æ—¶é—´
TIMEOUTS: {
  API_REQUEST: 15000,  // å¢åŠ åˆ°15ç§’
  PAGE_LOAD: 45000     // å¢åŠ åˆ°45ç§’
}
```

### è°ƒè¯•æŠ€å·§

#### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
# è¿è¡Œæ—¶æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
DEBUG=* node tests/run-real-integration-tests.js
```

#### 2. å•ç‹¬è¿è¡Œå¤±è´¥çš„æµ‹è¯•
```bash
# åªè¿è¡Œç‰¹å®šçš„æµ‹è¯•æ–‡ä»¶
npm run test -- --run tests/integration/real-backend.test.ts
```

#### 3. æŸ¥çœ‹æµè§ˆå™¨è°ƒè¯•ï¼ˆE2Eæµ‹è¯•ï¼‰
```typescript
// åœ¨æµ‹è¯•æ–‡ä»¶ä¸­ä¸´æ—¶å¯ç”¨è°ƒè¯•
await page.pause();
```

## ğŸ”„ æŒç»­é›†æˆ

### GitHub Actionsé…ç½®
```yaml
# .github/workflows/real-integration-tests.yml
name: Real Integration Tests

on: [push, pull_request]

jobs:
  real-integration-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '18'

      - name: Install dependencies
        run: npm run install:all

      - name: Setup test environment
        run: npm run seed-data:complete

      - name: Start services
        run: npm run start:all &
        sleep: 30

      - name: Run real integration tests
        run: node tests/run-real-integration-tests.js

      - name: Upload coverage reports
        uses: codecov/codecov-action@v1
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. æµ‹è¯•éš”ç¦»
- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åº”è¯¥æ˜¯ç‹¬ç«‹çš„
- ä½¿ç”¨ `beforeEach` å’Œ `afterEach` æ¸…ç†æµ‹è¯•æ•°æ®
- é¿å…æµ‹è¯•ä¹‹é—´çš„ä¾èµ–å…³ç³»

### 2. æ•°æ®ç®¡ç†
- ä½¿ç”¨ä¸“é—¨çš„æµ‹è¯•æ•°æ®åº“
- åœ¨æµ‹è¯•å¼€å§‹å‰å‡†å¤‡æµ‹è¯•æ•°æ®
- åœ¨æµ‹è¯•ç»“æŸåæ¸…ç†æ•°æ®

### 3. é”™è¯¯å¤„ç†
- æ•è·å’ŒéªŒè¯æ‰€æœ‰æ§åˆ¶å°é”™è¯¯
- æµ‹è¯•å„ç§é”™è¯¯åœºæ™¯
- éªŒè¯é”™è¯¯æ¶ˆæ¯çš„å‡†ç¡®æ€§

### 4. æ€§èƒ½è€ƒè™‘
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- é¿å…é•¿æ—¶é—´è¿è¡Œçš„æµ‹è¯•

### 5. ç»´æŠ¤æ€§
- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- æ·»åŠ é€‚å½“çš„æ³¨é‡Š
- å®šæœŸæ›´æ–°æµ‹è¯•æ•°æ®å’ŒåŸºå‡†

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•
1. åœ¨ç›¸åº”çš„ç›®å½•åˆ›å»ºæµ‹è¯•æ–‡ä»¶
2. ä½¿ç”¨æ ‡å‡†çš„æµ‹è¯•ç»“æ„å’Œå·¥å…·å‡½æ•°
3. æ›´æ–°è¿è¡Œè„šæœ¬ï¼ˆå¦‚éœ€è¦ï¼‰
4. æ·»åŠ æ–‡æ¡£è¯´æ˜

### ä¿®æ”¹ç°æœ‰æµ‹è¯•
1. ç¡®ä¿ä¿®æ”¹ä¸ä¼šç ´åå…¶ä»–æµ‹è¯•
2. æ›´æ–°ç›¸å…³çš„é…ç½®å’Œæ–‡æ¡£
3. éªŒè¯æ‰€æœ‰æµ‹è¯•ä»ç„¶é€šè¿‡

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Vitestæ–‡æ¡£](https://vitest.dev/)
- [Playwrightæ–‡æ¡£](https://playwright.dev/)
- [Node.jsæµ‹è¯•æœ€ä½³å®è·µ](https://github.com/goldbergyoni/nodebestpractices#-testing-and-overall-quality-practices)

---

## ğŸ“ æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿™äº›æµ‹è¯•æ—¶é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥æµ‹è¯•æ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯
3. åœ¨é¡¹ç›®Issuesä¸­æŠ¥å‘Šé—®é¢˜
4. è”ç³»å¼€å‘å›¢é˜Ÿè·å–æ”¯æŒ

**è®°ä½**: è¿™äº›æµ‹è¯•æ˜¯ä¸ºäº†ç¡®ä¿ç³»ç»Ÿåœ¨çœŸå®ç¯å¢ƒä¸­çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚è¯·è®¤çœŸå¯¹å¾…æ¯ä¸ªæµ‹è¯•å¤±è´¥çš„æƒ…å†µã€‚