<template>
  <div class="modern-login-page">
    <!-- å…¨å±Loadingé®ç½© -->
    <div v-if="loading" class="fullscreen-loading">
      <div class="loading-spinner-large"></div>
    </div>

    <!-- åŠ¨æ€èƒŒæ™¯ -->
    <div class="animated-background">
      <div class="gradient-mesh"></div>
      <div class="floating-particles">
        <div class="particle particle-1"></div>
        <div class="particle particle-2"></div>
        <div class="particle particle-3"></div>
        <div class="particle particle-4"></div>
        <div class="particle particle-5"></div>
        <div class="particle particle-6"></div>
      </div>
    </div>

    <!-- ä¸»å®¹å™¨ -->
    <div class="login-container">
      <div class="auth-panel">

      <!-- å·¦ä¾§å“ç‰ŒåŒºåŸŸ -->
      <div class="brand-section">
        <div class="brand-content">
          <!-- Logoå’Œå“ç‰Œ -->
          <div class="brand-header">
            <div class="logo-container">
              <div class="logo-icon">
                <img src="@/assets/logo.png" alt="å©´å©´å‘ä¸Šæ™ºèƒ½æ‹›ç”Ÿç³»ç»Ÿ" class="logo-image" />
              </div>
            </div>
            <h1 class="brand-title">
              <span class="title-main">æ™ºæ…§å¹¼å„¿å›­</span>
              <span class="title-sub">ç®¡ç†ç³»ç»Ÿ</span>
            </h1>
            <p class="brand-slogan">è®©æ•™è‚²æ›´æ™ºèƒ½ Â· è®©æˆé•¿æ›´ç¾å¥½</p>
          </div>

          <!-- ç‰¹è‰²åŠŸèƒ½å±•ç¤º -->
          <div class="features-showcase">
            <div class="feature-card">
              <div class="feature-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <!-- ç”µè¯å›¾æ ‡ -->
                  <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                </svg>
              </div>
              <div class="feature-content">
                <h3>ç”µè¯å‘¼å«</h3>
                <p>å®¢æƒ…ç»´æŠ¤ï¼Œæ–°ç”Ÿé‚€çº¦ï¼Œä¸ç”¨å·¥èµ„çš„é«˜çº§é”€å”®äººå‘˜</p>
              </div>
            </div>
            <div class="feature-card">
              <div class="feature-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <!-- AIåŠ©æ‰‹å›¾æ ‡ -->
                  <rect x="3" y="8" width="18" height="12" rx="2"/>
                  <circle cx="9" cy="14" r="1"/>
                  <circle cx="15" cy="14" r="1"/>
                  <path d="M9 8V6a3 3 0 0 1 3-3h0a3 3 0 0 1 3 3v2"/>
                </svg>
              </div>
              <div class="feature-content">
                <h3>AIåŠ©æ‰‹</h3>
                <p>å…¨èƒ½AIåŠ©æ‰‹ï¼Œå‘Šåˆ«å¡«è¡¨ï¼Œç­–åˆ’ï¼ŒæŠ¥è¡¨å¡«å†™</p>
              </div>
            </div>
            <div class="feature-card">
              <div class="feature-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <!-- è¯¾ç¨‹/ä¹¦ç±å›¾æ ‡ -->
                  <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                  <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
              </div>
              <div class="feature-content">
                <h3>åˆ›å»ºè¯¾ç¨‹</h3>
                <p>AIèŠå¤©å³å¯ç”Ÿæˆå¤šåª’ä½“äº’åŠ¨è¯¾ç¨‹ï¼ˆå›¾ç‰‡ï¼Œè§†é¢‘ï¼Œäº’åŠ¨æ¸¸æˆï¼‰ï¼Œä¸€å¥è¯å°±æ˜¯ç”Ÿæˆï¼ŒçœŸæ­£æ­¥å…¥å›­æœ¬è¯¾ç¨‹æ—¶ä»£</p>
              </div>
            </div>
            <div class="feature-card">
              <div class="feature-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <!-- æ¶æ„/ç½‘ç»œå›¾æ ‡ -->
                  <circle cx="12" cy="12" r="10"/>
                  <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                  <path d="M2 12h20"/>
                </svg>
              </div>
              <div class="feature-content">
                <h3>ä¸šåŠ¡æ¶æ„</h3>
                <p>ä»¥ä¸šåŠ¡é©±åŠ¨ï¼ŒæŠŠå¹¼å„¿å›­çš„æ‹›ç”Ÿå’Œè¯¾ç¨‹æœåŠ¡äº¤ä»˜ä½œä¸ºé‡ç‚¹ï¼Œå…¨å¹´è®¡åˆ’äº†ç„¶äºèƒ¸</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- å³ä¾§ç™»å½•åŒºåŸŸ -->
      <div class="login-section">
        <div class="login-card">
          <!-- ç™»å½•è¡¨å•å¤´éƒ¨ -->
          <div class="login-header">
            <h2 class="login-title">æ¬¢è¿å›æ¥</h2>
            <p class="login-subtitle">è¯·ç™»å½•æ‚¨çš„è´¦æˆ·</p>
          </div>

          <!-- ç™»å½•è¡¨å• -->
          <form @submit.prevent="handleLogin" class="login-form">
            <!-- ç”¨æˆ·åè¾“å…¥ -->
            <div class="input-group">
              <div class="input-container">
                <div class="input-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                  </svg>
                </div>
                <input
                  v-model="loginForm.username"
                  type="text"
                  placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                  :disabled="loading"
                  required
                  class="form-input"
                  :class="{ 'error': errors.username }"
                  autocomplete="username"
                  data-testid="username-input"
                />
              </div>
              <div v-if="errors.username" class="error-message">
                {{ errors.username }}
              </div>
            </div>

            <!-- å¯†ç è¾“å…¥ -->
            <div class="input-group">
              <div class="input-container">
                <div class="input-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18,8h-1V6c0-2.76-2.24-5-5-5S7,3.24,7,6v2H6c-1.1,0-2,0.9-2,2v10c0,1.1,0.9,2,2,2h12c1.1,0,2-0.9,2-2V10C20,8.9,19.1,8,18,8z M12,17c-1.1,0-2-0.9-2-2s0.9-2,2-2s2,0.9,2,2S13.1,17,12,17z M15.1,8H8.9V6c0-1.71,1.39-3.1,3.1-3.1s3.1,1.39,3.1,3.1V8z"/>
                  </svg>
                </div>
                <input
                  v-model="loginForm.password"
                  type="password"
                  placeholder="è¯·è¾“å…¥å¯†ç "
                  :disabled="loading"
                  required
                  class="form-input"
                  :class="{ 'error': errors.password }"
                  autocomplete="current-password"
                  data-testid="password-input"
                />
              </div>
              <div v-if="errors.password" class="error-message">
                {{ errors.password }}
              </div>
            </div>

            <!-- å…¨å±€é”™è¯¯ä¿¡æ¯ -->
            <div v-if="globalError" class="global-error" data-testid="error-message">
              <div class="error-icon">âš ï¸</div>
              <span>{{ globalError }}</span>
            </div>

            <!-- ç™»å½•æŒ‰é’® -->
            <button
              type="submit"
              class="login-btn"
              :disabled="loading"
              data-testid="login-button"
            >
              <span class="btn-text">ç«‹å³ç™»å½•</span>
              <div class="btn-arrow">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"/>
                </svg>
              </div>
            </button>
          </form>

          <!-- å¿«æ·ç™»å½• -->
          <div class="quick-login">
            <div class="divider">
              <span class="divider-text">å¿«æ·ç™»å½•</span>
            </div>

            <div class="quick-description">
              <span class="quick-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                </svg>
              </span>
              <span class="quick-text">é€‰æ‹©è§’è‰²å¿«é€Ÿä½“éªŒ</span>
            </div>

            <div class="quick-buttons">
              <button
                class="quick-btn admin-btn"
                @click="quickLogin('admin')"
                :disabled="loading"
              >
                <div class="btn-content">
                  <div class="btn-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                      <circle cx="12" cy="7" r="4"/>
                    </svg>
                  </div>
                  <div class="btn-info">
                    <div class="btn-title">ç³»ç»Ÿç®¡ç†å‘˜</div>
                  </div>
                </div>
              </button>

              <button
                class="quick-btn principal-btn"
                @click="quickLogin('principal')"
                :disabled="loading"
              >
                <div class="btn-content">
                  <div class="btn-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <circle cx="12" cy="12" r="6"/>
                      <circle cx="12" cy="12" r="2"/>
                    </svg>
                  </div>
                  <div class="btn-info">
                    <div class="btn-title">å›­é•¿</div>
                  </div>
                </div>
              </button>

              <button
                class="quick-btn teacher-btn"
                @click="quickLogin('teacher')"
                :disabled="loading"
              >
                <div class="btn-content">
                  <div class="btn-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                      <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    </svg>
                  </div>
                  <div class="btn-info">
                    <div class="btn-title">æ•™å¸ˆ</div>
                  </div>
                </div>
              </button>

              <button
                class="quick-btn parent-btn"
                @click="quickLogin('parent')"
                :disabled="loading"
              >
                <div class="btn-content">
                  <div class="btn-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="9" cy="7" r="4"/>
                      <path d="M1 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2"/>
                      <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                      <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    </svg>
                  </div>
                  <div class="btn-info">
                    <div class="btn-title">å®¶é•¿</div>
                  </div>
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>

    <div class="page-footer">
      <p>&copy; 2024 æ™ºæ…§å¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿ Â· è®©æ•™è‚²æ›´æ™ºèƒ½</p>
      <p class="tech-support">
        <a href="http://localhost:5173" target="_blank" rel="noopener noreferrer" class="tech-link">
          å©´å©´å‘ä¸Šï¼ˆåŒ—äº¬ï¼‰æ•™è‚²ç§‘æŠ€å…¬å¸æä¾›æŠ€æœ¯æ”¯æŒ
        </a>
      </p>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useRouter, useRoute } from 'vue-router'
import { ElMessage } from 'element-plus'
import { useUserStore } from '@/stores/user'
import { login } from '@/api/modules/user'
import DesignTokenManager from '@/config/design-tokens'
import AnimationConfigManager from '@/config/animation-config'

const router = useRouter()
const route = useRoute()
const userStore = useUserStore()

// è¡¨å•æ•°æ®
const loginForm = ref({
  username: '',
  password: ''
})

// çŠ¶æ€ç®¡ç†
const loading = ref(false)
const globalError = ref('')
const errors = ref({
  username: '',
  password: ''
})

// æ·»åŠ ä¸€ä¸ªç”¨äºé˜²æ­¢é‡å¤æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯çš„å¼•ç”¨
const lastErrorMessage = ref('')
const lastErrorMessageTime = ref(0)

// è¡¨å•éªŒè¯
const validateForm = () => {
  errors.value.username = ''
  errors.value.password = ''
  globalError.value = ''

  let isValid = true

  if (!loginForm.value.username.trim()) {
    errors.value.username = 'è¯·è¾“å…¥ç”¨æˆ·å'
    isValid = false
  }

  if (!loginForm.value.password.trim()) {
    errors.value.password = 'è¯·è¾“å…¥å¯†ç '
    isValid = false
  }

  return isValid
}

// ä¸»ç™»å½•å¤„ç†å‡½æ•°
const handleLogin = async () => {
  console.log('ğŸš€ å¼€å§‹ç™»å½•æµç¨‹...')

  if (!validateForm()) {
    console.log('âŒ è¡¨å•éªŒè¯å¤±è´¥')
    return
  }

  loading.value = true
  globalError.value = ''

  try {
    console.log('ğŸ“¡ å‘é€ç™»å½•è¯·æ±‚:', {
      username: loginForm.value.username,
      password: '***'
    })

    // ç›´æ¥è°ƒç”¨åç«¯APIè¿›è¡ŒéªŒè¯
    console.log('ğŸ”§ è¿æ¥åç«¯è¿›è¡Œç”¨æˆ·éªŒè¯')
    const response = await login({
      username: loginForm.value.username,
      password: loginForm.value.password
    })

    console.log('âœ… ç™»å½•å“åº”:', response)

    if (response.success && response.data) {
      await processLoginSuccess(response.data)
    } else {
      throw new Error(response.message || 'ç™»å½•å¤±è´¥')
    }

  } catch (error: any) {
    console.error('âŒ ç™»å½•å¤±è´¥:', error)
    handleLoginError(error)
  } finally {
    loading.value = false
  }
}


// å¤„ç†ç™»å½•æˆåŠŸ
const processLoginSuccess = async (loginData: any) => {
  console.log('ğŸ‰ ç™»å½•æˆåŠŸï¼Œå¤„ç†ç”¨æˆ·æ•°æ®:', loginData)

  try {
    // ä¿å­˜tokenåˆ°å¤šä¸ªä½ç½®ï¼ˆå…¼å®¹æ€§ï¼‰
    const token = loginData.token
    localStorage.setItem('kindergarten_token', token)
    localStorage.setItem('token', token)
    localStorage.setItem('auth_token', token)

    // ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°store - é€‚é…åç«¯è¿”å›çš„æ•°æ®æ ¼å¼
    const userInfo = {
      token: token,
      username: loginData.user.username,
      displayName: loginData.user.realName || loginData.user.username,
      role: loginData.user.role?.toLowerCase() || 'user',  // ç»Ÿä¸€ä½¿ç”¨å°å†™
      roles: loginData.user.roles || [loginData.user.role],
      permissions: loginData.user.permissions || (loginData.user.isAdmin ? ['*'] : []),
      email: loginData.user.email,
      avatar: loginData.user.avatar,
      id: loginData.user.id,
      isAdmin: loginData.user.isAdmin || loginData.user.role === 'admin',
      kindergartenId: loginData.user.kindergartenId,  // âœ… æ·»åŠ kindergartenIdå­—æ®µ
      status: 'active'
    }

    console.log('ğŸ’¾ ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°store:', userInfo)
    userStore.setUserInfo(userInfo)

    // ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°localStorageï¼ˆæŒä¹…åŒ–ï¼‰- ä¿å­˜åˆ°ä¸¤ä¸ªåœ°æ–¹ç¡®ä¿å…¼å®¹æ€§
    localStorage.setItem('userInfo', JSON.stringify(userInfo))
    localStorage.setItem('kindergarten_user_info', JSON.stringify(userInfo))

    ElMessage.success(`æ¬¢è¿å›æ¥ï¼Œ${userInfo.displayName}ï¼`)

    // å¤„ç†é‡å®šå‘ - æ ¹æ®ç”¨æˆ·è§’è‰²å†³å®šè·³è½¬é¡µé¢
    let redirectUrl = route.query.redirect as string

    if (!redirectUrl) {
      // æ ¹æ®ç”¨æˆ·è§’è‰²è®¾ç½®é»˜è®¤è·³è½¬é¡µé¢
      const userRole = userInfo.role?.toLowerCase()
      console.log('ğŸ¯ æ£€æµ‹åˆ°ç”¨æˆ·è§’è‰²:', userRole)

      switch (userRole) {
        case 'teacher':
          // æ•™å¸ˆè·³è½¬åˆ°æ•™å¸ˆä¸­å¿ƒä»ªè¡¨æ¿
          redirectUrl = '/teacher-center/dashboard'
          console.log('ğŸ‘©â€ğŸ« æ•™å¸ˆè§’è‰²ï¼Œè·³è½¬åˆ°æ•™å¸ˆä¸­å¿ƒä»ªè¡¨æ¿')
          break
        case 'parent':
          // å®¶é•¿è·³è½¬åˆ°å®¶é•¿ä¸­å¿ƒé¦–é¡µ
          redirectUrl = '/parent-center/dashboard'
          console.log('ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶é•¿è§’è‰²ï¼Œè·³è½¬åˆ°å®¶é•¿ä¸­å¿ƒé¦–é¡µ')
          break
        case 'principal':
          // å›­é•¿è·³è½¬åˆ°dashboardï¼ˆç»Ÿä¸€ä½¿ç”¨dashboardï¼‰
          redirectUrl = '/dashboard'
          console.log('ğŸ¯ å›­é•¿è§’è‰²ï¼Œè·³è½¬åˆ°ä»ªè¡¨æ¿')
          break
        case 'admin':
        case 'super_admin':
        default:
          // ç®¡ç†å‘˜è·³è½¬åˆ°dashboard
          redirectUrl = '/dashboard'
          console.log('ğŸ‘¤ ç®¡ç†å‘˜è§’è‰²ï¼Œè·³è½¬åˆ°ä»ªè¡¨æ¿')
          break
      }
    }

    console.log('ğŸ”€ å‡†å¤‡è·³è½¬åˆ°:', redirectUrl)

    // ä½¿ç”¨replaceé¿å…è¿”å›åˆ°ç™»å½•é¡µ
    await router.replace(redirectUrl)
    console.log('âœ… é¡µé¢è·³è½¬å®Œæˆ')

  } catch (error) {
    console.error('âŒ å¤„ç†ç™»å½•æ•°æ®å¤±è´¥:', error)
    throw new Error('ç™»å½•æ•°æ®å¤„ç†å¤±è´¥')
  }
}

// å¤„ç†ç™»å½•é”™è¯¯
const handleLoginError = (error: any) => {
  let errorMessage = 'ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•'

  if (error.response?.data?.message) {
    errorMessage = error.response.data.message
  } else if (error.message) {
    errorMessage = error.message
  }

  // é˜²æ­¢é‡å¤æ˜¾ç¤ºç›¸åŒçš„é”™è¯¯æ¶ˆæ¯ï¼ˆ5ç§’å†…ä¸é‡å¤æ˜¾ç¤ºç›¸åŒæ¶ˆæ¯ï¼‰
  const now = Date.now()
  if (lastErrorMessage.value === errorMessage && now - lastErrorMessageTime.value < 5000) {
    // å¦‚æœæ˜¯ç›¸åŒé”™è¯¯æ¶ˆæ¯ä¸”åœ¨5ç§’å†…ï¼Œåˆ™åªæ›´æ–°å…¨å±€é”™è¯¯çŠ¶æ€ï¼Œä¸æ˜¾ç¤ºElMessage
    globalError.value = errorMessage
    return
  }

  // æ›´æ–°æœ€åé”™è¯¯æ¶ˆæ¯å’Œæ—¶é—´
  lastErrorMessage.value = errorMessage
  lastErrorMessageTime.value = now

  globalError.value = errorMessage
  ElMessage.error(errorMessage)

  console.error('Error details:', error)
}

// å¿«æ·ç™»å½•
const quickLogin = async (role: string) => {
  console.log('âš¡ å¿«æ·ç™»å½•:', role)

  // ä½¿ç”¨å®é™…å¯ä»¥ç™»å½•çš„æµ‹è¯•è´¦å·
  const credentials = {
    admin: { username: 'admin', password: 'admin123' },
    principal: { username: 'principal', password: '123456' },     // ä½¿ç”¨principalè´¦å·ï¼ˆå›­é•¿æƒé™ï¼‰
    teacher: { username: 'test_teacher', password: 'admin123' },  // ä½¿ç”¨test_teacherè´¦å·
    parent: { username: 'test_parent', password: 'admin123' }     // ä½¿ç”¨test_parentè´¦å·
  }

  const credential = credentials[role as keyof typeof credentials]
  if (credential) {
    loginForm.value.username = credential.username
    loginForm.value.password = credential.password
    await handleLogin()
  }
}

// å›¾ç‰‡é”™è¯¯å¤„ç†
const handleImageError = (event: Event) => {
  const target = event.target as HTMLImageElement
  if (target) {
    target.style.display = 'none'
    const parent = target.parentElement
    if (parent) {
      parent.innerHTML = '<div class="logo-fallback">ğŸ«</div>'
    }
  }
}

// ç»„ä»¶æŒ‚è½½æ—¶çš„åˆå§‹åŒ–
onMounted(() => {
  console.log('ğŸ”§ ç™»å½•é¡µé¢åˆå§‹åŒ–')
  console.log('ç¯å¢ƒä¿¡æ¯:', {
    mode: import.meta.env.MODE,
    dev: import.meta.env.DEV,
    redirectUrl: route.query.redirect
  })

  // åˆå§‹åŒ–è®¾è®¡ä»¤ç‰Œå’ŒåŠ¨ç”»é…ç½®CSSå˜é‡
  DesignTokenManager.applyCSSVariables()
  AnimationConfigManager.applyCSSVariables()

  // å¦‚æœå·²ç»ç™»å½•ï¼Œç›´æ¥è·³è½¬
  if (userStore.isLoggedIn) {
    console.log('ğŸ‘¤ ç”¨æˆ·å·²ç™»å½•ï¼Œè‡ªåŠ¨è·³è½¬')
    let redirectUrl = route.query.redirect as string

    if (!redirectUrl) {
      // æ ¹æ®ç”¨æˆ·è§’è‰²è®¾ç½®é»˜è®¤è·³è½¬é¡µé¢
      const userRole = userStore.userInfo?.role?.toLowerCase()
      console.log('ğŸ¯ æ£€æµ‹åˆ°å·²ç™»å½•ç”¨æˆ·è§’è‰²:', userRole)

      switch (userRole) {
        case 'teacher':
          redirectUrl = '/teacher-center/dashboard'
          break
        case 'parent':
          redirectUrl = '/parent-center/dashboard'
          break
        case 'admin':
        case 'super_admin':
        case 'principal':
        default:
          redirectUrl = '/'
          break
      }
    }

    router.replace(redirectUrl)
  }
})
</script>

<style lang="scss" scoped>
// å¯¼å…¥ç‹¬ç«‹æ ·å¼æ–‡ä»¶
@import './login-styles.scss';


</style>