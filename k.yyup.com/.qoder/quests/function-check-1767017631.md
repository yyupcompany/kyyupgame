# æ ¡åŒºéš”ç¦»åŠŸèƒ½å®Œæˆæƒ…å†µæ ¸æŸ¥æŠ¥å‘Š

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›® | å†…å®¹ |
|------|------|
| æ–‡æ¡£ç±»å‹ | åŠŸèƒ½æ ¸æŸ¥æŠ¥å‘Š |
| æ ¸æŸ¥æ—¶é—´ | 2024-12-29 |
| æ ¸æŸ¥èŒƒå›´ | æ ¡åŒºéš”ç¦»åŠŸèƒ½å®ç°çŠ¶æ€ |
| å‚è€ƒè®¾è®¡ | function-check.md |

## ä¸€ã€æ ¸æŸ¥ç»“æœæ¦‚è§ˆ

### 1.1 æ€»ä½“å®Œæˆåº¦

| åŠŸèƒ½æ¨¡å— | è®¾è®¡æ–‡æ¡£çŠ¶æ€ | å®é™…å®ŒæˆçŠ¶æ€ | å®Œæˆåº¦ |
|---------|------------|------------|--------|
| æ•°æ®åº“æ¨¡å‹æ‰©å±• | âœ… 100% | âœ… å·²å®ç° | 100% |
| æ•°æ®åº“è¿ç§»è„šæœ¬ | âœ… 100% | âœ… å·²å®ç° | 100% |
| æ•°æ®èŒƒå›´ä¸­é—´ä»¶ | âœ… 100% | âœ… å·²å®ç° | 100% |
| ç§Ÿæˆ·æ³¨å†ŒAPI | âŒ 0% | âœ… å·²å®ç° | 100% |
| æ€»å›­é•¿åˆ†å›­ç®¡ç† | âŒ 0% | âœ… å·²å®ç° | 100% |
| å›­é•¿å¼€é€šæ•™å¸ˆè´¦å· | âŒ 0% | âœ… å·²å®ç° | 100% |
| å›­é•¿å¼€é€šå®¶é•¿è´¦å· | âŒ 0% | âœ… å·²å®ç° | 100% |
| ç°æœ‰APIæ•°æ®èŒƒå›´é€‚é… | âŒ 0% | âš ï¸ æœªç¡®è®¤ | æœªçŸ¥ |
| AIè¡¨éš”ç¦»å­—æ®µè¡¥å…… | âŒ 0% | âš ï¸ æœªç¡®è®¤ | æœªçŸ¥ |
| å‰ç«¯ç®¡ç†ç•Œé¢ | âŒ 0% | âš ï¸ æœªç¡®è®¤ | æœªçŸ¥ |

**ç»¼åˆå®Œæˆåº¦**ï¼šæ ¸å¿ƒåç«¯åŠŸèƒ½ 100%ï¼Œæ•°æ®é€‚é…å’Œå‰ç«¯æœªç¡®è®¤

## äºŒã€å·²å®ŒæˆåŠŸèƒ½è¯¦ç»†æ ¸æŸ¥

### 2.1 æ•°æ®åº“æ¨¡å‹æ‰©å±• âœ…

**å®ç°æ–‡ä»¶**ï¼š`server/src/migrations/20241227000000-add-kindergarten-isolation-fields.js`

**å®Œæˆé¡¹ç›®**ï¼š
- âœ… Userè¡¨æ·»åŠ  `primaryKindergartenId` å­—æ®µ
- âœ… Userè¡¨æ·»åŠ  `allowedKindergartenIds` å­—æ®µï¼ˆJSONæ•°ç»„ï¼‰
- âœ… Userè¡¨æ·»åŠ  `dataScope` å­—æ®µï¼ˆall/single/noneï¼‰
- âœ… åˆ›å»ºæ–°è§’è‰²ï¼šgroup_adminã€chief_principalã€branch_principal
- âœ… ç°æœ‰ç®¡ç†å‘˜ç”¨æˆ·åˆå§‹åŒ–dataScopeä¸º'all'

**éªŒè¯æ–¹æ³•**ï¼šæ£€æŸ¥æ•°æ®åº“è¡¨ç»“æ„ï¼Œç¡®è®¤å­—æ®µå­˜åœ¨

### 2.2 æ•°æ®èŒƒå›´ä¸­é—´ä»¶ âœ…

**å®ç°æ–‡ä»¶**ï¼š`server/src/middlewares/data-scope.middleware.ts`

**å®Œæˆé¡¹ç›®**ï¼š
- âœ… `applyDataScope` - è‡ªåŠ¨åº”ç”¨æ•°æ®èŒƒå›´è¿‡æ»¤
- âœ… `getDataScopeFilter` - è·å–æ•°æ®èŒƒå›´è¿‡æ»¤æ¡ä»¶
- âœ… `canAccessKindergarten` - æ£€æŸ¥å›­åŒºè®¿é—®æƒé™

**æ ¸å¿ƒé€»è¾‘**ï¼š
```
dataScope = 'all' â†’ å¯è®¿é—®allowedKindergartenIdsä¸­çš„æ‰€æœ‰å›­åŒº
dataScope = 'single' â†’ åªèƒ½è®¿é—®primaryKindergartenId
dataScope = 'none' â†’ æ— æƒé™è®¿é—®ä»»ä½•å›­åŒº
```

### 2.3 ç§Ÿæˆ·æ³¨å†ŒAPI âœ…

**å®ç°æ–‡ä»¶**ï¼š
- æ§åˆ¶å™¨ï¼š`server/src/controllers/tenant-registration.controller.ts`
- è·¯ç”±ï¼š`server/src/routes/tenant.routes.ts`
- è·¯ç”±æ³¨å†Œï¼š`server/src/routes/index.ts` (ç¬¬143è¡Œ)

**APIç«¯ç‚¹**ï¼š`POST /api/tenant/register-callback`

**åŠŸèƒ½æµç¨‹**ï¼š
1. æ¥æ”¶ç»Ÿä¸€ç§Ÿæˆ·ç³»ç»Ÿçš„æ³¨å†Œå›è°ƒ
2. éªŒè¯ç§Ÿæˆ·æ‰‹æœºå·å’Œç§Ÿæˆ·åç§°
3. åˆ›å»ºä¸»å›­åŒºKindergartenè®°å½•ï¼ˆè®¾ç½®tenantPhoneNumberç­‰ï¼‰
4. åˆ›å»ºæ€»å›­é•¿Userè®°å½•ï¼ˆdataScope='all'ï¼Œè§’è‰²chief_principalï¼‰
5. è¿”å›å›­åŒºIDå’Œå›­é•¿è´¦å·ä¿¡æ¯

**çŠ¶æ€**ï¼šâœ… å·²å®Œæ•´å®ç°

### 2.4 æ€»å›­é•¿åˆ†å›­ç®¡ç†API âœ…

**å®ç°æ–‡ä»¶**ï¼š`server/src/controllers/kindergarten-group.controller.ts`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š`createBranchKindergarten` - æ€»å›­é•¿å¼€é€šæ–°åˆ†å›­

**åŠŸèƒ½æµç¨‹**ï¼š
1. éªŒè¯æ€»å›­é•¿æƒé™ï¼ˆdataScope='all'ï¼‰
2. åˆ›å»ºåˆ†å›­Kindergartenè®°å½•
3. åœ¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿæ³¨å†Œåˆ†å›­å›­é•¿è´¦å·
4. åœ¨ç§Ÿæˆ·æ•°æ®åº“åˆ›å»ºå›­é•¿Userè®°å½•ï¼ˆdataScope='single'ï¼‰
5. åˆ†é…branch_principalè§’è‰²
6. åˆ›å»ºåˆå§‹ç­çº§
7. è¿”å›åˆ†å›­å’Œå›­é•¿ä¿¡æ¯

**çŠ¶æ€**ï¼šâœ… å·²å®Œæ•´å®ç°

**æ³¨æ„**ï¼šæœªå‘ç°å¯¹åº”çš„è·¯ç”±æ³¨å†Œï¼Œéœ€è¦è¡¥å……è·¯ç”±é…ç½®

### 2.5 å›­é•¿å¼€é€šæ•™å¸ˆè´¦å·API âœ…

**å®ç°æ–‡ä»¶**ï¼š`server/src/controllers/principal-teacher-register.controller.ts`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š`createTeacherByPrincipal` - å›­é•¿ä¸ºæœ¬å›­å¼€é€šæ•™å¸ˆè´¦å·

**åŠŸèƒ½æµç¨‹**ï¼š
1. éªŒè¯å›­é•¿æƒé™ï¼ˆprincipalæˆ–branch_principalè§’è‰²ï¼‰
2. éªŒè¯ç­çº§å±äºæœ¬å›­
3. åœ¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿæ³¨å†Œæ•™å¸ˆè´¦å·
4. åœ¨ç§Ÿæˆ·æ•°æ®åº“åˆ›å»ºTeacherå’ŒUserè®°å½•
5. è®¾ç½®primaryKindergartenIdä¸ºå›­é•¿çš„å›­åŒº
6. åˆ†é…teacherè§’è‰²
7. è¿”å›æ•™å¸ˆè´¦å·ä¿¡æ¯

**çŠ¶æ€**ï¼šâœ… å·²å®Œæ•´å®ç°

**æ³¨æ„**ï¼šæœªå‘ç°å¯¹åº”çš„è·¯ç”±æ³¨å†Œï¼Œéœ€è¦è¡¥å……è·¯ç”±é…ç½®

### 2.6 å›­é•¿å¼€é€šå®¶é•¿è´¦å·API âœ…

**å®ç°æ–‡ä»¶**ï¼š`server/src/controllers/principal-parent-register.controller.ts`

**æ ¸å¿ƒåŠŸèƒ½**ï¼š`createParentByPrincipal` - å›­é•¿ä¸ºæœ¬å›­å­¦ç”Ÿå¼€é€šå®¶é•¿è´¦å·

**åŠŸèƒ½æµç¨‹**ï¼š
1. éªŒè¯å›­é•¿æƒé™ï¼ˆprincipalæˆ–branch_principalè§’è‰²ï¼‰
2. éªŒè¯å­¦ç”Ÿå±äºæœ¬å›­
3. åœ¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿæ³¨å†Œå®¶é•¿è´¦å·
4. åœ¨ç§Ÿæˆ·æ•°æ®åº“åˆ›å»ºParentå’ŒUserè®°å½•
5. è®¾ç½®kindergartenIdå†—ä½™å­—æ®µ
6. åˆ›å»ºParentStudentRelationå…³è”
7. åˆ†é…parentè§’è‰²
8. è¿”å›å®¶é•¿è´¦å·ä¿¡æ¯

**çŠ¶æ€**ï¼šâœ… å·²å®Œæ•´å®ç°

**æ³¨æ„**ï¼šæœªå‘ç°å¯¹åº”çš„è·¯ç”±æ³¨å†Œï¼Œéœ€è¦è¡¥å……è·¯ç”±é…ç½®

## ä¸‰ã€å¾…ç¡®è®¤åŠŸèƒ½æ¸…å•

### 3.1 è·¯ç”±æ³¨å†Œé—®é¢˜ âš ï¸

**é—®é¢˜æè¿°**ï¼šä»¥ä¸‹æ§åˆ¶å™¨å·²å®ç°ï¼Œä½†æœªå‘ç°è·¯ç”±æ³¨å†Œ

| æ§åˆ¶å™¨ | åŠŸèƒ½ | çŠ¶æ€ |
|--------|------|------|
| kindergarten-group.controller.ts | åˆ†å›­ç®¡ç† | âš ï¸ ç¼ºå°‘è·¯ç”± |
| principal-teacher-register.controller.ts | æ•™å¸ˆå¼€é€š | âš ï¸ ç¼ºå°‘è·¯ç”± |
| principal-parent-register.controller.ts | å®¶é•¿å¼€é€š | âš ï¸ ç¼ºå°‘è·¯ç”± |

**éœ€è¦è¡ŒåŠ¨**ï¼š
- åˆ›å»ºå¯¹åº”çš„è·¯ç”±æ–‡ä»¶
- åœ¨`routes/index.ts`ä¸­æ³¨å†Œè·¯ç”±
- éªŒè¯APIç«¯ç‚¹å¯è®¿é—®

### 3.2 ç°æœ‰APIæ•°æ®èŒƒå›´é€‚é… âŒ

**è®¾è®¡æ–‡æ¡£è¦æ±‚**ï¼šæ‰€æœ‰æ¶‰åŠå›­åŒºæ•°æ®çš„APIéƒ½åº”åº”ç”¨æ•°æ®èŒƒå›´è¿‡æ»¤

**æ ¸æŸ¥ç»“æœ**ï¼š**æœªå®ç°æ•°æ®èŒƒå›´è¿‡æ»¤**

**æ ¸æŸ¥å‘ç°**ï¼š

1. **å­¦ç”Ÿç®¡ç†API** (`server/src/routes/students.routes.ts`)ï¼š
   - âŒ æœªä½¿ç”¨`applyDataScope`ä¸­é—´ä»¶
   - âš ï¸ éƒ¨åˆ†æ¥å£æœ‰åŸºç¡€çš„kindergartenIdå¤„ç†ï¼ˆåˆ›å»ºæ—¶è‡ªåŠ¨å¡«å……ï¼‰
   - âŒ æŸ¥è¯¢æ¥å£æœªæ ¹æ®ç”¨æˆ·dataScopeè¿‡æ»¤æ•°æ®
   - **é£é™©**ï¼šæ€»å›­é•¿å’Œåˆ†å›­å›­é•¿éƒ½èƒ½çœ‹åˆ°æ‰€æœ‰å­¦ç”Ÿæ•°æ®

2. **ç­çº§ç®¡ç†API** (`server/src/routes/classes.routes.ts`)ï¼š
   - âŒ æœªä½¿ç”¨`applyDataScope`ä¸­é—´ä»¶
   - âŒ æœªå‘ç°ä»»ä½•æ•°æ®èŒƒå›´è¿‡æ»¤é€»è¾‘
   - **é£é™©**ï¼šè·¨å›­åŒºæ•°æ®æ³„éœ²

3. **æ•™å¸ˆç®¡ç†API**ï¼š
   - âš ï¸ æœªæ‰¾åˆ°ç‹¬ç«‹çš„teachers.routes.tsæ–‡ä»¶
   - éœ€è¦è¿›ä¸€æ­¥æ ¸æŸ¥è·¯ç”±æ³¨å†Œä½ç½®

4. **å…¶ä»–æ ¸å¿ƒAPI**ï¼š
   - âŒ æœªå‘ç°ä»»ä½•è·¯ç”±ä½¿ç”¨`applyDataScope`ä¸­é—´ä»¶
   - âŒ æœªå‘ç°Serviceå±‚ä½¿ç”¨`getDataScopeFilter`

**ä¸¥é‡æ€§è¯„ä¼°**ï¼šğŸ”´ **é«˜é£é™©**

å½“å‰çŠ¶æ€ä¸‹ï¼š
- ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥æŸ¥è¯¢åˆ°æ‰€æœ‰å›­åŒºçš„æ•°æ®
- æ•°æ®éš”ç¦»åŠŸèƒ½å®Œå…¨å¤±æ•ˆ
- å­˜åœ¨ä¸¥é‡çš„æ•°æ®å®‰å…¨éšæ‚£

**éœ€è¦ç´§æ€¥ä¿®å¤çš„API**ï¼š

é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒä¸šåŠ¡ï¼‰ï¼š
- `/api/students/*` - å­¦ç”Ÿç®¡ç†ï¼ˆ5ä¸ªæ¥å£ï¼‰
- `/api/teachers/*` - æ•™å¸ˆç®¡ç†ï¼ˆéœ€å®šä½è·¯ç”±ï¼‰
- `/api/classes/*` - ç­çº§ç®¡ç†ï¼ˆ5ä¸ªæ¥å£ï¼‰
- `/api/parents/*` - å®¶é•¿ç®¡ç†ï¼ˆéœ€å®šä½è·¯ç”±ï¼‰
- `/api/activities/*` - æ´»åŠ¨ç®¡ç†ï¼ˆéœ€å®šä½è·¯ç”±ï¼‰
- `/api/enrollment/*` - æ‹›ç”Ÿç®¡ç†ï¼ˆéœ€å®šä½è·¯ç”±ï¼‰

ä¸­ä¼˜å…ˆçº§ï¼ˆè¾…åŠ©åŠŸèƒ½ï¼‰ï¼š
- `/api/attendance/*` - è€ƒå‹¤ç®¡ç†
- `/api/health/*` - å¥åº·ç®¡ç†
- `/api/meals/*` - è†³é£Ÿç®¡ç†
- `/api/fees/*` - æ”¶è´¹ç®¡ç†

**ä¿®å¤æ–¹æ¡ˆ**ï¼š

æ–¹æ¡ˆ1ï¼šæ‰¹é‡æ·»åŠ ä¸­é—´ä»¶ï¼ˆæ¨èï¼‰
```typescript
// åœ¨æ¯ä¸ªè·¯ç”±æ–‡ä»¶ä¸­æ·»åŠ 
import { applyDataScope } from '../middlewares/data-scope.middleware';

router.get('/', applyDataScope, async (req, res) => {
  // ä¸šåŠ¡é€»è¾‘
});
```

æ–¹æ¡ˆ2ï¼šServiceå±‚æ‰‹åŠ¨è¿‡æ»¤
```typescript
import { getDataScopeFilter } from '../middlewares/data-scope.middleware';

const filter = getDataScopeFilter(req);
const students = await Student.findAll({
  where: { ...filter, ...otherConditions }
});
```

**é¢„ä¼°å·¥ä½œé‡**ï¼š3-5å¤©
- ä¿®æ”¹è·¯ç”±æ–‡ä»¶ï¼š2å¤©
- æµ‹è¯•éªŒè¯ï¼š1-2å¤©
- å›å½’æµ‹è¯•ï¼š1å¤©

### 3.3 AIè¡¨éš”ç¦»å­—æ®µè¡¥å…… âŒ

**è®¾è®¡æ–‡æ¡£è¦æ±‚**ï¼šä¸ºAIç›¸å…³è¡¨æ·»åŠ kindergartenIdå­—æ®µ

**æ ¸æŸ¥ç»“æœ**ï¼š**æœªå®ç°**

**æ¨¡å‹æ–‡ä»¶æ£€æŸ¥**ï¼š

1. **ai-conversation.model.ts** - AIå¯¹è¯ä¼šè¯
   - âŒ æœªåŒ…å«kindergartenIdå­—æ®µ
   - âœ… åŒ…å«userIdå­—æ®µï¼ˆå¯ç”¨äºå›å¡«ï¼‰
   - è¡¨åï¼š`ai_conversations`

2. **ai-message.model.ts** - AIæ¶ˆæ¯è®°å½•
   - âŒ æœªåŒ…å«kindergartenIdå­—æ®µ
   - è¡¨åï¼š`ai_messages`
   - å…³è”ï¼šé€šè¿‡conversationIdå…³è”åˆ°ai_conversations

3. **ai-feedback.model.ts** - AIåé¦ˆè®°å½•
   - âŒ æœªåŒ…å«kindergartenIdå­—æ®µ
   - è¡¨åï¼š`ai_feedbacks`

4. **ai-billing-record.model.ts** - AIè®¡è´¹è®°å½•
   - âŒ æœªåŒ…å«kindergartenIdå­—æ®µ
   - è¡¨åï¼š`ai_billing_records`

**å½±å“è¯„ä¼°**ï¼š

å½“å‰é—®é¢˜ï¼š
- AIä¼šè¯æ•°æ®æœªæŒ‰å›­åŒºéš”ç¦»
- æ€»å›­é•¿å’Œåˆ†å›­å›­é•¿å¯èƒ½çœ‹åˆ°å…¶ä»–å›­åŒºçš„AIå¯¹è¯è®°å½•
- AIè®¡è´¹ç»Ÿè®¡æ— æ³•æŒ‰å›­åŒºåˆ†ç»„

**ä¿®å¤æ­¥éª¤**ï¼š

æ­¥éª¤1ï¼šåˆ›å»ºæ•°æ®åº“è¿ç§»è„šæœ¬
- æ–‡ä»¶åï¼š`20241229000000-add-ai-tables-kindergarten-id.js`
- æ·»åŠ kindergarten_idå­—æ®µåˆ°4ä¸ªè¡¨
- æ·»åŠ ç´¢å¼•å’Œå¤–é”®çº¦æŸ

æ­¥éª¤2ï¼šæ•°æ®å›å¡«
```sql
UPDATE ai_conversations ac
JOIN users u ON ac.external_user_id = u.id
SET ac.kindergarten_id = u.primary_kindergarten_id
WHERE u.primary_kindergarten_id IS NOT NULL;

UPDATE ai_messages am
JOIN ai_conversations ac ON am.conversation_id = ac.id
SET am.kindergarten_id = ac.kindergarten_id;

UPDATE ai_feedbacks af
JOIN users u ON af.user_id = u.id
SET af.kindergarten_id = u.primary_kindergarten_id;

UPDATE ai_billing_records ab
JOIN users u ON ab.user_id = u.id
SET ab.kindergarten_id = u.primary_kindergarten_id;
```

æ­¥éª¤3ï¼šæ›´æ–°æ¨¡å‹å®šä¹‰
- åœ¨4ä¸ªæ¨¡å‹æ–‡ä»¶ä¸­æ·»åŠ kindergartenIdå­—æ®µå®šä¹‰
- æ·»åŠ ä¸Kindergartenæ¨¡å‹çš„å…³è”

æ­¥éª¤4ï¼šé€‚é…AIæŸ¥è¯¢API
- æ·»åŠ æ•°æ®èŒƒå›´è¿‡æ»¤
- æ›´æ–°ç»Ÿè®¡æŸ¥è¯¢é€»è¾‘

**é¢„ä¼°å·¥ä½œé‡**ï¼š1-2å¤©
- è¿ç§»è„šæœ¬ç¼–å†™ï¼š0.5å¤©
- æ¨¡å‹æ›´æ–°ï¼š0.5å¤©
- APIé€‚é…ï¼š0.5-1å¤©
- æµ‹è¯•éªŒè¯ï¼š0.5å¤©

### 3.4 å‰ç«¯ç®¡ç†ç•Œé¢ âŒ

**è®¾è®¡æ–‡æ¡£è¦æ±‚**ï¼šæä¾›å‰ç«¯ç®¡ç†ç•Œé¢

**æ ¸æŸ¥ç»“æœ**ï¼š**æœªå®ç°**

**å‰ç«¯é¡µé¢æ£€æŸ¥**ï¼š

1. **å›­é•¿é¡µé¢ç›®å½•** (`client/src/pages/principal/`)ï¼š
   - âœ… å­˜åœ¨20ä¸ªé¡µé¢æ–‡ä»¶
   - âŒ æœªå‘ç°åˆ†å›­ç®¡ç†ç›¸å…³é¡µé¢
   - âŒ æœªå‘ç°å›­é•¿åˆ†é…ç•Œé¢
   - âŒ æœªå‘ç°è´¦å·å¼€é€šç•Œé¢

2. **ç°æœ‰å›­é•¿é¡µé¢**ï¼š
   - Dashboard.vue - å›­é•¿å·¥ä½œå°
   - CustomerPool.vue - å®¢æˆ·æ± ç®¡ç†
   - Activities.vue - æ´»åŠ¨ç®¡ç†
   - Performance.vue - ç»©æ•ˆç®¡ç†
   - PosterGenerator.vue - æµ·æŠ¥ç”Ÿæˆ
   - å…¶ä»–å¸¸è§„ç®¡ç†é¡µé¢

3. **ç¼ºå¤±çš„å…³é”®é¡µé¢**ï¼š
   - âŒ åˆ†å›­ç®¡ç†é¡µé¢ï¼ˆBranchManagement.vueï¼‰
   - âŒ å›­é•¿åˆ†é…é¡µé¢ï¼ˆPrincipalAssignment.vueï¼‰
   - âŒ æ•™å¸ˆè´¦å·å¼€é€šé¡µé¢ï¼ˆTeacherRegistration.vueï¼‰
   - âŒ å®¶é•¿è´¦å·å¼€é€šé¡µé¢ï¼ˆParentRegistration.vueï¼‰

**éœ€è¦å¼€å‘çš„é¡µé¢æ¸…å•**ï¼š

é¡µé¢1ï¼šåˆ†å›­ç®¡ç†é¡µé¢
- è·¯å¾„ï¼š`/principal/branch-management`
- åŠŸèƒ½ï¼š
  - æŸ¥çœ‹æ‰€æœ‰åˆ†å›­åˆ—è¡¨
  - åˆ›å»ºæ–°åˆ†å›­
  - ç¼–è¾‘åˆ†å›­åŸºæœ¬ä¿¡æ¯
  - æŸ¥çœ‹åˆ†å›­ç»Ÿè®¡æ•°æ®
- æƒé™ï¼šä»…æ€»å›­é•¿ï¼ˆdataScope='all'ï¼‰å¯è§

é¡µé¢2ï¼šå›­é•¿åˆ†é…é¡µé¢
- è·¯å¾„ï¼š`/principal/branch/:id/assign-principal`
- åŠŸèƒ½ï¼š
  - ä¸ºåˆ†å›­æŒ‡å®šå›­é•¿
  - æ›´æ¢å›­é•¿
  - æŸ¥çœ‹å›­é•¿ä¿¡æ¯
  - é‡ç½®å›­é•¿å¯†ç 
- æƒé™ï¼šä»…æ€»å›­é•¿å¯æ“ä½œ

é¡µé¢3ï¼šæ•™å¸ˆè´¦å·å¼€é€šé¡µé¢
- è·¯å¾„ï¼š`/principal/teacher-registration`
- åŠŸèƒ½ï¼š
  - å•ä¸ªæ•™å¸ˆè´¦å·å¼€é€š
  - æ‰¹é‡å¯¼å…¥æ•™å¸ˆ
  - æŸ¥çœ‹æœ¬å›­æ•™å¸ˆåˆ—è¡¨
  - åœç”¨æ•™å¸ˆè´¦å·
- æƒé™ï¼šåˆ†å›­å›­é•¿å’Œæ€»å›­é•¿å¯ç”¨

é¡µé¢4ï¼šå®¶é•¿è´¦å·å¼€é€šé¡µé¢
- è·¯å¾„ï¼š`/principal/parent-registration`
- åŠŸèƒ½ï¼š
  - ä¸ºå­¦ç”Ÿæ·»åŠ å®¶é•¿è´¦å·
  - æ‰¹é‡å¯¼å…¥å®¶é•¿
  - æŸ¥çœ‹å®¶é•¿åˆ—è¡¨
  - ç®¡ç†å®¶é•¿æƒé™
- æƒé™ï¼šåˆ†å›­å›­é•¿å’Œæ€»å›­é•¿å¯ç”¨

**å‰ç«¯å¼€å‘å·¥ä½œé‡è¯„ä¼°**ï¼š

| é¡µé¢ | å¤æ‚åº¦ | é¢„ä¼°å·¥ä½œé‡ |
|------|-------|----------|
| åˆ†å›­ç®¡ç†é¡µé¢ | é«˜ | 2å¤© |
| å›­é•¿åˆ†é…é¡µé¢ | ä¸­ | 1å¤© |
| æ•™å¸ˆè´¦å·å¼€é€š | ä¸­ | 1å¤© |
| å®¶é•¿è´¦å·å¼€é€š | ä¸­ | 1å¤© |
| è”è°ƒæµ‹è¯• | - | 1å¤© |
| **æ€»è®¡** | - | **6å¤©** |

**å‰ç½®æ¡ä»¶**ï¼š
- âœ… åç«¯APIå·²å®ç°ï¼ˆéœ€è¡¥å……è·¯ç”±æ³¨å†Œï¼‰
- âŒ APIæ–‡æ¡£éœ€è¦å®Œå–„
- âŒ æ¥å£æµ‹è¯•éœ€è¦å®Œæˆ

## å››ã€è®¾è®¡æ–‡æ¡£ä¸å®é™…å®ç°çš„å·®å¼‚

### 4.1 APIç«¯ç‚¹å·®å¼‚

**è®¾è®¡æ–‡æ¡£ä¸­çš„API**ï¼ˆæœªå®ç°è·¯ç”±æ³¨å†Œï¼‰ï¼š

| è®¾è®¡ç«¯ç‚¹ | æ–¹æ³• | å®é™…çŠ¶æ€ |
|---------|------|---------|
| /api/kindergartens/branches | POST | æ§åˆ¶å™¨å·²å®ç°ï¼Œè·¯ç”±ç¼ºå¤± |
| /api/kindergartens/branches | GET | æ§åˆ¶å™¨å·²å®ç°ï¼Œè·¯ç”±ç¼ºå¤± |
| /api/kindergartens/:id/assign-principal | POST | æ§åˆ¶å™¨å·²å®ç°ï¼Œè·¯ç”±ç¼ºå¤± |
| /api/teachers/register | POST | æ§åˆ¶å™¨å·²å®ç°ï¼Œè·¯ç”±ç¼ºå¤± |
| /api/parents/register | POST | æ§åˆ¶å™¨å·²å®ç°ï¼Œè·¯ç”±ç¼ºå¤± |

**å½±å“**ï¼šåç«¯åŠŸèƒ½å·²å®Œæˆï¼Œä½†å‰ç«¯æ— æ³•è°ƒç”¨

### 4.2 è§’è‰²å®šä¹‰å·®å¼‚

**è®¾è®¡æ–‡æ¡£**ï¼š
- group_admin - é›†å›¢ç®¡ç†å‘˜
- chief_principal - æ€»å›­é•¿
- branch_principal - åˆ†å›­å›­é•¿

**å®é™…å®ç°**ï¼š
- âœ… æ•°æ®åº“è¿ç§»è„šæœ¬å·²åˆ›å»ºè¿™ä¸‰ä¸ªè§’è‰²
- âš ï¸ æœªç¡®è®¤ç°æœ‰ä»£ç ä¸­çš„è§’è‰²åˆ¤æ–­é€»è¾‘

**éœ€è¦æ ¸æŸ¥**ï¼š
- æ£€æŸ¥æ§åˆ¶å™¨ä¸­è§’è‰²åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†æ–°è§’è‰²ä»£ç 
- éªŒè¯æƒé™ä¸­é—´ä»¶æ˜¯å¦æ”¯æŒæ–°è§’è‰²

## äº”ã€ä¿®å¤ä¼˜å…ˆçº§å’Œè¡ŒåŠ¨è®¡åˆ’

### 5.1 ç´§æ€¥ä¿®å¤é¡¹ï¼ˆP0 - å¿…é¡»ç«‹å³å®Œæˆï¼‰

#### ä¿®å¤1ï¼šè¡¥å……ç¼ºå¤±çš„è·¯ç”±æ³¨å†Œ

**å·¥ä½œé‡**ï¼š0.5å¤©

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º `server/src/routes/kindergarten-group.routes.ts`
- [ ] åˆ›å»º `server/src/routes/principal-teacher.routes.ts`
- [ ] åˆ›å»º `server/src/routes/principal-parent.routes.ts`
- [ ] åœ¨ `server/src/routes/index.ts` ä¸­æ³¨å†Œè¿™3ä¸ªè·¯ç”±
- [ ] éªŒè¯APIç«¯ç‚¹å¯è®¿é—®æ€§

**è·¯ç”±é…ç½®ç¤ºä¾‹**ï¼š
```typescript
// kindergarten-group.routes.ts
import { Router } from 'express';
import { verifyToken } from '../middlewares/auth.middleware';
import * as controller from '../controllers/kindergarten-group.controller';

const router = Router();
router.use(verifyToken);

router.post('/kindergartens/branches', controller.createBranchKindergarten);
router.get('/kindergartens/branches', controller.listBranchKindergartens);
// ... å…¶ä»–ç«¯ç‚¹

export default router;
```

#### ä¿®å¤2ï¼šç°æœ‰APIæ·»åŠ æ•°æ®èŒƒå›´è¿‡æ»¤

**å·¥ä½œé‡**ï¼š3-5å¤©

**ç´§æ€¥ç¨‹åº¦**ï¼šğŸ”´ é«˜å± - æ•°æ®æ³„éœ²é£é™©

**ç¬¬ä¸€æ‰¹ä¿®å¤ï¼ˆé«˜ä¼˜å…ˆçº§ï¼Œ1-2å¤©ï¼‰**ï¼š
- [ ] `/api/students/*` - 5ä¸ªæ¥å£æ·»åŠ applyDataScopeä¸­é—´ä»¶
- [ ] `/api/classes/*` - 5ä¸ªæ¥å£æ·»åŠ applyDataScopeä¸­é—´ä»¶
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯éš”ç¦»æ•ˆæœ
- [ ] å›å½’æµ‹è¯•ç°æœ‰åŠŸèƒ½

**ç¬¬äºŒæ‰¹ä¿®å¤ï¼ˆä¸­ä¼˜å…ˆçº§ï¼Œ1-2å¤©ï¼‰**ï¼š
- [ ] å®šä½teachersã€parentsã€activitiesã€enrollmentè·¯ç”±æ–‡ä»¶
- [ ] ä¸ºè¿™äº›è·¯ç”±æ·»åŠ applyDataScopeä¸­é—´ä»¶
- [ ] ç¼–å†™é›†æˆæµ‹è¯•

**ç¬¬ä¸‰æ‰¹ä¿®å¤ï¼ˆä½ä¼˜å…ˆçº§ï¼Œ1å¤©ï¼‰**ï¼š
- [ ] ä¿®å¤è¾…åŠ©åŠŸèƒ½APIï¼ˆè€ƒå‹¤ã€å¥åº·ã€è†³é£Ÿã€æ”¶è´¹ï¼‰
- [ ] å…¨é¢å›å½’æµ‹è¯•

**éªŒè¯æµ‹è¯•ç”¨ä¾‹**ï¼š
```typescript
// æµ‹è¯•åœºæ™¯1ï¼šæ€»å›­é•¿æŸ¥çœ‹æ‰€æœ‰å›­åŒºå­¦ç”Ÿ
test('æ€»å›­é•¿å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å›­åŒºå­¦ç”Ÿ', async () => {
  const response = await request(app)
    .get('/api/students')
    .set('Authorization', `Bearer ${chiefPrincipalToken}`);
  
  expect(response.body.data.items.length).toBeGreaterThan(0);
  // éªŒè¯åŒ…å«å¤šä¸ªå›­åŒºçš„å­¦ç”Ÿ
});

// æµ‹è¯•åœºæ™¯2ï¼šåˆ†å›­å›­é•¿åªèƒ½æŸ¥çœ‹æœ¬å›­å­¦ç”Ÿ
test('åˆ†å›­å›­é•¿åªèƒ½æŸ¥çœ‹æœ¬å›­å­¦ç”Ÿ', async () => {
  const response = await request(app)
    .get('/api/students')
    .set('Authorization', `Bearer ${branchPrincipalToken}`);
  
  const students = response.body.data.items;
  students.forEach(student => {
    expect(student.kindergartenId).toBe(branchKindergartenId);
  });
});

// æµ‹è¯•åœºæ™¯3ï¼šè¶Šæƒè®¿é—®è¢«æ‹’ç»
test('åˆ†å›­å›­é•¿æ— æ³•è®¿é—®å…¶ä»–å›­åŒºå­¦ç”Ÿ', async () => {
  const response = await request(app)
    .get(`/api/students/${otherKindergartenStudentId}`)
    .set('Authorization', `Bearer ${branchPrincipalToken}`);
  
  expect(response.status).toBe(403);
});
```

### 5.2 é‡è¦ä¿®å¤é¡¹ï¼ˆP1 - æœ¬å‘¨å†…å®Œæˆï¼‰

#### ä¿®å¤3ï¼šAIè¡¨éš”ç¦»å­—æ®µè¡¥å……

**å·¥ä½œé‡**ï¼š1-2å¤©

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»ºè¿ç§»è„šæœ¬ `20241229000000-add-ai-tables-kindergarten-id.js`
- [ ] æ‰§è¡Œæ•°æ®åº“è¿ç§»
- [ ] éªŒè¯æ•°æ®å›å¡«æˆåŠŸ
- [ ] æ›´æ–°4ä¸ªAIæ¨¡å‹æ–‡ä»¶
- [ ] æ›´æ–°AIæŸ¥è¯¢APIæ·»åŠ æ•°æ®èŒƒå›´è¿‡æ»¤
- [ ] ç¼–å†™æµ‹è¯•ç”¨ä¾‹

**è¿ç§»è„šæœ¬æ¨¡æ¿**ï¼š
```javascript
module.exports = {
  async up(queryInterface, Sequelize) {
    const transaction = await queryInterface.sequelize.transaction();
    
    try {
      // 1. æ·»åŠ å­—æ®µ
      await queryInterface.addColumn('ai_conversations', 'kindergarten_id', {
        type: Sequelize.INTEGER,
        allowNull: true,
        references: { model: 'kindergartens', key: 'id' },
        comment: 'å¹¼å„¿å›­ID'
      }, { transaction });
      
      // 2. æ•°æ®å›å¡«
      await queryInterface.sequelize.query(`
        UPDATE ai_conversations ac
        JOIN users u ON ac.external_user_id = u.id
        SET ac.kindergarten_id = u.primary_kindergarten_id
        WHERE u.primary_kindergarten_id IS NOT NULL
      `, { transaction });
      
      // 3. æ·»åŠ ç´¢å¼•
      await queryInterface.addIndex('ai_conversations', ['kindergarten_id'], {
        name: 'idx_ai_conversations_kindergarten_id',
        transaction
      });
      
      // é‡å¤ä»¥ä¸Šæ­¥éª¤å¤„ç†å…¶ä»–3ä¸ªè¡¨
      
      await transaction.commit();
    } catch (error) {
      await transaction.rollback();
      throw error;
    }
  }
};
```

### 5.3 åŠŸèƒ½è¡¥å…¨é¡¹ï¼ˆP2 - ä¸¤å‘¨å†…å®Œæˆï¼‰

#### è¡¥å…¨1ï¼šå‰ç«¯ç®¡ç†ç•Œé¢å¼€å‘

**å·¥ä½œé‡**ï¼š6å¤©

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ†å›­ç®¡ç†é¡µé¢å¼€å‘ï¼ˆ2å¤©ï¼‰
- [ ] å›­é•¿åˆ†é…é¡µé¢å¼€å‘ï¼ˆ1å¤©ï¼‰
- [ ] æ•™å¸ˆè´¦å·å¼€é€šé¡µé¢å¼€å‘ï¼ˆ1å¤©ï¼‰
- [ ] å®¶é•¿è´¦å·å¼€é€šé¡µé¢å¼€å‘ï¼ˆ1å¤©ï¼‰
- [ ] è”è°ƒæµ‹è¯•ï¼ˆ1å¤©ï¼‰

**å‰ç½®æ¡ä»¶æ£€æŸ¥**ï¼š
- [ ] åç«¯APIè·¯ç”±å·²æ³¨å†Œ
- [ ] APIæ–‡æ¡£å·²å®Œå–„
- [ ] æ¥å£æµ‹è¯•å·²é€šè¿‡

### 5.4 æµ‹è¯•éªŒè¯é¡¹ï¼ˆP3 - æŒç»­è¿›è¡Œï¼‰

#### æµ‹è¯•1ï¼šåŠŸèƒ½å®Œæ•´æ€§æµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼š

åœºæ™¯1ï¼šç§Ÿæˆ·æ³¨å†Œæµç¨‹
- è°ƒç”¨ç§Ÿæˆ·æ³¨å†Œå›è°ƒAPI
- éªŒè¯ä¸»å›­åŒºåˆ›å»ºæˆåŠŸ
- éªŒè¯æ€»å›­é•¿è´¦å·åˆ›å»ºæˆåŠŸ
- éªŒè¯æ€»å›­é•¿dataScopeä¸º'all'

åœºæ™¯2ï¼šåˆ†å›­ç®¡ç†æµç¨‹
- æ€»å›­é•¿åˆ›å»ºåˆ†å›­
- ä¸ºåˆ†å›­åˆ†é…å›­é•¿
- éªŒè¯åˆ†å›­å›­é•¿dataScopeä¸º'single'
- éªŒè¯åˆ†å›­å›­é•¿åªèƒ½è®¿é—®æœ¬å›­æ•°æ®

åœºæ™¯3ï¼šè´¦å·å¼€é€šæµç¨‹
- åˆ†å›­å›­é•¿å¼€é€šæ•™å¸ˆè´¦å·
- åˆ†å›­å›­é•¿å¼€é€šå®¶é•¿è´¦å·
- éªŒè¯è´¦å·å½’å±æ­£ç¡®
- éªŒè¯è´¦å·æƒé™æ­£ç¡®

#### æµ‹è¯•2ï¼šæ•°æ®éš”ç¦»éªŒè¯æµ‹è¯•

**éªŒè¯é¡¹**ï¼š
- [ ] æ€»å›­é•¿å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å›­åŒºå­¦ç”Ÿ
- [ ] æ€»å›­é•¿å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å›­åŒºæ•™å¸ˆ
- [ ] æ€»å›­é•¿å¯ä»¥æŸ¥çœ‹æ‰€æœ‰å›­åŒºç­çº§
- [ ] åˆ†å›­å›­é•¿åªèƒ½æŸ¥çœ‹æœ¬å›­å­¦ç”Ÿ
- [ ] åˆ†å›­å›­é•¿åªèƒ½æŸ¥çœ‹æœ¬å›­æ•™å¸ˆ
- [ ] åˆ†å›­å›­é•¿åªèƒ½æŸ¥çœ‹æœ¬å›­ç­çº§
- [ ] æ•™å¸ˆåªèƒ½æŸ¥çœ‹æœ¬å›­æ•°æ®
- [ ] å®¶é•¿åªèƒ½æŸ¥çœ‹æœ¬å›­æ•°æ®
- [ ] è¶Šæƒè®¿é—®è¢«æ­£ç¡®æ‹’ç»ï¼ˆ403é”™è¯¯ï¼‰
- [ ] è·¨å›­è®¿é—®æœ‰å®¡è®¡æ—¥å¿—è®°å½•

#### æµ‹è¯•3ï¼šå®‰å…¨æ€§æµ‹è¯•

**æµ‹è¯•é¡¹**ï¼š
- [ ] Tokenä¼ªé€ æµ‹è¯•
- [ ] å‚æ•°ç¯¡æ”¹æµ‹è¯•ï¼ˆä¿®æ”¹kindergartenIdå‚æ•°ï¼‰
- [ ] SQLæ³¨å…¥æµ‹è¯•
- [ ] æ•°æ®æ³„éœ²æµ‹è¯•
- [ ] ä¼šè¯åŠ«æŒæµ‹è¯•

#### æµ‹è¯•4ï¼šæ€§èƒ½æµ‹è¯•

**æ€§èƒ½æŒ‡æ ‡**ï¼š
- [ ] æŸ¥è¯¢æ€§èƒ½ä¸‹é™ < 10%
- [ ] Tokenå¤§å°å¢åŠ  < 200å­—èŠ‚
- [ ] APIå“åº”æ—¶é—´ < 2ç§’
- [ ] æ•°æ®åº“ç´¢å¼•æ•ˆç‡éªŒè¯

## å…­ã€æ€»ä½“æ—¶é—´è§„åˆ’

### 6.1 å¿«é€Ÿä¿®å¤è·¯å¾„ï¼ˆ1å‘¨ï¼‰

**ç¬¬1-2å¤©**ï¼š
- è¡¥å……è·¯ç”±æ³¨å†Œï¼ˆ0.5å¤©ï¼‰
- å­¦ç”Ÿå’Œç­çº§APIæ·»åŠ æ•°æ®èŒƒå›´è¿‡æ»¤ï¼ˆ1.5å¤©ï¼‰

**ç¬¬3-4å¤©**ï¼š
- å…¶ä»–æ ¸å¿ƒAPIæ·»åŠ æ•°æ®èŒƒå›´è¿‡æ»¤ï¼ˆ2å¤©ï¼‰

**ç¬¬5å¤©**ï¼š
- AIè¡¨éš”ç¦»å­—æ®µè¡¥å……ï¼ˆ1å¤©ï¼‰

**ç¬¬6-7å¤©**ï¼š
- å…¨é¢æµ‹è¯•éªŒè¯ï¼ˆ2å¤©ï¼‰

### 6.2 å®Œæ•´å®æ–½è·¯å¾„ï¼ˆ2-3å‘¨ï¼‰

**ç¬¬1å‘¨**ï¼š
- è·¯ç”±æ³¨å†Œ + æ ¸å¿ƒAPIä¿®å¤ + AIè¡¨è¡¥å…… + æµ‹è¯•

**ç¬¬2å‘¨**ï¼š
- å‰ç«¯é¡µé¢å¼€å‘ï¼ˆ6å¤©ï¼‰

**ç¬¬3å‘¨**ï¼š
- é›†æˆæµ‹è¯•ã€å®‰å…¨æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ï¼ˆ5å¤©ï¼‰

## å…­ã€æ ¸æŸ¥ç»“è®º

### 6.1 æ ¸å¿ƒåŠŸèƒ½å®Œæˆåº¦

**å·²å®Œæˆ**ï¼š
- âœ… æ•°æ®åº“æ¨¡å‹æ‰©å±•ï¼ˆ100%ï¼‰
- âœ… æ•°æ®åº“è¿ç§»è„šæœ¬ï¼ˆ100%ï¼‰
- âœ… æ•°æ®èŒƒå›´ä¸­é—´ä»¶ï¼ˆ100%ï¼‰
- âœ… ç§Ÿæˆ·æ³¨å†Œä¸šåŠ¡é€»è¾‘ï¼ˆ100%ï¼‰
- âœ… åˆ†å›­ç®¡ç†ä¸šåŠ¡é€»è¾‘ï¼ˆ100%ï¼‰
- âœ… æ•™å¸ˆå¼€é€šä¸šåŠ¡é€»è¾‘ï¼ˆ100%ï¼‰
- âœ… å®¶é•¿å¼€é€šä¸šåŠ¡é€»è¾‘ï¼ˆ100%ï¼‰

**å¾…è¡¥å……**ï¼š
- âš ï¸ è·¯ç”±æ³¨å†Œé…ç½®
- âš ï¸ ç°æœ‰APIæ•°æ®èŒƒå›´é€‚é…éªŒè¯
- âš ï¸ AIè¡¨éš”ç¦»å­—æ®µ
- âš ï¸ å‰ç«¯ç®¡ç†ç•Œé¢

### 6.2 ä¸è®¾è®¡æ–‡æ¡£çš„åå·®

**å…³é”®å‘ç°**ï¼š

1. **è®¾è®¡æ–‡æ¡£ä½ä¼°äº†å®Œæˆåº¦**
   - è®¾è®¡æ–‡æ¡£æ ‡æ³¨ç§Ÿæˆ·æ³¨å†Œã€åˆ†å›­ç®¡ç†ç­‰ä¸º0%
   - å®é™…è¿™äº›åŠŸèƒ½çš„ä¸šåŠ¡é€»è¾‘å·²100%å®Œæˆ
   - åªæ˜¯ç¼ºå°‘è·¯ç”±æ³¨å†Œé…ç½®

2. **è®¾è®¡æ–‡æ¡£æœªåæ˜ å®é™…è¿›åº¦**
   - åŠŸèƒ½å®ç°ä¸è®¾è®¡æ–‡æ¡£æè¿°ä¸€è‡´
   - ä½†è®¾è®¡æ–‡æ¡£çš„å®Œæˆåº¦ç»Ÿè®¡éœ€è¦æ›´æ–°

3. **éƒ¨åˆ†åŠŸèƒ½å®ç°è¶…å‡ºè®¾è®¡æ–‡æ¡£**
   - ç§Ÿæˆ·æ³¨å†Œå®ç°åŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†
   - åˆ†å›­ç®¡ç†å®ç°äº†ç»Ÿä¸€è®¤è¯ç³»ç»Ÿé›†æˆ
   - è´¦å·å¼€é€šå®ç°äº†äº‹åŠ¡ç®¡ç†

### 6.3 æ€»ä½“è¯„ä¼°

**æ ¸å¿ƒè¯„ä»·**ï¼šæ ¡åŒºéš”ç¦»åŠŸèƒ½çš„**æ ¸å¿ƒåç«¯é€»è¾‘å·²100%å®Œæˆ**ï¼Œåªéœ€è¡¥å……è·¯ç”±é…ç½®å’ŒéªŒè¯æµ‹è¯•å³å¯æŠ•å…¥ä½¿ç”¨

**å·¥ä½œé‡è¯„ä¼°**ï¼š
- è·¯ç”±æ³¨å†Œï¼š0.5å¤©
- APIé€‚é…éªŒè¯ï¼š2-3å¤©
- AIè¡¨è¡¥å……ï¼š1å¤©
- å‰ç«¯å¼€å‘ï¼š3-5å¤©ï¼ˆå¦‚éœ€è¦ï¼‰
- é›†æˆæµ‹è¯•ï¼š1-2å¤©

**æ€»è®¡**ï¼š7.5-11.5å¤©å¯å®Œæˆå…¨éƒ¨å‰©ä½™å·¥ä½œ

### 6.3 å…³é”®é£é™©æç¤º

ğŸ”´ **é«˜å±é£é™©**ï¼šç°æœ‰APIæœªå®ç°æ•°æ®èŒƒå›´è¿‡æ»¤

**é£é™©æè¿°**ï¼š
- å½“å‰æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥æŸ¥è¯¢åˆ°æ‰€æœ‰å›­åŒºçš„æ•°æ®
- å­˜åœ¨ä¸¥é‡çš„è·¨å›­åŒºæ•°æ®æ³„éœ²éšæ‚£
- æ•°æ®éš”ç¦»åŠŸèƒ½å®Œå…¨å¤±æ•ˆ

**å½±å“èŒƒå›´**ï¼š
- å­¦ç”Ÿç®¡ç†API
- ç­çº§ç®¡ç†API
- æ•™å¸ˆç®¡ç†API
- å®¶é•¿ç®¡ç†API
- æ´»åŠ¨ç®¡ç†API
- æ‹›ç”Ÿç®¡ç†API

**å»ºè®®æªæ–½**ï¼š
1. ç«‹å³åœæ­¢å¤šå›­åŒºåŠŸèƒ½çš„ä½¿ç”¨
2. ä¼˜å…ˆä¿®å¤æ ¸å¿ƒAPIçš„æ•°æ®èŒƒå›´è¿‡æ»¤
3. å…¨é¢æµ‹è¯•éªŒè¯åå†å¯¹å¤–å¼€æ”¾

âš ï¸ **ä¸­å±é£é™©**ï¼šAIè¡¨ç¼ºå°‘kindergartenIdå­—æ®µ

**é£é™©æè¿°**ï¼š
- AIå¯¹è¯è®°å½•æœªæŒ‰å›­åŒºéš”ç¦»
- å¯èƒ½æ³„éœ²å…¶ä»–å›­åŒºçš„AIä¼šè¯å†…å®¹

**å½±å“èŒƒå›´**ï¼š
- AIå¯¹è¯å†å²
- AIè®¡è´¹ç»Ÿè®¡
- AIåé¦ˆè®°å½•

**å»ºè®®æªæ–½**ï¼š
1. åœ¨ç¬¬1å‘¨å†…å®ŒæˆAIè¡¨è¡¥å……
2. éªŒè¯æ•°æ®å›å¡«æ­£ç¡®æ€§
3. æ›´æ–°AIæŸ¥è¯¢é€»è¾‘

## ä¸ƒã€èµ„æºæ¶ˆè€—é¢„ä¼°

### 7.1 äººåŠ›èµ„æº

**å¿«é€Ÿä¿®å¤è·¯å¾„ï¼ˆ1å‘¨ï¼‰**ï¼š
- åç«¯å¼€å‘ï¼š1äºº * 5å¤© = 5äººæ—¥
- æµ‹è¯•äººå‘˜ï¼š1äºº * 2å¤© = 2äººæ—¥
- **æ€»è®¡**ï¼š7äººæ—¥

**å®Œæ•´å®æ–½è·¯å¾„ï¼ˆ2-3å‘¨ï¼‰**ï¼š
- åç«¯å¼€å‘ï¼š1äºº * 7å¤© = 7äººæ—¥
- å‰ç«¯å¼€å‘ï¼š1äºº * 6å¤© = 6äººæ—¥
- æµ‹è¯•äººå‘˜ï¼š1äºº * 5å¤© = 5äººæ—¥
- **æ€»è®¡**ï¼š18äººæ—¥

### 7.2 Tokenæ¶ˆè€—

æœ¬æ¬¡æ ¸æŸ¥ä»»åŠ¡Tokenæ¶ˆè€—ï¼š
- ä»£ç æ£€ç´¢å’Œæ–‡ä»¶è¯»å–ï¼šçº¦ 15,000 tokens
- è®¾è®¡æ–‡æ¡£ç”Ÿæˆï¼šçº¦ 3,000 tokens
- **æ€»è®¡**ï¼šçº¦ 18,000 tokens

### 7.3 æ•°æ®åº“èµ„æº

**è¿ç§»è„šæœ¬å½±å“**ï¼š
- AIè¡¨æ·»åŠ å­—æ®µï¼š4ä¸ªè¡¨
- æ•°æ®å›å¡«ï¼šé¢„è®¡å½±å“æ•°æ®é‡å–å†³äºç°æœ‰AIå¯¹è¯æ•°é‡
- ç´¢å¼•æ·»åŠ ï¼š4ä¸ªæ–°ç´¢å¼•

**æ€§èƒ½å½±å“**ï¼š
- æ•°æ®èŒƒå›´è¿‡æ»¤å¢åŠ WHEREæ¡ä»¶ï¼Œé¢„è®¡å½±å“ < 5%
- æ–°å¢ç´¢å¼•å¯ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æ ¸æŸ¥å®Œæˆæ—¶é—´**ï¼š2024-12-29  
**æ ¸æŸ¥å·¥å…·**ï¼šä»£ç å®¡æŸ¥ + æ–‡ä»¶æ£€ç´¢  
**ä¸‹ä¸€æ­¥å»ºè®®**ï¼šç«‹å³å¼€å§‹ P0 ç´§æ€¥ä¿®å¤é¡¹
