# ğŸš€ æ™ºèƒ½ä»£ç†å¿«é€Ÿä¿®å¤æŒ‡å—

## ğŸ“‹ ç«‹å³è¡ŒåŠ¨æ¸…å•

### ğŸš¨ ç´§æ€¥ä¿®å¤ (ç«‹å³æ‰§è¡Œ)

#### 1. è¿è¡Œè‡ªåŠ¨å®‰å…¨ä¿®å¤
```bash
# æ‰§è¡Œå®‰å…¨ä¿®å¤è„šæœ¬
node scripts/å®‰å…¨ä¿®å¤è„šæœ¬.js

# æ£€æŸ¥ä¿®å¤ç»“æœ
ls reports/security-fix-report-*.json
```

#### 2. éªŒè¯ä¿®å¤æ•ˆæœ
```bash
# è¿è¡ŒåŠŸèƒ½æ£€æµ‹
npm run test:smart-agent

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
npm run status
```

#### 3. é‡å¯æœåŠ¡
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
npm run stop

# é‡æ–°å¯åŠ¨
npm run start
```

---

## ğŸ”§ æ‰‹åŠ¨ä¿®å¤æ­¥éª¤

### ä¿®å¤1: é»˜è®¤æƒé™æ¼æ´ ğŸ”´

**æ–‡ä»¶**: `client/src/components/ai-assistant/AIAssistant.vue`

**é—®é¢˜**: ç¬¬2446è¡Œé»˜è®¤ç»™äºˆADMINæƒé™
```typescript
// âŒ å±é™©ä»£ç 
userRole: userStore.userInfo?.role || 'ADMIN'
```

**ä¿®å¤**:
```typescript
// âœ… å®‰å…¨ä»£ç 
userRole: userStore.userInfo?.role || 'USER'
```

**æ“ä½œæ­¥éª¤**:
1. æ‰“å¼€ `client/src/components/ai-assistant/AIAssistant.vue`
2. æœç´¢ `|| 'ADMIN'`
3. æ›¿æ¢ä¸º `|| 'USER'`
4. ä¿å­˜æ–‡ä»¶

### ä¿®å¤2: æƒé™æ£€æŸ¥å¢å¼º ğŸŸ¡

**æ–‡ä»¶**: `client/src/components/ai-assistant/AIAssistant.vue`

**é—®é¢˜**: ç¬¬916è¡Œæƒé™æ£€æŸ¥è¿‡äºç®€å•
```typescript
// âŒ ç®€å•æ£€æŸ¥
const canAutoExecute = computed(() => userStore.isAdmin)
```

**ä¿®å¤**:
```typescript
// âœ… å¢å¼ºæ£€æŸ¥
const canAutoExecute = computed(() => {
  return userStore.isAdmin || 
         (userStore.userInfo?.permissions?.includes('AI_AGENT_USE') ?? false);
})
```

### ä¿®å¤3: é”™è¯¯å¤„ç†å¢å¼º ğŸŸ¡

**åˆ›å»ºæ–°æ–‡ä»¶**: `client/src/utils/errorHandler.ts`

```typescript
export class AIExecutionError extends Error {
  constructor(
    message: string,
    public code: string,
    public details?: any,
    public recoverable: boolean = true
  ) {
    super(message);
    this.name = 'AIExecutionError';
  }
}

export class ErrorHandler {
  static async executeWithRetry<T>(
    fn: () => Promise<T>,
    maxRetries: number = 3
  ): Promise<T> {
    let lastError: Error;
    
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        return await fn();
      } catch (error) {
        lastError = error as Error;
        if (attempt === maxRetries) {
          throw new AIExecutionError(
            `æ“ä½œå¤±è´¥ï¼Œå·²é‡è¯•${maxRetries}æ¬¡`,
            'MAX_RETRIES_EXCEEDED',
            { originalError: error },
            false
          );
        }
        await new Promise(resolve => 
          setTimeout(resolve, 1000 * Math.pow(2, attempt - 1))
        );
      }
    }
    throw lastError!;
  }
}
```

---

## ğŸ“Š éªŒè¯ä¿®å¤

### 1. åŠŸèƒ½æµ‹è¯•
```bash
# åŸºç¡€åŠŸèƒ½æµ‹è¯•
npm run test:smart-agent

# è¯¦ç»†æµ‹è¯•
npm run test:smart-agent:verbose
```

### 2. å®‰å…¨æµ‹è¯•
```bash
# æ£€æŸ¥æƒé™æ§åˆ¶
curl -X POST http://localhost:3000/api/ai/conversations \
  -H "Content-Type: application/json" \
  -d '{"title":"æƒé™æµ‹è¯•","metadata":{"enableTools":true}}'
```

### 3. æ€§èƒ½æµ‹è¯•
```bash
# å“åº”æ—¶é—´æµ‹è¯•
time curl -X GET http://localhost:3000/api/ai/health
```

---

## ğŸ” é—®é¢˜æ’æŸ¥

### å¸¸è§é—®é¢˜

#### Q1: ä¿®å¤è„šæœ¬æ‰§è¡Œå¤±è´¥
```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version

# æ£€æŸ¥ä¾èµ–
npm list chalk axios

# é‡æ–°å®‰è£…ä¾èµ–
npm install
```

#### Q2: æƒé™ä¿®å¤ååŠŸèƒ½å¼‚å¸¸
```bash
# æ£€æŸ¥ç”¨æˆ·æƒé™é…ç½®
# ç¡®ä¿ç”¨æˆ·å…·æœ‰ AI_AGENT_USE æƒé™

# æ£€æŸ¥æ§åˆ¶å°é”™è¯¯
# æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
```

#### Q3: æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :3000
netstat -ano | findstr :5173

# æ¸…ç†è¿›ç¨‹
npm run stop
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. æ·»åŠ ç¼“å­˜æœºåˆ¶
```typescript
// åœ¨ unified-intelligence.service.ts ä¸­æ·»åŠ 
const toolResultCache = new Map<string, { result: any, timestamp: number }>();

const getCachedResult = (key: string): any | null => {
  const cached = toolResultCache.get(key);
  if (cached && Date.now() - cached.timestamp < 5 * 60 * 1000) {
    return cached.result;
  }
  return null;
};
```

### 2. æ·»åŠ è¶…æ—¶æ§åˆ¶
```typescript
// åœ¨ API è°ƒç”¨ä¸­æ·»åŠ è¶…æ—¶
const executeWithTimeout = async <T>(
  fn: () => Promise<T>, 
  timeout: number = 30000
): Promise<T> => {
  return Promise.race([
    fn(),
    new Promise<never>((_, reject) => 
      setTimeout(() => reject(new Error('æ“ä½œè¶…æ—¶')), timeout)
    )
  ]);
};
```

---

## ğŸ¯ åç»­æ”¹è¿›

### çŸ­æœŸç›®æ ‡ (1-2å¤©)
- [ ] åº”ç”¨æ‰€æœ‰å®‰å…¨ä¿®å¤
- [ ] å®Œå–„é”™è¯¯å¤„ç†æœºåˆ¶
- [ ] æ·»åŠ è¯¦ç»†æ—¥å¿—è®°å½•

### ä¸­æœŸç›®æ ‡ (1å‘¨)
- [ ] å®ç°å·¥å…·è°ƒç”¨ç¼“å­˜
- [ ] ä¼˜åŒ–å¤æ‚åº¦è¯„ä¼°ç®—æ³•
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§

### é•¿æœŸç›®æ ‡ (1ä¸ªæœˆ)
- [ ] å®Œå–„æƒé™ç®¡ç†ç³»ç»Ÿ
- [ ] å®ç°é«˜çº§å·¥ä½œæµåŠŸèƒ½
- [ ] æ·»åŠ AIèƒ½åŠ›æ‰©å±•

---

## ğŸ“ æ”¯æŒè”ç³»

å¦‚æœåœ¨ä¿®å¤è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**: æ£€æŸ¥ `reports/` ç›®å½•ä¸‹çš„æŠ¥å‘Šæ–‡ä»¶
2. **è¿è¡Œè¯Šæ–­**: æ‰§è¡Œ `npm run test:smart-agent:verbose`
3. **æ£€æŸ¥é…ç½®**: ç¡®è®¤ `config/security.json` é…ç½®æ­£ç¡®
4. **é‡ç½®ç¯å¢ƒ**: ä½¿ç”¨å¤‡ä»½æ–‡ä»¶æ¢å¤åŸå§‹çŠ¶æ€

---

## âš¡ ä¸€é”®ä¿®å¤å‘½ä»¤

```bash
# å®Œæ•´ä¿®å¤æµç¨‹
npm run stop && \
node scripts/å®‰å…¨ä¿®å¤è„šæœ¬.js && \
npm run start && \
npm run test:smart-agent
```

è¿™ä¸ªå‘½ä»¤å°†ï¼š
1. åœæ­¢æ‰€æœ‰æœåŠ¡
2. æ‰§è¡Œå®‰å…¨ä¿®å¤
3. é‡å¯æœåŠ¡
4. è¿è¡ŒåŠŸèƒ½æµ‹è¯•

æ‰§è¡Œå®Œæˆåæ£€æŸ¥è¾“å‡ºï¼Œç¡®ä¿æ‰€æœ‰æ­¥éª¤éƒ½æˆåŠŸå®Œæˆã€‚
