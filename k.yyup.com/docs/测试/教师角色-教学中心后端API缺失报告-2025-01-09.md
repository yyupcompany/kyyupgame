# æ•™å¸ˆè§’è‰² - æ•™å­¦ä¸­å¿ƒåç«¯APIç¼ºå¤±æŠ¥å‘Š

**æŠ¥å‘Šæ—¶é—´**: 2025-01-09 00:15  
**æµ‹è¯•äººå‘˜**: AI Assistant  
**æµ‹è¯•è´¦å·**: test_teacher (æ•™å¸ˆè§’è‰²)  
**æµ‹è¯•é¡µé¢**: /teacher-center/teaching  
**é—®é¢˜ç±»å‹**: åç«¯APIç¼ºå¤±

---

## ğŸ“‹ é—®é¢˜æ¦‚è§ˆ

åœ¨æµ‹è¯•æ•™å¸ˆæ•™å­¦ä¸­å¿ƒé¡µé¢æ—¶ï¼Œå‘ç°**2ä¸ªå…³é”®APIç«¯ç‚¹ç¼ºå¤±**ï¼Œå¯¼è‡´æ•™å­¦è®°å½•å’Œå­¦ç”Ÿç®¡ç†åŠŸèƒ½æ— æ³•ä½¿ç”¨ã€‚

### ç¼ºå¤±çš„APIç«¯ç‚¹
1. âŒ `/api/teacher-dashboard/teaching/records` - æ•™å­¦è®°å½•ç®¡ç†
2. âŒ `/api/teacher-dashboard/teaching/students` - å­¦ç”Ÿç®¡ç†

---

## ğŸ” è¯¦ç»†é—®é¢˜åˆ†æ

### é—®é¢˜1: æ•™å­¦è®°å½•APIç¼ºå¤± âš ï¸

#### é”™è¯¯ä¿¡æ¯
```
GET /api/teacher-dashboard/teaching/records?_t=1759938796875 - 404 Not Found
```

#### å‰ç«¯è°ƒç”¨
**æ–‡ä»¶**: `client/src/api/modules/teacher-teaching.ts`

**è°ƒç”¨ä»£ç **:
```typescript
// è·å–æ•™å­¦è®°å½•ï¼ˆè§£åŒ…ï¼‰
getTeachingRecords: async (params?: {
  classId?: number
  startDate?: string
  endDate?: string
  page?: number
  limit?: number
}): Promise<{
  records: TeachingRecord[]
  total: number
  page: number
  limit: number
}> => {
  const res = await request.get<{
    records: TeachingRecord[]
    total: number
    page: number
    limit: number
  }>('/teacher-dashboard/teaching/records', { params })
  return res.data
}
```

#### å½±å“èŒƒå›´
- âŒ æ— æ³•æŸ¥çœ‹æ•™å­¦è®°å½•åˆ—è¡¨
- âŒ æ— æ³•åˆ›å»ºæ–°çš„æ•™å­¦è®°å½•
- âŒ æ— æ³•ç¼–è¾‘ç°æœ‰æ•™å­¦è®°å½•
- âŒ æ— æ³•åˆ é™¤æ•™å­¦è®°å½•
- âŒ æ— æ³•å¯¼å‡ºæ•™å­¦è®°å½•

#### é¡µé¢è¡¨ç°
- æ˜¾ç¤º"æš‚æ— æ•™å­¦è®°å½•"
- é”™è¯¯æç¤ºï¼š"è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨"
- é”™è¯¯æç¤ºï¼š"åŠ è½½è®°å½•æ•°æ®å¤±è´¥"

---

### é—®é¢˜2: å­¦ç”Ÿç®¡ç†APIç¼ºå¤± âš ï¸

#### é”™è¯¯ä¿¡æ¯
```
GET /api/teacher-dashboard/teaching/students?_t=1759938816810 - 404 Not Found
```

#### å‰ç«¯è°ƒç”¨
**æ–‡ä»¶**: `client/src/api/modules/teacher-teaching.ts`

**è°ƒç”¨ä»£ç **:
```typescript
// è·å–å­¦ç”Ÿåˆ—è¡¨ï¼ˆè§£åŒ…ï¼‰
getStudentsList: async (params?: {
  classId?: number
  page?: number
  limit?: number
}): Promise<{
  students: StudentInfo[]
  total: number
  page: number
  limit: number
}> => {
  const res = await request.get<{
    students: StudentInfo[]
    total: number
    page: number
    limit: number
  }>('/teacher-dashboard/teaching/students', { params })
  return res.data
}
```

#### å½±å“èŒƒå›´
- âŒ æ— æ³•æŸ¥çœ‹å­¦ç”Ÿåˆ—è¡¨
- âŒ æ— æ³•æŸ¥çœ‹å­¦ç”Ÿè¯¦æƒ…
- âŒ æ— æ³•æŒ‰ç­çº§ç­›é€‰å­¦ç”Ÿ
- âŒ æ— æ³•æŒ‰æ€§åˆ«ç­›é€‰å­¦ç”Ÿ
- âŒ æ— æ³•æœç´¢å­¦ç”Ÿ

#### é¡µé¢è¡¨ç°
- æ˜¾ç¤º"æš‚æ— å­¦ç”Ÿæ•°æ®"
- é”™è¯¯æç¤ºï¼š"è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨"
- é”™è¯¯æç¤ºï¼š"åŠ è½½å­¦ç”Ÿæ•°æ®å¤±è´¥"

---

## ğŸ¯ éœ€è¦å®ç°çš„APIç«¯ç‚¹

### 1. æ•™å­¦è®°å½•ç®¡ç†API

#### 1.1 è·å–æ•™å­¦è®°å½•åˆ—è¡¨
```
GET /api/teacher-dashboard/teaching/records
```

**è¯·æ±‚å‚æ•°**:
```typescript
{
  classId?: number      // ç­çº§IDï¼ˆå¯é€‰ï¼‰
  startDate?: string    // å¼€å§‹æ—¥æœŸï¼ˆå¯é€‰ï¼‰
  endDate?: string      // ç»“æŸæ—¥æœŸï¼ˆå¯é€‰ï¼‰
  page?: number         // é¡µç ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼‰
  limit?: number        // æ¯é¡µæ•°é‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤10ï¼‰
}
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: true,
  data: {
    records: [
      {
        id: number
        classId: number
        className: string
        courseName: string
        teachingDate: string
        duration: number
        content: string
        homework: string
        notes: string
        attachments: string[]
        createdAt: string
        updatedAt: string
      }
    ],
    total: number
    page: number
    limit: number
  }
}
```

#### 1.2 åˆ›å»ºæ•™å­¦è®°å½•
```
POST /api/teacher-dashboard/teaching/records
```

**è¯·æ±‚ä½“**:
```typescript
{
  classId: number
  courseName: string
  teachingDate: string
  duration: number
  content: string
  homework?: string
  notes?: string
  attachments?: string[]
}
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: true,
  data: {
    id: number
    classId: number
    className: string
    courseName: string
    teachingDate: string
    duration: number
    content: string
    homework: string
    notes: string
    attachments: string[]
    createdAt: string
    updatedAt: string
  }
}
```

#### 1.3 æ›´æ–°æ•™å­¦è®°å½•
```
PUT /api/teacher-dashboard/teaching/records/:id
```

**è¯·æ±‚ä½“**:
```typescript
{
  courseName?: string
  teachingDate?: string
  duration?: number
  content?: string
  homework?: string
  notes?: string
  attachments?: string[]
}
```

**å“åº”æ ¼å¼**: åŒåˆ›å»ºæ•™å­¦è®°å½•

#### 1.4 åˆ é™¤æ•™å­¦è®°å½•
```
DELETE /api/teacher-dashboard/teaching/records/:id
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: true,
  message: "æ•™å­¦è®°å½•åˆ é™¤æˆåŠŸ"
}
```

---

### 2. å­¦ç”Ÿç®¡ç†API

#### 2.1 è·å–å­¦ç”Ÿåˆ—è¡¨
```
GET /api/teacher-dashboard/teaching/students
```

**è¯·æ±‚å‚æ•°**:
```typescript
{
  classId?: number      // ç­çº§IDï¼ˆå¯é€‰ï¼‰
  gender?: string       // æ€§åˆ«ï¼ˆå¯é€‰ï¼šmale/femaleï¼‰
  keyword?: string      // æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼‰
  page?: number         // é¡µç ï¼ˆå¯é€‰ï¼Œé»˜è®¤1ï¼‰
  limit?: number        // æ¯é¡µæ•°é‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤12ï¼‰
}
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: true,
  data: {
    students: [
      {
        id: number
        name: string
        gender: string
        age: number
        classId: number
        className: string
        avatar: string
        parentName: string
        parentPhone: string
        enrollmentDate: string
        status: string
      }
    ],
    total: number
    page: number
    limit: number
  }
}
```

#### 2.2 è·å–å­¦ç”Ÿè¯¦æƒ…
```
GET /api/teacher-dashboard/teaching/students/:id
```

**å“åº”æ ¼å¼**:
```typescript
{
  success: true,
  data: {
    id: number
    name: string
    gender: string
    age: number
    classId: number
    className: string
    avatar: string
    parentName: string
    parentPhone: string
    enrollmentDate: string
    status: string
    records: [
      {
        id: number
        courseName: string
        teachingDate: string
        content: string
        notes: string
      }
    ],
    progress: [
      {
        id: number
        courseName: string
        totalSessions: number
        completedSessions: number
        completionRate: number
      }
    ]
  }
}
```

---

## ğŸ“Š åç«¯å®ç°å»ºè®®

### æ–‡ä»¶ç»“æ„
```
server/src/
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ teacher-dashboard.controller.ts  # æ·»åŠ æ–°æ–¹æ³•
â”œâ”€â”€ services/
â”‚   â””â”€â”€ teacher-dashboard.service.ts     # æ·»åŠ ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ teacher-dashboard.routes.ts      # æ·»åŠ è·¯ç”±
â””â”€â”€ models/
    â”œâ”€â”€ teaching-record.model.ts         # æ•™å­¦è®°å½•æ¨¡å‹ï¼ˆå¯èƒ½éœ€è¦åˆ›å»ºï¼‰
    â””â”€â”€ student.model.ts                 # å­¦ç”Ÿæ¨¡å‹ï¼ˆå·²å­˜åœ¨ï¼‰
```

### æ§åˆ¶å™¨æ–¹æ³•
**æ–‡ä»¶**: `server/src/controllers/teacher-dashboard.controller.ts`

```typescript
// æ•™å­¦è®°å½•ç®¡ç†
export const getTeachingRecords = async (req: Request, res: Response) => {
  try {
    const { classId, startDate, endDate, page = 1, limit = 10 } = req.query;
    const teacherId = req.user.id;
    
    // å®ç°æŸ¥è¯¢é€»è¾‘
    const records = await TeacherDashboardService.getTeachingRecords({
      teacherId,
      classId: classId ? Number(classId) : undefined,
      startDate: startDate as string,
      endDate: endDate as string,
      page: Number(page),
      limit: Number(limit)
    });
    
    res.json({
      success: true,
      data: records
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'è·å–æ•™å­¦è®°å½•å¤±è´¥',
      error: error.message
    });
  }
};

export const createTeachingRecord = async (req: Request, res: Response) => {
  try {
    const teacherId = req.user.id;
    const recordData = req.body;
    
    const record = await TeacherDashboardService.createTeachingRecord({
      ...recordData,
      teacherId
    });
    
    res.json({
      success: true,
      data: record
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'åˆ›å»ºæ•™å­¦è®°å½•å¤±è´¥',
      error: error.message
    });
  }
};

// å­¦ç”Ÿç®¡ç†
export const getStudentsList = async (req: Request, res: Response) => {
  try {
    const { classId, gender, keyword, page = 1, limit = 12 } = req.query;
    const teacherId = req.user.id;
    
    const students = await TeacherDashboardService.getStudentsList({
      teacherId,
      classId: classId ? Number(classId) : undefined,
      gender: gender as string,
      keyword: keyword as string,
      page: Number(page),
      limit: Number(limit)
    });
    
    res.json({
      success: true,
      data: students
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      message: 'è·å–å­¦ç”Ÿåˆ—è¡¨å¤±è´¥',
      error: error.message
    });
  }
};
```

### è·¯ç”±é…ç½®
**æ–‡ä»¶**: `server/src/routes/teacher-dashboard.routes.ts`

```typescript
// æ•™å­¦è®°å½•ç®¡ç†
router.get('/teaching/records',
  requireRole(['teacher', 'admin']),
  TeacherDashboardController.getTeachingRecords
);

router.post('/teaching/records',
  requireRole(['teacher', 'admin']),
  TeacherDashboardController.createTeachingRecord
);

router.put('/teaching/records/:id',
  requireRole(['teacher', 'admin']),
  TeacherDashboardController.updateTeachingRecord
);

router.delete('/teaching/records/:id',
  requireRole(['teacher', 'admin']),
  TeacherDashboardController.deleteTeachingRecord
);

// å­¦ç”Ÿç®¡ç†
router.get('/teaching/students',
  requireRole(['teacher', 'admin']),
  TeacherDashboardController.getStudentsList
);

router.get('/teaching/students/:id',
  requireRole(['teacher', 'admin']),
  TeacherDashboardController.getStudentDetail
);
```

---

## ğŸ“ å®ç°ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®ç°ï¼‰
1. âœ… `GET /api/teacher-dashboard/teaching/records` - è·å–æ•™å­¦è®°å½•åˆ—è¡¨
2. âœ… `GET /api/teacher-dashboard/teaching/students` - è·å–å­¦ç”Ÿåˆ—è¡¨

### ä¸­ä¼˜å…ˆçº§ï¼ˆå»ºè®®å®ç°ï¼‰
3. âœ… `POST /api/teacher-dashboard/teaching/records` - åˆ›å»ºæ•™å­¦è®°å½•
4. âœ… `PUT /api/teacher-dashboard/teaching/records/:id` - æ›´æ–°æ•™å­¦è®°å½•
5. âœ… `DELETE /api/teacher-dashboard/teaching/records/:id` - åˆ é™¤æ•™å­¦è®°å½•
6. âœ… `GET /api/teacher-dashboard/teaching/students/:id` - è·å–å­¦ç”Ÿè¯¦æƒ…

### ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰å®ç°ï¼‰
7. â­• `POST /api/teacher-dashboard/teaching/records/export` - å¯¼å‡ºæ•™å­¦è®°å½•

---

## ğŸ¯ é¢„è®¡å·¥ä½œé‡

### æ•™å­¦è®°å½•APIå®ç°
- åˆ›å»ºæ•°æ®æ¨¡å‹: 15åˆ†é’Ÿ
- å®ç°Serviceå±‚: 30åˆ†é’Ÿ
- å®ç°Controllerå±‚: 15åˆ†é’Ÿ
- é…ç½®è·¯ç”±: 5åˆ†é’Ÿ
- æµ‹è¯•éªŒè¯: 15åˆ†é’Ÿ
- **å°è®¡**: 80åˆ†é’Ÿ

### å­¦ç”Ÿç®¡ç†APIå®ç°
- å®ç°Serviceå±‚: 20åˆ†é’Ÿ
- å®ç°Controllerå±‚: 10åˆ†é’Ÿ
- é…ç½®è·¯ç”±: 5åˆ†é’Ÿ
- æµ‹è¯•éªŒè¯: 10åˆ†é’Ÿ
- **å°è®¡**: 45åˆ†é’Ÿ

### æ€»è®¡
- **é¢„è®¡æ€»æ—¶é—´**: 125åˆ†é’Ÿï¼ˆçº¦2å°æ—¶ï¼‰

---

## ğŸ“¸ æµ‹è¯•æˆªå›¾

### æ•™å­¦è®°å½•Tabé”™è¯¯
- æ–‡ä»¶: `teacher-teaching-records-tab-error.png`
- é”™è¯¯: 404 Not Found
- æç¤º: "æš‚æ— æ•™å­¦è®°å½•"

### å­¦ç”Ÿç®¡ç†Tabé”™è¯¯
- æ–‡ä»¶: `teacher-teaching-students-tab-error.png`
- é”™è¯¯: 404 Not Found
- æç¤º: "æš‚æ— å­¦ç”Ÿæ•°æ®"

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-09 00:20  
**é—®é¢˜çŠ¶æ€**: å¾…ä¿®å¤  
**ä¼˜å…ˆçº§**: é«˜  
**é¢„è®¡ä¿®å¤æ—¶é—´**: 2å°æ—¶

