# å›­é•¿è§’è‰²æƒé™é—®é¢˜æ€»ç»“

**é—®é¢˜å‘ç°æ—¥æœŸ**: 2025-01-08  
**é—®é¢˜å‘ç°æ—¶é—´**: 22:40  
**å½“å‰åˆ†æ”¯**: AIDEBUG1

---

## ğŸ”´ æ ¸å¿ƒé—®é¢˜

### é—®é¢˜æè¿°

**ç”¨æˆ·éœ€æ±‚**: å›­é•¿è§’è‰²åº”è¯¥æ¯” admin è§’è‰²å°‘ä¸€ä¸ª"ç³»ç»Ÿä¸­å¿ƒ"

**å®é™…æƒ…å†µ**: å›­é•¿è§’è‰²ç›®å‰**æœ‰**ç³»ç»Ÿä¸­å¿ƒæƒé™

---

## ğŸ“Š å½“å‰çŠ¶æ€

### è§’è‰²å¯¹æ¯”

| æŒ‡æ ‡ | å›­é•¿(principal) | ç®¡ç†å‘˜(admin) | å·®å¼‚ |
|------|-----------------|---------------|------|
| æƒé™æ•°é‡ | 56ä¸ª | 149ä¸ª | +93ä¸ª (ç®¡ç†å‘˜å¤š) |
| è·¯ç”±æ•°é‡ | 50ä¸ª | 89ä¸ª | +39ä¸ª (ç®¡ç†å‘˜å¤š) |
| ä¸­å¿ƒèœå• | **12ä¸ª** | **22ä¸ª** | +10ä¸ª (ç®¡ç†å‘˜å¤š) |

### å›­é•¿çš„12ä¸ªä¸­å¿ƒèœå•

1. âœ… Personnel Center (äººå‘˜ä¸­å¿ƒ)
2. âœ… Activity Center (æ´»åŠ¨ä¸­å¿ƒ)
3. âœ… Enrollment Center (æ‹›ç”Ÿä¸­å¿ƒ)
4. âœ… Marketing Center (è¥é”€ä¸­å¿ƒ)
5. âœ… Customer Pool Center (å®¢æˆ·æ± ä¸­å¿ƒ)
6. âœ… Task Center (ä»»åŠ¡ä¸­å¿ƒ)
7. âš ï¸  **System Center (ç³»ç»Ÿä¸­å¿ƒ)** â† **éœ€è¦ç§»é™¤**
8. âœ… Finance Center (è´¢åŠ¡ä¸­å¿ƒ)
9. âœ… Teaching Center (æ•™å­¦ä¸­å¿ƒ)
10. âœ… Script Center (è¯æœ¯ä¸­å¿ƒ)
11. âœ… Media Center (åª’ä½“ä¸­å¿ƒ)
12. âœ… ä¸»ä»ªè¡¨æ¿

### ç®¡ç†å‘˜ä¸“å±èœå• (5ä¸ª)

1. Business Center (ä¸šåŠ¡ä¸­å¿ƒ)
2. Notification Center (é€šçŸ¥ä¸­å¿ƒ)
3. Inspection Center (å·¡æ£€ä¸­å¿ƒ)
4. å®¶é•¿ä¸­å¿ƒ
5. æ•™å¸ˆä¸­å¿ƒ

---

## ğŸ” é—®é¢˜åˆ†æ

### ç³»ç»Ÿä¸­å¿ƒæƒé™è¯¦æƒ…

**æƒé™ID**: 2013  
**æƒé™ä»£ç **: SYSTEM_CENTER  
**æƒé™åç§°**: ç³»ç»Ÿä¸­å¿ƒ  
**è·¯å¾„**: /centers/system  

**å½“å‰çŠ¶æ€**: 
- âœ… admin è§’è‰²æœ‰æ­¤æƒé™
- âš ï¸  principal è§’è‰²ä¹Ÿæœ‰æ­¤æƒé™ï¼ˆ**éœ€è¦ç§»é™¤**ï¼‰

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä»æ•°æ®åº“ç§»é™¤æƒé™ï¼ˆæ¨èï¼‰

**SQL å‘½ä»¤**:
```sql
-- ç§»é™¤å›­é•¿è§’è‰²çš„ç³»ç»Ÿä¸­å¿ƒæƒé™
DELETE FROM role_permissions 
WHERE permission_id = 2013 
AND role_id = (SELECT id FROM roles WHERE name = 'principal');
```

**æ‰§è¡Œæ­¥éª¤**:
1. è¿æ¥åˆ°æ•°æ®åº“
2. æ‰§è¡Œä¸Šè¿° SQL å‘½ä»¤
3. é‡æ–°ç™»å½• principal è´¦å·éªŒè¯

**é¢„æœŸç»“æœ**:
- å›­é•¿ä¸­å¿ƒèœå•: 12ä¸ª â†’ **11ä¸ª**
- ç§»é™¤: System Center (ç³»ç»Ÿä¸­å¿ƒ)

---

### æ–¹æ¡ˆ2: é€šè¿‡æƒé™ç®¡ç†APIç§»é™¤ï¼ˆå¦‚æœæœ‰ï¼‰

å¦‚æœç³»ç»Ÿæœ‰æƒé™ç®¡ç†APIï¼Œå¯ä»¥é€šè¿‡APIç§»é™¤ï¼š

```bash
DELETE /api/roles/{principal_role_id}/permissions/{2013}
```

---

## ğŸ“‹ ç™»å½•é¡µé¢é…ç½®é—®é¢˜

### å½“å‰é…ç½®

**æ–‡ä»¶**: `client/src/pages/Login/index.vue` (ç¬¬437è¡Œ)

```javascript
const credentials = {
  admin: { username: 'admin', password: 'admin123' },
  principal: { username: 'test_admin', password: 'admin123' },  // âŒ é”™è¯¯
  teacher: { username: 'test_teacher', password: 'admin123' },
  parent: { username: 'test_parent', password: 'admin123' }
}
```

### é—®é¢˜

| æŒ‰é’®æ˜¾ç¤º | é…ç½®ç”¨æˆ·å | å®é™…è§’è‰² | æœŸæœ›è§’è‰² | çŠ¶æ€ |
|----------|------------|----------|----------|------|
| ç³»ç»Ÿç®¡ç†å‘˜ | `admin` | `admin` | `admin` | âœ… æ­£ç¡® |
| **å›­é•¿** | `test_admin` | **`admin`** | `principal` | âŒ **é”™è¯¯** |
| æ•™å¸ˆ | `test_teacher` | `teacher` | `teacher` | âœ… æ­£ç¡® |
| å®¶é•¿ | `test_parent` | - | `parent` | âŒ ä¸å­˜åœ¨ |

### ä¿®å¤æ–¹æ¡ˆ

#### é€‰é¡¹1: ä½¿ç”¨ç°æœ‰ principal è´¦å·

```javascript
const credentials = {
  admin: { username: 'admin', password: 'admin123' },
  principal: { username: 'principal', password: '123456' },  // âœ… ä¿®æ”¹
  teacher: { username: 'test_teacher', password: 'admin123' },
  parent: { username: 'test_parent', password: 'admin123' }
}
```

#### é€‰é¡¹2: åˆ›å»º test_principal è´¦å·

1. åœ¨æ•°æ®åº“ä¸­åˆ›å»ºç”¨æˆ·ï¼š
```sql
INSERT INTO users (username, password, role, email, status) 
VALUES ('test_principal', '$2b$10$...', 'principal', 'principal@test.com', 'active');
```

2. ä¿®æ”¹ç™»å½•é…ç½®ï¼š
```javascript
const credentials = {
  admin: { username: 'admin', password: 'admin123' },
  principal: { username: 'test_principal', password: 'admin123' },  // âœ… ä¿®æ”¹
  teacher: { username: 'test_teacher', password: 'admin123' },
  parent: { username: 'test_parent', password: 'admin123' }
}
```

---

## ğŸ¯ å®Œæ•´ä¿®å¤æ­¥éª¤

### æ­¥éª¤1: ç§»é™¤å›­é•¿çš„ç³»ç»Ÿä¸­å¿ƒæƒé™

```sql
-- è¿æ¥æ•°æ®åº“
mysql -h dbconn.sealoshzh.site -P 43906 -u root -p

-- åˆ‡æ¢æ•°æ®åº“
USE kindergarten_management;

-- ç§»é™¤æƒé™
DELETE FROM role_permissions 
WHERE permission_id = 2013 
AND role_id = (SELECT id FROM roles WHERE name = 'principal');

-- éªŒè¯
SELECT COUNT(*) FROM role_permissions 
WHERE permission_id = 2013 
AND role_id = (SELECT id FROM roles WHERE name = 'principal');
-- åº”è¯¥è¿”å› 0
```

### æ­¥éª¤2: ä¿®å¤ç™»å½•é¡µé¢é…ç½®

**æ–‡ä»¶**: `client/src/pages/Login/index.vue`

**ä¿®æ”¹ç¬¬437è¡Œ**:
```javascript
// ä¿®æ”¹å‰
principal: { username: 'test_admin', password: 'admin123' },

// ä¿®æ”¹å
principal: { username: 'principal', password: '123456' },
```

### æ­¥éª¤3: éªŒè¯ä¿®å¤

1. **é‡æ–°ç™»å½• principal è´¦å·**:
```bash
node scripts/compare-principal-admin.cjs
```

2. **æ£€æŸ¥ä¸­å¿ƒèœå•æ•°é‡**:
   - å›­é•¿: åº”è¯¥æ˜¯ **11ä¸ª** (ç§»é™¤äº†ç³»ç»Ÿä¸­å¿ƒ)
   - ç®¡ç†å‘˜: åº”è¯¥æ˜¯ **22ä¸ª** (ä¿æŒä¸å˜)

3. **æ£€æŸ¥ç³»ç»Ÿä¸­å¿ƒ**:
   - å›­é•¿: âŒ æ²¡æœ‰ç³»ç»Ÿä¸­å¿ƒ
   - ç®¡ç†å‘˜: âœ… æœ‰ç³»ç»Ÿä¸­å¿ƒ

---

## ğŸ“Š ä¿®å¤åçš„é¢„æœŸç»“æœ

### è§’è‰²å¯¹æ¯”ï¼ˆä¿®å¤åï¼‰

| æŒ‡æ ‡ | å›­é•¿(principal) | ç®¡ç†å‘˜(admin) | å·®å¼‚ |
|------|-----------------|---------------|------|
| æƒé™æ•°é‡ | **55ä¸ª** | 149ä¸ª | +94ä¸ª (ç®¡ç†å‘˜å¤š) |
| ä¸­å¿ƒèœå• | **11ä¸ª** | **22ä¸ª** | +11ä¸ª (ç®¡ç†å‘˜å¤š) |

### å›­é•¿çš„11ä¸ªä¸­å¿ƒèœå•ï¼ˆä¿®å¤åï¼‰

1. âœ… Personnel Center (äººå‘˜ä¸­å¿ƒ)
2. âœ… Activity Center (æ´»åŠ¨ä¸­å¿ƒ)
3. âœ… Enrollment Center (æ‹›ç”Ÿä¸­å¿ƒ)
4. âœ… Marketing Center (è¥é”€ä¸­å¿ƒ)
5. âœ… Customer Pool Center (å®¢æˆ·æ± ä¸­å¿ƒ)
6. âœ… Task Center (ä»»åŠ¡ä¸­å¿ƒ)
7. âœ… Finance Center (è´¢åŠ¡ä¸­å¿ƒ)
8. âœ… Teaching Center (æ•™å­¦ä¸­å¿ƒ)
9. âœ… Script Center (è¯æœ¯ä¸­å¿ƒ)
10. âœ… Media Center (åª’ä½“ä¸­å¿ƒ)
11. âœ… ä¸»ä»ªè¡¨æ¿

### ç®¡ç†å‘˜ä¸“å±èœå•ï¼ˆä¿®å¤åï¼Œ6ä¸ªï¼‰

1. **System Center (ç³»ç»Ÿä¸­å¿ƒ)** â† **æ–°å¢åˆ°ä¸“å±åˆ—è¡¨**
2. Business Center (ä¸šåŠ¡ä¸­å¿ƒ)
3. Notification Center (é€šçŸ¥ä¸­å¿ƒ)
4. Inspection Center (å·¡æ£€ä¸­å¿ƒ)
5. å®¶é•¿ä¸­å¿ƒ
6. æ•™å¸ˆä¸­å¿ƒ

---

## ğŸ“ æµ‹è¯•è„šæœ¬

å·²åˆ›å»ºçš„æµ‹è¯•è„šæœ¬ï¼š

1. `scripts/compare-principal-admin.cjs` - å¯¹æ¯”å›­é•¿å’Œç®¡ç†å‘˜æƒé™
2. `scripts/remove-principal-system-center.cjs` - æŸ¥æ‰¾ç³»ç»Ÿä¸­å¿ƒæƒé™
3. `scripts/verify-login-roles.cjs` - éªŒè¯ç™»å½•é¡µé¢è§’è‰²é…ç½®
4. `scripts/test-principal-account.cjs` - æµ‹è¯• test_principal è´¦å·

---

## ğŸ” ç›¸å…³æ–‡ä»¶

### å‰ç«¯
- `client/src/pages/Login/index.vue` - ç™»å½•é¡µé¢ï¼ˆéœ€è¦ä¿®æ”¹ç¬¬437è¡Œï¼‰

### åç«¯
- `server/src/models/user.model.ts` - ç”¨æˆ·æ¨¡å‹
- `server/src/middlewares/role.middleware.ts` - è§’è‰²ä¸­é—´ä»¶

### æ•°æ®åº“
- `role_permissions` è¡¨ - è§’è‰²æƒé™å…³è”è¡¨
- `permissions` è¡¨ - æƒé™è¡¨
- `roles` è¡¨ - è§’è‰²è¡¨

---

## âœ… æ€»ç»“

### éœ€è¦æ‰§è¡Œçš„æ“ä½œ

1. âœ… **æ•°æ®åº“æ“ä½œ**: ç§»é™¤ principal è§’è‰²çš„ç³»ç»Ÿä¸­å¿ƒæƒé™ï¼ˆæƒé™ID: 2013ï¼‰
2. âœ… **å‰ç«¯ä¿®æ”¹**: ä¿®æ”¹ç™»å½•é¡µé¢é…ç½®ï¼Œä½¿ç”¨æ­£ç¡®çš„ principal è´¦å·
3. âœ… **éªŒè¯æµ‹è¯•**: é‡æ–°æµ‹è¯•å›­é•¿å’Œç®¡ç†å‘˜çš„æƒé™å·®å¼‚

### é¢„æœŸæ•ˆæœ

- âœ… å›­é•¿è§’è‰²: **11ä¸ªä¸­å¿ƒèœå•**ï¼ˆæ²¡æœ‰ç³»ç»Ÿä¸­å¿ƒï¼‰
- âœ… ç®¡ç†å‘˜è§’è‰²: **22ä¸ªä¸­å¿ƒèœå•**ï¼ˆæœ‰ç³»ç»Ÿä¸­å¿ƒï¼‰
- âœ… å›­é•¿æ¯”ç®¡ç†å‘˜å°‘ **1ä¸ªç³»ç»Ÿä¸­å¿ƒ** â† **ç¬¦åˆéœ€æ±‚**

---

**åˆ›å»ºæ—¶é—´**: 2025-01-08 22:40  
**åˆ›å»ºäººå‘˜**: AI Assistant  
**çŠ¶æ€**: âš ï¸  **å¾…ä¿®å¤**

