# 检查中心开发文档

## 📋 文档概述

**版本**: v1.0
**创建日期**: 2025-10-04
**最后更新**: 2025-10-04
**作者**: AI Assistant
**状态**: 开发阶段

---

## 🎯 功能目标

检查中心是幼儿园管理系统的核心功能模块，旨在通过Timeline方式直观展示全年检查计划，实现文档模板化管理，支持智能提醒和任务分解，帮助幼儿园高效应对各类检查。

### 核心功能

1. **Timeline可视化展示**：以时间轴方式展示年度检查计划，直观显示检查时间点和状态
2. **文档模板化管理**：将检查所需文档模板化，支持变量替换，快速生成各类文档
3. **智能提醒系统**：根据检查时间自动设置提醒，避免遗漏重要检查
4. **任务分解分配**：将检查准备工作分解为具体任务，分配给相关人员
5. **多级检查适配**：支持不同行政级别（一线/二线/三线城市、县级、乡镇）的检查要求
6. **进度跟踪管理**：实时跟踪检查准备进度，确保按时完成

---

## 📊 幼儿园检查体系研究

### 1. 检查类型分类

根据教育部及各地教育行政部门的要求，幼儿园主要面临以下检查：

#### 1.1 年度检查类

| 检查类型 | 检查周期 | 检查时间 | 检查部门 | 适用范围 |
|---------|---------|---------|---------|---------|
| **年检** | 每年1次 | 每年8-9月 | 教育局 | 所有幼儿园 |
| **办园行为督导评估** | 3-5年1次 | 不固定 | 教育督导部门 | 所有幼儿园 |
| **等级评估** | 3年1次 | 申报后 | 教育局 | 申报幼儿园 |
| **普惠性认定** | 3年1次 | 每年认定 | 教育局+财政局 | 民办幼儿园 |

#### 1.2 专项检查类

| 检查类型 | 检查频次 | 检查时间 | 检查部门 | 重点内容 |
|---------|---------|---------|---------|---------|
| **卫生保健检查** | 每年2-4次 | 春秋季+不定期 | 卫生健康委 | 晨检、消毒、疾病防控 |
| **食品安全检查** | 每年至少1次 | 春秋季开学前 | 市场监管局 | 食材采购、加工、留样 |
| **消防安全检查** | 每年2次 | 春秋季开学前 | 消防救援支队 | 消防设施、疏散通道 |
| **校车安全检查** | 每学期1次 | 开学前 | 交警支队 | 车况、驾驶员资质 |
| **安全生产检查** | 每季度1次 | 季度末 | 应急管理局 | 安全隐患排查 |

#### 1.3 常态化督导类

| 检查类型 | 检查频次 | 检查方式 | 检查人员 | 重点内容 |
|---------|---------|---------|---------|---------|
| **责任督学挂牌督导** | 每月2次 | 实地检查 | 责任督学 | 办园行为、保教质量 |
| **日常巡查** | 不定期 | 随机抽查 | 教育局工作人员 | 规范办园 |

### 2. 不同行政级别检查差异

#### 2.1 一线城市(北上广深)

**特点**: 检查频次高、标准严格、信息化程度高

| 检查项目 | 频次 | 特殊要求 |
|---------|------|---------|
| 年检 | 每年1次 | 需在线提交材料，现场核查 |
| 办园行为督导 | 每3年全覆盖 | 每年不少于1/3幼儿园 |
| 卫生保健 | 每季度1次 | 需配备专职保健医生 |
| 食品安全 | 每月1次 | 需接入"明厨亮灶"系统 |
| 消防安全 | 每学期1次 | 需配备自动喷淋系统 |
| 责任督学 | 每月2次 | 需提交月度报告 |

**年度检查时间表**:
- 1月: 寒假安全检查
- 2-3月: 春季开学检查(食品、消防、卫生)
- 4-5月: 办园行为督导评估(部分园)
- 6月: 夏季食品安全专项检查
- 7月: 暑假安全检查
- 8-9月: 年检 + 秋季开学检查
- 10-11月: 办园行为督导评估(部分园)
- 12月: 年度安全生产检查

#### 2.2 二线城市

**特点**: 检查频次适中、标准较严、逐步信息化

| 检查项目 | 频次 | 特殊要求 |
|---------|------|---------|
| 年检 | 每年1次 | 纸质+电子材料 |
| 办园行为督导 | 每5年全覆盖 | 每年不少于1/5幼儿园 |
| 卫生保健 | 每学期2次 | 需配备保健医生或保健员 |
| 食品安全 | 每学期1次 | 推荐接入"明厨亮灶" |
| 消防安全 | 每学期1次 | 需配备消防设施 |
| 责任督学 | 每月1-2次 | 需提交季度报告 |

**年度检查时间表**:
- 2-3月: 春季开学检查
- 5-6月: 办园行为督导评估(部分园)
- 8-9月: 年检 + 秋季开学检查
- 11-12月: 年度总结检查

#### 2.3 三线城市

**特点**: 检查频次基本、标准适中、部分信息化

| 检查项目 | 频次 | 特殊要求 |
|---------|------|---------|
| 年检 | 每年1次 | 主要纸质材料 |
| 办园行为督导 | 每5年全覆盖 | 每年不少于1/5幼儿园 |
| 卫生保健 | 每学期1次 | 需配备保健员 |
| 食品安全 | 每学期1次 | 基本食品安全要求 |
| 消防安全 | 每学期1次 | 基本消防设施 |
| 责任督学 | 每月1次 | 需提交学期报告 |

**年度检查时间表**:
- 3月: 春季开学检查
- 6月: 办园行为督导评估(部分园)
- 9月: 年检 + 秋季开学检查
- 12月: 年度安全检查

#### 2.4 县级

**特点**: 检查频次基本、标准适中、传统方式为主

| 检查项目 | 频次 | 特殊要求 |
|---------|------|---------|
| 年检 | 每年1次 | 纸质材料为主 |
| 办园行为督导 | 每5年全覆盖 | 每年不少于1/5幼儿园 |
| 卫生保健 | 每学期1次 | 可兼职保健员 |
| 食品安全 | 每学期1次 | 基本食品安全 |
| 消防安全 | 每学期1次 | 基本消防设施 |
| 责任督学 | 每学期2-3次 | 需提交学期报告 |

**年度检查时间表**:
- 3月: 春季开学检查
- 9月: 年检 + 秋季开学检查
- 12月: 年度总结

#### 2.5 乡镇

**特点**: 检查频次较少、标准基本、传统方式

| 检查项目 | 频次 | 特殊要求 |
|---------|------|---------|
| 年检 | 每年1次 | 纸质材料 |
| 办园行为督导 | 不定期 | 抽查方式 |
| 卫生保健 | 每年1次 | 基本卫生要求 |
| 食品安全 | 每年1次 | 基本食品安全 |
| 消防安全 | 每年1次 | 基本消防安全 |
| 责任督学 | 每学期1-2次 | 简化报告 |

**年度检查时间表**:
- 3月: 春季开学检查
- 9月: 年检 + 秋季开学检查

---

## 🏗️ 系统架构设计

### 1. 技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                        前端层 (Vue 3)                        │
├─────────────────────────────────────────────────────────────┤
│  检查中心页面  │  Timeline视图  │  文档管理  │  任务管理  │
│  提醒设置     │  进度跟踪     │  模板编辑  │  人员分配  │
└─────────────────────────────────────────────────────────────┘
                              ↓↑ HTTP/REST API
┌─────────────────────────────────────────────────────────────┐
│                      后端层 (Express.js)                     │
├─────────────────────────────────────────────────────────────┤
│  检查管理服务  │  文档服务  │  任务服务  │  提醒服务  │
│  模板引擎     │  权限控制  │  通知服务  │  统计分析  │
└─────────────────────────────────────────────────────────────┘
                              ↓↑ Sequelize ORM
┌─────────────────────────────────────────────────────────────┐
│                       数据层 (MySQL)                         │
├─────────────────────────────────────────────────────────────┤
│  检查类型表  │  检查计划表  │  文档模板表  │  任务表  │
│  提醒表     │  进度记录表  │  变量配置表  │  日志表  │
└─────────────────────────────────────────────────────────────┘
```

### 2. 核心功能模块

#### 2.1 检查管理模块

**功能**:
- 检查类型管理(增删改查)
- 检查计划管理(年度计划、周期性计划)
- 检查记录管理(检查结果、整改记录)
- 检查统计分析

**关键特性**:
- 支持多级分类(年度检查、专项检查、常态化督导)
- 支持周期性自动生成检查计划
- 支持检查结果评分和等级评定
- 支持检查历史记录查询

#### 2.2 Timeline可视化模块

**功能**:
- 年度检查时间轴展示
- 月度检查日历视图
- 检查状态标识(未开始、准备中、已完成、已逾期)
- 检查详情快速查看

**关键特性**:
- 响应式设计，支持PC和移动端
- 支持拖拽调整检查时间
- 支持筛选和搜索
- 支持导出为PDF/Excel

#### 2.3 文档模板模块

**功能**:
- 文档模板管理(上传、编辑、删除)
- 变量配置管理(定义变量、设置默认值)
- 文档生成(变量替换、格式化输出)
- 文档版本管理

**关键特性**:
- 支持Word/Excel/PDF模板
- 支持JSON格式变量配置
- 支持富文本编辑器
- 支持模板预览和测试生成

#### 2.4 任务管理模块

**功能**:
- 任务创建和分解
- 任务分配和指派
- 任务进度跟踪
- 任务完成验收

**关键特性**:
- 支持任务树状结构(父任务-子任务)
- 支持任务依赖关系
- 支持任务优先级设置
- 支持任务评论和附件

#### 2.5 提醒通知模块

**功能**:
- 提醒规则配置
- 自动提醒触发
- 多渠道通知(站内信、邮件、短信)
- 提醒历史记录

**关键特性**:
- 支持多种提醒时机(提前N天、当天、逾期)
- 支持提醒对象配置(负责人、相关人员、全体)
- 支持提醒频率设置(一次、每天、每周)
- 支持提醒确认和反馈

---

## 📦 数据库设计

### 1. 核心数据表

#### 1.1 检查类型表 (inspection_types)

```sql
CREATE TABLE inspection_types (
  id INT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(100) NOT NULL COMMENT '检查名称',
  category ENUM('annual', 'special', 'routine') NOT NULL COMMENT '检查类别',
  description TEXT COMMENT '检查描述',
  department VARCHAR(100) COMMENT '检查部门',
  frequency VARCHAR(50) COMMENT '检查频次',
  duration INT COMMENT '检查周期(天)',
  city_level ENUM('tier1', 'tier2', 'tier3', 'county', 'township', 'all') DEFAULT 'all' COMMENT '适用城市级别',
  is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
  sort_order INT DEFAULT 0 COMMENT '排序',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) COMMENT='检查类型表';
```

#### 1.2 检查计划表 (inspection_plans)

```sql
CREATE TABLE inspection_plans (
  id INT PRIMARY KEY AUTO_INCREMENT,
  kindergarten_id INT NOT NULL COMMENT '幼儿园ID',
  inspection_type_id INT NOT NULL COMMENT '检查类型ID',
  plan_year INT NOT NULL COMMENT '计划年度',
  plan_date DATE NOT NULL COMMENT '计划检查日期',
  actual_date DATE COMMENT '实际检查日期',
  status ENUM('pending', 'preparing', 'in_progress', 'completed', 'overdue') DEFAULT 'pending' COMMENT '状态',
  responsible_user_id INT COMMENT '负责人ID',
  notes TEXT COMMENT '备注',
  result TEXT COMMENT '检查结果',
  score DECIMAL(5,2) COMMENT '检查得分',
  grade VARCHAR(20) COMMENT '检查等级',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (kindergarten_id) REFERENCES kindergartens(id),
  FOREIGN KEY (inspection_type_id) REFERENCES inspection_types(id),
  FOREIGN KEY (responsible_user_id) REFERENCES users(id),
  INDEX idx_kindergarten_year (kindergarten_id, plan_year),
  INDEX idx_plan_date (plan_date),
  INDEX idx_status (status)
) COMMENT='检查计划表';
```

#### 1.3 文档模板表 (document_templates)

```sql
CREATE TABLE document_templates (
  id INT PRIMARY KEY AUTO_INCREMENT,
  inspection_type_id INT COMMENT '关联检查类型ID',
  name VARCHAR(200) NOT NULL COMMENT '模板名称',
  description TEXT COMMENT '模板描述',
  file_type ENUM('word', 'excel', 'pdf', 'html') NOT NULL COMMENT '文件类型',
  template_content LONGTEXT COMMENT '模板内容(HTML/JSON)',
  template_file_path VARCHAR(500) COMMENT '模板文件路径',
  variables JSON COMMENT '变量配置',
  is_system BOOLEAN DEFAULT FALSE COMMENT '是否系统模板',
  is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
  version VARCHAR(20) DEFAULT '1.0' COMMENT '版本号',
  created_by INT COMMENT '创建人ID',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (inspection_type_id) REFERENCES inspection_types(id),
  FOREIGN KEY (created_by) REFERENCES users(id),
  INDEX idx_inspection_type (inspection_type_id),
  INDEX idx_file_type (file_type)
) COMMENT='文档模板表';
```

**variables JSON结构示例**:
```json
{
  "kindergarten_name": {
    "label": "幼儿园名称",
    "type": "string",
    "source": "kindergarten.name",
    "required": true,
    "default": ""
  },
  "principal_name": {
    "label": "园长姓名",
    "type": "string",
    "source": "kindergarten.principal.name",
    "required": true,
    "default": ""
  },
  "teacher_count": {
    "label": "教师人数",
    "type": "number",
    "source": "statistics.teacher_count",
    "required": true,
    "default": 0
  },
  "student_count": {
    "label": "学生人数",
    "type": "number",
    "source": "statistics.student_count",
    "required": true,
    "default": 0
  },
  "class_count": {
    "label": "班级数量",
    "type": "number",
    "source": "statistics.class_count",
    "required": true,
    "default": 0
  },
  "inspection_date": {
    "label": "检查日期",
    "type": "date",
    "source": "inspection.plan_date",
    "required": true,
    "default": "{{today}}"
  },
  "report_date": {
    "label": "报告日期",
    "type": "date",
    "source": "manual",
    "required": false,
    "default": "{{today}}"
  }
}
```

#### 1.4 检查任务表 (inspection_tasks)

```sql
CREATE TABLE inspection_tasks (
  id INT PRIMARY KEY AUTO_INCREMENT,
  inspection_plan_id INT NOT NULL COMMENT '检查计划ID',
  parent_task_id INT COMMENT '父任务ID',
  title VARCHAR(200) NOT NULL COMMENT '任务标题',
  description TEXT COMMENT '任务描述',
  assigned_to INT COMMENT '指派给(用户ID)',
  priority ENUM('low', 'medium', 'high', 'urgent') DEFAULT 'medium' COMMENT '优先级',
  status ENUM('pending', 'in_progress', 'completed', 'cancelled') DEFAULT 'pending' COMMENT '状态',
  start_date DATE COMMENT '开始日期',
  due_date DATE COMMENT '截止日期',
  completed_date DATETIME COMMENT '完成日期',
  progress INT DEFAULT 0 COMMENT '进度(0-100)',
  sort_order INT DEFAULT 0 COMMENT '排序',
  created_by INT COMMENT '创建人ID',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (inspection_plan_id) REFERENCES inspection_plans(id) ON DELETE CASCADE,
  FOREIGN KEY (parent_task_id) REFERENCES inspection_tasks(id) ON DELETE CASCADE,
  FOREIGN KEY (assigned_to) REFERENCES users(id),
  FOREIGN KEY (created_by) REFERENCES users(id),
  INDEX idx_plan (inspection_plan_id),
  INDEX idx_assigned (assigned_to),
  INDEX idx_status (status),
  INDEX idx_due_date (due_date)
) COMMENT='检查任务表';
```

#### 1.5 任务附件表 (task_attachments)

```sql
CREATE TABLE task_attachments (
  id INT PRIMARY KEY AUTO_INCREMENT,
  task_id INT NOT NULL COMMENT '任务ID',
  file_name VARCHAR(255) NOT NULL COMMENT '文件名',
  file_path VARCHAR(500) NOT NULL COMMENT '文件路径',
  file_size INT COMMENT '文件大小(字节)',
  file_type VARCHAR(50) COMMENT '文件类型',
  uploaded_by INT COMMENT '上传人ID',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (task_id) REFERENCES inspection_tasks(id) ON DELETE CASCADE,
  FOREIGN KEY (uploaded_by) REFERENCES users(id),
  INDEX idx_task (task_id)
) COMMENT='任务附件表';
```

#### 1.6 任务评论表 (task_comments)

```sql
CREATE TABLE task_comments (
  id INT PRIMARY KEY AUTO_INCREMENT,
  task_id INT NOT NULL COMMENT '任务ID',
  user_id INT NOT NULL COMMENT '评论人ID',
  content TEXT NOT NULL COMMENT '评论内容',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (task_id) REFERENCES inspection_tasks(id) ON DELETE CASCADE,
  FOREIGN KEY (user_id) REFERENCES users(id),
  INDEX idx_task (task_id),
  INDEX idx_created_at (created_at)
) COMMENT='任务评论表';
```

#### 1.7 提醒配置表 (inspection_reminders)

```sql
CREATE TABLE inspection_reminders (
  id INT PRIMARY KEY AUTO_INCREMENT,
  inspection_type_id INT COMMENT '检查类型ID(为空则为全局规则)',
  reminder_type ENUM('before', 'on_day', 'overdue') NOT NULL COMMENT '提醒类型',
  days_before INT COMMENT '提前天数(负数表示逾期天数)',
  reminder_time TIME DEFAULT '09:00:00' COMMENT '提醒时间',
  notification_channels JSON COMMENT '通知渠道',
  recipient_roles JSON COMMENT '接收人角色',
  message_template TEXT COMMENT '消息模板',
  is_active BOOLEAN DEFAULT TRUE COMMENT '是否启用',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (inspection_type_id) REFERENCES inspection_types(id),
  INDEX idx_type (inspection_type_id),
  INDEX idx_active (is_active)
) COMMENT='提醒配置表';
```

**notification_channels JSON示例**:
```json
["system", "email", "sms"]
```

**recipient_roles JSON示例**:
```json
["principal", "responsible_user", "admin"]
```

#### 1.8 提醒记录表 (reminder_logs)

```sql
CREATE TABLE reminder_logs (
  id INT PRIMARY KEY AUTO_INCREMENT,
  inspection_plan_id INT NOT NULL COMMENT '检查计划ID',
  reminder_id INT NOT NULL COMMENT '提醒配置ID',
  sent_to INT NOT NULL COMMENT '接收人ID',
  channel VARCHAR(20) NOT NULL COMMENT '通知渠道',
  message TEXT COMMENT '消息内容',
  status ENUM('pending', 'sent', 'failed') DEFAULT 'pending' COMMENT '发送状态',
  sent_at DATETIME COMMENT '发送时间',
  error_message TEXT COMMENT '错误信息',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (inspection_plan_id) REFERENCES inspection_plans(id) ON DELETE CASCADE,
  FOREIGN KEY (reminder_id) REFERENCES inspection_reminders(id),
  FOREIGN KEY (sent_to) REFERENCES users(id),
  INDEX idx_plan (inspection_plan_id),
  INDEX idx_sent_to (sent_to),
  INDEX idx_status (status),
  INDEX idx_sent_at (sent_at)
) COMMENT='提醒记录表';
```

#### 1.9 生成文档记录表 (generated_documents)

```sql
CREATE TABLE generated_documents (
  id INT PRIMARY KEY AUTO_INCREMENT,
  inspection_plan_id INT NOT NULL COMMENT '检查计划ID',
  template_id INT NOT NULL COMMENT '模板ID',
  file_name VARCHAR(255) NOT NULL COMMENT '文件名',
  file_path VARCHAR(500) NOT NULL COMMENT '文件路径',
  file_size INT COMMENT '文件大小(字节)',
  variables_used JSON COMMENT '使用的变量值',
  generated_by INT COMMENT '生成人ID',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (inspection_plan_id) REFERENCES inspection_plans(id) ON DELETE CASCADE,
  FOREIGN KEY (template_id) REFERENCES document_templates(id),
  FOREIGN KEY (generated_by) REFERENCES users(id),
  INDEX idx_plan (inspection_plan_id),
  INDEX idx_template (template_id),
  INDEX idx_created_at (created_at)
) COMMENT='生成文档记录表';
```

---

## 🎨 前端界面设计

### 1. 检查中心主页

**布局结构**:
```
┌─────────────────────────────────────────────────────────────┐
│  检查中心                                    [设置] [帮助]  │
├─────────────────────────────────────────────────────────────┤
│  [年度视图] [月度视图] [列表视图]    [+ 新建检查计划]      │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│                     Timeline 时间轴                          │
│  ┌──────────────────────────────────────────────────────┐  │
│  │  1月  │  2月  │  3月  │  4月  │  5月  │  6月  │ ...  │  │
│  ├──────────────────────────────────────────────────────┤  │
│  │  [寒假安全检查]                                       │  │
│  │         [春季开学检查] [卫生保健检查]                 │  │
│  │                      [办园行为督导]                   │  │
│  │                             [食品安全检查]            │  │
│  │                                    [夏季安全检查]     │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  即将到来的检查 (7天内)                                     │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ 📋 春季开学检查          3月1日  [准备中] [查看详情] │  │
│  │ 🏥 卫生保健检查          3月15日 [未开始] [查看详情] │  │
│  │ 🔥 消防安全检查          3月20日 [未开始] [查看详情] │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  检查统计                                                    │
│  ┌────────┬────────┬────────┬────────┐                     │
│  │ 待准备  │ 准备中  │ 已完成  │ 已逾期  │                     │
│  │   5    │   3    │   12   │   1    │                     │
│  └────────┴────────┴────────┴────────┘                     │
└─────────────────────────────────────────────────────────────┘
```

### 2. 检查详情页面

**布局结构**:
```
┌─────────────────────────────────────────────────────────────┐
│  ← [返回列表]  春季开学检查详情              [编辑] [删除]  │
├─────────────────────────────────────────────────────────────┤
│  基本信息                                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ 检查类型: 春季开学检查                                │  │
│  │ 计划日期: 2025-03-01                                 │  │
│  │ 负责人: 张园长                                       │  │
│  │ 状态: 准备中                                         │  │
│  │ 进度: 60% ████████░░░░░░░░░░                         │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  任务列表                                    [+ 添加任务]   │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ☑ 准备消防安全材料                    张老师  已完成  │  │
│  │ ⏳ 更新卫生保健记录                    李护士  进行中  │  │
│  │ ⏳ 准备食品安全台账                    王厨师  进行中  │  │
│  │ ☐ 整理教师资质材料                    赵主任  未开始  │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  所需文档                                    [+ 生成文档]   │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ 📄 消防安全检查表.docx          [下载] [重新生成]     │  │
│  │ 📄 卫生保健自查报告.docx        [下载] [重新生成]     │  │
│  │ 📄 食品安全管理台账.xlsx        [下载] [重新生成]     │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  提醒设置                                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ ☑ 提前7天提醒    ☑ 提前3天提醒    ☑ 当天提醒         │  │
│  │ 提醒对象: 负责人、相关人员                            │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

### 3. 文档模板管理页面

**布局结构**:
```
┌─────────────────────────────────────────────────────────────┐
│  文档模板管理                                    [+ 新建模板] │
├─────────────────────────────────────────────────────────────┤
│  筛选: [检查类型] [文件类型]    [搜索框]                  │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  模板列表                                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ 📄 年检自查报告.docx     年检    [编辑] [复制] [删除] │  │
│  │ 📊 卫生保健统计表.xlsx   卫生检查 [编辑] [复制] [删除] │  │
│  │ 📋 消防安全检查表.docx   消防检查 [编辑] [复制] [删除] │  │
│  │ 📄 食品安全台账.xlsx     食品安全 [编辑] [复制] [删除] │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
│  模板预览(点击模板后显示)                                    │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ 模板名称: 年检自查报告                                │  │
│  │ 关联检查: 年检                                        │  │
│  │ 文件类型: Word文档                                    │  │
│  │                                                        │  │
│  │ 变量配置:                                              │  │
│  │ • 幼儿园名称: {kindergarten_name}                      │  │
│  │ • 园长姓名: {principal_name}                          │  │
│  │ • 教师人数: {teacher_count}                           │  │
│  │ • 学生人数: {student_count}                           │  │
│  │ • 检查日期: {inspection_date}                         │  │
│  │                                                        │  │
│  │ [预览文档] [测试生成] [保存] [取消]                   │  │
│  └──────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔧 API设计

### 1. 检查类型管理API

#### 1.1 获取检查类型列表
```
GET /api/inspection-types
Query参数:
  - category: 检查类别(annual/special/routine)
  - city_level: 城市级别(tier1/tier2/tier3/county/township)
  - is_active: 是否启用

响应:
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "name": "年检",
      "category": "annual",
      "description": "年度检查",
      "department": "教育局",
      "frequency": "每年1次",
      "duration": 30,
      "city_level": "all",
      "is_active": true,
      "sort_order": 1
    }
  ]
}
```

#### 1.2 创建检查类型
```
POST /api/inspection-types
请求体:
{
  "name": "新检查类型",
  "category": "special",
  "description": "检查描述",
  "department": "检查部门",
  "frequency": "检查频次",
  "duration": 30,
  "city_level": "all"
}

响应:
{
  "code": 201,
  "data": {
    "id": 2,
    "name": "新检查类型",
    // ...其他字段
  }
}
```

### 2. 检查计划管理API

#### 2.1 获取检查计划列表
```
GET /api/inspection-plans
Query参数:
  - kindergarten_id: 幼儿园ID
  - year: 年份
  - status: 状态
  - month: 月份(获取某月的计划)

响应:
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "kindergarten_id": 1,
      "inspection_type_id": 1,
      "inspection_type": {
        "name": "年检",
        "category": "annual"
      },
      "plan_year": 2025,
      "plan_date": "2025-09-01",
      "actual_date": null,
      "status": "pending",
      "responsible_user": {
        "id": 1,
        "name": "张园长"
      },
      "progress": 0,
      "task_count": 5,
      "completed_task_count": 0
    }
  ]
}
```

#### 2.2 创建检查计划
```
POST /api/inspection-plans
请求体:
{
  "kindergarten_id": 1,
  "inspection_type_id": 1,
  "plan_year": 2025,
  "plan_date": "2025-09-01",
  "responsible_user_id": 1,
  "notes": "备注信息"
}

响应:
{
  "code": 201,
  "data": {
    "id": 2,
    // ...其他字段
  }
}
```

#### 2.3 获取检查计划详情
```
GET /api/inspection-plans/:id

响应:
{
  "code": 200,
  "data": {
    "id": 1,
    "kindergarten_id": 1,
    "inspection_type": {
      "id": 1,
      "name": "年检",
      "category": "annual"
    },
    "plan_date": "2025-09-01",
    "status": "preparing",
    "responsible_user": {
      "id": 1,
      "name": "张园长"
    },
    "progress": 60,
    "tasks": [
      {
        "id": 1,
        "title": "准备消防安全材料",
        "description": "任务描述",
        "assigned_to": {
          "id": 2,
          "name": "张老师"
        },
        "status": "completed",
        "progress": 100
      }
    ],
    "documents": [
      {
        "id": 1,
        "template": {
          "id": 1,
          "name": "年检自查报告"
        },
        "file_name": "年检自查报告_2025.docx",
        "file_path": "/uploads/documents/年检自查报告_2025.docx",
        "generated_at": "2025-10-04T10:00:00Z"
      }
    ],
    "reminders": [
      {
        "id": 1,
        "reminder_type": "before",
        "days_before": 7,
        "is_active": true
      }
    ]
  }
}
```

### 3. 文档模板管理API

#### 3.1 获取文档模板列表
```
GET /api/document-templates
Query参数:
  - inspection_type_id: 检查类型ID
  - file_type: 文件类型
  - is_system: 是否系统模板

响应:
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "inspection_type_id": 1,
      "name": "年检自查报告",
      "description": "年检自查报告模板",
      "file_type": "word",
      "variables": {
        "kindergarten_name": {
          "label": "幼儿园名称",
          "type": "string",
          "required": true
        }
      },
      "is_system": true,
      "version": "1.0"
    }
  ]
}
```

#### 3.2 创建文档模板
```
POST /api/document-templates
Content-Type: multipart/form-data
请求体:
  - inspection_type_id: 检查类型ID
  - name: 模板名称
  - description: 模板描述
  - file_type: 文件类型
  - template_file: 模板文件
  - variables: 变量配置(JSON字符串)

响应:
{
  "code": 201,
  "data": {
    "id": 2,
    // ...其他字段
  }
}
```

#### 3.3 生成文档
```
POST /api/document-templates/:id/generate
请求体:
{
  "inspection_plan_id": 1,
  "variables": {
    "kindergarten_name": "示例幼儿园",
    "principal_name": "张园长",
    "teacher_count": 20,
    "student_count": 150,
    "inspection_date": "2025-09-01"
  }
}

响应:
{
  "code": 200,
  "data": {
    "document_id": 1,
    "file_name": "年检自查报告_示例幼儿园_20250901.docx",
    "file_path": "/uploads/generated/年检自查报告_示例幼儿园_20250901.docx",
    "download_url": "/api/documents/1/download"
  }
}
```

### 4. 任务管理API

#### 4.1 获取任务列表
```
GET /api/inspection-tasks
Query参数:
  - inspection_plan_id: 检查计划ID
  - assigned_to: 指派人ID
  - status: 状态
  - parent_task_id: 父任务ID

响应:
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "inspection_plan_id": 1,
      "parent_task_id": null,
      "title": "准备消防安全材料",
      "description": "任务描述",
      "assigned_to": {
        "id": 2,
        "name": "张老师"
      },
      "priority": "high",
      "status": "completed",
      "start_date": "2025-08-20",
      "due_date": "2025-08-25",
      "completed_date": "2025-08-24T10:30:00Z",
      "progress": 100,
      "subtasks": [
        {
          "id": 2,
          "title": "检查消防设施",
          "status": "completed"
        }
      ],
      "attachments": [
        {
          "id": 1,
          "file_name": "消防检查表.pdf",
          "file_path": "/uploads/attachments/消防检查表.pdf"
        }
      ],
      "comments": [
        {
          "id": 1,
          "user": {
            "id": 2,
            "name": "张老师"
          },
          "content": "已完成消防设施检查",
          "created_at": "2025-08-24T10:30:00Z"
        }
      ]
    }
  ]
}
```

#### 4.2 创建任务
```
POST /api/inspection-tasks
请求体:
{
  "inspection_plan_id": 1,
  "parent_task_id": null,
  "title": "新任务",
  "description": "任务描述",
  "assigned_to": 2,
  "priority": "medium",
  "start_date": "2025-10-05",
  "due_date": "2025-10-10"
}

响应:
{
  "code": 201,
  "data": {
    "id": 3,
    // ...其他字段
  }
}
```

#### 4.3 更新任务状态
```
PUT /api/inspection-tasks/:id
请求体:
{
  "status": "completed",
  "progress": 100,
  "completed_date": "2025-10-05T15:30:00Z"
}

响应:
{
  "code": 200,
  "data": {
    "id": 1,
    // ...更新后的字段
  }
}
```

### 5. 提醒管理API

#### 5.1 获取提醒配置
```
GET /api/inspection-reminders
Query参数:
  - inspection_type_id: 检查类型ID
  - is_active: 是否启用

响应:
{
  "code": 200,
  "data": [
    {
      "id": 1,
      "inspection_type_id": 1,
      "reminder_type": "before",
      "days_before": 7,
      "reminder_time": "09:00:00",
      "notification_channels": ["system", "email"],
      "recipient_roles": ["principal", "responsible_user"],
      "message_template": "提醒：{inspection_name}将在{days}天后进行，请做好准备。",
      "is_active": true
    }
  ]
}
```

#### 5.2 创建提醒配置
```
POST /api/inspection-reminders
请求体:
{
  "inspection_type_id": 1,
  "reminder_type": "before",
  "days_before": 7,
  "reminder_time": "09:00:00",
  "notification_channels": ["system", "email"],
  "recipient_roles": ["principal", "responsible_user"],
  "message_template": "提醒：{inspection_name}将在{days}天后进行，请做好准备。"
}

响应:
{
  "code": 201,
  "data": {
    "id": 2,
    // ...其他字段
  }
}
```

---

## 🚀 开发实施计划

### 第一阶段：基础功能开发 (预计2周)

**后端开发**:
1. 数据库表结构创建
2. 检查类型管理API开发
3. 检查计划管理API开发
4. 基础权限控制实现

**前端开发**:
1. 检查中心基础页面搭建
2. 检查类型管理界面
3. 检查计划列表和详情页面
4. Timeline组件开发

### 第二阶段：核心功能开发 (预计3周)

**后端开发**:
1. 文档模板管理API开发
2. 文档生成服务实现
3. 任务管理API开发
4. 提醒服务实现

**前端开发**:
1. 文档模板管理界面
2. 文档生成和下载功能
3. 任务管理界面
4. 提醒设置界面

### 第三阶段：高级功能开发 (预计2周)

**后端开发**:
1. 统计分析API开发
2. 报表导出功能
3. 消息通知集成
4. 性能优化

**前端开发**:
1. 统计图表展示
2. 报表导出界面
3. 消息通知中心
4. 移动端适配

### 第四阶段：测试与优化 (预计1周)

1. 单元测试编写
2. 集成测试
3. 性能测试
4. 用户验收测试
5. Bug修复和优化

---

## 🔒 权限设计

### 1. 角色权限矩阵

| 功能模块 | 超级管理员 | 园长 | 教师 | 家长 |
|---------|-----------|------|------|------|
| 检查类型管理 | ✅ | ❌ | ❌ | ❌ |
| 检查计划管理 | ✅ | ✅ | ❌ | ❌ |
| 文档模板管理 | ✅ | ✅ | ❌ | ❌ |
| 任务管理 | ✅ | ✅ | ✅ | ❌ |
| 文档生成 | ✅ | ✅ | ✅ | ❌ |
| 提醒设置 | ✅ | ✅ | ❌ | ❌ |
| 进度查看 | ✅ | ✅ | ✅ | ❌ |

### 2. 数据权限

- **超级管理员**: 可查看和管理所有幼儿园的检查数据
- **园长**: 只能查看和管理本幼儿园的检查数据
- **教师**: 只能查看和处理分配给自己的任务
- **家长**: 无权限访问检查中心

---

## 📊 性能优化

### 1. 数据库优化

1. **索引优化**: 为经常查询的字段添加索引
2. **查询优化**: 避免N+1查询，使用JOIN优化
3. **分页加载**: 大数据量列表使用分页加载
4. **缓存策略**: 对不常变化的数据使用缓存

### 2. 前端优化

1. **组件懒加载**: 大型组件使用懒加载
2. **虚拟滚动**: 长列表使用虚拟滚动
3. **图片优化**: 图片压缩和懒加载
4. **代码分割**: 按路由分割代码

### 3. 文件处理优化

1. **异步处理**: 文档生成使用异步处理
2. **文件压缩**: 生成文档进行压缩
3. **CDN加速**: 静态资源使用CDN
4. **文件缓存**: 文档文件设置合理缓存策略

---

## 🧪 测试策略

### 1. 单元测试

- **后端**: 使用Jest进行API单元测试
- **前端**: 使用Vitest进行组件单元测试
- **覆盖率要求**: 核心功能覆盖率不低于80%

### 2. 集成测试

- **API集成测试**: 测试API接口之间的协作
- **数据库集成测试**: 测试数据操作的正确性
- **第三方服务集成测试**: 测试文件生成、消息发送等

### 3. E2E测试

- **关键流程测试**: 测试完整的检查流程
- **跨浏览器测试**: 确保主流浏览器兼容性
- **移动端测试**: 测试移动端功能正常

### 4. 性能测试

- **负载测试**: 测试系统在高并发下的表现
- **压力测试**: 测试系统的极限承载能力
- **响应时间测试**: 确保关键接口响应时间

---

## 📈 未来扩展

### 1. AI智能辅助

1. **智能任务分配**: 基于历史数据和人员能力自动分配任务
2. **智能提醒**: 基于检查内容和进度智能调整提醒策略
3. **智能模板推荐**: 根据检查类型推荐合适的文档模板
4. **智能风险预警**: 识别检查准备过程中的潜在风险

### 2. 移动端应用

1. **移动端APP**: 开发原生移动应用
2. **离线功能**: 支持离线查看和编辑
3. **推送通知**: 移动端推送通知
4. **扫码功能**: 扫码快速查看和更新任务

### 3. 数据分析

1. **检查趋势分析**: 分析检查结果的趋势和变化
2. **效率分析**: 分析检查准备的效率和瓶颈
3. **对比分析**: 不同幼儿园之间的对比分析
4. **预测分析**: 基于历史数据预测检查结果

### 4. 集成扩展

1. **政府系统对接**: 与教育部门系统对接
2. **第三方服务集成**: 集成更多第三方服务
3. **开放API**: 提供开放API供第三方使用
4. **插件系统**: 支持插件扩展功能

---

## 📝 总结

检查中心作为幼儿园管理系统的重要组成部分，通过Timeline可视化展示、文档模板化管理、智能提醒和任务分解等功能，帮助幼儿园高效应对各类检查。本文档详细介绍了检查中心的功能设计、技术架构、数据库设计、API设计和开发计划，为后续开发提供了全面的指导。

系统采用前后端分离架构，前端使用Vue3，后端使用Express.js，数据库使用MySQL，确保系统的可扩展性和可维护性。同时，系统支持不同行政级别的检查要求，具有良好的适应性和灵活性。

通过分阶段的开发计划和完善的测试策略，确保系统的质量和稳定性。未来还可以通过AI智能辅助、移动端应用、数据分析等功能进一步提升系统的价值和用户体验。