# 呼叫中心AI功能集成测试指南

## 📋 概述

本文档介绍呼叫中心系统中集成的AI功能，包括AI话术生成、语音识别、合规审查等功能的使用方法和测试指南。

---

## 🎯 已集成的AI功能

### 1. AI话术生成
**功能**: 根据客户信息和呼叫目的，自动生成个性化的招生话术

**API端点**: `POST /api/call-center/ai/generate-script`

**请求参数**:
```json
{
  "callPurpose": "enrollment",  // 呼叫目的: enrollment/course/activity/followup/survey
  "customerInfo": {
    "name": "张女士",           // 客户姓名(选填)
    "childAge": "3岁",          // 孩子年龄(选填)
    "interests": "艺术",        // 兴趣爱好(选填)
    "concerns": "师资力量"      // 关注点(选填)
  },
  "context": "上次通话提到..."  // 对话上下文(选填)
}
```

**响应示例**:
```json
{
  "success": true,
  "data": {
    "script": "张女士您好！我是XX幼儿园的招生顾问...",
    "model": "豆包1.6",
    "timestamp": "2025-10-14T16:32:14.000Z"
  },
  "message": "AI话术生成成功"
}
```

### 2. 语音识别(ASR)
**功能**: 将客户语音转换为文字，用于实时转写和分析

**API端点**: `POST /api/call-center/ai/speech-to-text`

**请求参数**: 
- Content-Type: `multipart/form-data`
- 字段: `audio` (音频文件)

**响应示例**:
```json
{
  "success": true,
  "data": {
    "text": "我想了解一下你们幼儿园的课程安排",
    "duration": 3.5,
    "language": "zh"
  },
  "message": "语音识别成功"
}
```

### 3. 合规审查
**功能**: 检测话术中的敏感词和合规性问题，提供修改建议

**API端点**: `POST /api/call-center/ai/check-compliance`

**请求参数**:
```json
{
  "content": "我们保证您的孩子一定能考上重点小学"
}
```

**响应示例**:
```json
{
  "success": true,
  "data": {
    "isCompliant": false,
    "complianceScore": 80,
    "detectedWords": ["保证", "一定"],
    "suggestions": [
      "建议将\"保证\"替换为\"努力\"",
      "建议将\"一定\"替换为\"通常\""
    ],
    "riskLevel": "medium"
  },
  "message": "合规审查完成"
}
```

### 4. TTS语音合成
**功能**: 将文本转换为语音，用于自动播报和语音回复

**API端点**: `POST /api/call-center/ai/tts/test`

**请求参数**:
```json
{
  "text": "欢迎来到我们的幼儿园",
  "voice": "zh_female_cancan_mars_bigtts",  // 音色ID
  "speed": 1.0,                              // 语速
  "format": "mp3"                            // 音频格式
}
```

**响应**: 返回音频文件的二进制数据

---

## 🚀 前端使用指南

### 访问呼叫中心
1. 打开浏览器访问: `http://localhost:5173`
2. 使用admin账号登录
3. 点击左侧菜单"呼叫中心"

### AI智能分析面板

在呼叫中心页面右侧，您会看到"AI智能分析"面板，包含以下功能卡片：

#### 1. AI语音合成
- **位置**: 面板顶部
- **功能**: 
  - 选择语音模型(豆包/Azure)
  - 选择音色(女声/男声/童声)
  - 输入文本内容
  - 点击"合成语音"生成音频
  - 点击"播放"试听合成的语音

#### 2. AI话术生成
- **位置**: 语音合成下方
- **功能**:
  - 选择呼叫目的(招生咨询/课程介绍/活动邀请/回访跟进/满意度调查)
  - 输入客户姓名(选填)
  - 输入孩子年龄(选填)
  - 点击"生成话术"
  - 查看生成的话术内容
  - 点击"复制"或"使用此话术"

#### 3. 合规审查
- **位置**: AI话术生成下方
- **功能**:
  - 输入需要审查的内容
  - 点击"审查内容"
  - 查看合规分数和风险等级
  - 查看检测到的敏感词
  - 查看修改建议

#### 4. 实时转写
- **位置**: 合规审查下方
- **功能**:
  - 显示通话过程中的实时转写内容
  - 点击"清空"清除转写内容
  - 点击"复制"复制转写文本

---

## 🧪 测试步骤

### 测试1: AI话术生成

1. **打开呼叫中心页面**
   ```
   http://localhost:5173/centers/call-center
   ```

2. **找到AI话术生成卡片**
   - 位于右侧AI智能分析面板

3. **填写测试数据**
   - 呼叫目的: 选择"招生咨询"
   - 客户姓名: 输入"张女士"
   - 孩子年龄: 输入"3岁"

4. **生成话术**
   - 点击"生成话术"按钮
   - 等待3-5秒

5. **验证结果**
   - ✅ 应该显示生成的话术内容
   - ✅ 话术应该包含客户姓名
   - ✅ 话术应该符合幼儿园招生场景
   - ✅ 话术长度应该在100-200字之间

6. **测试复制功能**
   - 点击"复制"按钮
   - ✅ 应该提示"话术已复制到剪贴板"

7. **测试使用话术功能**
   - 点击"使用此话术"按钮
   - ✅ 话术应该自动填充到语音合成的文本框中

### 测试2: 合规审查

1. **找到合规审查卡片**
   - 位于AI话术生成下方

2. **输入测试内容**
   ```
   我们保证您的孩子一定能考上重点小学，这是最好的幼儿园
   ```

3. **点击审查内容**
   - 等待1-2秒

4. **验证结果**
   - ✅ 应该显示"不合规"标签
   - ✅ 合规分数应该低于80分
   - ✅ 应该检测到敏感词: "保证", "一定", "最好"
   - ✅ 应该提供修改建议

5. **测试合规内容**
   ```
   我们致力于为您的孩子提供优质的教育环境
   ```
   - ✅ 应该显示"合规"标签
   - ✅ 合规分数应该为100分
   - ✅ 不应该检测到敏感词

### 测试3: TTS语音合成

1. **找到AI语音合成卡片**
   - 位于面板顶部

2. **配置参数**
   - 语音模型: 选择"豆包"
   - 语音音色: 选择"女声"

3. **输入测试文本**
   ```
   欢迎来到我们的幼儿园，我们致力于为每个孩子提供最优质的教育环境
   ```

4. **合成语音**
   - 点击"合成语音"按钮
   - 等待5-10秒

5. **验证结果**
   - ✅ 应该显示"语音合成成功"提示
   - ✅ 应该出现"播放"按钮
   - ✅ 控制台应该显示音频大小(>0 bytes)

6. **播放音频**
   - 点击"播放"按钮
   - ✅ 应该听到合成的语音
   - ✅ 语音应该清晰流畅

---

## 📊 预期结果

### AI话术生成
- ✅ 生成时间: 3-5秒
- ✅ 话术长度: 100-200字
- ✅ 话术质量: 专业、亲切、有说服力
- ✅ 个性化: 包含客户信息

### 合规审查
- ✅ 审查时间: 1-2秒
- ✅ 敏感词检测: 准确率>95%
- ✅ 修改建议: 实用且具体
- ✅ 合规分数: 准确反映风险等级

### TTS语音合成
- ✅ 合成时间: 5-10秒
- ✅ 音频质量: 清晰流畅
- ✅ 音色准确: 符合选择的音色
- ✅ 语速正常: 1.0倍速

---

## 🔧 故障排除

### 问题1: AI话术生成失败
**症状**: 点击"生成话术"后提示错误

**解决方案**:
1. 检查是否选择了呼叫目的
2. 检查后端服务是否正常运行
3. 检查豆包模型配置是否正确
4. 查看浏览器控制台错误信息

### 问题2: 合规审查无响应
**症状**: 点击"审查内容"后无反应

**解决方案**:
1. 检查是否输入了审查内容
2. 检查网络连接
3. 刷新页面重试

### 问题3: TTS语音合成返回0字节
**症状**: 合成成功但无法播放

**解决方案**:
1. 检查音色参数是否正确
2. 确认使用火山引擎音色(如: zh_female_cancan_mars_bigtts)
3. 检查后端日志中的音频大小
4. 参考: `docs/豆包模型注意事项/TTS文字转语音正确调用指南.md`

---

## 📝 技术细节

### 使用的AI模型
- **话术生成**: 豆包1.6 (doubao-seed-1.6-250615)
- **语音识别**: Whisper-1
- **语音合成**: 火山引擎TTS V3

### 音色映射
```typescript
{
  'female': 'zh_female_cancan_mars_bigtts',      // 灿灿女声
  'male': 'zh_male_qingsecunzheng_mars_bigtts',  // 青涩男声
  'child': 'zh_female_qingxin_mars_bigtts'       // 清新女声
}
```

### 敏感词库
```typescript
[
  '保证', '承诺', '最好', '第一', '绝对',
  '包过', '包会', '包学会', '保证考上',
  '虚假', '欺骗', '诱导', '强制'
]
```

---

## 🔗 相关文档

1. **TTS调用指南**: `docs/豆包模型注意事项/TTS文字转语音正确调用指南.md`
2. **常见问题FAQ**: `docs/豆包模型注意事项/常见问题FAQ.md`
3. **呼叫中心需求文档**: `docs/呼叫中心/呼叫中心开发需求文档.md`
4. **TTS测试指南**: `docs/呼叫中心/TTS语音合成测试指南.md`

---

## ✅ 测试检查清单

- [ ] AI话术生成功能正常
- [ ] 话术内容符合要求
- [ ] 复制功能正常
- [ ] 使用话术功能正常
- [ ] 合规审查功能正常
- [ ] 敏感词检测准确
- [ ] 修改建议实用
- [ ] TTS语音合成功能正常
- [ ] 音频播放正常
- [ ] 音色选择正确
- [ ] 所有功能响应时间合理
- [ ] 错误提示清晰明确

---

**最后更新**: 2025-10-14  
**版本**: v1.0  
**状态**: ✅ 已完成并可测试

