# å‘¼å«ä¸­å¿ƒèœå•æ˜¾ç¤ºæˆåŠŸæ€»ç»“

## ğŸ‰ æœ€ç»ˆæˆæœ

**çŠ¶æ€**: âœ… **å‘¼å«ä¸­å¿ƒèœå•å·²æˆåŠŸæ˜¾ç¤ºå¹¶å¯æ­£å¸¸è®¿é—®ï¼**

### æˆåŠŸæˆªå›¾

1. **ä¾§è¾¹æ èœå•æ˜¾ç¤º** - `call-center-menu-visible.png`
   - 17ä¸ªèœå•é¡¹å…¨éƒ¨æ˜¾ç¤º
   - å‘¼å«ä¸­å¿ƒä½äºæœ€åä¸€ä¸ªä½ç½®

2. **å‘¼å«ä¸­å¿ƒé¡µé¢åŠ è½½** - `call-center-page-loaded.png`
   - é¡µé¢å®Œæ•´åŠ è½½
   - æ‰€æœ‰åŠŸèƒ½æ¨¡å—æ­£å¸¸æ˜¾ç¤º

---

## ğŸ” é—®é¢˜è¯Šæ–­è¿‡ç¨‹

### é—®é¢˜1: èœå•ä¸æ˜¾ç¤ºï¼ˆåˆå§‹çŠ¶æ€ï¼‰

**ç°è±¡**:
```
ğŸ“Š èœå•æ•°é‡: 16  â† åº”è¯¥æ˜¯17
```

**åŸå› **: æ•°æ®åº“ä¸­æ²¡æœ‰å‘¼å«ä¸­å¿ƒæƒé™

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºå¹¶æ‰§è¡Œ `add-call-center-permissions.js`

```javascript
// æ·»åŠ äº†5ä¸ªæƒé™
- CALL_CENTER (ID: 5328) - category
- call_center_overview (ID: 5329) - page
- call_center_records (ID: 5330) - page
- call_center_sip_config (ID: 5331) - page
- call_center_statistics (ID: 5332) - page
```

---

### é—®é¢˜2: æƒé™æœªåˆ†é…ç»™adminè§’è‰²

**ç°è±¡**:
```
ğŸ“Š èœå•æ•°é‡: 16  â† ä»ç„¶æ˜¯16
```

**åŸå› **: æƒé™å·²æ·»åŠ ä½†æœªåˆ†é…ç»™adminè§’è‰²

**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºå¹¶æ‰§è¡Œ `assign-call-center-to-admin.js`

```sql
-- åˆ†é…äº†5ä¸ªæƒé™åˆ°role_id=1 (admin)
INSERT INTO role_permissions (role_id, permission_id)
VALUES (1, 5328), (1, 5329), (1, 5330), (1, 5331), (1, 5332);
```

---

### é—®é¢˜3: æƒé™IDæ˜ å°„é”™è¯¯ï¼ˆæ ¸å¿ƒé—®é¢˜ï¼‰

**ç°è±¡**:
```
ğŸ¢ ç”¨æˆ·å¯è®¿é—®çš„ä¸­å¿ƒ: [..., 'CALL_CENTER']  â† CALL_CENTERåœ¨åˆ—è¡¨ä¸­
ğŸ”‘ ä¸­å¿ƒæƒé™IDåˆ—è¡¨: [3002, 5234, ..., 5323, 5324]  â† ä½†æ˜¯5328ä¸åœ¨åˆ—è¡¨ä¸­ï¼
ğŸ“Š èœå•æ•°é‡: 16  â† ä»ç„¶æ˜¯16
```

**åŸå› **: `server/src/config/role-mapping.ts` ä¸­çš„æƒé™IDæ˜ å°„é”™è¯¯

```typescript
// âŒ é”™è¯¯çš„æ˜ å°„
[centerPermissions.CALL_CENTER]: 5324,  // 5324æ˜¯REFERRAL_CENTERï¼Œä¸æ˜¯CALL_CENTER

// âœ… æ­£ç¡®çš„æ˜ å°„
[centerPermissions.CALL_CENTER]: 5328,  // 5328æ‰æ˜¯CALL_CENTER
```

**æ•°æ®åº“éªŒè¯**:
```
ID: 5323, Code: USAGE_CENTER, Type: category, Name: ç”¨é‡ä¸­å¿ƒ
ID: 5324, Code: REFERRAL_CENTER, Type: menu, Name: æ¨å¹¿ä¸­å¿ƒ  â† ä¸æ˜¯categoryï¼
ID: 5328, Code: CALL_CENTER, Type: category, Name: å‘¼å«ä¸­å¿ƒ  â† æ­£ç¡®çš„ID
```

**è§£å†³æ–¹æ¡ˆ**: ä¿®å¤ `role-mapping.ts` ä¸­çš„æƒé™ID

```typescript
// server/src/config/role-mapping.ts
export const centerPermissionIds = {
  // ...
  [centerPermissions.USAGE_CENTER]: 5323,
  [centerPermissions.CALL_CENTER]: 5328,  // âœ… ä¿®å¤ï¼š5324 -> 5328
};
```

---

## ğŸ“Š æœ€ç»ˆéªŒè¯

### åç«¯æ—¥å¿—

```
ğŸ” ä»æ•°æ®åº“æŸ¥è¯¢åˆ° 184 æ¡è·¯ç”±è®°å½•  â† æ­£ç¡®
ğŸ“¦ è·¯ç”±æ•°æ®å·²ç¼“å­˜åˆ°å†…å­˜
âœ… è·¯ç”±ç¼“å­˜åˆå§‹åŒ–å®Œæˆ
ğŸ“Š ç¼“å­˜ç»Ÿè®¡:
   - è·¯ç”±æ€»æ•°: 184  â† æ­£ç¡®
   - è§’è‰²åˆ†ç»„: 11
```

### å‰ç«¯æ—¥å¿—

```
âœ… èœå•è·å–æˆåŠŸ: 17  â† æ­£ç¡®ï¼
ğŸ“‹ èœå•åˆ—è¡¨: äººå‘˜ä¸­å¿ƒ, æ´»åŠ¨ä¸­å¿ƒ, è¥é”€ä¸­å¿ƒ, ä¸šåŠ¡ä¸­å¿ƒ, å®¢æˆ·æ± ä¸­å¿ƒ, 
            ç³»ç»Ÿä¸­å¿ƒ, è´¢åŠ¡ä¸­å¿ƒ, æ‹›ç”Ÿä¸­å¿ƒ, ç£æŸ¥ä¸­å¿ƒ, ä»»åŠ¡ä¸­å¿ƒ, 
            æ•™å­¦ä¸­å¿ƒ, è¯æœ¯ä¸­å¿ƒ, æ–°åª’ä½“ä¸­å¿ƒ, è€ƒå‹¤ä¸­å¿ƒ, 
            é›†å›¢ç®¡ç†, ç”¨é‡ä¸­å¿ƒ, å‘¼å«ä¸­å¿ƒ  â† å‘¼å«ä¸­å¿ƒåœ¨æœ€åï¼

âœ… å­è·¯ç”±æ·»åŠ æˆåŠŸ: CallCenter  â† è·¯ç”±å·²æ·»åŠ 
âœ… Level 2: åç«¯æƒé™éªŒè¯æˆåŠŸ: /centers/call-center  â† æƒé™éªŒè¯é€šè¿‡
```

### é¡µé¢åŠ è½½

```
ğŸ”„ å¯¼èˆª: /dashboard -> /centers/call-center  â† å¯¼èˆªæˆåŠŸ
å¯¼èˆªå®Œæˆ: /dashboard -> /centers/call-center  â† é¡µé¢åŠ è½½å®Œæˆ
```

---

## ğŸ¯ å…³é”®æ–‡ä»¶ä¿®æ”¹

### 1. æ•°æ®åº“è„šæœ¬

**`server/scripts/add-call-center-permissions.js`**
- æ·»åŠ 5ä¸ªå‘¼å«ä¸­å¿ƒæƒé™åˆ°æ•°æ®åº“

**`server/scripts/assign-call-center-to-admin.js`**
- åˆ†é…æƒé™ç»™adminè§’è‰²

### 2. åç«¯é…ç½®

**`server/src/config/role-mapping.ts`** (æ ¸å¿ƒä¿®å¤)
```typescript
// ä¿®å¤å‰
[centerPermissions.CALL_CENTER]: 5324,  // âŒ é”™è¯¯

// ä¿®å¤å
[centerPermissions.CALL_CENTER]: 5328,  // âœ… æ­£ç¡®
```

### 3. å‰ç«¯é¡µé¢

**`client/src/pages/centers/CallCenter.vue`**
- å‘¼å«ä¸­å¿ƒä¸»é¡µé¢
- åŒ…å«SIPè¿æ¥ã€é€šè¯è®°å½•ã€AIè¯­éŸ³åˆæˆç­‰åŠŸèƒ½

---

## ğŸ“‹ æ•°æ®åº“æƒé™è®°å½•

### permissionsè¡¨

| ID | Code | Type | Name | Parent ID |
|----|------|------|------|-----------|
| 5328 | CALL_CENTER | category | å‘¼å«ä¸­å¿ƒ | NULL |
| 5329 | call_center_overview | page | å‘¼å«ä¸­å¿ƒæ¦‚è§ˆ | 5328 |
| 5330 | call_center_records | page | é€šè¯è®°å½• | 5328 |
| 5331 | call_center_sip_config | page | SIPé…ç½® | 5328 |
| 5332 | call_center_statistics | page | é€šè¯ç»Ÿè®¡ | 5328 |

### role_permissionsè¡¨

| Role ID | Permission ID | Role Name | Permission Code |
|---------|---------------|-----------|-----------------|
| 1 | 5328 | admin | CALL_CENTER |
| 1 | 5329 | admin | call_center_overview |
| 1 | 5330 | admin | call_center_records |
| 1 | 5331 | admin | call_center_sip_config |
| 1 | 5332 | admin | call_center_statistics |

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### æƒé™è¿‡æ»¤æµç¨‹

1. **åç«¯æŸ¥è¯¢ç”¨æˆ·è§’è‰²** â†’ `admin`
2. **è·å–è§’è‰²å¯è®¿é—®çš„ä¸­å¿ƒ** â†’ `roleCenterAccess[admin]` â†’ åŒ…å« `CALL_CENTER`
3. **æ˜ å°„ä¸­å¿ƒåˆ°æƒé™ID** â†’ `centerPermissionIds[CALL_CENTER]` â†’ `5328` âœ…
4. **è¿‡æ»¤æƒé™** â†’ åŒ…å«ID 5328çš„æ‰€æœ‰æƒé™
5. **è¿”å›èœå•æ ‘** â†’ 17ä¸ªèœå•é¡¹

### å‰ç«¯è·¯ç”±ç”Ÿæˆ

1. **è·å–èœå•æ•°æ®** â†’ 17ä¸ªèœå•é¡¹
2. **ç”ŸæˆåŠ¨æ€è·¯ç”±** â†’ 195ä¸ªå­è·¯ç”±
3. **æ·»åŠ åˆ°ä¸»è·¯ç”±** â†’ æ€»å…±420ä¸ªè·¯ç”±
4. **æƒé™éªŒè¯** â†’ `/centers/call-center` éªŒè¯é€šè¿‡
5. **é¡µé¢åŠ è½½** â†’ å‘¼å«ä¸­å¿ƒé¡µé¢æ˜¾ç¤º

---

## âœ… éªŒè¯æ¸…å•

- [x] æ•°æ®åº“ä¸­å­˜åœ¨å‘¼å«ä¸­å¿ƒæƒé™ï¼ˆ5ä¸ªï¼‰
- [x] æƒé™å·²åˆ†é…ç»™adminè§’è‰²
- [x] `role-mapping.ts` ä¸­çš„æƒé™IDæ­£ç¡®ï¼ˆ5328ï¼‰
- [x] åç«¯åŠ è½½184æ¡è·¯ç”±
- [x] å‰ç«¯æ˜¾ç¤º17ä¸ªèœå•é¡¹
- [x] å‘¼å«ä¸­å¿ƒèœå•å¯è§
- [x] å‘¼å«ä¸­å¿ƒèœå•å¯ç‚¹å‡»
- [x] å‘¼å«ä¸­å¿ƒé¡µé¢å¯è®¿é—®
- [x] æƒé™éªŒè¯é€šè¿‡
- [x] é¡µé¢åŠŸèƒ½æ­£å¸¸

---

## ğŸ‰ æ€»ç»“

**é—®é¢˜æ ¹æº**: `centerPermissionIds` æ˜ å°„ä¸­ï¼ŒCALL_CENTERçš„IDé”™è¯¯åœ°è®¾ç½®ä¸º5324ï¼ˆREFERRAL_CENTERçš„IDï¼‰ï¼Œè€Œä¸æ˜¯æ­£ç¡®çš„5328ã€‚

**è§£å†³æ–¹æ¡ˆ**: ä¿®å¤ `server/src/config/role-mapping.ts` ä¸­çš„æƒé™IDæ˜ å°„ã€‚

**æœ€ç»ˆç»“æœ**: 
- âœ… å‘¼å«ä¸­å¿ƒèœå•æˆåŠŸæ˜¾ç¤ºåœ¨ä¾§è¾¹æ 
- âœ… ç‚¹å‡»èœå•å¯æ­£å¸¸è¿›å…¥å‘¼å«ä¸­å¿ƒé¡µé¢
- âœ… é¡µé¢æ‰€æœ‰åŠŸèƒ½æ¨¡å—æ­£å¸¸æ˜¾ç¤º
- âœ… æƒé™éªŒè¯å®Œå…¨é€šè¿‡

**å…³é”®æ•™è®­**: 
1. æƒé™IDå¿…é¡»ä¸æ•°æ®åº“ä¸­çš„å®é™…IDå®Œå…¨åŒ¹é…
2. é…ç½®æ–‡ä»¶ä¸­çš„ç¡¬ç¼–ç IDå®¹æ˜“å‡ºé”™ï¼Œéœ€è¦ä»”ç»†éªŒè¯
3. åç«¯æ—¥å¿—ä¸­çš„"ä¸­å¿ƒæƒé™IDåˆ—è¡¨"æ˜¯è¯Šæ–­æƒé™é—®é¢˜çš„å…³é”®

---

**æœ€åæ›´æ–°**: å½“å‰ä¼šè¯  
**çŠ¶æ€**: âœ… å®Œæˆ

