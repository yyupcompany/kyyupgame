# 文档生成进度和预览功能使用指南

## 📋 概述

本指南介绍如何使用新增的文档生成进度提示和预览功能组件。

---

## 🎯 功能特性

### 1. 文档生成进度提示

**组件**: `DocumentGenerationProgress.vue`

**功能**:
- ✅ 实时进度条显示（0-100%）
- ✅ 分步骤进度跟踪（5个步骤）
- ✅ 预计剩余时间显示
- ✅ 步骤状态可视化（待执行、执行中、已完成）
- ✅ 支持不同文档类型的进度速度

**步骤**:
1. 分析需求 - 正在分析文档生成需求...
2. AI内容生成 - 正在生成文档内容...
3. 数据查询 - 正在查询相关数据...
4. 文档格式化 - 正在格式化文档...
5. 文件保存 - 正在保存文件...

**进度速度**（根据文档类型）:
- Word: 85秒
- PPT: 90秒
- Excel: 60秒
- PDF: 150秒

---

### 2. 文档预览功能

**组件**: `DocumentPreview.vue`

**功能**:
- ✅ Word/PDF文档摘要预览
- ✅ Excel表格数据预览（前10行）
- ✅ PPT幻灯片预览（前3张）
- ✅ 文档信息展示（文件名、大小、时间、类型）
- ✅ 下载功能集成

**预览类型**:

#### Word/PDF预览
- 显示文档图标
- 显示文档类型
- 显示内容摘要（如果有）
- 提示下载查看完整文档

#### Excel预览
- 显示前10行数据
- 表格形式展示
- 显示"还有更多数据"提示

#### PPT预览
- 显示前3张幻灯片
- 卡片式布局
- 显示幻灯片标题和内容
- 显示"还有更多幻灯片"提示

---

### 3. 文档生成结果展示

**组件**: `DocumentGenerationResult.vue`

**功能**:
- ✅ 生成中状态（进度显示）
- ✅ 生成成功状态（预览+下载）
- ✅ 生成失败状态（错误提示+重试）
- ✅ 文档详情展示
- ✅ 预览对话框集成

**状态**:
1. `generating` - 生成中，显示进度
2. `success` - 生成成功，显示预览和下载按钮
3. `error` - 生成失败，显示错误信息和重试按钮

---

## 💻 使用方式

### 基础用法

```vue
<template>
  <DocumentGenerationResult
    :status="status"
    :document-type="documentType"
    :tool-name="toolName"
    :result="result"
    :error-message="errorMessage"
    :start-time="startTime"
    @download="handleDownload"
    @retry="handleRetry"
  />
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { DocumentGenerationResult } from '@/components/ai-assistant/document'

const status = ref<'generating' | 'success' | 'error'>('generating')
const documentType = ref('PDF')
const toolName = ref('generate_pdf_report')
const startTime = ref(Date.now())

const result = ref({
  filename: 'formal_report_1760389881917.pdf',
  fileSize: 3356000, // 3356KB
  downloadUrl: '/uploads/documents/formal_report_1760389881917.pdf',
  generatedAt: '2025-10-13T21:11:21.918Z',
  reportType: 'formal_report',
  reportTitle: '教学报告',
  templateStyle: 'formal',
  summary: '包含封面页（2024年度教学质量评估报告、制作单位等信息）、目录页（摘要等章节）等。'
})

const errorMessage = ref('')

const handleDownload = (url: string) => {
  console.log('下载文档:', url)
  // 实现下载逻辑
}

const handleRetry = () => {
  console.log('重试生成')
  status.value = 'generating'
  // 实现重试逻辑
}
</script>
```

---

### 单独使用进度组件

```vue
<template>
  <DocumentGenerationProgress
    ref="progressRef"
    document-type="Word"
    tool-name="generate_word_document"
    :start-time="startTime"
  />
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { DocumentGenerationProgress } from '@/components/ai-assistant/document'

const progressRef = ref<InstanceType<typeof DocumentGenerationProgress> | null>(null)
const startTime = ref(Date.now())

// 完成进度
const completeProgress = () => {
  progressRef.value?.completeProgress()
}
</script>
```

---

### 单独使用预览组件

```vue
<template>
  <DocumentPreview
    :document-info="documentInfo"
    @close="handleClose"
    @download="handleDownload"
  />
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { DocumentPreview } from '@/components/ai-assistant/document'

const documentInfo = ref({
  title: '教学报告',
  filename: 'formal_report_1760389881917.pdf',
  fileSize: 3356000,
  generatedAt: '2025-10-13T21:11:21.918Z',
  type: 'pdf' as 'word' | 'pdf' | 'excel' | 'ppt',
  downloadUrl: '/uploads/documents/formal_report_1760389881917.pdf',
  summary: '包含封面页、目录页等',
  previewData: null
})

const handleClose = () => {
  console.log('关闭预览')
}

const handleDownload = (url: string) => {
  console.log('下载文档:', url)
}
</script>
```

---

## 🎨 样式定制

### 进度组件样式

```scss
.document-generation-progress {
  // 自定义背景渐变
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  
  // 自定义进度条颜色
  .el-progress {
    --el-color-primary: #409eff;
  }
}
```

### 预览组件样式

```scss
.document-preview {
  // 自定义头部背景
  .preview-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }
}
```

---

## 📊 数据格式

### DocumentResult 接口

```typescript
interface DocumentResult {
  filename: string              // 文件名
  fileSize: number              // 文件大小（字节）
  downloadUrl: string           // 下载链接
  generatedAt: string           // 生成时间（ISO格式）
  reportType?: string           // 报告类型
  reportTitle?: string          // 报告标题
  templateStyle?: string        // 模板风格
  summary?: string              // 内容摘要
  previewData?: any             // 预览数据（Excel/PPT）
}
```

### Excel预览数据格式

```typescript
// Excel预览数据示例
const previewData = [
  { id: '1', name: '张三', age: 5, class: '大班' },
  { id: '2', name: '李四', age: 4, class: '中班' },
  // ... 更多数据
]
```

### PPT预览数据格式

```typescript
// PPT预览数据示例
const previewData = [
  { title: '封面', content: '2024年度教学质量评估报告' },
  { title: '目录', content: '摘要、教学成果、师资建设...' },
  { title: '教学成果', content: '学生各项能力显著提升...' },
  // ... 更多幻灯片
]
```

---

## 🔧 集成到AI助手

### 在AI助手组件中使用

```vue
<template>
  <div class="ai-assistant">
    <!-- 其他内容 -->
    
    <!-- 文档生成结果 -->
    <DocumentGenerationResult
      v-if="showDocumentGeneration"
      :status="documentStatus"
      :document-type="documentType"
      :tool-name="currentToolName"
      :result="documentResult"
      :error-message="documentError"
      :start-time="documentStartTime"
      @download="handleDocumentDownload"
      @retry="handleDocumentRetry"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue'
import { DocumentGenerationResult } from '@/components/ai-assistant/document'

// 文档生成状态
const showDocumentGeneration = ref(false)
const documentStatus = ref<'generating' | 'success' | 'error'>('generating')
const documentType = ref('')
const currentToolName = ref('')
const documentResult = ref(null)
const documentError = ref('')
const documentStartTime = ref(0)

// 监听工具调用事件
const handleToolCallStart = (event: any) => {
  if (event.data.name.includes('generate_')) {
    showDocumentGeneration.value = true
    documentStatus.value = 'generating'
    documentType.value = getDocumentType(event.data.name)
    currentToolName.value = event.data.name
    documentStartTime.value = Date.now()
  }
}

const handleToolCallComplete = (event: any) => {
  if (event.data.name.includes('generate_')) {
    if (event.data.status === 'success') {
      documentStatus.value = 'success'
      documentResult.value = event.data.result
    } else {
      documentStatus.value = 'error'
      documentError.value = event.data.error || '生成失败'
    }
  }
}

// 获取文档类型
const getDocumentType = (toolName: string): string => {
  if (toolName.includes('word')) return 'Word'
  if (toolName.includes('pdf')) return 'PDF'
  if (toolName.includes('excel')) return 'Excel'
  if (toolName.includes('ppt')) return 'PPT'
  return '文档'
}

// 处理下载
const handleDocumentDownload = (url: string) => {
  window.open(url, '_blank')
}

// 处理重试
const handleDocumentRetry = () => {
  // 重新调用工具
  documentStatus.value = 'generating'
  documentStartTime.value = Date.now()
}
</script>
```

---

## 🎯 最佳实践

### 1. 进度显示

- 在工具调用开始时显示进度组件
- 根据文档类型设置合适的进度速度
- 在工具调用完成时调用 `completeProgress()`

### 2. 预览功能

- 为Excel提供前10行数据
- 为PPT提供前3张幻灯片数据
- 为Word/PDF提供内容摘要

### 3. 错误处理

- 显示清晰的错误信息
- 提供重试按钮
- 记录错误日志

### 4. 用户体验

- 使用流畅的动画效果
- 提供清晰的状态反馈
- 支持键盘操作（ESC关闭预览）

---

## 📝 注意事项

1. **文件大小**: 确保正确计算文件大小（字节）
2. **时间格式**: 使用ISO格式的时间字符串
3. **下载链接**: 确保下载链接可访问
4. **预览数据**: 根据文档类型提供正确的预览数据格式
5. **错误处理**: 捕获并显示所有可能的错误

---

## 🚀 下一步

1. 集成到AI助手主组件
2. 添加文档生成事件监听
3. 实现下载功能
4. 测试各种文档类型
5. 优化用户体验

---

**创建时间**: 2025-10-14 08:00  
**版本**: 1.0.0  
**状态**: ✅ 已完成

