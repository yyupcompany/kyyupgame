# æ´»åŠ¨æŠ¥åè‡ªåŠ¨åŠ å…¥å®¢æˆ·æ± æ–¹æ¡ˆ

## ğŸ“‹ ä¸šåŠ¡éœ€æ±‚åˆ†æ

### æ ¸å¿ƒéœ€æ±‚
1. **åˆ†äº«é“¾æ¥è¿½è¸ª** - å›­é•¿/è€å¸ˆåˆ†äº«æ´»åŠ¨æ—¶ï¼Œé“¾æ¥å¸¦æœ‰åˆ†äº«è€…ID
2. **æ¥æºæ¸…æ™°è®°å½•** - è®°å½•å®¢æˆ·æ¥æºï¼ˆçº¿ä¸Š/çº¿ä¸‹ã€æ´»åŠ¨/æ¨è/è‡ªæ·»åŠ ç­‰ï¼‰
3. **è‡ªåŠ¨åŠ å…¥å®¢æˆ·æ± ** - æ´»åŠ¨æŠ¥ååè‡ªåŠ¨åˆ›å»ºå®¢æˆ·è®°å½•
4. **åˆ†é…ç»™åˆ†äº«è€…** - è‡ªåŠ¨åˆ†é…ç»™åˆ†äº«é“¾æ¥çš„è€å¸ˆ
5. **è€å¸ˆå®¢æˆ·è·Ÿè¸ª** - è€å¸ˆåœ¨è‡ªå·±çš„é¡µé¢ç®¡ç†å®¢æˆ·

---

## ğŸ”— åˆ†äº«é“¾æ¥è®¾è®¡

### é“¾æ¥æ ¼å¼
```
https://localhost:5173/activity/register/{activityId}?shareBy={teacherId}&shareType={type}
```

### å‚æ•°è¯´æ˜
- `activityId`: æ´»åŠ¨ID
- `shareBy`: åˆ†äº«è€…IDï¼ˆå›­é•¿æˆ–è€å¸ˆçš„ç”¨æˆ·IDï¼‰
- `shareType`: åˆ†äº«ç±»å‹
  - `teacher` - è€å¸ˆåˆ†äº«
  - `principal` - å›­é•¿åˆ†äº«
  - `wechat` - å¾®ä¿¡åˆ†äº«
  - `qrcode` - äºŒç»´ç æ‰«æ

### ç¤ºä¾‹
```
# è€å¸ˆå¼ ä¸‰åˆ†äº«çš„æ´»åŠ¨é“¾æ¥
https://localhost:5173/activity/register/123?shareBy=456&shareType=teacher

# å›­é•¿åˆ†äº«çš„æ´»åŠ¨é“¾æ¥
https://localhost:5173/activity/register/123?shareBy=789&shareType=principal

# äºŒç»´ç æ‰«æ
https://localhost:5173/activity/register/123?shareBy=456&shareType=qrcode
```

---

## ğŸ“Š æ•°æ®åº“è®¾è®¡

### 1. ActivityRegistration è¡¨ï¼ˆæ´»åŠ¨æŠ¥åè¡¨ï¼‰

**éœ€è¦æ·»åŠ çš„å­—æ®µ**ï¼š
```sql
ALTER TABLE activity_registrations 
ADD COLUMN share_by INT COMMENT 'åˆ†äº«è€…IDï¼ˆè€å¸ˆæˆ–å›­é•¿ï¼‰',
ADD COLUMN share_type VARCHAR(20) COMMENT 'åˆ†äº«ç±»å‹: teacher/principal/wechat/qrcode',
ADD COLUMN source_type VARCHAR(50) COMMENT 'æ¥æºç±»å‹: ACTIVITY_ONLINE/ACTIVITY_OFFLINE/TEACHER_REFERRAL/SELF_ADD',
ADD COLUMN source_detail JSON COMMENT 'æ¥æºè¯¦æƒ…ï¼ˆJSONæ ¼å¼ï¼‰',
ADD COLUMN auto_assigned BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦è‡ªåŠ¨åˆ†é…ç»™è€å¸ˆ',
ADD INDEX idx_share_by (share_by),
ADD INDEX idx_source_type (source_type);
```

**å­—æ®µè¯´æ˜**ï¼š
- `share_by`: åˆ†äº«è€…IDï¼Œç”¨äºè‡ªåŠ¨åˆ†é…å®¢æˆ·
- `share_type`: åˆ†äº«ç±»å‹ï¼Œç”¨äºç»Ÿè®¡åˆ†äº«æ•ˆæœ
- `source_type`: æ¥æºç±»å‹ï¼Œç”¨äºå®¢æˆ·æ¥æºåˆ†æ
- `source_detail`: æ¥æºè¯¦æƒ…ï¼ŒJSONæ ¼å¼å­˜å‚¨æ›´å¤šä¿¡æ¯
- `auto_assigned`: æ˜¯å¦è‡ªåŠ¨åˆ†é…ï¼Œç”¨äºåŒºåˆ†è‡ªåŠ¨å’Œæ‰‹åŠ¨åˆ†é…

---

### 2. teacher_customers è¡¨ï¼ˆè€å¸ˆå®¢æˆ·è¡¨ï¼‰

**ç°æœ‰å­—æ®µ**ï¼ˆå·²å­˜åœ¨ï¼‰ï¼š
```sql
CREATE TABLE teacher_customers (
  id INT PRIMARY KEY AUTO_INCREMENT,
  teacher_id INT NOT NULL COMMENT 'æ•™å¸ˆID',
  customer_name VARCHAR(50) COMMENT 'å®¢æˆ·å§“å',
  phone VARCHAR(20) COMMENT 'è”ç³»ç”µè¯',
  gender TINYINT COMMENT 'æ€§åˆ«',
  child_name VARCHAR(50) COMMENT 'å­©å­å§“å',
  child_age INT COMMENT 'å­©å­å¹´é¾„',
  source VARCHAR(50) COMMENT 'æ¥æº',
  status VARCHAR(20) COMMENT 'çŠ¶æ€',
  last_follow_date DATE COMMENT 'æœ€åè·Ÿè¿›æ—¥æœŸ',
  assign_date DATE COMMENT 'åˆ†é…æ—¥æœŸ',
  assigned_by INT COMMENT 'åˆ†é…äººID',
  remarks TEXT COMMENT 'å¤‡æ³¨',
  created_at DATETIME,
  updated_at DATETIME,
  deleted_at DATETIME
);
```

**éœ€è¦æ·»åŠ çš„å­—æ®µ**ï¼š
```sql
ALTER TABLE teacher_customers 
ADD COLUMN source_type VARCHAR(50) COMMENT 'æ¥æºç±»å‹: ACTIVITY_ONLINE/ACTIVITY_OFFLINE/TEACHER_REFERRAL/SELF_ADD',
ADD COLUMN source_id INT COMMENT 'æ¥æºIDï¼ˆæ´»åŠ¨IDã€æŠ¥åIDç­‰ï¼‰',
ADD COLUMN source_detail JSON COMMENT 'æ¥æºè¯¦æƒ…ï¼ˆJSONæ ¼å¼ï¼‰',
ADD COLUMN auto_assigned BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦è‡ªåŠ¨åˆ†é…',
ADD INDEX idx_source_type (source_type),
ADD INDEX idx_source_id (source_id);
```

---

## ğŸ¯ æ¥æºç±»å‹å®šä¹‰

### SourceType æšä¸¾
```typescript
export enum CustomerSourceType {
  // çº¿ä¸Šæ´»åŠ¨æŠ¥å
  ACTIVITY_ONLINE = 'ACTIVITY_ONLINE',
  
  // çº¿ä¸‹æ´»åŠ¨æŠ¥å
  ACTIVITY_OFFLINE = 'ACTIVITY_OFFLINE',
  
  // è€å¸ˆæ¨è
  TEACHER_REFERRAL = 'TEACHER_REFERRAL',
  
  // è€å¸ˆè‡ªå·±æ·»åŠ 
  TEACHER_SELF_ADD = 'TEACHER_SELF_ADD',
  
  // å›­é•¿æ·»åŠ 
  PRINCIPAL_ADD = 'PRINCIPAL_ADD',
  
  // ç½‘ç«™å’¨è¯¢
  WEBSITE_INQUIRY = 'WEBSITE_INQUIRY',
  
  // ç”µè¯å’¨è¯¢
  PHONE_INQUIRY = 'PHONE_INQUIRY',
  
  // å¾®ä¿¡å’¨è¯¢
  WECHAT_INQUIRY = 'WECHAT_INQUIRY',
  
  // å…¶ä»–
  OTHER = 'OTHER'
}
```

### SourceDetail æ•°æ®ç»“æ„
```typescript
interface SourceDetail {
  // æ´»åŠ¨ç›¸å…³
  activityId?: number;
  activityTitle?: string;
  activityType?: string;
  registrationId?: number;
  registrationTime?: string;
  
  // åˆ†äº«ç›¸å…³
  shareBy?: number;
  shareByName?: string;
  shareType?: string;
  shareTime?: string;
  
  // æ¨èç›¸å…³
  referrerTeacherId?: number;
  referrerTeacherName?: string;
  referralReason?: string;
  
  // å…¶ä»–ä¿¡æ¯
  channel?: string;
  remark?: string;
}
```

---

## ğŸ”„ è‡ªåŠ¨åŠ å…¥å®¢æˆ·æ± æµç¨‹

### æµç¨‹å›¾
```
ç”¨æˆ·ç‚¹å‡»åˆ†äº«é“¾æ¥
    â†“
é“¾æ¥å¸¦æœ‰ shareBy å’Œ shareType å‚æ•°
    â†“
ç”¨æˆ·å¡«å†™æ´»åŠ¨æŠ¥åè¡¨å•
    â†“
æäº¤æŠ¥åï¼ˆåŒ…å« shareBy å’Œ shareTypeï¼‰
    â†“
åˆ›å»º ActivityRegistration è®°å½•
    â†“
ã€è‡ªåŠ¨è§¦å‘ã€‘æ£€æŸ¥å®¢æˆ·æ˜¯å¦å·²å­˜åœ¨
    â”œâ”€ å·²å­˜åœ¨ â†’ æ·»åŠ è·Ÿè¿›è®°å½• + å…³è”æ´»åŠ¨
    â””â”€ ä¸å­˜åœ¨ â†’ åˆ›å»ºå®¢æˆ·è®°å½•
    â†“
ã€è‡ªåŠ¨åˆ†é…ã€‘åˆ†é…ç»™ shareBy æŒ‡å®šçš„è€å¸ˆ
    â†“
ã€é€šçŸ¥è€å¸ˆã€‘å‘é€æ–°å®¢æˆ·é€šçŸ¥
    â†“
è€å¸ˆåœ¨"å®¢æˆ·è·Ÿè¸ª"é¡µé¢æŸ¥çœ‹å’Œç®¡ç†
```

---

## ğŸ’» ä»£ç å®ç°

### 1. æ›´æ–° ActivityRegistration æ¨¡å‹

**æ–‡ä»¶**: `server/src/models/activity-registration.model.ts`

```typescript
export class ActivityRegistration extends Model {
  // ... ç°æœ‰å­—æ®µ
  
  // æ–°å¢å­—æ®µ
  declare shareBy: number | null;
  declare shareType: string | null;
  declare sourceType: string | null;
  declare sourceDetail: any | null;
  declare autoAssigned: CreationOptional<boolean>;
}

export const initActivityRegistration = (sequelize: Sequelize) => {
  ActivityRegistration.init(
    {
      // ... ç°æœ‰å­—æ®µå®šä¹‰
      
      // æ–°å¢å­—æ®µå®šä¹‰
      shareBy: {
        type: DataTypes.INTEGER,
        allowNull: true,
        comment: 'åˆ†äº«è€…IDï¼ˆè€å¸ˆæˆ–å›­é•¿ï¼‰',
      },
      shareType: {
        type: DataTypes.STRING(20),
        allowNull: true,
        comment: 'åˆ†äº«ç±»å‹: teacher/principal/wechat/qrcode',
      },
      sourceType: {
        type: DataTypes.STRING(50),
        allowNull: true,
        comment: 'æ¥æºç±»å‹',
      },
      sourceDetail: {
        type: DataTypes.JSON,
        allowNull: true,
        comment: 'æ¥æºè¯¦æƒ…ï¼ˆJSONæ ¼å¼ï¼‰',
      },
      autoAssigned: {
        type: DataTypes.BOOLEAN,
        allowNull: false,
        defaultValue: false,
        comment: 'æ˜¯å¦è‡ªåŠ¨åˆ†é…ç»™è€å¸ˆ',
      },
    },
    // ... å…¶ä»–é…ç½®
  );
};
```

---

### 2. å®ç°è‡ªåŠ¨åŠ å…¥å®¢æˆ·æ± æœåŠ¡

**æ–‡ä»¶**: `server/src/services/activity/activity-registration.service.ts`

```typescript
import { QueryTypes, Transaction } from 'sequelize';
import { sequelize } from '../../config/database';

export class ActivityRegistrationService {
  /**
   * åˆ›å»ºæ´»åŠ¨æŠ¥åï¼ˆåŒ…å«è‡ªåŠ¨åŠ å…¥å®¢æˆ·æ± ï¼‰
   */
  public async createRegistration(data: {
    activityId: number;
    contactName: string;
    contactPhone: string;
    childName?: string;
    childAge?: number;
    childGender?: number;
    attendeeCount: number;
    specialNeeds?: string;
    source?: string;
    // æ–°å¢å‚æ•°
    shareBy?: number;
    shareType?: string;
  }, userId?: number): Promise<ActivityRegistration> {
    const transaction = await sequelize.transaction();
    
    try {
      // 1. æ£€æŸ¥æ´»åŠ¨æ˜¯å¦å­˜åœ¨ä¸”å¯æŠ¥å
      const activity = await Activity.findByPk(data.activityId);
      if (!activity) {
        throw new ApiError(404, 'æ´»åŠ¨ä¸å­˜åœ¨');
      }
      
      // æ£€æŸ¥æŠ¥åæ—¶é—´å’Œåé¢
      const now = new Date();
      if (now < activity.registrationStartTime || now > activity.registrationEndTime) {
        throw new ApiError(400, 'å½“å‰ä¸åœ¨æ´»åŠ¨æŠ¥åæ—¶é—´å†…');
      }
      if (activity.registeredCount >= activity.capacity) {
        throw new ApiError(400, 'æ´»åŠ¨åé¢å·²æ»¡');
      }
      
      // 2. ç¡®å®šæ¥æºç±»å‹
      const sourceType = this.determineSourceType(data.shareType, data.source);
      
      // 3. æ„å»ºæ¥æºè¯¦æƒ…
      const sourceDetail = {
        activityId: activity.id,
        activityTitle: activity.title,
        activityType: activity.activityType,
        registrationTime: new Date().toISOString(),
        shareBy: data.shareBy,
        shareType: data.shareType,
        channel: data.source
      };
      
      // 4. åˆ›å»ºæŠ¥åè®°å½•
      const registration = await ActivityRegistration.create({
        ...data,
        registrationTime: new Date(),
        status: activity.needsApproval ? 0 : 1,
        isConversion: false,
        sourceType,
        sourceDetail,
        autoAssigned: !!data.shareBy, // å¦‚æœæœ‰åˆ†äº«è€…ï¼Œæ ‡è®°ä¸ºè‡ªåŠ¨åˆ†é…
        creatorId: userId,
        updaterId: userId
      }, { transaction });
      
      // 5. è‡ªåŠ¨åŠ å…¥å®¢æˆ·æ± 
      await this.addToCustomerPool({
        registration,
        activity,
        shareBy: data.shareBy,
        shareType: data.shareType,
        sourceType,
        sourceDetail
      }, transaction);
      
      // 6. æ›´æ–°æ´»åŠ¨æŠ¥åäººæ•°
      await activity.increment('registeredCount', { transaction });
      
      await transaction.commit();
      return registration;
    } catch (error) {
      await transaction.rollback();
      throw error;
    }
  }
  
  /**
   * ç¡®å®šæ¥æºç±»å‹
   */
  private determineSourceType(shareType?: string, source?: string): string {
    if (shareType === 'teacher') {
      return 'ACTIVITY_ONLINE'; // è€å¸ˆåˆ†äº«çš„çº¿ä¸Šæ´»åŠ¨
    } else if (shareType === 'principal') {
      return 'ACTIVITY_ONLINE'; // å›­é•¿åˆ†äº«çš„çº¿ä¸Šæ´»åŠ¨
    } else if (shareType === 'qrcode') {
      return 'ACTIVITY_OFFLINE'; // äºŒç»´ç æ‰«æï¼Œå¯èƒ½æ˜¯çº¿ä¸‹æ´»åŠ¨
    } else if (source === 'offline') {
      return 'ACTIVITY_OFFLINE'; // çº¿ä¸‹æ´»åŠ¨
    } else {
      return 'ACTIVITY_ONLINE'; // é»˜è®¤çº¿ä¸Šæ´»åŠ¨
    }
  }
  
  /**
   * è‡ªåŠ¨åŠ å…¥å®¢æˆ·æ± 
   */
  private async addToCustomerPool(params: {
    registration: ActivityRegistration;
    activity: Activity;
    shareBy?: number;
    shareType?: string;
    sourceType: string;
    sourceDetail: any;
  }, transaction: Transaction): Promise<void> {
    const { registration, activity, shareBy, shareType, sourceType, sourceDetail } = params;
    
    try {
      // 1. æ£€æŸ¥å®¢æˆ·æ˜¯å¦å·²å­˜åœ¨ï¼ˆé€šè¿‡æ‰‹æœºå·ï¼‰
      const existingCustomer = await sequelize.query(
        `SELECT id, teacher_id FROM teacher_customers 
         WHERE phone = ? AND deleted_at IS NULL 
         LIMIT 1`,
        {
          replacements: [registration.contactPhone],
          type: QueryTypes.SELECT,
          transaction
        }
      );
      
      if (existingCustomer && existingCustomer.length > 0) {
        // å®¢æˆ·å·²å­˜åœ¨
        const customer = existingCustomer[0] as any;
        
        // æ·»åŠ è·Ÿè¿›è®°å½•
        await sequelize.query(
          `INSERT INTO parent_followups 
           (parent_id, content, followup_date, followup_type, result, created_by, created_at, updated_at) 
           VALUES (?, ?, NOW(), 'ACTIVITY', 'NEW', ?, NOW(), NOW())`,
          {
            replacements: [
              customer.id,
              `å‚åŠ æ´»åŠ¨æŠ¥å - ${activity.title}ï¼ˆæ´»åŠ¨ID: ${activity.id}ï¼‰`,
              shareBy || 1
            ],
            type: QueryTypes.INSERT,
            transaction
          }
        );
        
        console.log(`âœ… å®¢æˆ·å·²å­˜åœ¨ï¼Œæ·»åŠ è·Ÿè¿›è®°å½• - å®¢æˆ·ID: ${customer.id}`);
      } else {
        // æ–°å®¢æˆ·ï¼Œåˆ›å»ºå®¢æˆ·è®°å½•
        const assignedTeacherId = shareBy || null; // åˆ†é…ç»™åˆ†äº«è€…
        
        const [insertResult] = await sequelize.query(
          `INSERT INTO teacher_customers 
           (teacher_id, customer_name, phone, gender, child_name, child_age, 
            source, status, source_type, source_id, source_detail, 
            auto_assigned, assign_date, assigned_by, created_at, updated_at) 
           VALUES (?, ?, ?, ?, ?, ?, ?, 'NEW', ?, ?, ?, ?, NOW(), ?, NOW(), NOW())`,
          {
            replacements: [
              assignedTeacherId,
              registration.contactName,
              registration.contactPhone,
              registration.childGender || 1,
              registration.childName || 'å¾…å¡«å†™',
              registration.childAge || 36,
              shareType || 'ACTIVITY',
              sourceType,
              registration.id,
              JSON.stringify(sourceDetail),
              !!shareBy, // æ˜¯å¦è‡ªåŠ¨åˆ†é…
              shareBy || 1
            ],
            type: QueryTypes.INSERT,
            transaction
          }
        );
        
        const customerId = (insertResult as any);
        console.log(`âœ… åˆ›å»ºæ–°å®¢æˆ·è®°å½• - å®¢æˆ·ID: ${customerId}, åˆ†é…ç»™è€å¸ˆID: ${assignedTeacherId}`);
        
        // å¦‚æœæœ‰åˆ†äº«è€…ï¼Œå‘é€é€šçŸ¥ï¼ˆTODO: å®ç°é€šçŸ¥åŠŸèƒ½ï¼‰
        if (shareBy) {
          // await this.notifyTeacher(shareBy, customerId, activity);
        }
      }
    } catch (error) {
      console.error('âŒ åŠ å…¥å®¢æˆ·æ± å¤±è´¥:', error);
      // ä¸æŠ›å‡ºé”™è¯¯ï¼Œé¿å…å½±å“æŠ¥åæµç¨‹
    }
  }
}
```

---

## ğŸ“± å‰ç«¯å®ç°

### 1. æ´»åŠ¨æŠ¥åé¡µé¢è·å–åˆ†äº«å‚æ•°

**æ–‡ä»¶**: `client/src/pages/activity/ActivityRegister.vue`

```typescript
import { useRoute } from 'vue-router';

const route = useRoute();

// è·å–åˆ†äº«å‚æ•°
const shareBy = ref<number | null>(null);
const shareType = ref<string | null>(null);

onMounted(() => {
  // ä»URLå‚æ•°è·å–åˆ†äº«ä¿¡æ¯
  shareBy.value = route.query.shareBy ? Number(route.query.shareBy) : null;
  shareType.value = route.query.shareType as string || null;
  
  console.log('åˆ†äº«è€…ID:', shareBy.value);
  console.log('åˆ†äº«ç±»å‹:', shareType.value);
});

// æäº¤æŠ¥åæ—¶åŒ…å«åˆ†äº«å‚æ•°
const submitRegistration = async () => {
  const data = {
    activityId: activityId.value,
    contactName: form.contactName,
    contactPhone: form.contactPhone,
    childName: form.childName,
    childAge: form.childAge,
    childGender: form.childGender,
    attendeeCount: form.attendeeCount,
    specialNeeds: form.specialNeeds,
    source: 'online',
    // åŒ…å«åˆ†äº«å‚æ•°
    shareBy: shareBy.value,
    shareType: shareType.value
  };
  
  await createActivityRegistration(data);
};
```

---

### 2. ç”Ÿæˆåˆ†äº«é“¾æ¥

**æ–‡ä»¶**: `client/src/pages/activity/ActivityDetail.vue`

```typescript
import { useUserStore } from '@/stores/user';

const userStore = useUserStore();

// ç”Ÿæˆåˆ†äº«é“¾æ¥
const generateShareLink = (activityId: number, shareType: string = 'teacher') => {
  const baseUrl = 'https://localhost:5173/activity/register';
  const userId = userStore.user?.id;
  
  return `${baseUrl}/${activityId}?shareBy=${userId}&shareType=${shareType}`;
};

// å¤åˆ¶åˆ†äº«é“¾æ¥
const copyShareLink = () => {
  const link = generateShareLink(activityId.value, 'teacher');
  navigator.clipboard.writeText(link);
  ElMessage.success('åˆ†äº«é“¾æ¥å·²å¤åˆ¶');
};

// ç”ŸæˆäºŒç»´ç 
const generateQRCode = () => {
  const link = generateShareLink(activityId.value, 'qrcode');
  // ä½¿ç”¨äºŒç»´ç åº“ç”ŸæˆäºŒç»´ç 
  // ...
};
```

---

## ğŸ“Š è€å¸ˆå®¢æˆ·è·Ÿè¸ªé¡µé¢

è€å¸ˆåœ¨ `client/src/pages/teacher-center/customer-tracking/index.vue` é¡µé¢å¯ä»¥ï¼š

1. **æŸ¥çœ‹æ‰€æœ‰åˆ†é…ç»™è‡ªå·±çš„å®¢æˆ·**
   - åŒ…æ‹¬è‡ªåŠ¨åˆ†é…çš„ï¼ˆæ´»åŠ¨æŠ¥åï¼‰
   - åŒ…æ‹¬å›­é•¿æ‰‹åŠ¨åˆ†é…çš„

2. **æŸ¥çœ‹å®¢æˆ·æ¥æº**
   - æ¥æºç±»å‹ï¼šçº¿ä¸Šæ´»åŠ¨/çº¿ä¸‹æ´»åŠ¨/æ¨è/è‡ªæ·»åŠ 
   - æ¥æºè¯¦æƒ…ï¼šå…·ä½“æ´»åŠ¨åç§°ã€æŠ¥åæ—¶é—´ç­‰

3. **è·Ÿè¿›å®¢æˆ·**
   - æ·»åŠ è·Ÿè¿›è®°å½•
   - æ›´æ–°å®¢æˆ·çŠ¶æ€
   - è®¾ç½®ä¸‹æ¬¡è·Ÿè¿›æ—¶é—´

4. **è½¬åŒ–ç»Ÿè®¡**
   - æŸ¥çœ‹è‡ªå·±çš„å®¢æˆ·è½¬åŒ–ç‡
   - æŸ¥çœ‹å„æ¥æºçš„è½¬åŒ–æ•ˆæœ

---

## ğŸ¯ æ€»ç»“

### âœ… å®ç°çš„åŠŸèƒ½
1. **åˆ†äº«é“¾æ¥è¿½è¸ª** - é“¾æ¥å¸¦æœ‰åˆ†äº«è€…IDå’Œç±»å‹
2. **è‡ªåŠ¨åŠ å…¥å®¢æˆ·æ± ** - æŠ¥ååè‡ªåŠ¨åˆ›å»ºå®¢æˆ·è®°å½•
3. **è‡ªåŠ¨åˆ†é…** - è‡ªåŠ¨åˆ†é…ç»™åˆ†äº«é“¾æ¥çš„è€å¸ˆ
4. **æ¥æºæ¸…æ™°** - è®°å½•è¯¦ç»†çš„æ¥æºä¿¡æ¯
5. **è€å¸ˆç®¡ç†** - è€å¸ˆåœ¨è‡ªå·±çš„é¡µé¢ç®¡ç†å®¢æˆ·

### ğŸ“ éœ€è¦çš„æ•°æ®åº“è¿ç§»
```sql
-- 1. æ›´æ–° activity_registrations è¡¨
ALTER TABLE activity_registrations 
ADD COLUMN share_by INT COMMENT 'åˆ†äº«è€…ID',
ADD COLUMN share_type VARCHAR(20) COMMENT 'åˆ†äº«ç±»å‹',
ADD COLUMN source_type VARCHAR(50) COMMENT 'æ¥æºç±»å‹',
ADD COLUMN source_detail JSON COMMENT 'æ¥æºè¯¦æƒ…',
ADD COLUMN auto_assigned BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦è‡ªåŠ¨åˆ†é…';

-- 2. æ›´æ–° teacher_customers è¡¨
ALTER TABLE teacher_customers 
ADD COLUMN source_type VARCHAR(50) COMMENT 'æ¥æºç±»å‹',
ADD COLUMN source_id INT COMMENT 'æ¥æºID',
ADD COLUMN source_detail JSON COMMENT 'æ¥æºè¯¦æƒ…',
ADD COLUMN auto_assigned BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦è‡ªåŠ¨åˆ†é…';
```

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-10-05  
**ç»´æŠ¤äººå‘˜**ï¼šAI Assistant

