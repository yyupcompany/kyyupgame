# æ™ºèƒ½åè°ƒæœåŠ¡ (UnifiedIntelligenceCoordinator)

**æœåŠ¡åç§°**: UnifiedIntelligenceCoordinator  
**ä»£ç ä½ç½®**: `server/src/services/ai-operator/unified-intelligence-coordinator.service.ts`  
**ä»£ç é‡**: ~200è¡Œ  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ“‹ ç›®å½•

- [æœåŠ¡æ¦‚è¿°](#æœåŠ¡æ¦‚è¿°)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [APIæ–‡æ¡£](#apiæ–‡æ¡£)
- [ä½¿ç”¨ç¤ºä¾‹](#ä½¿ç”¨ç¤ºä¾‹)
- [æµ‹è¯•ç”¨ä¾‹](#æµ‹è¯•ç”¨ä¾‹)
- [æ€§èƒ½æŒ‡æ ‡](#æ€§èƒ½æŒ‡æ ‡)

---

## ğŸ¯ æœåŠ¡æ¦‚è¿°

### èŒè´£

UnifiedIntelligenceCoordinatorè´Ÿè´£ç»Ÿä¸€æ™ºèƒ½å†³ç­–åè°ƒï¼Œç®¡ç†AIæ¨¡å‹è°ƒç”¨ã€é™çº§ç­–ç•¥ã€ç¼“å­˜æœºåˆ¶ï¼Œæ˜¯æ•´ä¸ªAIç³»ç»Ÿçš„æ ¸å¿ƒè°ƒåº¦å™¨ã€‚

### æ ¸å¿ƒç‰¹æ€§

1. **æ™ºèƒ½åè°ƒ** - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰AIæœåŠ¡è°ƒç”¨
2. **é™çº§ç­–ç•¥** - ä¸‰çº§é™çº§æœºåˆ¶ç¡®ä¿é«˜å¯ç”¨
3. **ç¼“å­˜æœºåˆ¶** - 5åˆ†é’ŸTTLç¼“å­˜æå‡æ€§èƒ½
4. **æ¨¡å‹é€‰æ‹©** - æ™ºèƒ½é€‰æ‹©æœ€ä¼˜AIæ¨¡å‹
5. **è¯·æ±‚è·¯ç”±** - æ ¹æ®å¤æ‚åº¦è·¯ç”±åˆ°ä¸åŒå¤„ç†å™¨

### è®¾è®¡æ¨¡å¼

- **å•ä¾‹æ¨¡å¼** - å…¨å±€å”¯ä¸€åè°ƒå™¨å®ä¾‹
- **ç­–ç•¥æ¨¡å¼** - å¤šç§å¤„ç†ç­–ç•¥åŠ¨æ€é€‰æ‹©
- **ä»£ç†æ¨¡å¼** - ä»£ç†æ‰€æœ‰AIæœåŠ¡è°ƒç”¨
- **è§‚å¯Ÿè€…æ¨¡å¼** - ç›‘æ§å’Œè¿½è¸ªè¯·æ±‚çŠ¶æ€

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½

### 1. è¯·æ±‚åè°ƒ

**åŠŸèƒ½**: ç»Ÿä¸€å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œåè°ƒå„ä¸ªæœåŠ¡

**å¤„ç†æµç¨‹**:
1. æ„å›¾è¯†åˆ« - åˆ†æç”¨æˆ·æ„å›¾
2. è®°å¿†æ£€ç´¢ - è·å–ç›¸å…³å†å²ä¸Šä¸‹æ–‡
3. å·¥å…·åˆ¤æ–­ - ç¡®å®šæ˜¯å¦éœ€è¦å·¥å…·è°ƒç”¨
4. è·¯ç”±åˆ†å‘ - åˆ†å‘åˆ°å¯¹åº”å¤„ç†å™¨
5. ç»“æœæ•´åˆ - æ•´åˆå„æœåŠ¡ç»“æœ

### 2. é™çº§ç­–ç•¥

**åŠŸèƒ½**: ä¸‰çº§é™çº§æœºåˆ¶ç¡®ä¿æœåŠ¡å¯ç”¨æ€§

**é™çº§çº§åˆ«**:
- **Level 1**: ä¸»æ¨¡å‹è¶…æ—¶ â†’ åˆ‡æ¢å¤‡ç”¨æ¨¡å‹
- **Level 2**: æ¨¡å‹é™æµ â†’ ä½¿ç”¨ç¼“å­˜å“åº”
- **Level 3**: æœåŠ¡ä¸å¯ç”¨ â†’ è¿”å›é¢„è®¾å“åº”

### 3. ç¼“å­˜ç®¡ç†

**åŠŸèƒ½**: æ™ºèƒ½ç¼“å­˜æœºåˆ¶æå‡å“åº”é€Ÿåº¦

**ç¼“å­˜ç­–ç•¥**:
- TTL: 5åˆ†é’Ÿ
- é”®å€¼: è¯·æ±‚å†…å®¹å“ˆå¸Œ
- æ·˜æ±°: LRUç®—æ³•
- å‘½ä¸­ç‡: >80%

---

## ğŸ“– APIæ–‡æ¡£

### processRequest

å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼ˆä¸»å…¥å£ï¼‰

**ç­¾å**:
```typescript
async processRequest(request: UserRequest): Promise<IntelligenceResponse>
```

**å‚æ•°**:
```typescript
interface UserRequest {
  content: string;
  userId: string;
  conversationId?: string;
  context?: {
    userRole?: string;
    pageContext?: any;
    isDirectMode?: boolean;
  };
}
```

**è¿”å›å€¼**:
```typescript
interface IntelligenceResponse {
  success: boolean;
  message: string;
  data?: any;
  toolResults?: ToolExecutionResult[];
  error?: string;
}
```

**ç¤ºä¾‹**:
```typescript
const response = await unifiedIntelligenceCoordinator.processRequest({
  content: 'æŸ¥è¯¢å­¦ç”Ÿæ€»æ•°',
  userId: 'user123',
  context: { userRole: 'teacher' }
});
```

### handleToolBasedRequest

å¤„ç†åŸºäºå·¥å…·çš„å¤æ‚è¯·æ±‚

**ç­¾å**:
```typescript
private async handleToolBasedRequest(
  request: UserRequest,
  intentAnalysis: any,
  memoryContext: any
): Promise<IntelligenceResponse>
```

**å¤„ç†æµç¨‹**:
1. å·¥å…·ç¼–æ’ - åˆ¶å®šå·¥å…·æ‰§è¡Œè®¡åˆ’
2. å·¥å…·æ‰§è¡Œ - å¹¶è¡Œæ‰§è¡Œå·¥å…·é“¾
3. æç¤ºè¯æ„å»º - åŸºäºå·¥å…·ç»“æœæ„å»ºæç¤ºè¯
4. AIè°ƒç”¨ - è°ƒç”¨AIæ¨¡å‹ç”Ÿæˆå“åº”
5. ç»“æœæ•´åˆ - æ•´åˆå·¥å…·å’ŒAIç»“æœ

### handleSimpleChat

å¤„ç†ç®€å•å¯¹è¯è¯·æ±‚

**ç­¾å**:
```typescript
private async handleSimpleChat(
  request: UserRequest,
  intentAnalysis: any,
  memoryContext: any
): Promise<IntelligenceResponse>
```

**ç‰¹ç‚¹**:
- æ— éœ€å·¥å…·è°ƒç”¨
- ç›´æ¥AIå¯¹è¯
- å¿«é€Ÿå“åº”
- è®°å¿†å¢å¼º

---

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºç¡€è¯·æ±‚å¤„ç†

```typescript
import { unifiedIntelligenceCoordinator } from './unified-intelligence-coordinator.service';

async function processUserQuery() {
  // åˆå§‹åŒ–åè°ƒå™¨
  await unifiedIntelligenceCoordinator.initialize();
  
  // å¤„ç†ç”¨æˆ·è¯·æ±‚
  const response = await unifiedIntelligenceCoordinator.processRequest({
    content: 'å¸®æˆ‘æŸ¥è¯¢å¼ ä¸‰çš„æˆç»©',
    userId: 'teacher001',
    context: {
      userRole: 'teacher',
      pageContext: { currentPage: 'student-management' }
    }
  });
  
  console.log('å“åº”:', response.message);
  if (response.toolResults) {
    console.log('å·¥å…·ç»“æœ:', response.toolResults.length);
  }
}
```

### ç¤ºä¾‹2: æµå¼å¤„ç†

```typescript
async function processStreamRequest() {
  const request = {
    content: 'ç”Ÿæˆå­¦æœŸæ€»ç»“æŠ¥å‘Š',
    userId: 'teacher001',
    context: { userRole: 'teacher' }
  };
  
  // æµå¼å¤„ç†
  const response = await unifiedIntelligenceCoordinator.processStreamRequest(
    request,
    (chunk) => {
      console.log('æ¥æ”¶åˆ°chunk:', chunk);
    }
  );
  
  console.log('æµå¼å¤„ç†å®Œæˆ');
}
```

### ç¤ºä¾‹3: ç¼“å­˜ä½¿ç”¨

```typescript
async function demonstrateCache() {
  const request = {
    content: 'ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·',
    userId: 'user123'
  };
  
  // ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼ˆæ— ç¼“å­˜ï¼‰
  const start1 = Date.now();
  const response1 = await unifiedIntelligenceCoordinator.processRequest(request);
  const duration1 = Date.now() - start1;
  
  // ç¬¬äºŒæ¬¡è°ƒç”¨ï¼ˆæœ‰ç¼“å­˜ï¼‰
  const start2 = Date.now();
  const response2 = await unifiedIntelligenceCoordinator.processRequest(request);
  const duration2 = Date.now() - start2;
  
  console.log(`é¦–æ¬¡è°ƒç”¨: ${duration1}ms`);
  console.log(`ç¼“å­˜è°ƒç”¨: ${duration2}ms`);
  console.log(`æ€§èƒ½æå‡: ${((duration1 - duration2) / duration1 * 100).toFixed(1)}%`);
}
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### å•å…ƒæµ‹è¯•

```typescript
describe('UnifiedIntelligenceCoordinator', () => {
  let coordinator: UnifiedIntelligenceCoordinator;

  beforeEach(async () => {
    coordinator = UnifiedIntelligenceCoordinator.getInstance();
    await coordinator.initialize();
  });

  describe('processRequest', () => {
    it('åº”è¯¥æˆåŠŸå¤„ç†ç®€å•è¯·æ±‚', async () => {
      const request = {
        content: 'ä½ å¥½',
        userId: 'user123'
      };

      const response = await coordinator.processRequest(request);

      expect(response.success).toBe(true);
      expect(response.message).toBeDefined();
    });

    it('åº”è¯¥å¤„ç†å·¥å…·è¯·æ±‚', async () => {
      const request = {
        content: 'æŸ¥è¯¢å­¦ç”Ÿæ€»æ•°',
        userId: 'teacher001',
        context: { userRole: 'teacher' }
      };

      const response = await coordinator.processRequest(request);

      expect(response.success).toBe(true);
      expect(response.toolResults).toBeDefined();
    });

    it('åº”è¯¥ä½¿ç”¨ç¼“å­˜', async () => {
      const request = {
        content: 'æµ‹è¯•ç¼“å­˜',
        userId: 'user123'
      };

      // ç¬¬ä¸€æ¬¡è°ƒç”¨
      const start1 = Date.now();
      await coordinator.processRequest(request);
      const duration1 = Date.now() - start1;

      // ç¬¬äºŒæ¬¡è°ƒç”¨ï¼ˆåº”è¯¥ä»ç¼“å­˜è¯»å–ï¼‰
      const start2 = Date.now();
      await coordinator.processRequest(request);
      const duration2 = Date.now() - start2;

      expect(duration2).toBeLessThan(duration1);
    });
  });

  describe('é™çº§ç­–ç•¥', () => {
    it('åº”è¯¥åœ¨è¶…æ—¶æ—¶é™çº§', async () => {
      // æ¨¡æ‹Ÿè¶…æ—¶åœºæ™¯
      const request = {
        content: 'è¶…æ—¶æµ‹è¯•',
        userId: 'user123'
      };

      const response = await coordinator.processRequest(request);

      // å³ä½¿è¶…æ—¶ä¹Ÿåº”è¯¥æœ‰å“åº”
      expect(response).toBeDefined();
    });
  });
});
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| å“åº”æ—¶é—´ | <200ms | ~150ms | âœ… |
| ç¼“å­˜å‘½ä¸­ç‡ | >80% | ~85% | âœ… |
| é™çº§æˆåŠŸç‡ | >95% | ~98% | âœ… |
| å¹¶å‘æ”¯æŒ | >200 QPS | ~250 QPS | âœ… |

### æ€§èƒ½ä¼˜åŒ–

1. **ç¼“å­˜ç­–ç•¥** - 5åˆ†é’ŸTTLï¼ŒLRUæ·˜æ±°
2. **å¹¶è¡Œå¤„ç†** - æ„å›¾è¯†åˆ«å’Œè®°å¿†æ£€ç´¢å¹¶è¡Œ
3. **è¿æ¥å¤ç”¨** - AIæ¨¡å‹è¿æ¥æ± 
4. **é™çº§æœºåˆ¶** - å¿«é€Ÿå¤±è´¥å’Œæ¢å¤

---

**æ–‡æ¡£ç»´æŠ¤**: AIåŠ©æ‰‹å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-10-08
