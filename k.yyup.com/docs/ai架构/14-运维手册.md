# AIåŠ©æ‰‹ç³»ç»Ÿè¿ç»´æ‰‹å†Œ

**ç‰ˆæœ¬**: 2.0.0  
**æœ€åæ›´æ–°**: 2025-10-08  
**è¿ç»´å›¢é˜Ÿ**: AIåŠ©æ‰‹å¼€å‘å›¢é˜Ÿ

---

## ğŸ“‹ ç›®å½•

- [è¿ç»´æ¦‚è¿°](#è¿ç»´æ¦‚è¿°)
- [ç›‘æ§ä½“ç³»](#ç›‘æ§ä½“ç³»)
- [æ—¥å¿—ç®¡ç†](#æ—¥å¿—ç®¡ç†)
- [æ•…éšœå¤„ç†](#æ•…éšœå¤„ç†)
- [å¤‡ä»½æ¢å¤](#å¤‡ä»½æ¢å¤)
- [å®‰å…¨è¿ç»´](#å®‰å…¨è¿ç»´)

---

## ğŸ¯ è¿ç»´æ¦‚è¿°

### è¿ç»´ç›®æ ‡

1. **é«˜å¯ç”¨æ€§** - ç³»ç»Ÿå¯ç”¨æ€§ â‰¥ 99.9%
2. **é«˜æ€§èƒ½** - å“åº”æ—¶é—´ â‰¤ 2ç§’
3. **æ•°æ®å®‰å…¨** - é›¶æ•°æ®ä¸¢å¤±
4. **å¿«é€Ÿæ¢å¤** - æ•…éšœæ¢å¤æ—¶é—´ â‰¤ 5åˆ†é’Ÿ
5. **æŒç»­ä¼˜åŒ–** - æ€§èƒ½æŒç»­æ”¹è¿›

### è¿ç»´æ¶æ„

```
è¿ç»´ç›‘æ§ä½“ç³»
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç›‘æ§ä¸­å¿ƒ                    â”‚
â”‚  - Prometheus (æŒ‡æ ‡æ”¶é›†)                 â”‚
â”‚  - Grafana (å¯è§†åŒ–)                     â”‚
â”‚  - AlertManager (å‘Šè­¦)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ—¥å¿—ä¸­å¿ƒ                    â”‚
â”‚  - ELK Stack (æ—¥å¿—æ”¶é›†åˆ†æ)              â”‚
â”‚  - Fluentd (æ—¥å¿—è½¬å‘)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨å±‚ç›‘æ§                  â”‚
â”‚  - APM (åº”ç”¨æ€§èƒ½ç›‘æ§)                    â”‚
â”‚  - å¥åº·æ£€æŸ¥                              â”‚
â”‚  - ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š ç›‘æ§ä½“ç³»

### Prometheusé…ç½®

**æ–‡ä»¶**: `monitoring/prometheus/prometheus.yml`

```yaml
global:
  scrape_interval: 15s
  evaluation_interval: 15s

rule_files:
  - "rules/*.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

scrape_configs:
  # AIåŠ©æ‰‹åç«¯ç›‘æ§
  - job_name: 'ai-assistant-backend'
    static_configs:
      - targets: ['backend:3000']
    metrics_path: '/api/metrics'
    scrape_interval: 30s

  # æ•°æ®åº“ç›‘æ§
  - job_name: 'mysql'
    static_configs:
      - targets: ['mysql-exporter:9104']

  # Redisç›‘æ§
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']

  # ç³»ç»Ÿç›‘æ§
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']

  # Kubernetesç›‘æ§
  - job_name: 'kubernetes-pods'
    kubernetes_sd_configs:
      - role: pod
    relabel_configs:
      - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
        action: keep
        regex: true
```

### Grafanaä»ªè¡¨æ¿

**AIæœåŠ¡ç›‘æ§é¢æ¿**:

```json
{
  "dashboard": {
    "title": "AIåŠ©æ‰‹ç³»ç»Ÿç›‘æ§",
    "panels": [
      {
        "title": "APIå“åº”æ—¶é—´",
        "type": "graph",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))",
            "legendFormat": "P95å“åº”æ—¶é—´"
          }
        ]
      },
      {
        "title": "è¯·æ±‚é‡",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(http_requests_total[5m])",
            "legendFormat": "QPS"
          }
        ]
      },
      {
        "title": "é”™è¯¯ç‡",
        "type": "singlestat",
        "targets": [
          {
            "expr": "rate(http_requests_total{status=~\"5..\"}[5m]) / rate(http_requests_total[5m])",
            "legendFormat": "é”™è¯¯ç‡"
          }
        ]
      },
      {
        "title": "AIæ¨¡å‹è°ƒç”¨",
        "type": "graph",
        "targets": [
          {
            "expr": "rate(ai_model_requests_total[5m])",
            "legendFormat": "AIè°ƒç”¨é‡"
          }
        ]
      }
    ]
  }
}
```

### å‘Šè­¦è§„åˆ™

**æ–‡ä»¶**: `monitoring/prometheus/rules/alerts.yml`

```yaml
groups:
  - name: ai-assistant-alerts
    rules:
      # é«˜å“åº”æ—¶é—´å‘Šè­¦
      - alert: HighResponseTime
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) > 2
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "APIå“åº”æ—¶é—´è¿‡é«˜"
          description: "P95å“åº”æ—¶é—´è¶…è¿‡2ç§’ï¼Œå½“å‰å€¼: {{ $value }}ç§’"

      # é«˜é”™è¯¯ç‡å‘Šè­¦
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) / rate(http_requests_total[5m]) > 0.01
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "APIé”™è¯¯ç‡è¿‡é«˜"
          description: "é”™è¯¯ç‡è¶…è¿‡1%ï¼Œå½“å‰å€¼: {{ $value | humanizePercentage }}"

      # æ•°æ®åº“è¿æ¥å‘Šè­¦
      - alert: DatabaseConnectionFailed
        expr: mysql_up == 0
        for: 30s
        labels:
          severity: critical
        annotations:
          summary: "æ•°æ®åº“è¿æ¥å¤±è´¥"
          description: "MySQLæ•°æ®åº“æ— æ³•è¿æ¥"

      # å†…å­˜ä½¿ç”¨å‘Šè­¦
      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes > 0.9
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜"
          description: "å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡90%ï¼Œå½“å‰å€¼: {{ $value | humanizePercentage }}"

      # AIæœåŠ¡å¼‚å¸¸å‘Šè­¦
      - alert: AIServiceDown
        expr: up{job="ai-assistant-backend"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "AIæœåŠ¡ä¸å¯ç”¨"
          description: "AIåŠ©æ‰‹åç«¯æœåŠ¡æ— æ³•è®¿é—®"
```

---

## ğŸ“ æ—¥å¿—ç®¡ç†

### æ—¥å¿—é…ç½®

**æ–‡ä»¶**: `server/src/config/logger.ts`

```typescript
import winston from 'winston';
import 'winston-daily-rotate-file';

const logFormat = winston.format.combine(
  winston.format.timestamp(),
  winston.format.errors({ stack: true }),
  winston.format.json()
);

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: logFormat,
  defaultMeta: {
    service: 'ai-assistant',
    version: process.env.npm_package_version
  },
  transports: [
    // æ§åˆ¶å°è¾“å‡º
    new winston.transports.Console({
      format: winston.format.combine(
        winston.format.colorize(),
        winston.format.simple()
      )
    }),
    
    // é”™è¯¯æ—¥å¿—æ–‡ä»¶
    new winston.transports.DailyRotateFile({
      filename: 'logs/error-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      level: 'error',
      maxSize: '20m',
      maxFiles: '14d'
    }),
    
    // åº”ç”¨æ—¥å¿—æ–‡ä»¶
    new winston.transports.DailyRotateFile({
      filename: 'logs/app-%DATE%.log',
      datePattern: 'YYYY-MM-DD',
      maxSize: '20m',
      maxFiles: '30d'
    })
  ]
});

// ç”Ÿäº§ç¯å¢ƒæ·»åŠ ELKé›†æˆ
if (process.env.NODE_ENV === 'production') {
  logger.add(new winston.transports.Http({
    host: 'logstash',
    port: 5000,
    path: '/winston'
  }));
}
```

### ELK Stacké…ç½®

**Logstashé…ç½®**: `monitoring/elk/logstash.conf`

```ruby
input {
  beats {
    port => 5044
  }
  
  http {
    port => 5000
    codec => json
  }
}

filter {
  if [fields][service] == "ai-assistant" {
    # è§£æAIåŠ©æ‰‹æ—¥å¿—
    if [message] =~ /^\{/ {
      json {
        source => "message"
      }
    }
    
    # æ·»åŠ æ ‡ç­¾
    mutate {
      add_tag => ["ai-assistant"]
    }
    
    # è§£æé”™è¯¯å †æ ˆ
    if [level] == "error" and [stack] {
      mutate {
        add_field => { "error_stack" => "%{stack}" }
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "ai-assistant-logs-%{+YYYY.MM.dd}"
  }
  
  # é”™è¯¯æ—¥å¿—å‘é€å‘Šè­¦
  if [level] == "error" {
    http {
      url => "http://alertmanager:9093/api/v1/alerts"
      http_method => "post"
      format => "json"
      mapping => {
        "alerts" => [
          {
            "labels" => {
              "alertname" => "ApplicationError",
              "service" => "%{service}",
              "severity" => "warning"
            },
            "annotations" => {
              "summary" => "åº”ç”¨é”™è¯¯",
              "description" => "%{message}"
            }
          }
        ]
      }
    }
  }
}
```

### æ—¥å¿—æŸ¥è¯¢è„šæœ¬

**æ–‡ä»¶**: `scripts/log-analysis.sh`

```bash
#!/bin/bash

# æ—¥å¿—åˆ†æè„šæœ¬

# æŸ¥è¯¢æœ€è¿‘1å°æ—¶çš„é”™è¯¯æ—¥å¿—
echo "ğŸ” æœ€è¿‘1å°æ—¶é”™è¯¯æ—¥å¿—:"
curl -X GET "elasticsearch:9200/ai-assistant-logs-*/_search" \
  -H 'Content-Type: application/json' \
  -d '{
    "query": {
      "bool": {
        "must": [
          {"term": {"level": "error"}},
          {"range": {"@timestamp": {"gte": "now-1h"}}}
        ]
      }
    },
    "sort": [{"@timestamp": {"order": "desc"}}],
    "size": 50
  }' | jq '.hits.hits[]._source | {timestamp, message, stack}'

# ç»Ÿè®¡APIè°ƒç”¨é‡
echo "ğŸ“Š æœ€è¿‘1å°æ—¶APIè°ƒç”¨ç»Ÿè®¡:"
curl -X GET "elasticsearch:9200/ai-assistant-logs-*/_search" \
  -H 'Content-Type: application/json' \
  -d '{
    "query": {
      "bool": {
        "must": [
          {"exists": {"field": "url"}},
          {"range": {"@timestamp": {"gte": "now-1h"}}}
        ]
      }
    },
    "aggs": {
      "api_calls": {
        "terms": {
          "field": "url.keyword",
          "size": 10
        }
      }
    },
    "size": 0
  }' | jq '.aggregations.api_calls.buckets[]'

# æŸ¥è¯¢æ…¢æŸ¥è¯¢
echo "ğŸŒ æ…¢æŸ¥è¯¢æ—¥å¿—:"
curl -X GET "elasticsearch:9200/ai-assistant-logs-*/_search" \
  -H 'Content-Type: application/json' \
  -d '{
    "query": {
      "bool": {
        "must": [
          {"range": {"duration": {"gte": 2000}}},
          {"range": {"@timestamp": {"gte": "now-1h"}}}
        ]
      }
    },
    "sort": [{"duration": {"order": "desc"}}],
    "size": 20
  }' | jq '.hits.hits[]._source | {timestamp, url, duration, message}'
```

---

## ğŸš¨ æ•…éšœå¤„ç†

### æ•…éšœåˆ†ç±»

| çº§åˆ« | å½±å“èŒƒå›´ | å“åº”æ—¶é—´ | å¤„ç†æµç¨‹ |
|------|----------|----------|----------|
| P0 | ç³»ç»Ÿå®Œå…¨ä¸å¯ç”¨ | 5åˆ†é’Ÿ | ç«‹å³å“åº”ï¼Œç´§æ€¥ä¿®å¤ |
| P1 | æ ¸å¿ƒåŠŸèƒ½å¼‚å¸¸ | 15åˆ†é’Ÿ | å¿«é€Ÿå“åº”ï¼Œä¼˜å…ˆä¿®å¤ |
| P2 | éƒ¨åˆ†åŠŸèƒ½å¼‚å¸¸ | 1å°æ—¶ | æ­£å¸¸å“åº”ï¼Œè®¡åˆ’ä¿®å¤ |
| P3 | æ€§èƒ½é—®é¢˜ | 4å°æ—¶ | å»¶åå¤„ç†ï¼Œä¼˜åŒ–æ”¹è¿› |

### æ•…éšœå¤„ç†æµç¨‹

**1. æ•…éšœå‘ç°**
```bash
# æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
kubectl get pods -n ai-assistant
kubectl get services -n ai-assistant

# æ£€æŸ¥åº”ç”¨å¥åº·
curl http://api.localhost:5173/api/health

# æŸ¥çœ‹æœ€æ–°æ—¥å¿—
kubectl logs -f deployment/ai-assistant-backend -n ai-assistant
```

**2. æ•…éšœå®šä½**
```bash
# æŸ¥çœ‹ç›‘æ§æŒ‡æ ‡
curl http://prometheus:9090/api/v1/query?query=up{job="ai-assistant-backend"}

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -h mysql-cluster.internal -u app_user -p -e "SELECT 1"

# æ£€æŸ¥Redisè¿æ¥
redis-cli -h redis-cluster.internal ping

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
kubectl top pods -n ai-assistant
kubectl top nodes
```

**3. æ•…éšœä¿®å¤**
```bash
# é‡å¯æœåŠ¡
kubectl rollout restart deployment/ai-assistant-backend -n ai-assistant

# æ‰©å®¹æœåŠ¡
kubectl scale deployment/ai-assistant-backend --replicas=5 -n ai-assistant

# å›æ»šç‰ˆæœ¬
kubectl rollout undo deployment/ai-assistant-backend -n ai-assistant

# æ›´æ–°é…ç½®
kubectl apply -f k8s/configmap.yaml
```

### å¸¸è§æ•…éšœå¤„ç†

**æ•°æ®åº“è¿æ¥å¤±è´¥**:
```bash
# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
kubectl get pods -l app=mysql -n ai-assistant

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
kubectl logs mysql-0 -n ai-assistant

# é‡å¯æ•°æ®åº“
kubectl delete pod mysql-0 -n ai-assistant

# æ£€æŸ¥è¿æ¥æ± é…ç½®
kubectl describe configmap ai-assistant-config -n ai-assistant
```

**å†…å­˜æº¢å‡º**:
```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
kubectl top pods -n ai-assistant

# å¢åŠ å†…å­˜é™åˆ¶
kubectl patch deployment ai-assistant-backend -n ai-assistant -p '{"spec":{"template":{"spec":{"containers":[{"name":"backend","resources":{"limits":{"memory":"2Gi"}}}]}}}}'

# é‡å¯æœåŠ¡é‡Šæ”¾å†…å­˜
kubectl rollout restart deployment/ai-assistant-backend -n ai-assistant
```

**AIæœåŠ¡è¶…æ—¶**:
```bash
# æ£€æŸ¥AIæœåŠ¡é…ç½®
kubectl get secret ai-assistant-secrets -n ai-assistant -o yaml

# æŸ¥çœ‹AIè°ƒç”¨æ—¥å¿—
kubectl logs -f deployment/ai-assistant-backend -n ai-assistant | grep "AI_CALL"

# åˆ‡æ¢åˆ°å¤‡ç”¨æ¨¡å‹
kubectl patch configmap ai-assistant-config -n ai-assistant --patch '{"data":{"AI_MODEL":"backup-model"}}'
```

---

## ğŸ’¾ å¤‡ä»½æ¢å¤

### æ•°æ®åº“å¤‡ä»½

**è‡ªåŠ¨å¤‡ä»½è„šæœ¬**: `scripts/backup-database.sh`

```bash
#!/bin/bash

BACKUP_DIR="/backups/mysql"
DATE=$(date +%Y%m%d_%H%M%S)
DB_NAME="kindergarten_prod"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# æ•°æ®åº“å¤‡ä»½
echo "ğŸ—„ï¸ å¼€å§‹æ•°æ®åº“å¤‡ä»½..."
mysqldump -h mysql-cluster.internal \
  -u backup_user \
  -p$MYSQL_BACKUP_PASSWORD \
  --single-transaction \
  --routines \
  --triggers \
  $DB_NAME | gzip > $BACKUP_DIR/backup_${DATE}.sql.gz

# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶
if [ -f "$BACKUP_DIR/backup_${DATE}.sql.gz" ]; then
  echo "âœ… å¤‡ä»½æˆåŠŸ: backup_${DATE}.sql.gz"
  
  # ä¸Šä¼ åˆ°äº‘å­˜å‚¨
  aws s3 cp $BACKUP_DIR/backup_${DATE}.sql.gz s3://ai-assistant-backups/mysql/
  
  # æ¸…ç†7å¤©å‰çš„æœ¬åœ°å¤‡ä»½
  find $BACKUP_DIR -name "backup_*.sql.gz" -mtime +7 -delete
else
  echo "âŒ å¤‡ä»½å¤±è´¥"
  exit 1
fi
```

### æ•°æ®æ¢å¤

**æ¢å¤è„šæœ¬**: `scripts/restore-database.sh`

```bash
#!/bin/bash

BACKUP_FILE=$1
DB_NAME="kindergarten_prod"

if [ -z "$BACKUP_FILE" ]; then
  echo "ç”¨æ³•: $0 <backup_file>"
  exit 1
fi

echo "âš ï¸ å³å°†æ¢å¤æ•°æ®åº“ï¼Œè¿™å°†è¦†ç›–ç°æœ‰æ•°æ®ï¼"
read -p "ç¡®è®¤ç»§ç»­ï¼Ÿ(yes/no): " confirm

if [ "$confirm" != "yes" ]; then
  echo "å–æ¶ˆæ¢å¤æ“ä½œ"
  exit 0
fi

# åœæ­¢åº”ç”¨æœåŠ¡
echo "â¹ï¸ åœæ­¢åº”ç”¨æœåŠ¡..."
kubectl scale deployment/ai-assistant-backend --replicas=0 -n ai-assistant

# æ¢å¤æ•°æ®åº“
echo "ğŸ”„ å¼€å§‹æ•°æ®åº“æ¢å¤..."
gunzip -c $BACKUP_FILE | mysql -h mysql-cluster.internal \
  -u root \
  -p$MYSQL_ROOT_PASSWORD \
  $DB_NAME

if [ $? -eq 0 ]; then
  echo "âœ… æ•°æ®åº“æ¢å¤æˆåŠŸ"
  
  # é‡å¯åº”ç”¨æœåŠ¡
  echo "â–¶ï¸ é‡å¯åº”ç”¨æœåŠ¡..."
  kubectl scale deployment/ai-assistant-backend --replicas=3 -n ai-assistant
  
  echo "ğŸ‰ æ¢å¤å®Œæˆï¼"
else
  echo "âŒ æ•°æ®åº“æ¢å¤å¤±è´¥"
  exit 1
fi
```

### é…ç½®å¤‡ä»½

**é…ç½®å¤‡ä»½è„šæœ¬**: `scripts/backup-configs.sh`

```bash
#!/bin/bash

BACKUP_DIR="/backups/configs"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p $BACKUP_DIR

# å¤‡ä»½Kubernetesé…ç½®
echo "ğŸ“‹ å¤‡ä»½Kubernetesé…ç½®..."
kubectl get all -n ai-assistant -o yaml > $BACKUP_DIR/k8s-resources_${DATE}.yaml
kubectl get configmaps -n ai-assistant -o yaml > $BACKUP_DIR/configmaps_${DATE}.yaml
kubectl get secrets -n ai-assistant -o yaml > $BACKUP_DIR/secrets_${DATE}.yaml

# å¤‡ä»½åº”ç”¨é…ç½®
echo "âš™ï¸ å¤‡ä»½åº”ç”¨é…ç½®..."
cp -r /app/config $BACKUP_DIR/app-config_${DATE}

# å‹ç¼©å¤‡ä»½
tar -czf $BACKUP_DIR/config-backup_${DATE}.tar.gz \
  $BACKUP_DIR/k8s-resources_${DATE}.yaml \
  $BACKUP_DIR/configmaps_${DATE}.yaml \
  $BACKUP_DIR/secrets_${DATE}.yaml \
  $BACKUP_DIR/app-config_${DATE}

# ä¸Šä¼ åˆ°äº‘å­˜å‚¨
aws s3 cp $BACKUP_DIR/config-backup_${DATE}.tar.gz s3://ai-assistant-backups/configs/

echo "âœ… é…ç½®å¤‡ä»½å®Œæˆ"
```

---

## ğŸ”’ å®‰å…¨è¿ç»´

### å®‰å…¨æ£€æŸ¥æ¸…å•

**æ—¥å¸¸å®‰å…¨æ£€æŸ¥**:
- [ ] æ£€æŸ¥SSLè¯ä¹¦æœ‰æ•ˆæœŸ
- [ ] å®¡æŸ¥è®¿é—®æ—¥å¿—å¼‚å¸¸
- [ ] éªŒè¯é˜²ç«å¢™è§„åˆ™
- [ ] æ£€æŸ¥å¯†ç ç­–ç•¥
- [ ] å®¡æŸ¥ç”¨æˆ·æƒé™

**å®‰å…¨ç›‘æ§è„šæœ¬**: `scripts/security-check.sh`

```bash
#!/bin/bash

echo "ğŸ”’ å¼€å§‹å®‰å…¨æ£€æŸ¥..."

# æ£€æŸ¥SSLè¯ä¹¦
echo "ğŸ“œ æ£€æŸ¥SSLè¯ä¹¦..."
openssl s_client -connect api.localhost:5173:443 -servername api.localhost:5173 < /dev/null 2>/dev/null | \
  openssl x509 -noout -dates

# æ£€æŸ¥å¼‚å¸¸ç™»å½•
echo "ğŸ” æ£€æŸ¥å¼‚å¸¸ç™»å½•..."
kubectl logs deployment/ai-assistant-backend -n ai-assistant | \
  grep -i "login" | grep -E "(failed|error)" | tail -10

# æ£€æŸ¥é«˜é¢‘IPè®¿é—®
echo "ğŸ“Š æ£€æŸ¥é«˜é¢‘IPè®¿é—®..."
kubectl logs deployment/ai-assistant-backend -n ai-assistant | \
  grep -oE "\b([0-9]{1,3}\.){3}[0-9]{1,3}\b" | \
  sort | uniq -c | sort -nr | head -10

# æ£€æŸ¥æ•æ„Ÿæ“ä½œ
echo "âš ï¸ æ£€æŸ¥æ•æ„Ÿæ“ä½œ..."
kubectl logs deployment/ai-assistant-backend -n ai-assistant | \
  grep -E "(delete|drop|truncate)" | tail -10

echo "âœ… å®‰å…¨æ£€æŸ¥å®Œæˆ"
```

### è®¿é—®æ§åˆ¶

**RBACé…ç½®**: `k8s/rbac.yaml`

```yaml
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: ai-assistant
  name: ai-assistant-operator
rules:
- apiGroups: [""]
  resources: ["pods", "services", "configmaps"]
  verbs: ["get", "list", "watch", "create", "update", "patch"]
- apiGroups: ["apps"]
  resources: ["deployments"]
  verbs: ["get", "list", "watch", "update", "patch"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: ai-assistant-operator-binding
  namespace: ai-assistant
subjects:
- kind: User
  name: ops-team
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: Role
  name: ai-assistant-operator
  apiGroup: rbac.authorization.k8s.io
```

---

## ğŸ“ åº”æ€¥è”ç³»

### å€¼ç­å®‰æ’

| æ—¶é—´æ®µ | ä¸»å€¼ç­ | å¤‡å€¼ç­ | è”ç³»æ–¹å¼ |
|--------|--------|--------|----------|
| å·¥ä½œæ—¥ 9-18ç‚¹ | å¼€å‘å›¢é˜Ÿ | è¿ç»´å›¢é˜Ÿ | ä¼ä¸šå¾®ä¿¡ç¾¤ |
| å·¥ä½œæ—¥ 18-9ç‚¹ | è¿ç»´å›¢é˜Ÿ | å¼€å‘å›¢é˜Ÿ | ç”µè¯ + çŸ­ä¿¡ |
| å‘¨æœ«/èŠ‚å‡æ—¥ | å€¼ç­å·¥ç¨‹å¸ˆ | æŠ€æœ¯è´Ÿè´£äºº | ç”µè¯ + çŸ­ä¿¡ |

### å‡çº§æµç¨‹

```
æ•…éšœå‘ç° â†’ åˆæ­¥å¤„ç†(15åˆ†é’Ÿ) â†’ å‡çº§åˆ°é«˜çº§å·¥ç¨‹å¸ˆ(30åˆ†é’Ÿ) â†’ å‡çº§åˆ°æŠ€æœ¯è´Ÿè´£äºº(1å°æ—¶) â†’ å‡çº§åˆ°ç®¡ç†å±‚
```

---

**æ–‡æ¡£ç»´æŠ¤**: AIåŠ©æ‰‹å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-10-08
