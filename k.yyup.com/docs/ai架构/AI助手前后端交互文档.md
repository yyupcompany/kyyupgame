# AIåŠ©æ‰‹å‰åç«¯äº¤äº’æ–‡æ¡£

**ç‰ˆæœ¬**: 2.0.0  
**æœ€åæ›´æ–°**: 2025-01-24  
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ“‹ ç›®å½•

- [äº¤äº’æ¦‚è¿°](#äº¤äº’æ¦‚è¿°)
- [é€šä¿¡åè®®](#é€šä¿¡åè®®)
- [æ ¸å¿ƒäº¤äº’æµç¨‹](#æ ¸å¿ƒäº¤äº’æµç¨‹)
- [æ•°æ®æ ¼å¼](#æ•°æ®æ ¼å¼)
- [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)

---

## ğŸ¯ äº¤äº’æ¦‚è¿°

### äº¤äº’æ¨¡å¼

AIåŠ©æ‰‹å‰åç«¯é‡‡ç”¨ä¸¤ç§äº¤äº’æ¨¡å¼ï¼š

#### 1. Autoæ¨¡å¼ï¼ˆæ™ºèƒ½ä»£ç†æ¨¡å¼ï¼‰

**ç‰¹ç‚¹**:
- âœ… æ”¯æŒå·¥å…·è°ƒç”¨
- âœ… å¤šè½®å¯¹è¯
- âœ… å¤æ‚ä»»åŠ¡å¤„ç†
- âœ… SSEæµå¼å“åº”

**é€‚ç”¨åœºæ™¯**:
- æ•°æ®æŸ¥è¯¢å’Œåˆ†æ
- é¡µé¢æ“ä½œè‡ªåŠ¨åŒ–
- å·¥ä½œæµæ‰§è¡Œ
- å¤æ‚ä»»åŠ¡ç¼–æ’

#### 2. ç›´è¿æ¨¡å¼ï¼ˆç®€å•èŠå¤©æ¨¡å¼ï¼‰

**ç‰¹ç‚¹**:
- âœ… å¿«é€Ÿå“åº”
- âœ… ç®€å•å¯¹è¯
- âœ… æ— å·¥å…·è°ƒç”¨
- âœ… SSEæµå¼å“åº”

**é€‚ç”¨åœºæ™¯**:
- ç®€å•é—®ç­”
- é—²èŠå¯¹è¯
- å¿«é€Ÿå’¨è¯¢

---

## ğŸ“¡ é€šä¿¡åè®®

### SSE (Server-Sent Events)

æ‰€æœ‰AIå“åº”éƒ½é‡‡ç”¨SSEæµå¼ä¼ è¾“ï¼Œå®ç°å®æ—¶å“åº”ã€‚

**ä¼˜åŠ¿**:
- âœ… å•å‘é€šä¿¡ï¼ŒæœåŠ¡å™¨ä¸»åŠ¨æ¨é€
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶
- âœ… åŸºäºHTTPï¼Œæ— éœ€WebSocket
- âœ… æµè§ˆå™¨åŸç”Ÿæ”¯æŒ

**è¿æ¥å»ºç«‹**:
```typescript
// å‰ç«¯
const response = await fetch('/api/ai/unified-intelligence-stream', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'text/event-stream'
  },
  body: JSON.stringify({ message, conversationId })
})

const reader = response.body.getReader()
const decoder = new TextDecoder()

while (true) {
  const { done, value } = await reader.read()
  if (done) break
  
  const chunk = decoder.decode(value)
  // å¤„ç†SSEæ•°æ®
}
```

**æ•°æ®æ ¼å¼**:
```
data: {"type":"thinking","content":"æ­£åœ¨æ€è€ƒ..."}\n\n
data: {"type":"tool_call","name":"query_data","arguments":{...}}\n\n
data: {"type":"answer","content":"æ ¹æ®æŸ¥è¯¢ç»“æœ..."}\n\n
data: {"type":"done"}\n\n
```

---

## ğŸ”„ æ ¸å¿ƒäº¤äº’æµç¨‹

### 1. Autoæ¨¡å¼å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ (Client)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1. ç”¨æˆ·è¾“å…¥æ¶ˆæ¯
                              â†“
                    handleSendMessage()
                              â”‚
                              â”‚ 2. åˆ¤æ–­Autoæ¨¡å¼
                              â†“
                    Auto=ON â†’ AIAssistantCore
                              â”‚
                              â”‚ 3. è°ƒç”¨å¤šè½®å·¥å…·è°ƒç”¨
                              â†“
              useMultiRoundToolCalling.executeMultiRound()
                              â”‚
                              â”‚ 4. HTTP POSTè¯·æ±‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åç«¯ (Server)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 5. æ¥æ”¶è¯·æ±‚
                              â†“
              POST /api/ai/unified-intelligence-stream
                              â”‚
                              â”‚ 6. ä¼šè¯ç®¡ç†
                              â†“
                    ConversationService
                    - åˆ›å»º/è·å–ä¼šè¯
                    - ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
                              â”‚
                              â”‚ 7. æ¨¡å‹é€‰æ‹©
                              â†“
                    ModelSelectorService
                    - åˆ†ææŸ¥è¯¢å¤æ‚åº¦
                    - é€‰æ‹©æœ€ä½³æ¨¡å‹
                              â”‚
                              â”‚ 8. å·¥å…·å‡†å¤‡
                              â†“
                    ToolCallingService
                    - è·å–å¯ç”¨å·¥å…·åˆ—è¡¨
                              â”‚
                              â”‚ 9. AIè°ƒç”¨
                              â†“
                    AIBridgeService
                    - è°ƒç”¨AIæ¨¡å‹
                    - å¤„ç†æµå¼å“åº”
                              â”‚
                              â”‚ 10. SSEæµå¼è¿”å›
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ (Client)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 11. æ¥æ”¶SSEæµ
                              â†“
                    å¤„ç†ä¸åŒç±»å‹çš„äº‹ä»¶
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                   â”‚
                    â†“                   â†“
              thinkingäº‹ä»¶        tool_calläº‹ä»¶
                    â”‚                   â”‚
                    â†“                   â†“
        useAIResponse          useAIResponse
        .showThinkingPhase()   .showFunctionCall()
                    â”‚                   â”‚
                    â†“                   â†“
        ThinkingProcessç»„ä»¶    FunctionCallListç»„ä»¶
                              â”‚
                              â”‚ 12. å·¥å…·æ‰§è¡Œï¼ˆåç«¯ï¼‰
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åç«¯ (Server)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 13. æ‰§è¡Œå·¥å…·
                              â†“
                    ToolCallingService
                    - è§£æå·¥å…·è°ƒç”¨
                    - æ‰§è¡Œå·¥å…·
                    - è¿”å›ç»“æœ
                              â”‚
                              â”‚ 14. å·¥å…·ç»“æœè¿”å›
                              â†“
                    SSE: tool_resultäº‹ä»¶
                              â”‚
                              â”‚ 15. ç»§ç»­AIè°ƒç”¨
                              â†“
                    AIBridgeService
                    - å°†å·¥å…·ç»“æœå‘é€ç»™AI
                    - AIç”Ÿæˆä¸‹ä¸€æ­¥æ“ä½œ
                              â”‚
                              â”‚ 16. å¾ªç¯ç›´åˆ°å®Œæˆ
                              â†“
                    å¤šè½®å¾ªç¯ï¼ˆæœ€å¤š20è½®ï¼‰
                              â”‚
                              â”‚ 17. æœ€ç»ˆç­”æ¡ˆ
                              â†“
                    SSE: answeräº‹ä»¶
                              â”‚
                              â”‚ 18. å®Œæˆæ ‡è®°
                              â†“
                    SSE: doneäº‹ä»¶
                              â”‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ (Client)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 19. æ˜¾ç¤ºæœ€ç»ˆç­”æ¡ˆ
                              â†“
                    useAIResponse
                    .showFinalAnswer()
                              â”‚
                              â†“
                    AnswerDisplayç»„ä»¶
                              â”‚
                              â”‚ 20. ä¿å­˜æ¶ˆæ¯
                              â†“
                    MessageService
                    - ä¿å­˜AIæ¶ˆæ¯åˆ°æœåŠ¡å™¨
```

### 2. ç›´è¿æ¨¡å¼å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ (Client)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 1. ç”¨æˆ·è¾“å…¥æ¶ˆæ¯
                              â†“
                    handleSendMessage()
                              â”‚
                              â”‚ 2. åˆ¤æ–­Autoæ¨¡å¼
                              â†“
                    Auto=OFF â†’ useMessageHandling
                              â”‚
                              â”‚ 3. è°ƒç”¨ç›´è¿èŠå¤©
                              â†“
                    callDirectChatSSE()
                              â”‚
                              â”‚ 4. HTTP POSTè¯·æ±‚
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åç«¯ (Server)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 5. æ¥æ”¶è¯·æ±‚
                              â†“
                    POST /api/ai/direct-chat-sse
                              â”‚
                              â”‚ 6. ä¼šè¯ç®¡ç†
                              â†“
                    ConversationService
                    - åˆ›å»º/è·å–ä¼šè¯
                    - ä¿å­˜ç”¨æˆ·æ¶ˆæ¯
                              â”‚
                              â”‚ 7. AIè°ƒç”¨ï¼ˆæ— å·¥å…·ï¼‰
                              â†“
                    AIBridgeService
                    - è°ƒç”¨Flashæ¨¡å‹
                    - æµå¼å“åº”
                              â”‚
                              â”‚ 8. SSEæµå¼è¿”å›
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å‰ç«¯ (Client)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ 9. æ¥æ”¶SSEæµ
                              â†“
                    å¤„ç†contentäº‹ä»¶
                              â”‚
                              â†“
                    useAIResponse
                    .showDirectChatTypingEffect()
                              â”‚
                              â†“
                    AnswerDisplayç»„ä»¶
                    - æ‰“å­—æœºæ•ˆæœ
                    - å®æ—¶æ˜¾ç¤º
                              â”‚
                              â”‚ 10. å®Œæˆæ ‡è®°
                              â†“
                    SSE: doneäº‹ä»¶
                              â”‚
                              â”‚ 11. ä¿å­˜æ¶ˆæ¯
                              â†“
                    MessageService
                    - ä¿å­˜AIæ¶ˆæ¯åˆ°æœåŠ¡å™¨
```

---

## ğŸ“¦ æ•°æ®æ ¼å¼

### è¯·æ±‚æ ¼å¼

#### Autoæ¨¡å¼è¯·æ±‚

```typescript
// POST /api/ai/unified-intelligence-stream
{
  message: string,              // ç”¨æˆ·æ¶ˆæ¯
  conversationId?: string,      // ä¼šè¯IDï¼ˆå¯é€‰ï¼‰
  userId?: string,              // ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰
  enableTools: true,            // å¯ç”¨å·¥å…·è°ƒç”¨
  maxRounds: 20,                // æœ€å¤§è½®æ¬¡
  model?: string,               // æŒ‡å®šæ¨¡å‹ï¼ˆå¯é€‰ï¼‰
  webSearch?: boolean,          // å¯ç”¨ç½‘ç»œæœç´¢ï¼ˆå¯é€‰ï¼‰
  selectedExperts?: string[]    // é€‰ä¸­çš„ä¸“å®¶ï¼ˆå¯é€‰ï¼‰
}
```

#### ç›´è¿æ¨¡å¼è¯·æ±‚

```typescript
// POST /api/ai/direct-chat-sse
{
  message: string,              // ç”¨æˆ·æ¶ˆæ¯
  conversationId?: string,      // ä¼šè¯IDï¼ˆå¯é€‰ï¼‰
  userId?: string               // ç”¨æˆ·IDï¼ˆå¯é€‰ï¼‰
}
```

### å“åº”æ ¼å¼

#### SSEäº‹ä»¶ç±»å‹

```typescript
// 1. æ€è€ƒé˜¶æ®µ
{
  type: 'thinking',
  content: string               // æ€è€ƒå†…å®¹
}

// 2. å·¥å…·è°ƒç”¨
{
  type: 'tool_call',
  name: string,                 // å·¥å…·åç§°
  arguments: object             // å·¥å…·å‚æ•°
}

// 3. å·¥å…·ç»“æœ
{
  type: 'tool_result',
  name: string,                 // å·¥å…·åç§°
  result: any,                  // å·¥å…·ç»“æœ
  status: 'success' | 'error'   // æ‰§è¡ŒçŠ¶æ€
}

// 4. ç­”æ¡ˆå†…å®¹
{
  type: 'answer',
  content: string               // ç­”æ¡ˆå†…å®¹ï¼ˆå¢é‡ï¼‰
}

// 5. å®Œæˆæ ‡è®°
{
  type: 'done'
}

// 6. é”™è¯¯äº‹ä»¶
{
  type: 'error',
  error: string,                // é”™è¯¯ä¿¡æ¯
  code?: string                 // é”™è¯¯ä»£ç 
}
```

### å·¥å…·è°ƒç”¨æ ¼å¼

#### å·¥å…·å®šä¹‰

```typescript
{
  name: string,                 // å·¥å…·åç§°
  description: string,          // å·¥å…·æè¿°
  parameters: {
    type: 'object',
    properties: {
      [key: string]: {
        type: string,           // å‚æ•°ç±»å‹
        description: string,    // å‚æ•°æè¿°
        enum?: string[]         // æšä¸¾å€¼ï¼ˆå¯é€‰ï¼‰
      }
    },
    required: string[]          // å¿…å¡«å‚æ•°
  }
}
```

#### å·¥å…·æ‰§è¡Œç»“æœ

```typescript
{
  name: string,                 // å·¥å…·åç§°
  status: 'success' | 'error',  // æ‰§è¡ŒçŠ¶æ€
  result: any,                  // æ‰§è¡Œç»“æœ
  error?: string                // é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœå¤±è´¥ï¼‰
}
```

---

## âš ï¸ é”™è¯¯å¤„ç†

### é”™è¯¯ç±»å‹

```typescript
enum ErrorType {
  NETWORK_ERROR = 'network_error',           // ç½‘ç»œé”™è¯¯
  TIMEOUT_ERROR = 'timeout_error',           // è¶…æ—¶é”™è¯¯
  AI_ERROR = 'ai_error',                     // AIæœåŠ¡é”™è¯¯
  TOOL_ERROR = 'tool_error',                 // å·¥å…·æ‰§è¡Œé”™è¯¯
  VALIDATION_ERROR = 'validation_error',     // å‚æ•°éªŒè¯é”™è¯¯
  AUTH_ERROR = 'auth_error',                 // è®¤è¯é”™è¯¯
  RATE_LIMIT_ERROR = 'rate_limit_error'      // é€Ÿç‡é™åˆ¶é”™è¯¯
}
```

### é”™è¯¯å¤„ç†æµç¨‹

```
é”™è¯¯å‘ç”Ÿ
  â†“
åç«¯æ•è·é”™è¯¯
  â†“
åˆ†ç±»é”™è¯¯ç±»å‹
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯é‡è¯•é”™è¯¯                           â”‚
â”‚ - ç½‘ç»œé”™è¯¯                           â”‚
â”‚ - è¶…æ—¶é”™è¯¯                           â”‚
â”‚ - é€Ÿç‡é™åˆ¶é”™è¯¯                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
æ™ºèƒ½é‡è¯•æœºåˆ¶
  â”œâ”€ æŒ‡æ•°é€€é¿
  â”œâ”€ æœ€å¤š3æ¬¡é‡è¯•
  â””â”€ é™çº§ç­–ç•¥
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸å¯é‡è¯•é”™è¯¯                         â”‚
â”‚ - å‚æ•°éªŒè¯é”™è¯¯                       â”‚
â”‚ - è®¤è¯é”™è¯¯                           â”‚
â”‚ - å·¥å…·æ‰§è¡Œé”™è¯¯                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
SSEé”™è¯¯äº‹ä»¶
  â†“
å‰ç«¯æ¥æ”¶é”™è¯¯
  â†“
useAIResponseå¤„ç†
  â†“
æ˜¾ç¤ºé”™è¯¯æç¤º
  â†“
ElMessage.error()
```

### å‰ç«¯é”™è¯¯å¤„ç†

```typescript
// useMessageHandling.ts
try {
  await callDirectChatSSE(message, chatHistory)
} catch (error) {
  console.error('âŒ [ç›´è¿èŠå¤©] è°ƒç”¨å¤±è´¥:', error)
  
  // åˆ†ç±»é”™è¯¯
  if (error.name === 'AbortError') {
    ElMessage.info('å·²å–æ¶ˆAIå“åº”')
  } else if (error.message.includes('timeout')) {
    ElMessage.error('AIå“åº”è¶…æ—¶ï¼Œè¯·é‡è¯•')
  } else if (error.message.includes('network')) {
    ElMessage.error('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ')
  } else {
    ElMessage.error('AIæœåŠ¡å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•')
  }
  
  // æ¸…ç†çŠ¶æ€
  sending.value = false
  rightSidebarLoading.value = false
}
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### 1. è¿æ¥å¤ç”¨

**åç«¯ä¼˜åŒ–**:
```typescript
// AIBridgeServiceä½¿ç”¨åŸç”ŸHTTPæ¨¡å—
const httpModule = isHttps ? https : http
const req = httpModule.request(requestOptions, (res) => {
  // å¤„ç†å“åº”
})
```

**ä¼˜åŠ¿**:
- âœ… æ€§èƒ½æå‡40%
- âœ… è¿æ¥æ± å¤ç”¨
- âœ… æ›´ä½çš„å†…å­˜å ç”¨

### 2. æµå¼ä¼ è¾“

**SSEæµå¼ä¼ è¾“**:
```typescript
// åç«¯
res.write(`data: ${JSON.stringify(event)}\n\n`)

// å‰ç«¯
const reader = response.body.getReader()
while (true) {
  const { done, value } = await reader.read()
  if (done) break
  processChunk(value)
}
```

**ä¼˜åŠ¿**:
- âœ… å®æ—¶å“åº”
- âœ… é™ä½é¦–å­—èŠ‚æ—¶é—´
- âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

### 3. è¯·æ±‚ä¸­æ­¢

**AbortController**:
```typescript
// å‰ç«¯
let abortController = new AbortController()

fetch(url, {
  signal: abortController.signal
})

// ä¸­æ­¢è¯·æ±‚
abortController.abort()
```

**ä¼˜åŠ¿**:
- âœ… é¿å…æ— æ•ˆè¯·æ±‚
- âœ… èŠ‚çœå¸¦å®½
- âœ… æ›´å¥½çš„èµ„æºç®¡ç†

### 4. ç¼“å­˜ç­–ç•¥

**ä¼šè¯ç¼“å­˜**:
```typescript
// å‰ç«¯
const conversationId = ref<string | null>(null)

// å¤ç”¨ä¼šè¯ID
if (conversationId.value) {
  // ä½¿ç”¨ç°æœ‰ä¼šè¯
} else {
  // åˆ›å»ºæ–°ä¼šè¯
  conversationId.value = await ensureConversation()
}
```

**ä¼˜åŠ¿**:
- âœ… å‡å°‘æœåŠ¡å™¨è¯·æ±‚
- âœ… æ›´å¿«çš„å“åº”é€Ÿåº¦
- âœ… æ›´å¥½çš„ä¸Šä¸‹æ–‡è¿ç»­æ€§

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [AIåŠ©æ‰‹å‰ç«¯æ¶æ„æ–‡æ¡£](./AIåŠ©æ‰‹å‰ç«¯æ¶æ„æ–‡æ¡£.md)
- [AIåŠ©æ‰‹åç«¯æ¶æ„æ–‡æ¡£](./AIåŠ©æ‰‹åç«¯æ¶æ„æ–‡æ¡£.md)
- [ç³»ç»Ÿæ¶æ„æ€»è§ˆ](./00-ç³»ç»Ÿæ¶æ„æ€»è§ˆ.md)
- [æµå¼å¤„ç†æœåŠ¡æ–‡æ¡£](./03-æµå¼å¤„ç†æœåŠ¡.md)

---

**æ–‡æ¡£ç»´æŠ¤**: AIåŠ©æ‰‹å¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**: 2025-01-24

