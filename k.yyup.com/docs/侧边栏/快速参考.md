# ä¾§è¾¹æ å¿«é€Ÿå‚è€ƒæŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æŸ¥çœ‹å½“å‰æ‰€æœ‰ä¸­å¿ƒ

```bash
cd server
node check-center-names.js
```

### æ·»åŠ æ–°ä¸­å¿ƒï¼ˆå®Œæ•´æµç¨‹ï¼‰

```sql
-- 1. æ·»åŠ ä¸­å¿ƒåˆ†ç±»
INSERT INTO permissions (name, chinese_name, code, type, path, icon, sort, status)
VALUES ('New Center', 'æ–°ä¸­å¿ƒ', 'NEW_CENTER', 'category', '#new', 'Star', 30, 1);

-- 2. æ·»åŠ ä¸­å¿ƒé¡µé¢
INSERT INTO permissions (name, chinese_name, code, type, path, component, icon, sort, parent_id, status)
VALUES ('new-center-page', 'æ–°ä¸­å¿ƒ', 'NEW_CENTER_PAGE', 'menu', '/centers/new', 
        'pages/centers/NewCenter.vue', 'Star', 10, 
        (SELECT id FROM permissions WHERE code='NEW_CENTER'), 1);
```

```bash
# 3. åˆ›å»ºVueç»„ä»¶
touch client/src/pages/centers/NewCenter.vue
```

### ä¿®æ”¹ä¸­å¿ƒåç§°

```sql
UPDATE permissions 
SET chinese_name = 'æ–°åç§°' 
WHERE code = 'CENTER_CODE';
```

### è°ƒæ•´ä¸­å¿ƒæ’åº

```sql
UPDATE permissions 
SET sort = æ–°æ’åºå€¼ 
WHERE code = 'CENTER_CODE';
```

### ç¦ç”¨/å¯ç”¨ä¸­å¿ƒ

```sql
-- ç¦ç”¨
UPDATE permissions SET status = 0 WHERE code = 'CENTER_CODE';

-- å¯ç”¨
UPDATE permissions SET status = 1 WHERE code = 'CENTER_CODE';
```

---

## ğŸ“Š å½“å‰ä¸­å¿ƒåˆ—è¡¨

| åºå· | ä¸­å¿ƒåç§° | Code | è·¯ç”± | æ’åº |
|------|---------|------|------|------|
| 1 | äººå‘˜ä¸­å¿ƒ | PERSONNEL_CENTER | /centers/personnel | 1 |
| 2 | æ´»åŠ¨ä¸­å¿ƒ | ACTIVITY_CENTER | /centers/activity | 3 |
| 3 | è¥é”€ä¸­å¿ƒ | MARKETING_CENTER | /centers/marketing | 4 |
| 4 | ä¸šåŠ¡ä¸­å¿ƒ | BUSINESS_CENTER | /centers/business | 6 |
| 5 | å®¢æˆ·æ± ä¸­å¿ƒ | CUSTOMER_POOL_CENTER | /centers/customer-pool | 7 |
| 6 | ç³»ç»Ÿä¸­å¿ƒ | SYSTEM_CENTER | /centers/system | 8 |
| 7 | è´¢åŠ¡ä¸­å¿ƒ | FINANCE_CENTER | /centers/finance | 9 |
| 8 | æ‹›ç”Ÿä¸­å¿ƒ | ENROLLMENT_CENTER | /centers/enrollment | 11 |
| 9 | ä»»åŠ¡ä¸­å¿ƒ | TASK_CENTER | /centers/task | 13 |
| 10 | æ•™å­¦ä¸­å¿ƒ | TEACHING_CENTER | /centers/teaching | 15 |
| 11 | è¯æœ¯ä¸­å¿ƒ | SCRIPT_CENTER | /centers/script | 21 |
| 12 | æ–°åª’ä½“ä¸­å¿ƒ | MEDIA_CENTER | /principal/media-center | 25 |

---

## ğŸ¨ å›¾æ ‡æ˜ å°„è¡¨

| ä¸­å¿ƒ | å›¾æ ‡åç§° | é¢„è§ˆ |
|------|---------|------|
| äººå‘˜ä¸­å¿ƒ | Users | ğŸ‘¥ |
| æ´»åŠ¨ä¸­å¿ƒ | Calendar | ğŸ“… |
| è¥é”€ä¸­å¿ƒ | TrendingUp | ğŸ“ˆ |
| ä¸šåŠ¡ä¸­å¿ƒ | Briefcase | ğŸ’¼ |
| å®¢æˆ·æ± ä¸­å¿ƒ | Users | ğŸ‘¥ |
| ç³»ç»Ÿä¸­å¿ƒ | Settings | âš™ï¸ |
| è´¢åŠ¡ä¸­å¿ƒ | DollarSign | ğŸ’° |
| æ‹›ç”Ÿä¸­å¿ƒ | School | ğŸ« |
| ä»»åŠ¡ä¸­å¿ƒ | CheckSquare | âœ… |
| æ•™å­¦ä¸­å¿ƒ | BookOpen | ğŸ“– |
| è¯æœ¯ä¸­å¿ƒ | MessageSquare | ğŸ’¬ |
| æ–°åª’ä½“ä¸­å¿ƒ | Video | ğŸ¥ |

---

## ğŸ”§ å¸¸ç”¨SQLæŸ¥è¯¢

### æŸ¥çœ‹æ‰€æœ‰æ´»è·ƒä¸­å¿ƒ

```sql
SELECT id, name, chinese_name, code, sort, status 
FROM permissions 
WHERE type='category' AND parent_id IS NULL AND status=1 
ORDER BY sort;
```

### æŸ¥çœ‹æŸä¸ªä¸­å¿ƒçš„è¯¦ç»†ä¿¡æ¯

```sql
SELECT * FROM permissions WHERE code = 'CENTER_CODE';
```

### æŸ¥çœ‹ä¸­å¿ƒçš„å­èœå•

```sql
SELECT p.* 
FROM permissions p
WHERE p.parent_id = (SELECT id FROM permissions WHERE code = 'CENTER_CODE')
AND p.status = 1;
```

### æŸ¥çœ‹è§’è‰²æƒé™åˆ†é…

```sql
SELECT r.name as role_name, p.chinese_name as permission_name
FROM role_permissions rp
JOIN roles r ON rp.role_id = r.id
JOIN permissions p ON rp.permission_id = p.id
WHERE p.type = 'category'
ORDER BY r.name, p.sort;
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: ä¾§è¾¹æ ä¸æ˜¾ç¤º

**æ£€æŸ¥æ¸…å•**:
- [ ] ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼Ÿ
- [ ] æƒé™æ•°æ®æ˜¯å¦åŠ è½½ï¼Ÿ
- [ ] ä¸­å¿ƒstatusæ˜¯å¦ä¸º1ï¼Ÿ
- [ ] è§’è‰²æ˜¯å¦æœ‰æƒé™ï¼Ÿ

**è°ƒè¯•å‘½ä»¤**:
```javascript
// æµè§ˆå™¨æ§åˆ¶å°
const permissionsStore = usePermissionsStore();
console.log('èœå•æ•°é‡:', permissionsStore.menuItems.length);
console.log('æ˜¯å¦ç®¡ç†å‘˜:', permissionsStore.isAdmin);
```

### é—®é¢˜2: ä¸­å¿ƒåç§°æ˜¾ç¤ºé”™è¯¯

**æ£€æŸ¥**:
```sql
SELECT id, name, chinese_name FROM permissions WHERE type='category';
```

**ä¿®å¤**:
```sql
UPDATE permissions SET chinese_name = 'æ­£ç¡®åç§°' WHERE id = XXX;
```

### é—®é¢˜3: ç‚¹å‡»ä¸­å¿ƒè·³è½¬404

**æ£€æŸ¥è·¯ç”±é…ç½®**:
```typescript
// client/src/router/dynamic-routes.ts
const componentMap = {
  'pages/centers/YourCenter.vue': () => import('../pages/centers/YourCenter.vue')
};
```

**æ£€æŸ¥ç»„ä»¶æ–‡ä»¶**:
```bash
ls -la client/src/pages/centers/YourCenter.vue
```

---

## ğŸ“ å…³é”®æ–‡ä»¶è·¯å¾„

### å‰ç«¯

```
client/src/
â”œâ”€â”€ layouts/components/Sidebar.vue          # ä¾§è¾¹æ ä¸»ç»„ä»¶
â”œâ”€â”€ stores/permissions.ts                   # æƒé™çŠ¶æ€ç®¡ç†
â”œâ”€â”€ router/
â”‚   â”œâ”€â”€ index.ts                           # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ dynamic-routes.ts                  # åŠ¨æ€è·¯ç”±ç”Ÿæˆ
â””â”€â”€ pages/centers/                         # ä¸­å¿ƒé¡µé¢ç»„ä»¶
    â”œâ”€â”€ PersonnelCenter.vue
    â”œâ”€â”€ ActivityCenter.vue
    â””â”€â”€ ...
```

### åç«¯

```
server/src/
â”œâ”€â”€ controllers/dynamic-permissions.ts      # æƒé™æ§åˆ¶å™¨
â”œâ”€â”€ models/permission.model.ts             # æƒé™æ¨¡å‹
â””â”€â”€ routes/dynamic-permissions.ts          # æƒé™è·¯ç”±
```

### å·¥å…·è„šæœ¬

```
server/
â”œâ”€â”€ check-center-names.js                  # æ£€æŸ¥ä¸­å¿ƒåç§°
â”œâ”€â”€ fix-center-chinese-names.js            # ä¿®å¤ä¸­å¿ƒåç§°
â””â”€â”€ remove-centers.js                      # ç§»é™¤ä¸­å¿ƒ
```

---

## ğŸ”‘ æƒé™ä»£ç è§„èŒƒ

### å‘½åè§„åˆ™

```
{åŠŸèƒ½}_{æ“ä½œ}

ç¤ºä¾‹:
- PERSONNEL_CENTER          # äººå‘˜ä¸­å¿ƒï¼ˆåˆ†ç±»ï¼‰
- PERSONNEL_CENTER_PAGE     # äººå‘˜ä¸­å¿ƒé¡µé¢ï¼ˆèœå•ï¼‰
- PERSONNEL_CENTER_VIEW     # äººå‘˜ä¸­å¿ƒæŸ¥çœ‹ï¼ˆæƒé™ï¼‰
- PERSONNEL_CENTER_CREATE   # äººå‘˜ä¸­å¿ƒåˆ›å»ºï¼ˆæƒé™ï¼‰
- PERSONNEL_CENTER_EDIT     # äººå‘˜ä¸­å¿ƒç¼–è¾‘ï¼ˆæƒé™ï¼‰
- PERSONNEL_CENTER_DELETE   # äººå‘˜ä¸­å¿ƒåˆ é™¤ï¼ˆæƒé™ï¼‰
```

### ç±»å‹è¯´æ˜

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| category | ä¸€çº§åˆ†ç±»ï¼ˆä¸­å¿ƒï¼‰ | PERSONNEL_CENTER |
| menu | èœå•é¡µé¢ | PERSONNEL_CENTER_PAGE |
| button | æŒ‰é’®æƒé™ | PERSONNEL_CENTER_CREATE |

---

## ğŸ¯ è§’è‰²æƒé™çŸ©é˜µ

| ä¸­å¿ƒ | admin | principal | teacher | parent |
|------|-------|-----------|---------|--------|
| å·¥ä½œå° | âœ… | âœ… | âœ… | âœ… |
| ä¸šåŠ¡ä¸­å¿ƒ | âœ… | âœ… | âŒ | âŒ |
| äººå‘˜ä¸­å¿ƒ | âœ… | âœ… | âœ… | âŒ |
| æ´»åŠ¨ä¸­å¿ƒ | âœ… | âœ… | âœ… | âœ… |
| è¥é”€ä¸­å¿ƒ | âœ… | âœ… | âŒ | âŒ |
| å®¢æˆ·æ± ä¸­å¿ƒ | âœ… | âœ… | âŒ | âŒ |
| ç³»ç»Ÿä¸­å¿ƒ | âœ… | âŒ | âŒ | âŒ |
| è´¢åŠ¡ä¸­å¿ƒ | âœ… | âœ… | âŒ | âŒ |
| æ‹›ç”Ÿä¸­å¿ƒ | âœ… | âœ… | âœ… | âŒ |
| ä»»åŠ¡ä¸­å¿ƒ | âœ… | âœ… | âœ… | âŒ |
| æ•™å­¦ä¸­å¿ƒ | âœ… | âœ… | âœ… | âŒ |
| è¯æœ¯ä¸­å¿ƒ | âœ… | âœ… | âŒ | âŒ |
| æ–°åª’ä½“ä¸­å¿ƒ | âœ… | âœ… | âŒ | âŒ |

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### ç›¸å…³æ–‡æ¡£
- [å®Œæ•´è¯´æ˜æ–‡æ¡£](./ä¾§è¾¹æ é¡µé¢è¯´æ˜.md)
- [ä¸­å¿ƒåç§°ä¿®å¤æŠ¥å‘Š](../../ä¸­å¿ƒåç§°ä¿®å¤æŠ¥å‘Š.md)

### å·¥å…·è„šæœ¬
```bash
# æ£€æŸ¥ä¸­å¿ƒé…ç½®
cd server && node check-center-names.js

# ä¿®å¤ä¸­å¿ƒåç§°
cd server && node fix-center-chinese-names.js

# ç§»é™¤ä¸­å¿ƒ
cd server && node remove-centers.js
```

---

**æœ€åæ›´æ–°**: 2025-10-07  
**ç»´æŠ¤è€…**: AI Assistant

