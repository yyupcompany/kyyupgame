# TC-012: 教学活动管理测试

## 测试概述
**测试目标**: 验证移动端教学活动管理功能，包括课程计划创建、户外训练记录、校外展示管理、锦标赛组织等
**测试类型**: 功能测试 + 数据验证测试 + 交互测试
**优先级**: 高
**预计执行时间**: 20-25分钟

## 测试环境
- **设备**: 移动端设备 (iOS/Android)
- **浏览器**: Chrome Mobile/Safari Mobile
- **网络**: 4G/WiFi
- **用户角色**: 教师

## 前置条件
1. 用户已成功登录系统
2. 用户具有教学管理权限
3. 系统中存在班级和学生数据
4. 移动端网络连接正常

## 测试用例详情

### TC-012-01: 课程计划管理
**测试描述**: 验证课程计划的创建、编辑、查看和删除功能

**测试步骤**:
1. 进入教学中心
2. 点击"创建课程计划"快捷操作
3. 填写课程计划基本信息
4. 设置教学目标和进度安排
5. 保存课程计划
6. 验证列表显示
7. 编辑已创建的课程计划
8. 删除测试课程计划

**预期结果**:
- ✅ 课程计划创建表单正确显示
- ✅ 表单验证规则生效
- ✅ 课程计划成功保存
- ✅ 列表显示新创建的课程计划
- ✅ 编辑功能正常工作
- ✅ 删除操作有确认提示
- ✅ 数据同步更新

**严格验证要求**:
```javascript
// 验证课程计划创建表单
const validateCoursePlanForm = () => {
  const formElement = document.querySelector('.course-plan-form');
  expect(formElement).toBeTruthy();

  // 必填字段验证
  const requiredFields = ['title', 'grade', 'duration', 'objectives'];
  requiredFields.forEach(field => {
    const fieldElement = document.querySelector(`[name="${field}"]`);
    expect(fieldElement).toBeTruthy();
    expect(fieldElement.hasAttribute('required')).toBe(true);
  });

  // 数据类型验证
  const titleField = document.querySelector('[name="title"]');
  const durationField = document.querySelector('[name="duration"]');

  expect(titleField.type).toBe('text');
  expect(durationField.type).toBe('number');
};

// API响应验证
const validateCoursePlanResponse = (response) => {
  // 必填字段验证
  validateRequiredFields(response.data, [
    'id', 'title', 'grade', 'duration', 'objectives', 'status', 'createdAt'
  ]);

  // 字段类型验证
  validateFieldTypes(response.data, {
    id: 'number',
    title: 'string',
    grade: 'string',
    duration: 'number',
    objectives: 'array',
    status: 'string',
    createdAt: 'string'
  });

  // 业务规则验证
  expect(response.data.duration).toBeGreaterThan(0);
  expect(['draft', 'active', 'completed', 'cancelled']).toContain(response.data.status);
  expect(Array.isArray(response.data.objectives)).toBe(true);
  expect(response.data.objectives.length).toBeGreaterThan(0);
};

// 创建课程计划测试数据
const coursePlanTestData = {
  title: '测试脑科学课程计划',
  grade: '中班',
  duration: 12,
  objectives: [
    '提升儿童认知能力',
    '培养逻辑思维',
    '增强记忆力'
  ],
  weeklyPlan: [
    { week: 1, topic: '认识大脑', activities: ['大脑模型观察'] },
    { week: 2, topic: '感官训练', activities: ['听觉游戏', '视觉训练'] }
  ]
};

// 表单提交验证
const validateFormSubmission = async (testData) => {
  const submitButton = document.querySelector('.submit-button');
  const form = document.querySelector('.course-plan-form');

  // 填写表单
  Object.keys(testData).forEach(key => {
    const field = form.querySelector(`[name="${key}"]`);
    if (field) {
      if (field.type === 'number') {
        field.value = testData[key];
      } else {
        field.value = testData[key];
      }
    }
  });

  // 提交表单
  submitButton.click();

  // 等待响应
  await new Promise(resolve => setTimeout(resolve, 1000));

  // 验证成功提示
  const successToast = document.querySelector('.van-toast--success');
  expect(successToast).toBeTruthy();
};
```

### TC-012-02: 户外训练记录
**测试描述**: 验证户外训练活动的记录、统计和管理功能

**测试步骤**:
1. 点击"记录户外训练"快捷操作
2. 选择训练日期和班级
3. 填写训练内容和成果
4. 上传训练照片（如有）
5. 记录参与学生情况
6. 保存训练记录
7. 查看训练统计数据

**预期结果**:
- ✅ 训练记录表单正确显示
- ✅ 日期选择器正常工作
- ✅ 班级选择功能正常
- ✅ 文件上传功能可用
- ✅ 学生参与情况可记录
- ✅ 统计数据准确显示
- ✅ 训练历史可查看

**严格验证要求**:
```javascript
// 验证户外训练记录表单
const validateOutdoorTrainingForm = () => {
  const formElement = document.querySelector('.outdoor-training-form');
  expect(formElement).toBeTruthy();

  // 必填字段验证
  const requiredFields = ['date', 'classId', 'activities', 'participants'];
  requiredFields.forEach(field => {
    const fieldElement = document.querySelector(`[name="${field}"]`);
    expect(fieldElement).toBeTruthy();
  });

  // 日期字段验证
  const dateField = document.querySelector('[name="date"]');
  expect(dateField.type).toBe('date');
  const today = new Date().toISOString().split('T')[0];
  expect(dateField.max).toBe(today);
};

// API响应验证
const validateOutdoorTrainingResponse = (response) => {
  validateRequiredFields(response.data, [
    'id', 'date', 'classId', 'activities', 'participants', 'weather', 'duration', 'photos'
  ]);

  validateFieldTypes(response.data, {
    id: 'number',
    date: 'string',
    classId: 'number',
    activities: 'array',
    participants: 'array',
    weather: 'string',
    duration: 'number',
    photos: 'array'
  });

  // 业务规则验证
  expect(response.data.activities.length).toBeGreaterThan(0);
  expect(response.data.participants.length).toBeGreaterThan(0);
  expect(response.data.duration).toBeGreaterThan(0);
  expect(['sunny', 'cloudy', 'rainy', 'windy']).toContain(response.data.weather);
};

// 训练统计数据验证
const validateTrainingStats = (response) => {
  validateRequiredFields(response.data, [
    'completedWeeks', 'totalWeeks', 'averageRate', 'classStats'
  ]);

  validateFieldTypes(response.data, {
    completedWeeks: 'number',
    totalWeeks: 'number',
    averageRate: 'number',
    classStats: 'array'
  });

  // 数值范围验证
  expect(response.data.completedWeeks).toBeGreaterThanOrEqual(0);
  expect(response.data.completedWeeks).toBeLessThanOrEqual(response.data.totalWeeks);
  expect(response.data.averageRate).toBeBetween(0, 100);
};

// 户外训练测试数据
const outdoorTrainingTestData = {
  date: '2024-01-15',
  classId: 2,
  activities: [
    { name: '自然观察', duration: 30, description: '观察植物和昆虫' },
    { name: '体能训练', duration: 45, description: '跑步和跳跃练习' }
  ],
  participants: [101, 102, 103, 104],
  weather: 'sunny',
  duration: 90,
  notes: '孩子们参与积极性很高'
};
```

### TC-012-03: 校外展示管理
**测试描述**: 验证校外展示活动的创建、组织、记录和统计功能

**测试步骤**:
1. 点击"添加校外展示"快捷操作
2. 填写展示活动基本信息
3. 设置展示时间和地点
4. 选择参与班级和学生
5. 安排展示内容
6. 保存展示计划
7. 记录展示结果
8. 查看展示统计

**预期结果**:
- ✅ 展示活动表单正确显示
- ✅ 时间和地点选择正常
- ✅ 参与人员选择功能完整
- ✅ 展示内容可详细设置
- ✅ 结果记录功能可用
- ✅ 统计数据准确计算
- ✅ 历史记录可追溯

**严格验证要求**:
```javascript
// 验证校外展示表单
const validateExternalDisplayForm = () => {
  const formElement = document.querySelector('.external-display-form');
  expect(formElement).toBeTruthy();

  // 必填字段验证
  const requiredFields = ['title', 'date', 'location', 'type', 'participants'];
  requiredFields.forEach(field => {
    const fieldElement = document.querySelector(`[name="${field}"]`);
    expect(fieldElement).toBeTruthy();
    expect(fieldElement.hasAttribute('required')).toBe(true);
  });

  // 展示类型验证
  const typeField = document.querySelector('[name="type"]');
  const validTypes = ['competition', 'exhibition', 'performance', 'visit'];
  const typeOptions = typeField.querySelectorAll('option');
  typeOptions.forEach(option => {
    expect(validTypes).toContain(option.value);
  });
};

// API响应验证
const validateExternalDisplayResponse = (response) => {
  validateRequiredFields(response.data, [
    'id', 'title', 'date', 'location', 'type', 'participants', 'results', 'photos'
  ]);

  validateFieldTypes(response.data, {
    id: 'number',
    title: 'string',
    date: 'string',
    location: 'string',
    type: 'string',
    participants: 'array',
    results: 'object',
    photos: 'array'
  });

  // 业务规则验证
  expect(['competition', 'exhibition', 'performance', 'visit']).toContain(response.data.type);
  expect(Array.isArray(response.data.participants)).toBe(true);
  expect(response.data.participants.length).toBeGreaterThan(0);

  if (response.data.results) {
    validateRequiredFields(response.data.results, ['achievement', 'feedback']);
  }
};

// 展示统计数据验证
const validateDisplayStats = (response) => {
  validateRequiredFields(response.data, [
    'totalOutings', 'semesterOutings', 'averageRate', 'upcomingDisplays'
  ]);

  validateFieldTypes(response.data, {
    totalOutings: 'number',
    semesterOutings: 'number',
    averageRate: 'number',
    upcomingDisplays: 'array'
  });

  expect(response.data.totalOutings).toBeGreaterThanOrEqual(response.data.semesterOutings);
  expect(response.data.averageRate).toBeBetween(0, 100);
};

// 校外展示测试数据
const externalDisplayTestData = {
  title: '春季艺术展',
  date: '2024-03-15',
  location: '市美术馆',
  type: 'exhibition',
  participants: [201, 202, 203],
  description: '展示孩子们的艺术作品',
  expectedAudience: 500,
  preparation: [
    { task: '作品收集', deadline: '2024-03-01', responsible: '王老师' },
    { task: '场地布置', deadline: '2024-03-14', responsible: '李老师' }
  ]
};
```

### TC-012-04: 全员锦标赛管理
**测试描述**: 验证全员锦标赛活动的组织、赛程安排、成绩记录和统计功能

**测试步骤**:
1. 点击"创建锦标赛"快捷操作
2. 设置锦标赛基本信息
3. 配置比赛项目和规则
4. 安排赛程时间表
5. 注册参赛学生
6. 记录比赛成绩
7. 生成排行榜
8. 发布比赛结果

**预期结果**:
- ✅ 锦标赛设置表单完整
- ✅ 比赛项目可自定义
- ✅ 赛程安排合理有序
- ✅ 学生注册功能正常
- ✅ 成绩记录准确无误
- ✅ 排行榜自动生成
- ✅ 结果发布功能可用

**严格验证要求**:
```javascript
// 验证锦标赛创建表单
const validateChampionshipForm = () => {
  const formElement = document.querySelector('.championship-form');
  expect(formElement).toBeTruthy();

  // 必填字段验证
  const requiredFields = ['title', 'startDate', 'endDate', 'events', 'rules'];
  requiredFields.forEach(field => {
    const fieldElement = document.querySelector(`[name="${field}"]`);
    expect(fieldElement).toBeTruthy();
  });

  // 日期范围验证
  const startDateField = document.querySelector('[name="startDate"]');
  const endDateField = document.querySelector('[name="endDate"]');

  // 日期逻辑验证会在实际使用时进行
  expect(startDateField.type).toBe('date');
  expect(endDateField.type).toBe('date');
};

// API响应验证
const validateChampionshipResponse = (response) => {
  validateRequiredFields(response.data, [
    'id', 'title', 'startDate', 'endDate', 'events', 'participants', 'results', 'status'
  ]);

  validateFieldTypes(response.data, {
    id: 'number',
    title: 'string',
    startDate: 'string',
    endDate: 'string',
    events: 'array',
    participants: 'array',
    results: 'object',
    status: 'string'
  });

  // 业务规则验证
  expect(['preparation', 'ongoing', 'completed', 'cancelled']).toContain(response.data.status);
  expect(Array.isArray(response.data.events)).toBe(true);
  expect(response.data.events.length).toBeGreaterThan(0);

  response.data.events.forEach(event => {
    validateRequiredFields(event, ['id', 'name', 'type', 'rules']);
  });
};

// 锦标赛统计验证
const validateChampionshipStats = (response) => {
  validateRequiredFields(response.data, [
    'brainScienceRate', 'courseContentRate', 'outdoorTrainingRate', 'externalDisplayRate'
  ]);

  validateFieldTypes(response.data, {
    brainScienceRate: 'number',
    courseContentRate: 'number',
    outdoorTrainingRate: 'number',
    externalDisplayRate: 'number'
  });

  // 达标率范围验证
  Object.values(response.data).forEach(rate => {
    expect(rate).toBeBetween(0, 100);
  });
};

// 锦标赛测试数据
const championshipTestData = {
  title: '2024春季全能锦标赛',
  startDate: '2024-04-01',
  endDate: '2024-04-30',
  events: [
    {
      name: '脑科学知识竞赛',
      type: 'knowledge',
      rules: '答题形式，包含记忆力和逻辑思维题目',
      maxScore: 100
    },
    {
      name: '体能挑战赛',
      type: 'physical',
      rules: '包含跑步、跳跃、平衡等项目',
      maxScore: 100
    },
    {
      name: '创意作品展示',
      type: 'creative',
      rules: '自由创作，评委打分',
      maxScore: 100
    },
    {
      name: '团队协作游戏',
      type: 'teamwork',
      rules: '团队合作完成任务',
      maxScore: 100
    }
  ],
  participants: [], // 将从班级中自动获取
  scoringRules: {
    individualWeight: 0.7,
    teamWeight: 0.3
  }
};
```

### TC-012-05: 活动统计和报告
**测试描述**: 验证各类教学活动的统计数据生成和报告导出功能

**测试步骤**:
1. 查看教学进度总览
2. 检查各项活动统计指标
3. 验证数据准确性
4. 测试报告生成功能
5. 导出统计报告
6. 验证报告格式和内容

**预期结果**:
- ✅ 统计数据实时更新
- ✅ 各项指标准确计算
- ✅ 图表展示清晰直观
- ✅ 报告生成功能正常
- ✅ 导出格式符合要求
- ✅ 数据完整性验证通过

**严格验证要求**:
```javascript
// 统计数据验证
const validateActivityStatistics = (response) => {
  validateRequiredFields(response.data, [
    'overview', 'timeline', 'achievements', 'trends'
  ]);

  // 概览数据验证
  validateRequiredFields(response.data.overview, [
    'totalActivities', 'completedActivities', 'participationRate', 'achievementRate'
  ]);

  validateFieldTypes(response.data.overview, {
    totalActivities: 'number',
    completedActivities: 'number',
    participationRate: 'number',
    achievementRate: 'number'
  });

  // 数值逻辑验证
  expect(response.data.overview.completedActivities).toBeLessThanOrEqual(
    response.data.overview.totalActivities
  );
  expect(response.data.overview.participationRate).toBeBetween(0, 100);
  expect(response.data.overview.achievementRate).toBeBetween(0, 100);
};

// 报告生成验证
const validateReportGeneration = (reportData) => {
  validateRequiredFields(reportData, [
    'title', 'period', 'generatedAt', 'statistics', 'charts', 'summary'
  ]);

  validateFieldTypes(reportData, {
    title: 'string',
    period: 'string',
    generatedAt: 'string',
    statistics: 'object',
    charts: 'array',
    summary: 'string'
  });

  // 日期格式验证
  const dateRegex = /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/;
  expect(dateRegex.test(reportData.generatedAt)).toBe(true);

  // 图表数据验证
  expect(Array.isArray(reportData.charts)).toBe(true);
  reportData.charts.forEach(chart => {
    validateRequiredFields(chart, ['type', 'title', 'data']);
  });
};

// 数据导出验证
const validateDataExport = (exportData, format) => {
  switch (format) {
    case 'excel':
      expect(exportData.mimeType).toBe('application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
      expect(exportData.filename).toMatch(/\.xlsx$/);
      break;
    case 'pdf':
      expect(exportData.mimeType).toBe('application/pdf');
      expect(exportData.filename).toMatch(/\.pdf$/);
      break;
    case 'csv':
      expect(exportData.mimeType).toBe('text/csv');
      expect(exportData.filename).toMatch(/\.csv$/);
      break;
  }

  expect(exportData.size).toBeGreaterThan(0);
  expect(exportData.data).toBeTruthy();
};
```

## API接口测试

### POST /api/teaching-center/course-plans
**请求体**:
```json
{
  "title": "脑科学课程计划",
  "grade": "中班",
  "duration": 12,
  "objectives": ["提升认知能力", "培养逻辑思维"],
  "weeklyPlan": [...]
}
```

**成功响应**:
```json
{
  "success": true,
  "data": {
    "id": 123,
    "title": "脑科学课程计划",
    "grade": "中班",
    "duration": 12,
    "status": "active",
    "createdAt": "2024-01-15T10:00:00Z"
  },
  "message": "课程计划创建成功"
}
```

### POST /api/teaching-center/outdoor-training
**请求体**:
```json
{
  "date": "2024-01-15",
  "classId": 2,
  "activities": [...],
  "participants": [101, 102, 103],
  "weather": "sunny",
  "duration": 90
}
```

### GET /api/teaching-center/statistics
**成功响应**:
```json
{
  "success": true,
  "data": {
    "overview": {
      "totalActivities": 45,
      "completedActivities": 38,
      "participationRate": 92.5,
      "achievementRate": 87.3
    },
    "byType": {
      "coursePlan": 15,
      "outdoorTraining": 18,
      "externalDisplay": 8,
      "championship": 4
    }
  }
}
```

## 性能测试要求

### 数据加载性能
- **统计数据加载**: < 2秒
- **活动列表加载**: < 1.5秒
- **报告生成时间**: < 5秒
- **数据导出时间**: < 10秒

**性能验证**:
```javascript
// 统计数据加载性能测试
const statsLoadStart = performance.now();
await fetch('/api/teaching-center/statistics');
const statsLoadEnd = performance.now();
expect(statsLoadEnd - statsLoadStart).toBeLessThan(2000);

// 报告生成性能测试
const reportGenStart = performance.now();
await generateReport();
const reportGenEnd = performance.now();
expect(reportGenEnd - reportGenStart).toBeLessThan(5000);
```

## 边界条件测试

### 数据边界测试
- 超长标题名称处理
- 最大活动数量限制
- 最长持续时间设置
- 最大参与人数限制

### 时间边界测试
- 跨月活动安排
- 历史数据查看
- 未来计划设置
- 时区处理验证

## 错误处理测试

### 网络错误处理
- 断网状态下的操作提示
- 请求超时的重试机制
- 数据同步失败的恢复

### 数据验证错误
- 重复活动创建
- 时间冲突检测
- 必填字段验证
- 数据格式验证

**错误处理验证**:
```javascript
// 重复活动创建验证
const duplicateCreationTest = async () => {
  const sameActivityData = { /* 相同的活动数据 */ };

  // 第一次创建
  const firstResponse = await createActivity(sameActivityData);
  expect(firstResponse.success).toBe(true);

  // 第二次创建相同活动
  const secondResponse = await createActivity(sameActivityData);
  expect(secondResponse.success).toBe(false);
  expect(secondResponse.message).toContain('已存在');
};

// 数据验证错误测试
const validationErrorTest = async () => {
  const invalidData = {
    title: '', // 空标题
    duration: -1, // 负数时长
    date: 'invalid-date' // 无效日期
  };

  const response = await createActivity(invalidData);
  expect(response.success).toBe(false);
  expect(response.errors).toBeTruthy();
};
```

## 回归测试检查点
1. 现有活动数据不受影响
2. 统计算法保持一致
3. 导出格式兼容性好
4. 界面交互体验不变

## 测试通过标准
- 所有CRUD操作100%功能正常
- 数据验证严格准确
- 统计计算结果正确
- 性能指标达到要求
- 错误处理机制完善
- 用户体验流畅自然

## 相关文件
- 测试页面: `/mobile/centers/teaching-center/index.vue`
- API接口: `/api/teaching-center/*`
- 测试脚本: `/tests/mobile/teacher-center/TC-012.spec.js`
- 验证工具: `/tests/utils/validation-helpers.js`