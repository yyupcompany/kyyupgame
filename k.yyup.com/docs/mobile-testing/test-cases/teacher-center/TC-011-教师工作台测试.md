# TC-011: 教师工作台测试

## 测试概述
**测试目标**: 验证移动端教师工作台的核心功能，包括教学进度总览、统计数据显示、快捷操作入口等
**测试类型**: 功能测试 + UI测试 + 数据验证测试
**优先级**: 高
**预计执行时间**: 15-20分钟

## 测试环境
- **设备**: 移动端设备 (iOS/Android)
- **浏览器**: Chrome Mobile/Safari Mobile
- **网络**: 4G/WiFi
- **用户角色**: 教师

## 前置条件
1. 用户已成功登录系统
2. 用户具有教师权限
3. 系统中存在基础教学数据
4. 移动端网络连接正常

## 测试用例详情

### TC-011-01: 页面加载和初始化
**测试描述**: 验证教师工作台页面能够正确加载并显示初始数据

**测试步骤**:
1. 打开移动端应用
2. 登录教师账号
3. 导航到教学中心页面
4. 等待页面完全加载

**预期结果**:
- ✅ 页面标题显示为"教学中心"
- ✅ 显示"快捷操作"按钮
- ✅ 页面布局完整，无错位现象
- ✅ 加载状态正确显示和消失
- ✅ 控制台无错误信息

**严格验证要求**:
```javascript
// 验证页面元素存在
const pageElement = document.querySelector('.mobile-teaching-center');
expect(pageElement).toBeTruthy();

// 验证标题文本
const titleElement = document.querySelector('.van-nav-bar__title');
expect(titleElement?.textContent).toContain('教学中心');

// 验证快捷操作按钮
const actionButton = document.querySelector('.van-button--primary');
expect(actionButton).toBeTruthy();
expect(actionButton?.textContent).toContain('快捷操作');

// 验证无控制台错误
const consoleErrors = [];
console.error = (...args) => consoleErrors.push(args);
expect(consoleErrors.length).toBe(0);
```

### TC-011-02: 教学进度统计数据验证
**测试描述**: 验证教学进度统计数据的正确性和数据完整性

**测试步骤**:
1. 进入教学中心页面
2. 查看进度统计区域
3. 验证4个统计卡片数据
4. 检查数据格式和单位

**预期结果**:
- ✅ 显示4个统计卡片：全员普及进度、结果达标率、户外训练周数、本学期外出
- ✅ 每个卡片显示正确的数值和单位
- ✅ 趋势指示器正确显示（上升/下降箭头和百分比）
- ✅ 图标正确对应统计类型
- ✅ 数据格式符合规范（百分比、计数等）

**严格验证要求**:
```javascript
// 验证统计卡片数量
const statCards = document.querySelectorAll('.stat-card-mobile');
expect(statCards.length).toBe(4);

// 验证每个卡片的必填字段
statCards.forEach((card, index) => {
  const valueElement = card.querySelector('.stat-value');
  const titleElement = card.querySelector('.stat-title');
  const iconElement = card.querySelector('.stat-icon van-icon');

  expect(valueElement).toBeTruthy();
  expect(titleElement).toBeTruthy();
  expect(iconElement).toBeTruthy();

  // 验证数据类型
  const value = valueElement.textContent;
  expect(value).toBeTruthy();
  expect(typeof value).toBe('string');

  // 验证标题内容
  const expectedTitles = ['全员普及进度', '结果达标率', '户外训练周数', '本学期外出'];
  expect(expectedTitles).toContain(titleElement.textContent);
});

// API响应数据验证
const validateProgressStats = (response) => {
  // 必填字段验证
  validateRequiredFields(response.data, [
    'overallProgress', 'achievementRate', 'outdoorWeeks', 'semesterOutings'
  ]);

  // 字段类型验证
  validateFieldTypes(response.data, {
    overallProgress: 'number',
    achievementRate: 'number',
    outdoorWeeks: 'number',
    semesterOutings: 'number'
  });

  // 数值范围验证
  expect(response.data.overallProgress).toBeGreaterThanOrEqual(0);
  expect(response.data.overallProgress).toBeLessThanOrEqual(100);
  expect(response.data.achievementRate).toBeGreaterThanOrEqual(0);
  expect(response.data.achievementRate).toBeLessThanOrEqual(100);
};
```

### TC-011-03: 教学流程时间轴功能
**测试描述**: 验证教学流程时间轴的显示、交互和数据完整性

**测试步骤**:
1. 滚动到教学流程区域
2. 验证时间轴项目显示
3. 点击不同的时间轴项目
4. 验证项目状态和图标
5. 测试时间轴交互效果

**预期结果**:
- ✅ 显示4个教学流程项目：脑科学课程计划、户外训练与展示、校外展示、全员锦标赛
- ✅ 每个项目显示标题、描述、日期、状态标签
- ✅ 状态图标和颜色正确对应（已完成、进行中、待处理、未开始）
- ✅ 点击项目有选中效果
- ✅ 项目统计数据正确显示

**严格验证要求**:
```javascript
// 验证时间轴项目数量
const timelineItems = document.querySelectorAll('.van-step');
expect(timelineItems.length).toBe(4);

// 验证时间轴项目内容
const validateTimelineItem = (item, expectedData) => {
  const titleElement = item.querySelector('.van-step__title');
  const descElement = item.querySelector('.van-step__description');
  const statusElement = item.querySelector('.timeline-status');

  expect(titleElement?.textContent).toBe(expectedData.title);
  expect(descElement?.textContent).toBe(expectedData.description);
  expect(statusElement).toBeTruthy();

  // 验证统计数据结构
  const statsElements = item.querySelectorAll('.timeline-stats .stat-item');
  if (expectedData.stats) {
    expect(statsElements.length).toBe(expectedData.stats.length);
  }
};

// API时间轴数据验证
const validateTimelineData = (response) => {
  validateRequiredFields(response.data, ['timeline']);
  expect(Array.isArray(response.data.timeline)).toBe(true);

  response.data.timeline.forEach(item => {
    validateRequiredFields(item, [
      'id', 'type', 'title', 'description', 'date', 'status'
    ]);

    validateFieldTypes(item, {
      id: 'string',
      type: 'string',
      title: 'string',
      description: 'string',
      date: 'string',
      status: 'string'
    });

    // 验证状态枚举值
    const validStatuses = ['completed', 'in-progress', 'pending', 'not-started'];
    expect(validStatuses).toContain(item.status);
  });
};
```

### TC-011-04: 选中项详情显示
**测试描述**: 验证时间轴项目选中后的详情显示功能

**测试步骤**:
1. 点击任意时间轴项目
2. 验证选中状态变化
3. 检查详情区域显示
4. 验证详情组件加载
5. 测试详情抽屉功能

**预期结果**:
- ✅ 点击后项目显示选中状态
- ✅ 详情区域显示选中项目的信息
- ✅ 详情组件正确渲染（课程计划、户外训练等）
- ✅ "查看详细内容"按钮可点击
- ✅ 详情抽屉可以打开和关闭

**严格验证要求**:
```javascript
// 点击测试
const firstTimelineItem = document.querySelector('.van-step');
firstTimelineItem.click();

// 验证选中状态
const activeItem = document.querySelector('.timeline-item-active');
expect(activeItem).toBeTruthy();

// 验证详情区域
const detailSection = document.querySelector('.selected-detail');
expect(detailSection).toBeTruthy();

const detailTitle = detailSection.querySelector('.detail-title');
expect(detailTitle?.textContent).toBeTruthy();

// 验证详情按钮
const detailButton = detailSection.querySelector('.van-button');
expect(detailButton?.textContent).toContain('查看详细内容');

// 抽屉功能测试
detailButton.click();
const drawer = document.querySelector('.van-popup');
expect(drawer).toBeTruthy();
expect(drawer?.style.display).not.toBe('none');
```

### TC-011-05: 快捷操作功能
**测试描述**: 验证快捷操作按钮组的显示和功能

**测试步骤**:
1. 滚动到快捷操作区域
2. 验证4个快捷操作按钮
3. 点击每个快捷操作按钮
4. 验证操作面板功能
5. 测试各操作功能响应

**预期结果**:
- ✅ 显示4个快捷操作：创建课程计划、记录户外训练、添加校外展示、创建锦标赛
- ✅ 按钮图标和标签正确显示
- ✅ 点击按钮有触发相应功能
- ✅ 操作面板可以打开
- ✅ 每个操作选项可用

**严格验证要求**:
```javascript
// 验证快捷操作按钮数量
const actionCards = document.querySelectorAll('.action-card');
expect(actionCards.length).toBe(4);

// 验证按钮内容
const expectedActions = [
  { key: 'create-course', label: '创建课程计划' },
  { key: 'outdoor-record', label: '记录户外训练' },
  { key: 'external-display', label: '添加校外展示' },
  { key: 'championship', label: '创建锦标赛' }
];

actionCards.forEach((card, index) => {
  const textElement = card.querySelector('.action-text');
  const iconElement = card.querySelector('van-icon');

  expect(textElement?.textContent).toBe(expectedActions[index].label);
  expect(iconElement).toBeTruthy();
});

// 点击测试
const firstAction = actionCards[0];
firstAction.click();

// 验证操作面板
const actionSheet = document.querySelector('.van-action-sheet');
expect(actionSheet).toBeTruthy();
```

### TC-011-06: 数据加载和错误处理
**测试描述**: 验证数据加载过程和错误处理机制

**测试步骤**:
1. 模拟网络断开情况
2. 刷新页面
3. 模拟API错误响应
4. 验证错误处理和重试机制
5. 测试加载状态显示

**预期结果**:
- ✅ 网络错误时显示友好提示
- ✅ 加载状态正确显示
- ✅ 错误信息不包含技术细节
- ✅ 支持数据重试加载
- ✅ 页面不会崩溃或白屏

**严格验证要求**:
```javascript
// 模拟网络错误
const originalFetch = window.fetch;
window.fetch = () => Promise.reject(new Error('Network error'));

// 触发数据加载
location.reload();

setTimeout(() => {
  // 验证错误提示
  const toastElement = document.querySelector('.van-toast');
  expect(toastElement?.textContent).toContain('加载失败');

  // 验证页面未崩溃
  const pageElement = document.querySelector('.mobile-teaching-center');
  expect(pageElement).toBeTruthy();

  // 恢复网络
  window.fetch = originalFetch;
}, 1000);

// 验证加载状态
const loadingElement = document.querySelector('.van-loading');
expect(loadingElement).toBeTruthy();
```

## API接口测试

### GET /api/teaching-center/progress-stats
**请求参数**: 无
**成功响应**:
```json
{
  "success": true,
  "data": {
    "overallProgress": 75,
    "achievementRate": 82,
    "outdoorWeeks": 12,
    "semesterOutings": 6,
    "trends": {
      "progressTrend": 5.2,
      "achievementTrend": -2.1,
      "outdoorTrend": 1.5,
      "outingTrend": 0.8
    }
  },
  "message": "获取教学统计数据成功"
}
```

**严格验证**:
```javascript
const validateProgressStatsResponse = (response) => {
  // 响应结构验证
  validateRequiredFields(response, ['success', 'data', 'message']);
  expect(response.success).toBe(true);

  // 数据结构验证
  validateRequiredFields(response.data, [
    'overallProgress', 'achievementRate', 'outdoorWeeks', 'semesterOutings'
  ]);

  // 数据类型验证
  validateFieldTypes(response.data, {
    overallProgress: 'number',
    achievementRate: 'number',
    outdoorWeeks: 'number',
    semesterOutings: 'number'
  });

  // 数据范围验证
  expect(response.data.overallProgress).toBeBetween(0, 100);
  expect(response.data.achievementRate).toBeBetween(0, 100);
  expect(response.data.outdoorWeeks).toBeBetween(0, 16);
  expect(response.data.semesterOutings).toBeGreaterThanOrEqual(0);
};
```

### GET /api/teaching-center/timeline
**请求参数**: 无
**成功响应**:
```json
{
  "success": true,
  "data": {
    "timeline": [
      {
        "id": "course-plan",
        "type": "course-plan",
        "title": "脑科学课程计划",
        "description": "全员普及进度和结果达标率管理",
        "date": "2024-01-15",
        "status": "in-progress",
        "stats": [
          { "label": "普及进度", "value": "75%" },
          { "label": "达标率", "value": "82%" }
        ]
      }
    ]
  }
}
```

## 性能测试要求

### 页面加载性能
- **首次加载时间**: < 3秒
- **数据加载时间**: < 2秒
- **交互响应时间**: < 300ms
- **动画流畅性**: 60fps

**性能验证**:
```javascript
// 页面加载时间监测
const loadStartTime = performance.now();
window.addEventListener('load', () => {
  const loadEndTime = performance.now();
  const loadTime = loadEndTime - loadStartTime;
  expect(loadTime).toBeLessThan(3000);
});

// 数据加载时间监测
const dataLoadStart = performance.now();
// 数据加载完成
const dataLoadEnd = performance.now();
expect(dataLoadEnd - dataLoadStart).toBeLessThan(2000);
```

## 边界条件测试

### 数据边界测试
- 进度值为0%和100%的显示
- 超大数据量的渲染性能
- 网络延迟下的用户体验
- 异常数据的容错处理

### 设备兼容性测试
- 小屏设备（320px宽度）适配
- 触摸交互的准确性
- 不同设备的显示一致性

## 回归测试检查点
1. 页面布局不发生变化
2. API接口响应格式兼容
3. 现有功能不受影响
4. 性能指标不下降

## 测试通过标准
- 所有功能测试用例100%通过
- 严格验证检查点全部满足
- 性能指标达到要求
- 无控制台错误或警告
- 用户体验流畅自然
- 数据验证完整准确

## 相关文件
- 测试页面: `/mobile/centers/teaching-center/index.vue`
- API接口: `/api/teaching-center/*`
- 测试脚本: `/tests/mobile/teacher-center/TC-011.spec.js`
- 验证工具: `/tests/utils/validation-helpers.js`