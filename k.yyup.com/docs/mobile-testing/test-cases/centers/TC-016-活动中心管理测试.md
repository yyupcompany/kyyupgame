# TC-016: 活动中心管理测试

## 测试概述
**测试目标**: 验证移动端活动中心管理功能，包括活动创建、报名管理、活动执行、统计报告等
**测试类型**: 功能测试 + 数据验证测试 + 业务流程测试
**优先级**: 高
**预计执行时间**: 25-30分钟

## 测试环境
- **设备**: 移动端设备 (iOS/Android)
- **浏览器**: Chrome Mobile/Safari Mobile
- **网络**: 4G/WiFi
- **用户角色**: 管理员/活动负责人

## 前置条件
1. 用户已成功登录系统
2. 用户具有活动管理权限
3. 系统中存在班级和学生数据
4. 移动端网络连接正常

## 测试用例详情

### TC-016-01: 活动创建和管理
**测试描述**: 验证各类活动的创建、编辑、发布和管理功能

**测试步骤**:
1. 进入活动中心页面
2. 点击创建新活动按钮
3. 选择活动类型（教学活动、户外活动、文体活动、家长活动等）
4. 填写活动基本信息
5. 设置活动时间地点
6. 配置参与人员限制
7. 设置活动费用和报名要求
8. 添加活动详情和注意事项
9. 上传活动图片和资料
10. 保存并发布活动

**预期结果**:
- ✅ 活动创建表单完整显示
- ✅ 活动类型选择正确
- ✅ 表单验证规则生效
- ✅ 时间地点设置成功
- ✅ 人员限制配置有效
- ✅ 费用设置正常工作
- ✅ 图片上传功能可用
- ✅ 活动成功发布
- ✅ 活动列表正确显示

**严格验证要求**:
```javascript
// 验证活动创建界面
const validateActivityCreationInterface = () => {
  const activityForm = document.querySelector('.activity-creation-form');
  expect(activityForm).toBeTruthy();

  // 验证必填字段
  const requiredFields = ['title', 'type', 'startDate', 'endDate', 'location', 'maxParticipants'];
  requiredFields.forEach(field => {
    const fieldElement = activityForm.querySelector(`[name="${field}"]`);
    expect(fieldElement).toBeTruthy();
    expect(fieldElement.hasAttribute('required')).toBe(true);
  });

  // 验证活动类型
  const typeField = activityForm.querySelector('[name="type"]');
  const typeOptions = typeField.querySelectorAll('option');
  const validTypes = ['teaching', 'outdoor', 'sports', 'arts', 'parent', 'holiday', 'competition'];
  typeOptions.forEach(option => {
    expect(validTypes).toContain(option.value);
  });

  // 验证日期时间字段
  const startDateField = activityForm.querySelector('[name="startDate"]');
  const endDateField = activityForm.querySelector('[name="endDate"]');
  expect(startDateField.type).toBe('datetime-local');
  expect(endDateField.type).toBe('datetime-local');

  // 验证参与限制
  const maxParticipantsField = activityForm.querySelector('[name="maxParticipants"]');
  const participantTypes = activityForm.querySelector('[name="participantTypes"]');
  expect(maxParticipantsField.type).toBe('number');
  expect(maxParticipantsField.min).toBe('1');
  expect(participantTypes).toBeTruthy();

  // 验证费用设置
  const feeSection = activityForm.querySelector('.activity-fee-section');
  const isFreeField = feeSection.querySelector('[name="isFree"]');
  const feeAmountField = feeSection.querySelector('[name="feeAmount"]');
  expect(isFreeField).toBeTruthy();
  expect(feeAmountField).toBeTruthy();

  // 验证图片上传
  const imageUpload = activityForm.querySelector('.image-upload-section');
  expect(imageUpload).toBeTruthy();
};

// API响应验证
const validateActivityCreationResponse = (response) => {
  validateRequiredFields(response.data, [
    'id', 'title', 'type', 'description', 'startDate', 'endDate', 'location',
    'maxParticipants', 'currentParticipants', 'fee', 'status', 'creatorId',
    'createdAt', 'updatedAt'
  ]);

  validateFieldTypes(response.data, {
    id: 'number',
    title: 'string',
    type: 'string',
    description: 'string',
    startDate: 'string',
    endDate: 'string',
    location: 'string',
    maxParticipants: 'number',
    currentParticipants: 'number',
    fee: 'object',
    status: 'string',
    creatorId: 'number',
    createdAt: 'string',
    updatedAt: 'string'
  });

  // 活动类型枚举验证
  expect(['teaching', 'outdoor', 'sports', 'arts', 'parent', 'holiday', 'competition'])
    .toContain(response.data.type);

  // 状态枚举验证
  expect(['draft', 'published', 'ongoing', 'completed', 'cancelled'])
    .toContain(response.data.status);

  // 参与人数验证
  expect(response.data.currentParticipants).toBeGreaterThanOrEqual(0);
  expect(response.data.currentParticipants).toBeLessThanOrEqual(response.data.maxParticipants);

  // 费用信息验证
  validateRequiredFields(response.data.fee, ['isFree', 'amount', 'description']);
  validateFieldTypes(response.data.fee, {
    isFree: 'boolean',
    amount: 'number',
    description: 'string'
  });

  // 日期时间格式验证
  const dateTimeRegex = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z?$/;
  expect(dateTimeRegex.test(response.data.startDate)).toBe(true);
  expect(dateTimeRegex.test(response.data.endDate)).toBe(true);
  expect(dateTimeRegex.test(response.data.createdAt)).toBe(true);
  expect(dateTimeRegex.test(response.data.updatedAt)).toBe(true);

  // 时间逻辑验证
  expect(new Date(response.data.endDate) > new Date(response.data.startDate)).toBe(true);
};

// 活动测试数据
const activityTestData = {
  title: '春季亲子运动会',
  type: 'parent',
  description: '邀请家长和孩子一起参与趣味运动比赛，增进亲子关系',
  startDate: '2024-03-15T09:00:00Z',
  endDate: '2024-03-15T12:00:00Z',
  location: '幼儿园操场',
  maxParticipants: 100,
  participantTypes: ['students', 'parents'],
  fee: {
    isFree: false,
    amount: 20,
    description: '包含活动材料和午餐'
  },
  requirements: [
    '家长必须陪同参与',
    '请穿着运动服装',
    '自备水杯'
  ],
  schedule: [
    { time: '09:00', activity: '签到集合' },
    { time: '09:30', activity: '开幕式' },
    { time: '10:00', activity: '趣味游戏' },
    { time: '11:30', activity: '颁奖典礼' },
    { time: '12:00', activity: '午餐时间' }
  ],
  contactPerson: '张老师',
  contactPhone: '13800138000'
};
```

### TC-016-02: 活动报名管理
**测试描述**: 验证活动报名的申请、审核、统计和管理功能

**测试步骤**:
1. 选择要报名的活动
2. 填写报名信息
3. 选择参与家庭成员
4. 提交报名申请
4. 查看报名状态
5. 管理员审核报名
6. 处理报名费用
7. 生成报名名单
8. 导出报名数据

**预期结果**:
- ✅ 报名表单正确显示
- ✅ 家庭成员选择可用
- ✅ 报名提交功能正常
- ✅ 报名状态实时更新
- ✅ 审核流程完整可用
- ✅ 费用处理功能正常
- ✅ 报名名单准确生成
- ✅ 数据导出格式正确

**严格验证要求**:
```javascript
// 验证活动报名界面
const validateActivityRegistrationInterface = () => {
  const registrationForm = document.querySelector('.activity-registration-form');
  expect(registrationForm).toBeTruthy();

  // 验证活动信息显示
  const activityInfo = registrationForm.querySelector('.activity-info-section');
  expect(activityInfo).toBeTruthy();

  const activityTitle = activityInfo.querySelector('.activity-title');
  const activityTime = activityInfo.querySelector('.activity-time');
  const activityLocation = activityInfo.querySelector('.activity-location');
  expect(activityTitle?.textContent).toBeTruthy();
  expect(activityTime?.textContent).toBeTruthy();
  expect(activityLocation?.textContent).toBeTruthy();

  // 验证报名信息表单
  const participantInfo = registrationForm.querySelector('.participant-info-section');
  expect(participantInfo).toBeTruthy();

  const requiredFields = ['parentName', 'parentPhone', 'emergencyContact'];
  requiredFields.forEach(field => {
    const fieldElement = participantInfo.querySelector(`[name="${field}"]`);
    expect(fieldElement).toBeTruthy();
    expect(fieldElement.hasAttribute('required')).toBe(true);
  });

  // 验证家庭成员选择
  const familyMembersSection = registrationForm.querySelector('.family-members-section');
  expect(familyMembersSection).toBeTruthy();

  const memberCheckboxes = familyMembersSection.querySelectorAll('.member-checkbox');
  expect(memberCheckboxes.length).toBeGreaterThan(0);

  memberCheckboxes.forEach(checkbox => {
    const memberName = checkbox.querySelector('.member-name');
    const memberRelation = checkbox.querySelector('.member-relation');
    expect(memberName?.textContent).toBeTruthy();
    expect(memberRelation?.textContent).toBeTruthy();
  });

  // 验证费用信息
  const feeSection = registrationForm.querySelector('.registration-fee-section');
  expect(feeSection).toBeTruthy();

  const totalFee = feeSection.querySelector('.total-fee');
  const paymentMethod = feeSection.querySelector('[name="paymentMethod"]');
  expect(totalFee?.textContent).toBeTruthy();
  expect(paymentMethod).toBeTruthy();

  // 验证同意条款
  const agreementSection = registrationForm.querySelector('.agreement-section');
  expect(agreementSection).toBeTruthy();

  const agreementCheckbox = agreementSection.querySelector('[name="agreeTerms"]');
  expect(agreementCheckbox.hasAttribute('required')).toBe(true);
};

// 报名API响应验证
const validateActivityRegistrationResponse = (response) => {
  validateRequiredFields(response.data, [
    'registrationId', 'activityId', 'parentId', 'participants', 'status',
    'fee', 'paymentStatus', 'registeredAt'
  ]);

  validateFieldTypes(response.data, {
    registrationId: 'number',
    activityId: 'number',
    parentId: 'number',
    participants: 'array',
    status: 'string',
    fee: 'object',
    paymentStatus: 'string',
    registeredAt: 'string'
  });

  // 报名状态枚举验证
  expect(['pending', 'approved', 'rejected', 'cancelled', 'completed'])
    .toContain(response.data.status);

  // 支付状态验证
  expect(['unpaid', 'paid', 'refunded', 'exempt']).toContain(response.data.paymentStatus);

  // 参与者验证
  expect(Array.isArray(response.data.participants)).toBe(true);
  response.data.participants.forEach(participant => {
    validateRequiredFields(participant, ['id', 'name', 'relation', 'age']);
    validateFieldTypes(participant, {
      id: 'number',
      name: 'string',
      relation: 'string',
      age: 'number'
    });
    expect(['student', 'parent', 'sibling', 'grandparent']).toContain(participant.relation);
  });

  // 费用信息验证
  validateRequiredFields(response.data.fee, ['totalAmount', 'discountAmount', 'finalAmount']);
  validateFieldTypes(response.data.fee, {
    totalAmount: 'number',
    discountAmount: 'number',
    finalAmount: 'number'
  });

  expect(response.data.fee.finalAmount).toBeGreaterThanOrEqual(0);
  expect(response.data.fee.finalAmount)
    .toBe(response.data.fee.totalAmount - response.data.fee.discountAmount);
};

// 报名审核验证
const validateRegistrationApprovalResponse = (response) => {
  validateRequiredFields(response.data, [
    'registrationId', 'oldStatus', 'newStatus', 'reviewerId', 'reviewedAt',
    'reviewComment', 'notificationSent'
  ]);

  validateFieldTypes(response.data, {
    registrationId: 'number',
    oldStatus: 'string',
    newStatus: 'string',
    reviewerId: 'number',
    reviewedAt: 'string',
    reviewComment: 'string',
    notificationSent: 'boolean'
  });

  // 状态流转验证
  expect(response.data.oldStatus).toBe('pending');
  expect(['approved', 'rejected']).toContain(response.data.newStatus);

  // 通知验证
  expect(typeof response.data.notificationSent).toBe('boolean');
};

// 报名统计验证
const validateRegistrationStats = (response) => {
  validateRequiredFields(response.data, [
    'totalRegistrations', 'approvedRegistrations', 'pendingRegistrations',
    'rejectedRegistrations', 'totalParticipants', 'participantBreakdown',
    'feeStats', 'registrationTrend'
  ]);

  validateFieldTypes(response.data, {
    totalRegistrations: 'number',
    approvedRegistrations: 'number',
    pendingRegistrations: 'number',
    rejectedRegistrations: 'number',
    totalParticipants: 'number',
    participantBreakdown: 'object',
    feeStats: 'object',
    registrationTrend: 'array'
  });

  // 数值逻辑验证
  const totalStatus = response.data.approvedRegistrations + response.data.pendingRegistrations +
                    response.data.rejectedRegistrations;
  expect(totalStatus).toBe(response.data.totalRegistrations);

  // 参与者分类统计验证
  expect(Array.isArray(response.data.participantBreakdown.byType)).toBe(true);
  response.data.participantBreakdown.byType.forEach(breakdown => {
    validateRequiredFields(breakdown, ['type', 'count', 'percentage']);
    validateFieldTypes(breakdown, {
      type: 'string',
      count: 'number',
      percentage: 'number'
    });
    expect(['student', 'parent', 'family']).toContain(breakdown.type);
  });

  // 费用统计验证
  validateRequiredFields(response.data.feeStats, [
    'totalCollected', 'totalExpected', 'collectionRate', 'paymentBreakdown'
  ]);

  validateFieldTypes(response.data.feeStats, {
    totalCollected: 'number',
    totalExpected: 'number',
    collectionRate: 'number',
    paymentBreakdown: 'object'
  });

  // 报名趋势验证
  expect(Array.isArray(response.data.registrationTrend)).toBe(true);
  response.data.registrationTrend.forEach(trend => {
    validateRequiredFields(trend, ['date', 'registrations', 'cumulative']);
    validateFieldTypes(trend, {
      date: 'string',
      registrations: 'number',
      cumulative: 'number'
    });
  });
};
```

### TC-016-03: 活动执行和管理
**测试描述**: 验证活动执行过程中的签到、现场管理、进度跟踪等功能

**测试步骤**:
1. 进入活动执行页面
2. 查看活动执行清单
3. 进行参与者签到
4. 记录活动过程
5. 管理活动现场
6. 处理突发情况
7. 更新活动进度
8. 保存执行记录

**预期结果**:
- ✅ 执行页面正确显示
- ✅ 签到功能正常工作
- ✅ 活动过程可记录
- ✅ 现场管理功能完整
- ✅ 异常情况可处理
- ✅ 进度更新及时
- ✅ 执行记录完整

**严格验证要求**:
```javascript
// 验证活动执行界面
const validateActivityExecutionInterface = () => {
  const executionView = document.querySelector('.activity-execution-view');
  expect(executionView).toBeTruthy();

  // 验证活动信息显示
  const activityHeader = executionView.querySelector('.activity-execution-header');
  expect(activityHeader).toBeTruthy();

  const activityStatus = activityHeader.querySelector('.activity-status');
  const participantCount = activityHeader.querySelector('.participant-count');
  const progressIndicator = activityHeader.querySelector('.progress-indicator');
  expect(activityStatus?.textContent).toBeTruthy();
  expect(participantCount?.textContent).toBeTruthy();
  expect(progressIndicator).toBeTruthy();

  // 验证签到功能
  const checkInSection = executionView.querySelector('.checkin-section');
  expect(checkInSection).toBeTruthy();

  const checkinSearch = checkInSection.querySelector('.checkin-search');
  const checkinList = checkInSection.querySelector('.checkin-list');
  expect(checkinSearch).toBeTruthy();
  expect(checkinList).toBeTruthy();

  // 验证参与者列表
  const participants = checkinList.querySelectorAll('.participant-item');
  participants.forEach(participant => {
    const participantName = participant.querySelector('.participant-name');
    const checkinStatus = participant.querySelector('.checkin-status');
    const checkinButton = participant.querySelector('.checkin-button');

    expect(participantName?.textContent).toBeTruthy();
    expect(checkinStatus).toBeTruthy();
    expect(checkinButton).toBeTruthy();

    const status = checkinStatus.textContent;
    expect(['未签到', '已签到', '迟到', '请假']).toContain(status);
  });

  // 验证活动进度管理
  const progressSection = executionView.querySelector('.activity-progress-section');
  expect(progressSection).toBeTruthy();

  const progressSteps = progressSection.querySelectorAll('.progress-step');
  expect(progressSteps.length).toBeGreaterThan(0);

  progressSteps.forEach(step => {
    const stepTitle = step.querySelector('.step-title');
    const stepStatus = step.querySelector('.step-status');
    const stepNotes = step.querySelector('.step-notes');

    expect(stepTitle?.textContent).toBeTruthy();
    expect(stepStatus).toBeTruthy();
    expect(stepNotes).toBeTruthy();
  });

  // 验证现场管理功能
  const managementSection = executionView.querySelector('.on-site-management-section');
  expect(managementSection).toBeTruthy();

  const emergencyButton = managementSection.querySelector('.emergency-button');
  const notesButton = managementSection.querySelector('.add-notes-button');
  const photoButton = managementSection.querySelector('.add-photo-button');

  expect(emergencyButton).toBeTruthy();
  expect(notesButton).toBeTruthy();
  expect(photoButton).toBeTruthy();
};

// 签到API响应验证
const validateCheckinResponse = (response) => {
  validateRequiredFields(response.data, [
    'checkinId', 'activityId', 'participantId', 'checkinTime',
    'checkinStatus', 'checkedInBy', 'notes'
  ]);

  validateFieldTypes(response.data, {
    checkinId: 'number',
    activityId: 'number',
    participantId: 'number',
    checkinTime: 'string',
    checkinStatus: 'string',
    checkedInBy: 'number',
    notes: 'string'
  });

  // 签到状态验证
  expect(['on_time', 'late', 'absent', 'excused']).toContain(response.data.checkinStatus);

  // 时间格式验证
  const dateTimeRegex = /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d{3})?Z?$/;
  expect(dateTimeRegex.test(response.data.checkinTime)).toBe(true);
};

// 活动进度更新验证
const validateProgressUpdateResponse = (response) => {
  validateRequiredFields(response.data, [
    'activityId', 'stepId', 'oldStatus', 'newStatus', 'updatedBy',
    'updatedAt', 'notes', 'attachments'
  ]);

  validateFieldTypes(response.data, {
    activityId: 'number',
    stepId: 'number',
    oldStatus: 'string',
    newStatus: 'string',
    updatedBy: 'number',
    updatedAt: 'string',
    notes: 'string',
    attachments: 'array'
  });

  // 状态枚举验证
  expect(['pending', 'in_progress', 'completed', 'skipped', 'delayed'])
    .toContain(response.data.newStatus);

  // 附件验证
  expect(Array.isArray(response.data.attachments)).toBe(true);
  response.data.attachments.forEach(attachment => {
    validateRequiredFields(attachment, ['id', 'filename', 'url', 'type']);
    validateFieldTypes(attachment, {
      id: 'number',
      filename: 'string',
      url: 'string',
      type: 'string'
    });
  });
};

// 突发情况处理验证
const validateEmergencyHandlingResponse = (response) => {
  validateRequiredFields(response.data, [
    'incidentId', 'activityId', 'type', 'severity', 'description',
    'affectedParticipants', 'actionsTaken', 'reportedBy', 'resolvedAt'
  ]);

  validateFieldTypes(response.data, {
    incidentId: 'number',
    activityId: 'number',
    type: 'string',
    severity: 'string',
    description: 'string',
    affectedParticipants: 'array',
    actionsTaken: 'array',
    reportedBy: 'number',
    resolvedAt: 'string'
  });

  // 事件类型验证
  expect(['injury', 'sickness', 'missing_person', 'property_damage', 'weather', 'other'])
    .toContain(response.data.type);

  // 严重程度验证
  expect(['low', 'medium', 'high', 'critical']).toContain(response.data.severity);

  // 受影响参与者验证
  expect(Array.isArray(response.data.affectedParticipants)).toBe(true);
  response.data.affectedParticipants.forEach(participant => {
    validateRequiredFields(participant, ['participantId', 'name', 'injuryType', 'status']);
    validateFieldTypes(participant, {
      participantId: 'number',
      name: 'string',
      injuryType: 'string',
      status: 'string'
    });
  });

  // 处理措施验证
  expect(Array.isArray(response.data.actionsTaken)).toBe(true);
  response.data.actionsTaken.forEach(action => {
    validateRequiredFields(action, ['action', 'responsible', 'timestamp']);
    validateFieldTypes(action, {
      action: 'string',
      responsible: 'string',
      timestamp: 'string'
    });
  });
};
```

### TC-016-04: 活动统计分析
**测试描述**: 验证活动数据的统计分析、报告生成和趋势分析功能

**测试步骤**:
1. 查看活动统计概览
2. 按不同维度筛选分析
3. 查看活动参与率统计
4. 分析活动效果评价
5. 生成活动执行报告
6. 导出统计数据
7. 查看趋势分析图表

**预期结果**:
- ✅ 统计概览数据完整
- ✅ 多维度分析可用
- ✅ 参与率计算准确
- ✅ 效果评价到位
- ✅ 报告生成功能正常
- ✅ 数据导出格式正确
- ✅ 趋势图表清晰直观

**严格验证要求**:
```javascript
// 活动统计概览验证
const validateActivityStatisticsOverview = (response) => {
  validateRequiredFields(response.data, [
    'overview', 'byType', 'byStatus', 'participationStats', 'feeStats',
    'satisfactionStats', 'trendData'
  ]);

  // 概览数据验证
  validateRequiredFields(response.data.overview, [
    'totalActivities', 'completedActivities', 'ongoingActivities',
    'cancelledActivities', 'totalParticipants', 'averageParticipationRate'
  ]);

  validateFieldTypes(response.data.overview, {
    totalActivities: 'number',
    completedActivities: 'number',
    ongoingActivities: 'number',
    cancelledActivities: 'number',
    totalParticipants: 'number',
    averageParticipationRate: 'number'
  });

  // 数值逻辑验证
  const totalStatus = response.data.overview.completedActivities +
                    response.data.overview.ongoingActivities +
                    response.data.overview.cancelledActivities;
  expect(totalStatus).toBeLessThanOrEqual(response.data.overview.totalActivities);

  // 参与率验证
  expect(response.data.overview.averageParticipationRate).toBeBetween(0, 100);

  // 按类型统计验证
  expect(Array.isArray(response.data.byType)).toBe(true);
  response.data.byType.forEach(type => {
    validateRequiredFields(type, ['type', 'count', 'participants', 'averageRate']);
    validateFieldTypes(type, {
      type: 'string',
      count: 'number',
      participants: 'number',
      averageRate: 'number'
    });
    expect(['teaching', 'outdoor', 'sports', 'arts', 'parent', 'holiday', 'competition'])
      .toContain(type.type);
  });

  // 按状态统计验证
  expect(Array.isArray(response.data.byStatus)).toBe(true);
  response.data.byStatus.forEach(status => {
    validateRequiredFields(status, ['status', 'count', 'percentage']);
    validateFieldTypes(status, {
      status: 'string',
      count: 'number',
      percentage: 'number'
    });
    expect(['draft', 'published', 'ongoing', 'completed', 'cancelled'])
      .toContain(status.status);
  });

  // 参与统计验证
  validateRequiredFields(response.data.participationStats, [
    'totalParticipants', 'uniqueParticipants', 'averageParticipants',
    'participationByType', 'participationTrend'
  ]);

  validateFieldTypes(response.data.participationStats, {
    totalParticipants: 'number',
    uniqueParticipants: 'number',
    averageParticipants: 'number',
    participationByType: 'object',
    participationTrend: 'array'
  });

  // 满意度统计验证
  validateRequiredFields(response.data.satisfactionStats, [
    'averageRating', 'ratingDistribution', 'positiveFeedbackRate',
    'commonFeedback', 'improvementSuggestions'
  ]);

  validateFieldTypes(response.data.satisfactionStats, {
    averageRating: 'number',
    ratingDistribution: 'object',
    positiveFeedbackRate: 'number',
    commonFeedback: 'array',
    improvementSuggestions: 'array'
  });

  // 评分验证
  expect(response.data.satisfactionStats.averageRating).toBeBetween(1, 5);

  // 评分分布验证
  Object.keys(response.data.satisfactionStats.ratingDistribution).forEach(rating => {
    const ratingNum = parseInt(rating);
    expect(ratingNum).toBeBetween(1, 5);
    expect(typeof response.data.satisfactionStats.ratingDistribution[rating]).toBe('number');
  });

  // 趋势数据验证
  expect(Array.isArray(response.data.trendData)).toBe(true);
  response.data.trendData.forEach(trend => {
    validateRequiredFields(trend, ['period', 'activityCount', 'participantCount', 'averageRating']);
    validateFieldTypes(trend, {
      period: 'string',
      activityCount: 'number',
      participantCount: 'number',
      averageRating: 'number'
    });
  });
};

// 活动报告生成验证
const validateActivityReport = (reportData) => {
  validateRequiredFields(reportData, [
    'title', 'period', 'generatedAt', 'executiveSummary', 'detailedAnalysis',
    'performanceMetrics', 'satisfactionAnalysis', 'recommendations', 'appendix'
  ]);

  validateFieldTypes(reportData, {
    title: 'string',
    period: 'string',
    generatedAt: 'string',
    executiveSummary: 'object',
    detailedAnalysis: 'object',
    performanceMetrics: 'object',
    satisfactionAnalysis: 'object',
    recommendations: 'array',
    appendix: 'object'
  });

  // 执行摘要验证
  validateRequiredFields(reportData.executiveSummary, [
    'keyMetrics', 'highlights', 'challenges', 'achievements'
  ]);

  // 性能指标验证
  validateRequiredFields(reportData.performanceMetrics, [
    'participationMetrics', 'efficiencyMetrics', 'qualityMetrics',
    'financialMetrics', 'complianceMetrics'
  ]);

  // 参与度指标验证
  validateRequiredFields(reportData.performanceMetrics.participationMetrics, [
    'overallParticipationRate', 'repeatParticipationRate', 'newParticipantRate',
    'participantSatisfaction', 'engagementLevel'
  ]);

  // 满意度分析验证
  validateRequiredFields(reportData.satisfactionAnalysis, [
    'overallSatisfaction', 'aspectSatisfaction', 'feedbackAnalysis',
    'complaintAnalysis', 'improvementAreas'
  ]);

  // 建议验证
  expect(Array.isArray(reportData.recommendations)).toBe(true);
  reportData.recommendations.forEach(recommendation => {
    validateRequiredFields(recommendation, ['category', 'description', 'priority', 'impact']);
    validateFieldTypes(recommendation, {
      category: 'string',
      description: 'string',
      priority: 'string',
      impact: 'string'
    });
    expect(['process', 'content', 'logistics', 'communication', 'safety'])
      .toContain(recommendation.category);
    expect(['low', 'medium', 'high']).toContain(recommendation.priority);
  });
};
```

### TC-016-05: 活动财务管理
**测试描述**: 验证活动费用设置、收费管理、财务统计和报表功能

**测试步骤**:
1. 设置活动费用标准
2. 管理费用优惠政策
3. 处理费用收取
4. 进行费用统计分析
5. 生成财务报表
6. 处理退款申请
7. 查看收支明细

**预期结果**:
- ✅ 费用设置功能正常
- ✅ 优惠政策有效执行
- ✅ 收费流程完整
- ✅ 财务统计准确
- ✅ 报表生成正确
- ✅ 退款处理规范
- ✅ 收支记录清晰

**严格验证要求**:
```javascript
// 活动财务管理界面验证
const validateActivityFinanceInterface = () => {
  const financeView = document.querySelector('.activity-finance-view');
  expect(financeView).toBeTruthy();

  // 验证费用设置
  const feeSettingsSection = financeView.querySelector('.fee-settings-section');
  expect(feeSettingsSection).toBeTruthy();

  const feeAmount = feeSettingsSection.querySelector('[name="feeAmount"]');
  const feeDescription = feeSettingsSection.querySelector('[name="feeDescription"]');
  expect(feeAmount.type).toBe('number');
  expect(feeAmount.min).toBe('0');
  expect(feeDescription.hasAttribute('required')).toBe(true);

  // 验证优惠政策
  const discountSection = financeView.querySelector('.discount-policy-section');
  expect(discountSection).toBeTruthy();

  const discountRules = discountSection.querySelectorAll('.discount-rule');
  discountRules.forEach(rule => {
    const ruleType = rule.querySelector('.rule-type');
    const discountValue = rule.querySelector('.discount-value');
    const condition = rule.querySelector('.condition');
    expect(ruleType?.textContent).toBeTruthy();
    expect(discountValue?.textContent).toBeTruthy();
    expect(condition?.textContent).toBeTruthy();
  });

  // 验证收费记录
  const paymentRecordsSection = financeView.querySelector('.payment-records-section');
  expect(paymentRecordsSection).toBeTruthy();

  const paymentList = paymentRecordsSection.querySelector('.payment-list');
  const totalCollected = paymentRecordsSection.querySelector('.total-collected');
  const pendingPayments = paymentRecordsSection.querySelector('.pending-payments');
  expect(paymentList).toBeTruthy();
  expect(totalCollected?.textContent).toBeTruthy();
  expect(pendingPayments?.textContent).toBeTruthy();

  // 验证财务统计
  const financeStatsSection = financeView.querySelector('.finance-stats-section');
  expect(financeStatsSection).toBeTruthy();

  const revenueChart = financeStatsSection.querySelector('.revenue-chart');
  const paymentMethodChart = financeStatsSection.querySelector('.payment-method-chart');
  expect(revenueChart).toBeTruthy();
  expect(paymentMethodChart).toBeTruthy();
};

// 费用设置API验证
const validateFeeSettingsResponse = (response) => {
  validateRequiredFields(response.data, [
    'activityId', 'feePolicy', 'discountRules', 'paymentMethods', 'updatedAt'
  ]);

  validateFieldTypes(response.data, {
    activityId: 'number',
    feePolicy: 'object',
    discountRules: 'array',
    paymentMethods: 'array',
    updatedAt: 'string'
  });

  // 费用政策验证
  validateRequiredFields(response.data.feePolicy, [
    'isFree', 'baseAmount', 'description', 'includes', 'excludes'
  ]);

  validateFieldTypes(response.data.feePolicy, {
    isFree: 'boolean',
    baseAmount: 'number',
    description: 'string',
    includes: 'array',
    excludes: 'array'
  });

  expect(response.data.feePolicy.baseAmount).toBeGreaterThanOrEqual(0);

  // 优惠规则验证
  expect(Array.isArray(response.data.discountRules)).toBe(true);
  response.data.discountRules.forEach(rule => {
    validateRequiredFields(rule, ['id', 'type', 'value', 'condition', 'enabled']);
    validateFieldTypes(rule, {
      id: 'number',
      type: 'string',
      value: 'number',
      condition: 'object',
      enabled: 'boolean'
    });

    expect(['percentage', 'fixed_amount', 'free_pass']).toContain(rule.type);
    expect(rule.value).toBeGreaterThan(0);
    expect(typeof rule.enabled).toBe('boolean');
  });

  // 支付方式验证
  expect(Array.isArray(response.data.paymentMethods)).toBe(true);
  response.data.paymentMethods.forEach(method => {
    validateRequiredFields(method, ['type', 'enabled', 'settings']);
    validateFieldTypes(method, {
      type: 'string',
      enabled: 'boolean',
      settings: 'object'
    });

    expect(['cash', 'wechat', 'alipay', 'bank_transfer', 'online_payment'])
      .toContain(method.type);
  });
};

// 支付记录API验证
const validatePaymentRecordResponse = (response) => {
  validateRequiredFields(response.data, [
    'paymentId', 'activityId', 'registrationId', 'payerId', 'amount',
    'method', 'status', 'transactionId', 'paidAt', 'refundInfo'
  ]);

  validateFieldTypes(response.data, {
    paymentId: 'number',
    activityId: 'number',
    registrationId: 'number',
    payerId: 'number',
    amount: 'number',
    method: 'string',
    status: 'string',
    transactionId: 'string',
    paidAt: 'string',
    refundInfo: 'object'
  });

  // 支付状态验证
  expect(['pending', 'paid', 'failed', 'refunded', 'partially_refunded'])
    .toContain(response.data.status);

  // 支付方式验证
  expect(['cash', 'wechat', 'alipay', 'bank_transfer', 'online_payment'])
    .toContain(response.data.method);

  // 金额验证
  expect(response.data.amount).toBeGreaterThan(0);

  // 退款信息验证
  if (response.data.refundInfo) {
    validateRequiredFields(response.data.refundInfo, [
      'refundAmount', 'refundReason', 'refundedAt', 'refundMethod'
    ]);
    validateFieldTypes(response.data.refundInfo, {
      refundAmount: 'number',
      refundReason: 'string',
      refundedAt: 'string',
      refundMethod: 'string'
    });
  }
};

// 财务统计验证
const validateFinanceStatistics = (response) => {
  validateRequiredFields(response.data, [
    'summary', 'paymentBreakdown', 'refundStatistics', 'revenueTrend',
    'profitAnalysis', 'complianceStatus'
  ]);

  // 财务摘要验证
  validateRequiredFields(response.data.summary, [
    'totalRevenue', 'totalExpenses', 'netProfit', 'profitMargin',
    'averageRevenuePerActivity', 'collectionRate'
  ]);

  validateFieldTypes(response.data.summary, {
    totalRevenue: 'number',
    totalExpenses: 'number',
    netProfit: 'number',
    profitMargin: 'number',
    averageRevenuePerActivity: 'number',
    collectionRate: 'number'
  });

  // 财务逻辑验证
  expect(response.data.summary.netProfit)
    .toBe(response.data.summary.totalRevenue - response.data.summary.totalExpenses);

  if (response.data.summary.totalRevenue > 0) {
    expect(response.data.summary.profitMargin)
      .toBe((response.data.summary.netProfit / response.data.summary.totalRevenue) * 100);
  }

  // 支付方式分布验证
  validateRequiredFields(response.data.paymentBreakdown, [
    'byMethod', 'byTime', 'byAmount'
  ]);

  // 退款统计验证
  validateRequiredFields(response.data.refundStatistics, [
    'totalRefunds', 'refundRate', 'averageRefundAmount', 'refundReasons'
  ]);

  // 收入趋势验证
  expect(Array.isArray(response.data.revenueTrend)).toBe(true);
  response.data.revenueTrend.forEach(trend => {
    validateRequiredFields(trend, ['period', 'revenue', 'expenses', 'profit']);
    validateFieldTypes(trend, {
      period: 'string',
      revenue: 'number',
      expenses: 'number',
      profit: 'number'
    });
  });
};
```

## API接口测试

### POST /api/activities/create
**请求体**:
```json
{
  "title": "春季亲子运动会",
  "type": "parent",
  "description": "邀请家长和孩子一起参与趣味运动比赛",
  "startDate": "2024-03-15T09:00:00Z",
  "endDate": "2024-03-15T12:00:00Z",
  "location": "幼儿园操场",
  "maxParticipants": 100,
  "participantTypes": ["students", "parents"],
  "fee": {
    "isFree": false,
    "amount": 20,
    "description": "包含活动材料和午餐"
  }
}
```

**成功响应**:
```json
{
  "success": true,
  "data": {
    "id": 789,
    "title": "春季亲子运动会",
    "type": "parent",
    "status": "published",
    "maxParticipants": 100,
    "currentParticipants": 0,
    "createdAt": "2024-01-15T10:00:00Z"
  },
  "message": "活动创建成功"
}
```

### POST /api/activities/{activityId}/register
**请求体**:
```json
{
  "parentId": 1001,
  "participants": [
    { "id": 101, "name": "张小明", "relation": "student", "age": 5 },
    { "id": 1001, "name": "张爸爸", "relation": "parent", "age": 35 }
  ],
  "paymentMethod": "wechat"
}
```

### GET /api/activities/statistics
**查询参数**: `?startDate=2024-01-01&endDate=2024-03-31`

**成功响应**:
```json
{
  "success": true,
  "data": {
    "overview": {
      "totalActivities": 12,
      "completedActivities": 8,
      "ongoingActivities": 2,
      "totalParticipants": 456,
      "averageParticipationRate": 87.5
    },
    "byType": [
      {
        "type": "parent",
        "count": 4,
        "participants": 180,
        "averageRate": 92.3
      }
    ],
    "participationStats": {
      "totalParticipants": 456,
      "uniqueParticipants": 320,
      "averageParticipants": 38
    }
  }
}
```

## 性能测试要求

### 数据加载性能
- **活动列表加载**: < 2秒
- **报名数据处理**: < 1.5秒
- **统计数据生成**: < 3秒
- **财务报告生成**: < 5秒

**性能验证**:
```javascript
// 活动列表加载性能测试
const activityListLoadStart = performance.now();
await loadActivityList({ status: 'published', page: 1 });
const activityListLoadEnd = performance.now();
expect(activityListLoadEnd - activityListLoadStart).toBeLessThan(2000);

// 报名数据处理性能测试
const registrationProcessStart = performance.now();
await processRegistration({
  activityId: 789,
  participants: [...], // 大量参与者
  paymentInfo: {...}
});
const registrationProcessEnd = performance.now();
expect(registrationProcessEnd - registrationProcessStart).toBeLessThan(1500);
```

## 边界条件测试

### 数据量边界测试
- 大型活动报名（500+参与者）
- 复杂费用优惠政策（10+规则）
- 长时间活动执行（持续多天）
- 复杂退款处理（批量退款）

### 业务边界测试
- 超额报名处理
- 重复报名检测
- 费用计算准确性
- 活动冲突检测

## 错误处理测试

### 业务逻辑错误
- 重复活动创建检测
- 报名人数超限处理
- 费用支付失败恢复
- 活动时间冲突检测

**错误处理验证**:
```javascript
// 超额报名测试
const overCapacityTest = async () => {
  const activityId = 789; // 假设最大参与人数为100

  // 先注册99个参与者
  for (let i = 0; i < 99; i++) {
    await registerParticipant(activityId, { participantId: i + 1 });
  }

  // 第100个参与者应该成功
  const response100 = await registerParticipant(activityId, { participantId: 100 });
  expect(response100.success).toBe(true);

  // 第101个参与者应该失败
  const response101 = await registerParticipant(activityId, { participantId: 101 });
  expect(response101.success).toBe(false);
  expect(response101.message).toContain('人数已满');
};

// 重复报名检测测试
const duplicateRegistrationTest = async () => {
  const registrationData = {
    activityId: 789,
    parentId: 1001,
    participants: [{ id: 101, name: '张小明' }]
  };

  // 第一次报名成功
  const firstResponse = await registerActivity(registrationData);
  expect(firstResponse.success).toBe(true);

  // 重复报名应该失败
  const secondResponse = await registerActivity(registrationData);
  expect(secondResponse.success).toBe(false);
  expect(secondResponse.message).toContain('已经报名');
};
```

## 回归测试检查点
1. 现有活动数据完整性
2. 报名信息一致性
3. 财务数据准确性
4. 统计分析方法正确性

## 测试通过标准
- 所有活动管理操作100%功能正常
- 报名流程完整可靠
- 财务管理准确规范
- 统计分析数据正确
- 性能指标达到要求
- 错误处理机制完善

## 相关文件
- 测试页面: `/mobile/centers/activity-center/index.vue`
- API接口: `/api/activities/*`
- 测试脚本: `/tests/mobile/centers/TC-016.spec.js`
- 验证工具: `/tests/utils/validation-helpers.js`