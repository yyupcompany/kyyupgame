# æŸ¥è¯¢å·¥å…·å›é€€æœºåˆ¶è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯´æ˜äº†æ•°æ®æŸ¥è¯¢å·¥å…·çš„å›é€€æœºåˆ¶,ç¡®ä¿å½“ `read_data_record` å·¥å…·æ— æ³•å¤„ç†æŸ¥è¯¢æ—¶,AIå¯ä»¥è‡ªåŠ¨ä½¿ç”¨ `any_query` å·¥å…·è¿›è¡Œæ™ºèƒ½æŸ¥è¯¢ã€‚

---

## ğŸ¯ æŸ¥è¯¢å·¥å…·æ¶æ„

### ä¸¤å±‚æŸ¥è¯¢ç³»ç»Ÿ

| å·¥å…· | ç”¨é€” | æ€§èƒ½ | æ”¯æŒèŒƒå›´ | å®ç°æ–¹å¼ |
|------|------|------|---------|---------|
| **read_data_record** | ç®€å•æŸ¥è¯¢ | âš¡ <1ç§’ | 11ä¸ªå®ä½“ç±»å‹ | ç›´æ¥APIè°ƒç”¨ |
| **any_query** | å¤æ‚æŸ¥è¯¢ | ğŸŒ ~18ç§’ | **æ‰€æœ‰æ•°æ®è¡¨** | AI+APIåˆ†ç»„ |

---

## ğŸ“Š read_data_record æ”¯æŒçš„å®ä½“ç±»å‹

### å½“å‰æ”¯æŒ (11ä¸ª)

1. **students** - å­¦ç”Ÿ
2. **teachers** - æ•™å¸ˆ
3. **classes** - ç­çº§
4. **activities** - æ´»åŠ¨
5. **parents** - å®¶é•¿
6. **users** - ç”¨æˆ·
7. **enrollments** - æ‹›ç”Ÿç”³è¯·
8. **todos** - å¾…åŠäº‹é¡¹
9. **kindergartens** - å¹¼å„¿å›­
10. **roles** - è§’è‰²
11. **permissions** - æƒé™

### ä¸æ”¯æŒçš„å®ä½“ç±»å‹

å½“æŸ¥è¯¢ä»¥ä¸‹ç±»å‹æ—¶,`read_data_record` ä¼šè¿”å›é”™è¯¯å¹¶å»ºè®®ä½¿ç”¨ `any_query`:

- **customer-pool** - å®¢æˆ·æ± 
- **poster-template** - æµ·æŠ¥æ¨¡æ¿
- **poster-generation** - æµ·æŠ¥ç”Ÿæˆ
- **performance-evaluations** - ç»©æ•ˆè¯„ä¼°
- **performance-reports** - ç»©æ•ˆæŠ¥å‘Š
- **marketing-campaigns** - è¥é”€æ´»åŠ¨
- **channel-trackings** - æ¸ é“è·Ÿè¸ª
- **conversion-trackings** - è½¬åŒ–è·Ÿè¸ª
- **notifications** - é€šçŸ¥
- **schedules** - æ—¥ç¨‹
- **system-logs** - ç³»ç»Ÿæ—¥å¿—
- **operation-logs** - æ“ä½œæ—¥å¿—
- **ai-memories** - AIè®°å¿†
- ä»¥åŠå…¶ä»–æ‰€æœ‰æ•°æ®è¡¨...

---

## ğŸ”„ å›é€€æœºåˆ¶

### å·¥ä½œæµç¨‹

```
ç”¨æˆ·æŸ¥è¯¢
    â†“
AIé€‰æ‹©å·¥å…·
    â†“
read_data_record (å°è¯•)
    â†“
å®ä½“ç±»å‹æ£€æŸ¥
    â†“
    â”œâ”€ æ”¯æŒ â†’ ç›´æ¥APIè°ƒç”¨ â†’ è¿”å›ç»“æœ âœ…
    â”‚
    â””â”€ ä¸æ”¯æŒ â†’ è¿”å›é”™è¯¯ + å»ºè®®ä½¿ç”¨any_query
                    â†“
                AIè¯†åˆ«å»ºè®®
                    â†“
                è°ƒç”¨any_query
                    â†“
                æ™ºèƒ½æŸ¥è¯¢ â†’ è¿”å›ç»“æœ âœ…
```

---

## ğŸ’¡ é”™è¯¯æç¤ºç¤ºä¾‹

### read_data_record é”™è¯¯å“åº”

å½“æŸ¥è¯¢ä¸æ”¯æŒçš„å®ä½“ç±»å‹æ—¶,è¿”å›:

```json
{
  "name": "read_data_record",
  "status": "error",
  "result": null,
  "error": "ä¸æ”¯æŒçš„å®ä½“ç±»å‹: customer-pool\n\næ”¯æŒçš„ç±»å‹: students, teachers, classes, activities, parents, users, enrollments, todos, kindergartens, roles, permissions\n\nğŸ’¡ å»ºè®®ï¼šå®ä½“ç±»å‹ \"customer-pool\" ä¸åœ¨å¿«é€ŸæŸ¥è¯¢æ”¯æŒåˆ—è¡¨ä¸­ã€‚\n   è¯·ä½¿ç”¨ any_query å·¥å…·è¿›è¡Œæ™ºèƒ½æŸ¥è¯¢ã€‚\n   \n   any_query æ”¯æŒæ‰€æœ‰æ•°æ®è¡¨çš„æŸ¥è¯¢ï¼Œå¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€æŸ¥è¯¢ä»»æ„è¡¨çš„æ•°æ®ã€‚\n   \n   ç¤ºä¾‹: any_query({query: \"æŸ¥è¯¢ customer-pool ç›¸å…³æ•°æ®\"})"
}
```

### AIè¯†åˆ«å»ºè®®

AIä¼šè¯†åˆ«é”™è¯¯ä¿¡æ¯ä¸­çš„å»ºè®®,å¹¶è‡ªåŠ¨è°ƒç”¨ `any_query`:

```javascript
// AIè‡ªåŠ¨ç”Ÿæˆçš„å·¥å…·è°ƒç”¨
{
  "name": "any_query",
  "arguments": {
    "query": "æŸ¥è¯¢å®¢æˆ·æ± ç›¸å…³æ•°æ®"
  }
}
```

---

## ğŸš€ any_query èƒ½åŠ›

### æ ¸å¿ƒèƒ½åŠ›

1. **æ”¯æŒæ‰€æœ‰æ•°æ®è¡¨** - ä¸é™äºç‰¹å®šå®ä½“ç±»å‹
2. **æ™ºèƒ½APIåˆ†ç»„è¯†åˆ«** - è‡ªåŠ¨è¯†åˆ«æŸ¥è¯¢æ¶‰åŠçš„APIåˆ†ç»„
3. **å¤šæ­¥éª¤æŸ¥è¯¢æ”¯æŒ** - å¯ä»¥ç»„åˆå¤šä¸ªAPIè°ƒç”¨
4. **å¤æ‚æŸ¥è¯¢å¤„ç†** - æ”¯æŒJOINã€èšåˆã€ç»Ÿè®¡ç­‰

### é€‚ç”¨åœºæ™¯

- âœ… å¤æ‚çš„å¤šè¡¨JOINæŸ¥è¯¢
- âœ… éœ€è¦èšåˆè®¡ç®—çš„æŸ¥è¯¢ï¼ˆç»Ÿè®¡ã€æ±‚å’Œã€å¹³å‡å€¼ç­‰ï¼‰
- âœ… è·¨ä¸šåŠ¡åŸŸçš„ç»¼åˆæŸ¥è¯¢
- âœ… read_data_recordä¸æ”¯æŒçš„å®ä½“ç±»å‹æŸ¥è¯¢
- âœ… éœ€è¦è‡ªå®šä¹‰æ¡ä»¶çš„å¤æ‚æŸ¥è¯¢

### æŸ¥è¯¢ç¤ºä¾‹

```javascript
// ç¤ºä¾‹1: æŸ¥è¯¢å®¢æˆ·æ± 
any_query({
  query: "æŸ¥è¯¢æ‰€æœ‰å®¢æˆ·æ± è®°å½•"
})

// ç¤ºä¾‹2: æŸ¥è¯¢æµ·æŠ¥æ¨¡æ¿
any_query({
  query: "æŸ¥è¯¢æµ·æŠ¥æ¨¡æ¿åˆ—è¡¨"
})

// ç¤ºä¾‹3: æŸ¥è¯¢ç»©æ•ˆè¯„ä¼°
any_query({
  query: "æŸ¥è¯¢æœ¬æœˆçš„ç»©æ•ˆè¯„ä¼°è®°å½•"
})

// ç¤ºä¾‹4: å¤æ‚ç»Ÿè®¡æŸ¥è¯¢
any_query({
  query: "ç»Ÿè®¡å„ä¸ªè¥é”€æ¸ é“çš„è½¬åŒ–ç‡"
})
```

---

## ğŸ“ å·¥å…·é€‰æ‹©æŒ‡å—

### ä½•æ—¶ä½¿ç”¨ read_data_record

âœ… **æ¨èä½¿ç”¨**:
- æŸ¥è¯¢11ä¸ªæ”¯æŒçš„å®ä½“ç±»å‹
- ç®€å•çš„å•è¡¨æŸ¥è¯¢
- éœ€è¦å¿«é€Ÿå“åº” (<1ç§’)
- ä¸éœ€è¦å¤æ‚JOINæˆ–èšåˆ

âŒ **ä¸æ¨èä½¿ç”¨**:
- æŸ¥è¯¢ä¸æ”¯æŒçš„å®ä½“ç±»å‹
- å¤æ‚çš„å¤šè¡¨JOIN
- éœ€è¦èšåˆè®¡ç®—
- è·¨ä¸šåŠ¡åŸŸæŸ¥è¯¢

### ä½•æ—¶ä½¿ç”¨ any_query

âœ… **æ¨èä½¿ç”¨**:
- æŸ¥è¯¢ä»»æ„æ•°æ®è¡¨
- å¤æ‚çš„å¤šè¡¨JOINæŸ¥è¯¢
- éœ€è¦èšåˆè®¡ç®—ï¼ˆç»Ÿè®¡ã€æ±‚å’Œã€å¹³å‡å€¼ç­‰ï¼‰
- è·¨ä¸šåŠ¡åŸŸçš„ç»¼åˆæŸ¥è¯¢
- read_data_recordè¿”å›é”™è¯¯æ—¶

âŒ **ä¸æ¨èä½¿ç”¨**:
- ç®€å•çš„å•è¡¨æŸ¥è¯¢ï¼ˆä¼˜å…ˆä½¿ç”¨read_data_recordï¼‰
- å¯¹æ€§èƒ½è¦æ±‚æé«˜çš„æŸ¥è¯¢ï¼ˆany_queryè¾ƒæ…¢ï¼‰

---

## ğŸ”§ æŠ€æœ¯å®ç°

### read_data_record é”™è¯¯å¤„ç†

<augment_code_snippet path="server/src/services/ai/tools/database-query/read-data-record.tool.ts" mode="EXCERPT">
```typescript
// ğŸ¯ ä½¿ç”¨Swagger APIæ˜ å°„è·å–ç«¯ç‚¹
const apiEndpoint = apiGroupMappingService.getApiEndpointByEntity(entity);
if (!apiEndpoint) {
  const supportedEntities = apiGroupMappingService.getSupportedEntities();
  
  // æ„å»ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯,åŒ…å«å»ºè®®
  const errorMessage = `ä¸æ”¯æŒçš„å®ä½“ç±»å‹: ${entity}

æ”¯æŒçš„ç±»å‹: ${supportedEntities.join(', ')}

ğŸ’¡ å»ºè®®ï¼šå®ä½“ç±»å‹ "${entity}" ä¸åœ¨å¿«é€ŸæŸ¥è¯¢æ”¯æŒåˆ—è¡¨ä¸­ã€‚
   è¯·ä½¿ç”¨ any_query å·¥å…·è¿›è¡Œæ™ºèƒ½æŸ¥è¯¢ã€‚
   
   any_query æ”¯æŒæ‰€æœ‰æ•°æ®è¡¨çš„æŸ¥è¯¢ï¼Œå¯ä»¥é€šè¿‡è‡ªç„¶è¯­è¨€æŸ¥è¯¢ä»»æ„è¡¨çš„æ•°æ®ã€‚
   
   ç¤ºä¾‹: any_query({query: "æŸ¥è¯¢ ${entity} ç›¸å…³æ•°æ®"})`;
  
  return {
    name: "read_data_record",
    status: "error",
    result: null,
    error: errorMessage
  };
}
```
</augment_code_snippet>

### any_query å·¥å…·æè¿°

<augment_code_snippet path="server/src/services/ai/tools/database-query/any-query.tool.ts" mode="EXCERPT">
```typescript
const anyQueryTool: ToolDefinition = {
  name: "any_query",
  description: `ğŸš€ æ™ºèƒ½APIæŸ¥è¯¢å·¥å…· - å°†è‡ªç„¶è¯­è¨€æŸ¥è¯¢è½¬æ¢ä¸ºAPIè°ƒç”¨

**æ ¸å¿ƒèƒ½åŠ›**:
1. æ”¯æŒæ‰€æœ‰æ•°æ®è¡¨çš„æŸ¥è¯¢ - ä¸é™äºç‰¹å®šå®ä½“ç±»å‹
2. æ™ºèƒ½APIåˆ†ç»„è¯†åˆ« - è‡ªåŠ¨è¯†åˆ«æŸ¥è¯¢æ¶‰åŠçš„APIåˆ†ç»„
3. å¤šæ­¥éª¤æŸ¥è¯¢æ”¯æŒ - å¯ä»¥ç»„åˆå¤šä¸ªAPIè°ƒç”¨
4. å¤æ‚æŸ¥è¯¢å¤„ç† - æ”¯æŒJOINã€èšåˆã€ç»Ÿè®¡ç­‰å¤æ‚æŸ¥è¯¢

**é€‚ç”¨åœºæ™¯**:
- âœ… å¤æ‚çš„å¤šè¡¨JOINæŸ¥è¯¢
- âœ… éœ€è¦èšåˆè®¡ç®—çš„æŸ¥è¯¢ï¼ˆç»Ÿè®¡ã€æ±‚å’Œã€å¹³å‡å€¼ç­‰ï¼‰
- âœ… è·¨ä¸šåŠ¡åŸŸçš„ç»¼åˆæŸ¥è¯¢
- âœ… read_data_recordä¸æ”¯æŒçš„å®ä½“ç±»å‹æŸ¥è¯¢
- âœ… éœ€è¦è‡ªå®šä¹‰æ¡ä»¶çš„å¤æ‚æŸ¥è¯¢`,
  // ...
};
```
</augment_code_snippet>

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| åœºæ™¯ | read_data_record | any_query | æ¨è |
|------|-----------------|-----------|------|
| æŸ¥è¯¢å­¦ç”Ÿåˆ—è¡¨ | <1ç§’ âš¡ | ~18ç§’ ğŸŒ | read_data_record |
| æŸ¥è¯¢å®¢æˆ·æ±  | âŒ ä¸æ”¯æŒ | ~18ç§’ âœ… | any_query |
| ç»Ÿè®¡æ´»åŠ¨å‚ä¸äººæ•° | âŒ ä¸æ”¯æŒ | ~18ç§’ âœ… | any_query |
| æŸ¥è¯¢æµ·æŠ¥æ¨¡æ¿ | âŒ ä¸æ”¯æŒ | ~18ç§’ âœ… | any_query |
| æŸ¥è¯¢ç»©æ•ˆè¯„ä¼° | âŒ ä¸æ”¯æŒ | ~18ç§’ âœ… | any_query |

---

## âœ… æœ€ä½³å®è·µ

### 1. ä¼˜å…ˆä½¿ç”¨ read_data_record

å¯¹äºæ”¯æŒçš„11ä¸ªå®ä½“ç±»å‹,ä¼˜å…ˆä½¿ç”¨ `read_data_record`:

```javascript
// âœ… æ¨è
read_data_record({ entity: 'students' })

// âŒ ä¸æ¨è (è™½ç„¶å¯ä»¥,ä½†æ€§èƒ½å·®)
any_query({ query: "æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿ" })
```

### 2. é‡åˆ°é”™è¯¯æ—¶åˆ‡æ¢åˆ° any_query

å½“ `read_data_record` è¿”å›é”™è¯¯æ—¶,ä½¿ç”¨ `any_query`:

```javascript
// ç¬¬ä¸€æ¬¡å°è¯•
read_data_record({ entity: 'customer-pool' })
// è¿”å›é”™è¯¯: ä¸æ”¯æŒçš„å®ä½“ç±»å‹

// ç¬¬äºŒæ¬¡å°è¯• (æ ¹æ®å»ºè®®)
any_query({ query: "æŸ¥è¯¢å®¢æˆ·æ± ç›¸å…³æ•°æ®" })
// æˆåŠŸè¿”å›ç»“æœ âœ…
```

### 3. å¤æ‚æŸ¥è¯¢ç›´æ¥ä½¿ç”¨ any_query

å¯¹äºå¤æ‚æŸ¥è¯¢,ç›´æ¥ä½¿ç”¨ `any_query`:

```javascript
// âœ… æ¨è
any_query({ 
  query: "ç»Ÿè®¡å„ä¸ªè¥é”€æ¸ é“çš„è½¬åŒ–ç‡,æŒ‰è½¬åŒ–ç‡é™åºæ’åˆ—" 
})

// âŒ ä¸æ¨è (read_data_recordæ— æ³•å¤„ç†)
read_data_record({ entity: 'channel-trackings' })
```

---

## ğŸ¯ æ€»ç»“

### å›é€€æœºåˆ¶ä¼˜åŠ¿

1. **æ™ºèƒ½æç¤º** - é”™è¯¯ä¿¡æ¯åŒ…å«æ˜ç¡®çš„å»ºè®®
2. **æ— ç¼åˆ‡æ¢** - AIå¯ä»¥è‡ªåŠ¨è¯†åˆ«å¹¶åˆ‡æ¢å·¥å…·
3. **å…¨è¦†ç›–** - ç¡®ä¿æ‰€æœ‰æ•°æ®è¡¨éƒ½å¯ä»¥æŸ¥è¯¢
4. **æ€§èƒ½ä¼˜åŒ–** - ç®€å•æŸ¥è¯¢ä½¿ç”¨å¿«é€Ÿå·¥å…·,å¤æ‚æŸ¥è¯¢ä½¿ç”¨æ™ºèƒ½å·¥å…·

### ç”¨æˆ·ä½“éªŒ

- âœ… ç”¨æˆ·æ— éœ€äº†è§£å·¥å…·ç»†èŠ‚
- âœ… AIè‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å·¥å…·
- âœ… æŸ¥è¯¢å¤±è´¥æ—¶è‡ªåŠ¨å›é€€
- âœ… æ‰€æœ‰æ•°æ®è¡¨éƒ½å¯ä»¥æŸ¥è¯¢

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**åˆ›å»ºæ—¶é—´**: 2025-10-10  
**ä½œè€…**: AI Assistant  
**çŠ¶æ€**: âœ… å·²å®ç°

