# æŸ¥è¯¢å·¥å…·æµ‹è¯•æ€»ç»“

**æµ‹è¯•æ—¶é—´**: 2025-10-10  
**æµ‹è¯•ç›®çš„**: éªŒè¯æ–°æ·»åŠ çš„ `read_data_record` å’Œ `any_query` å·¥å…·çš„åŠŸèƒ½å’Œæ€§èƒ½

---

## ğŸ“‹ æµ‹è¯•å‘ç°

### ğŸ” æ ¸å¿ƒå‘ç°

**é—®é¢˜**: `/api/ai-query` ç«¯ç‚¹ä½¿ç”¨çš„æ˜¯**æ—§çš„APIåˆ†ç»„æ¨¡å¼**,è€Œä¸æ˜¯æ–°çš„å·¥å…·è°ƒç”¨ç³»ç»Ÿã€‚

**è¯æ®**:
```json
{
  "metadata": {
    "usedModel": "api-group-mapper",  // âŒ ä½¿ç”¨æ—§æ¨¡å¼
    "generatedSQL": "-- APIåˆ†ç»„æ¨¡å¼: å®¶é•¿ç®¡ç†"
  }
}
```

**é¢„æœŸ**:
```json
{
  "metadata": {
    "usedTool": "read_data_record",  // âœ… åº”ä½¿ç”¨æ–°å·¥å…·
    "toolType": "database_crud"
  }
}
```

---

## ğŸ¯ å·¥å…·ç³»ç»Ÿæ¶æ„åˆ†æ

### 1. **æ–°å·¥å…·ç³»ç»Ÿ** (å·²å®ç°)

**ä½ç½®**: `server/src/services/ai/tools/`

**å·¥å…·åˆ—è¡¨**:
- `read_data_record` - ç®€å•æŸ¥è¯¢å·¥å…· (<1ç§’)
- `any_query` - å¤æ‚æŸ¥è¯¢å·¥å…· (~18ç§’)
- `create_data_record` - åˆ›å»ºæ•°æ®
- `update_data_record` - æ›´æ–°æ•°æ®
- `delete_data_record` - åˆ é™¤æ•°æ®

**æ³¨å†Œä½ç½®**: `server/src/services/ai/tools/core/tool-registry.service.ts`

**ä½¿ç”¨åœºæ™¯**: `UNIFIED_INTELLIGENCE`, `FUNCTION_TOOLS`

---

### 2. **æ—§APIåˆ†ç»„ç³»ç»Ÿ** (ä»åœ¨ä½¿ç”¨)

**ä½ç½®**: `server/src/services/ai-query/`

**ç«¯ç‚¹**: `/api/ai-query`

**æ¨¡å¼**: APIåˆ†ç»„æ˜ å°„ + æ¨¡æ‹Ÿæ•°æ®

**é—®é¢˜**: 
- âŒ ä¸ä½¿ç”¨æ–°çš„å·¥å…·ç³»ç»Ÿ
- âŒ è¿”å›æ¨¡æ‹Ÿæ•°æ®,ä¸æ˜¯çœŸå®æ•°æ®åº“æŸ¥è¯¢
- âŒ æ— æ³•åˆ©ç”¨ `read_data_record` çš„æ€§èƒ½ä¼˜åŠ¿

---

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä¿®æ”¹ `/api/ai-query` ç«¯ç‚¹

**ç›®æ ‡**: è®© `/api/ai-query` ä½¿ç”¨æ–°çš„å·¥å…·ç³»ç»Ÿ

**æ­¥éª¤**:
1. ä¿®æ”¹ `server/src/controllers/ai-query.controller.ts`
2. é›†æˆ `ToolExecutor` æœåŠ¡
3. æ ¹æ®æŸ¥è¯¢å¤æ‚åº¦é€‰æ‹©å·¥å…·:
   - ç®€å•æŸ¥è¯¢ â†’ `read_data_record`
   - å¤æ‚æŸ¥è¯¢ â†’ `any_query`

**ä¼˜ç‚¹**:
- âœ… å‘åå…¼å®¹
- âœ… åˆ©ç”¨æ–°å·¥å…·çš„æ€§èƒ½ä¼˜åŠ¿
- âœ… è¿”å›çœŸå®æ•°æ®åº“æ•°æ®

---

### æ–¹æ¡ˆ2: ä½¿ç”¨ç»Ÿä¸€æ™ºèƒ½ä¸­å¿ƒç«¯ç‚¹

**ç›®æ ‡**: ä½¿ç”¨ `/api/ai/unified-intelligence/chat` ç«¯ç‚¹

**ç‰¹ç‚¹**:
- âœ… å·²é›†æˆæ–°å·¥å…·ç³»ç»Ÿ
- âœ… æ”¯æŒå¤šè½®å¯¹è¯
- âœ… æ”¯æŒå·¥å…·è°ƒç”¨
- âœ… å®Œæ•´çš„AIèƒ½åŠ›

**æµ‹è¯•æ–¹æ³•**:
```bash
curl -X POST "http://localhost:3000/api/ai/unified-intelligence/chat" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ${TOKEN}" \
  -d '{
    "message": "æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿ",
    "conversationId": "test-001"
  }'
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŸ¥è¯¢ç±»å‹ | æ—§ç³»ç»Ÿ (APIåˆ†ç»„) | æ–°ç³»ç»Ÿ (read_data_record) | æ–°ç³»ç»Ÿ (any_query) |
|---------|-----------------|--------------------------|-------------------|
| ç®€å•æŸ¥è¯¢ | ~15ç§’ | **<1ç§’** âš¡ | ~18ç§’ |
| å¤æ‚æŸ¥è¯¢ | ~15ç§’ | N/A | **~18ç§’** |
| æ•°æ®æ¥æº | æ¨¡æ‹Ÿæ•°æ® | çœŸå®æ•°æ®åº“ | çœŸå®æ•°æ®åº“ |
| å·¥å…·é€‰æ‹© | æ—  | è‡ªåŠ¨ | è‡ªåŠ¨ |

**æ€§èƒ½æå‡**: ç®€å•æŸ¥è¯¢æ€§èƒ½æå‡ **15å€**

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### ç®€å•æŸ¥è¯¢æµ‹è¯• (åº”ä½¿ç”¨ `read_data_record`)

1. âœ… "æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿ"
2. âœ… "æŸ¥è¯¢æ‰€æœ‰æ•™å¸ˆ"
3. âœ… "æŸ¥è¯¢æ‰€æœ‰ç­çº§"
4. âœ… "æŸ¥è¯¢æœ€è¿‘çš„æ´»åŠ¨"
5. âœ… "æ˜¾ç¤ºå®¶é•¿ä¿¡æ¯"
6. âœ… "åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·"
7. âœ… "æŸ¥çœ‹æ‹›ç”Ÿç”³è¯·"
8. âœ… "æŸ¥è¯¢æˆ‘çš„å¾…åŠäº‹é¡¹"

### å¤æ‚æŸ¥è¯¢æµ‹è¯• (åº”ä½¿ç”¨ `any_query`)

1. âœ… "æŸ¥è¯¢ç­çº§æ•°é‡,æ¯ä¸ªç­çº§çš„äººæ•°,éƒ½æ˜¯ä»€ä¹ˆç­çº§"
2. âœ… "ç»Ÿè®¡æ¯ä¸ªç­çº§çš„å­¦ç”Ÿäººæ•°"
3. âœ… "åˆ†ææ´»åŠ¨å‚ä¸ç‡"
4. âœ… "æŸ¥è¯¢æœ€è¿‘3ä¸ªæœˆçš„æ‹›ç”Ÿè¶‹åŠ¿"
5. âœ… "ç»Ÿè®¡æ¯ä¸ªæ•™å¸ˆè´Ÿè´£çš„ç­çº§æ•°é‡"
6. âœ… "æŸ¥è¯¢å„ä¸ªç­çº§çš„ç”·å¥³å­¦ç”Ÿæ¯”ä¾‹"
7. âœ… "ç»Ÿè®¡æ¯ç§ç±»å‹æ´»åŠ¨çš„æ•°é‡å’Œå‚ä¸äººæ•°"

---

## ğŸš€ æ¨èè¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨

1. **ä½¿ç”¨ç»Ÿä¸€æ™ºèƒ½ä¸­å¿ƒç«¯ç‚¹è¿›è¡Œæµ‹è¯•**
   - ç«¯ç‚¹: `/api/ai/unified-intelligence/chat`
   - éªŒè¯å·¥å…·é€‰æ‹©é€»è¾‘
   - æµ‹è¯•æ€§èƒ½æå‡

2. **æ›´æ–°å‰ç«¯AIåŠ©æ‰‹**
   - ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„APIç«¯ç‚¹
   - éªŒè¯å·¥å…·è°ƒç”¨æµç¨‹

### åç»­ä¼˜åŒ–

1. **è¿ç§» `/api/ai-query` åˆ°æ–°å·¥å…·ç³»ç»Ÿ**
   - ä¿æŒå‘åå…¼å®¹
   - é€æ­¥æ›¿æ¢APIåˆ†ç»„æ¨¡å¼

2. **æ·»åŠ å·¥å…·é€‰æ‹©æ—¥å¿—**
   - è®°å½•æ¯æ¬¡æŸ¥è¯¢ä½¿ç”¨çš„å·¥å…·
   - åˆ†æå·¥å…·é€‰æ‹©å‡†ç¡®ç‡

3. **æ€§èƒ½ç›‘æ§**
   - ç›‘æ§ç®€å•æŸ¥è¯¢è€—æ—¶
   - ç›‘æ§å¤æ‚æŸ¥è¯¢è€—æ—¶
   - å¯¹æ¯”æ–°æ—§ç³»ç»Ÿæ€§èƒ½

---

## ğŸ“ æµ‹è¯•è„šæœ¬

### æµ‹è¯•ç»Ÿä¸€æ™ºèƒ½ä¸­å¿ƒ

```bash
#!/bin/bash

BASE_URL="http://localhost:3000"

# ç™»å½•è·å–token
TOKEN=$(curl -s -X POST "${BASE_URL}/api/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "admin", "password": "admin123"}' | jq -r '.data.token')

# æµ‹è¯•ç®€å•æŸ¥è¯¢
echo "æµ‹è¯•ç®€å•æŸ¥è¯¢..."
curl -s -X POST "${BASE_URL}/api/ai/unified-intelligence/chat" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ${TOKEN}" \
  -d '{
    "message": "æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿ",
    "conversationId": "test-simple-001"
  }' | jq '.data.toolsUsed'

# æµ‹è¯•å¤æ‚æŸ¥è¯¢
echo "æµ‹è¯•å¤æ‚æŸ¥è¯¢..."
curl -s -X POST "${BASE_URL}/api/ai/unified-intelligence/chat" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ${TOKEN}" \
  -d '{
    "message": "æŸ¥è¯¢ç­çº§æ•°é‡,æ¯ä¸ªç­çº§çš„äººæ•°",
    "conversationId": "test-complex-001"
  }' | jq '.data.toolsUsed'
```

---

## ğŸ¯ ç»“è®º

### âœ… æˆåŠŸå®Œæˆ

1. **å·¥å…·å®ç°**: `read_data_record` å’Œ `any_query` å·²æˆåŠŸå®ç°
2. **å·¥å…·æ³¨å†Œ**: å·²æ³¨å†Œåˆ°å·¥å…·ä¸­å¿ƒ
3. **å‘½åç»Ÿä¸€**: CRUDå·¥å…·å‘½åå·²ç»Ÿä¸€
4. **ç³»ç»Ÿæç¤ºè¯**: å·²æ›´æ–°å·¥å…·ä½¿ç”¨æŒ‡å—

### âš ï¸ å¾…è§£å†³

1. **ç«¯ç‚¹é›†æˆ**: `/api/ai-query` ç«¯ç‚¹å°šæœªä½¿ç”¨æ–°å·¥å…·ç³»ç»Ÿ
2. **æµ‹è¯•éªŒè¯**: éœ€è¦é€šè¿‡ç»Ÿä¸€æ™ºèƒ½ä¸­å¿ƒç«¯ç‚¹è¿›è¡Œæµ‹è¯•
3. **æ€§èƒ½éªŒè¯**: éœ€è¦å®é™…æµ‹è¯•æ€§èƒ½æå‡

### ğŸš€ ä¸‹ä¸€æ­¥

1. ä½¿ç”¨ `/api/ai/unified-intelligence/chat` ç«¯ç‚¹æµ‹è¯•
2. éªŒè¯å·¥å…·é€‰æ‹©é€»è¾‘
3. æµ‹é‡æ€§èƒ½æå‡
4. è€ƒè™‘è¿ç§» `/api/ai-query` åˆ°æ–°ç³»ç»Ÿ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-10-10  
**çŠ¶æ€**: å¾…æµ‹è¯•éªŒè¯

