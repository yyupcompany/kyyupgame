# åç«¯æŸ¥è¯¢å·¥å…·å®Œæ•´åˆ—è¡¨

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£åˆ—å‡ºäº†åç«¯æ‰€æœ‰çš„æŸ¥è¯¢ç›¸å…³å·¥å…·,åŒ…æ‹¬æ™ºèƒ½æŸ¥è¯¢ã€CRUDæ“ä½œç­‰ã€‚

**å·¥å…·æ³¨å†Œä¸­å¿ƒ**: `server/src/services/ai/tools/core/tool-registry.service.ts`
**å·¥å…·æ‰§è¡Œå™¨**: `server/src/services/ai-operator/function-tools.service.ts`

**æœ€æ–°ä¼˜åŒ–**: 2025-10-09 å·²ç§»é™¤å†—ä½™çš„æ•°æ®æŸ¥è¯¢å·¥å…·,ç»Ÿä¸€ä½¿ç”¨`any_query`

**æ€»è®¡**: 6ä¸ªæŸ¥è¯¢ç›¸å…³å·¥å…·

---

## ğŸš€ ä¸€ã€æ™ºèƒ½æŸ¥è¯¢å·¥å…· (1ä¸ª)



### 1. `any_query` - AIé©±åŠ¨çš„SQLç”Ÿæˆå·¥å…·

**æè¿°**: ğŸš€ æ™ºèƒ½APIæŸ¥è¯¢å·¥å…· - åŸºäºAPIåˆ†ç»„çš„æŸ¥è¯¢æ¨¡å¼(ä½†å®é™…å®ç°æ˜¯AIç”ŸæˆSQL)

**å‚æ•°**:
```typescript
{
  userQuery: string;            // ç”¨æˆ·çš„åŸå§‹æŸ¥è¯¢éœ€æ±‚(å®Œæ•´æè¿°)
  queryType?: string;           // æŸ¥è¯¢ç±»å‹: statisticalã€detailedã€comparisonã€trend
  expectedFormat?: string;      // æœŸæœ›çš„è¿”å›æ ¼å¼: tableã€chartã€summaryã€mixed
  userRole?: string;            // ç”¨æˆ·è§’è‰²,é»˜è®¤admin
}
```

**å·¥ä½œæµç¨‹**:
1. æ¥æ”¶è‡ªç„¶è¯­è¨€æŸ¥è¯¢
2. ç”Ÿæˆæ•°æ®åº“Schemaæè¿°(åŸºäºç”¨æˆ·è§’è‰²æƒé™)
3. è°ƒç”¨AIæ¨¡å‹ç”ŸæˆSQLæŸ¥è¯¢è¯­å¥
4. SQLå®‰å…¨æ£€æŸ¥(ç¦æ­¢å±é™©æ“ä½œã€éªŒè¯æƒé™)
5. æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢
6. æ ¼å¼åŒ–ç»“æœè¿”å›

**è¿”å›**:
```typescript
{
  success: boolean;
  data: {
    type: 'table' | 'chart' | 'summary' | 'mixed';
    columns?: Array<{key, title, width}>;
    rows?: Array<object>;
    summary?: object;
  };
  metadata: {
    name: 'any_query';
    originalQuery: string;
    generatedSQL: string;
    explanation: string;
    resultCount: number;
    queryType: string;
    expectedFormat: string;
  };
}
```

**é€‚ç”¨åœºæ™¯**:
- âœ… å¤æ‚çš„å¤šè¡¨JOINæŸ¥è¯¢
- âœ… éœ€è¦èšåˆè®¡ç®—çš„ç»Ÿè®¡æŸ¥è¯¢
- âœ… éœ€è¦çµæ´»æŸ¥è¯¢æ¡ä»¶çš„åœºæ™¯
- âœ… éœ€è¦ä¸¥æ ¼æƒé™æ§åˆ¶çš„åœºæ™¯

**ä¸é€‚ç”¨åœºæ™¯**:
- âŒ ç®€å•çš„å•è¡¨æŸ¥è¯¢(åº”è¯¥ç›´æ¥è°ƒç”¨API)
- âŒ é«˜é¢‘æŸ¥è¯¢(åº”è¯¥ä½¿ç”¨ç¼“å­˜)
- âŒ å®æ—¶æ€§è¦æ±‚é«˜çš„æŸ¥è¯¢(AIç”Ÿæˆè€—æ—¶é•¿)

**å®‰å…¨ç‰¹æ€§**:
- âœ… åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶(RBAC)
- âœ… ç»†ç²’åº¦çš„å­—æ®µçº§æƒé™
- âœ… å¼ºåˆ¶çš„WHEREæ¡ä»¶(æ•°æ®éš”ç¦»)
- âœ… ç¦æ­¢å±é™©SQLæ“ä½œ(DROPã€DELETEã€UPDATEç­‰)
- âœ… ç¦æ­¢è®¿é—®ç³»ç»Ÿé…ç½®è¡¨

**æ€§èƒ½**:
- AIç”ŸæˆSQL: ~10ç§’
- æ‰§è¡Œæ•°æ®åº“æŸ¥è¯¢: ~5ç§’
- æ€»è€—æ—¶: ~18ç§’

**å®ç°ä½ç½®**: 
- å·¥å…·å®šä¹‰: `unified-intelligence.service.ts:4937-4984`
- å·¥å…·å®ç°: `function-tools.service.ts:2183-2314`

**è¯¦ç»†åˆ†æ**: å‚è§ `docs/ai/ANY_QUERY_EXECUTION_TRACE.md`

---

## ğŸ“ äºŒã€æ•°æ®åº“CRUDå·¥å…· (4ä¸ª)

### 1. `create_data_record` - åˆ›å»ºæ•°æ®è®°å½•

**æè¿°**: ğŸš€ é€šç”¨æ•°æ®åˆ›å»ºå·¥å…· - æ™ºèƒ½åˆ†æAPIç«¯ç‚¹,ç”Ÿæˆåˆ›å»ºé¢„è§ˆ,ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œ

**å‚æ•°**:
```typescript
{
  table_name: string;           // ç›®æ ‡æ•°æ®è¡¨åç§°
  data: object;                 // è¦åˆ›å»ºçš„æ•°æ®å¯¹è±¡
  description?: string;         // åˆ›å»ºæ“ä½œçš„æè¿°,ç”¨äºç”¨æˆ·ç¡®è®¤
  auto_confirm?: boolean;       // æ˜¯å¦è‡ªåŠ¨ç¡®è®¤,é»˜è®¤false
}
```

**æ”¯æŒçš„è¡¨**:
- `students` - å­¦ç”Ÿ
- `teachers` - æ•™å¸ˆ
- `activities` - æ´»åŠ¨
- `classes` - ç­çº§
- `parents` - å®¶é•¿
- `users` - ç”¨æˆ·
- `enrollments` - æ‹›ç”Ÿ
- `todos` - å¾…åŠäº‹é¡¹

**è¿”å›**:
- åˆ›å»ºé¢„è§ˆ
- ç”¨æˆ·ç¡®è®¤åçš„åˆ›å»ºç»“æœ

**é€‚ç”¨åœºæ™¯**:
- âœ… åˆ›å»ºå•æ¡æ•°æ®è®°å½•
- âœ… éœ€è¦ç”¨æˆ·ç¡®è®¤çš„åˆ›å»ºæ“ä½œ
- âœ… æ™ºèƒ½APIç«¯ç‚¹åˆ†æ

**å®ç°ä½ç½®**: `tool-registry.service.ts:1220-1243`

---

### 2. `update_data_record` - æ›´æ–°æ•°æ®è®°å½•

**æè¿°**: ğŸš€ é€šç”¨æ•°æ®æ›´æ–°å·¥å…· - æ™ºèƒ½åˆ†æAPIç«¯ç‚¹,æ˜¾ç¤ºæ›´æ–°å‰åå¯¹æ¯”,ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œ

**å‚æ•°**:
```typescript
{
  table_name: string;           // ç›®æ ‡æ•°æ®è¡¨åç§°
  record_id: string;            // è¦æ›´æ–°çš„è®°å½•ID
  updates: object;              // è¦æ›´æ–°çš„å­—æ®µå’Œæ–°å€¼
  description?: string;         // æ›´æ–°æ“ä½œçš„æè¿°,ç”¨äºç”¨æˆ·ç¡®è®¤
  auto_confirm?: boolean;       // æ˜¯å¦è‡ªåŠ¨ç¡®è®¤,é»˜è®¤false
}
```

**è¿”å›**:
- æ›´æ–°å‰åå¯¹æ¯”
- ç”¨æˆ·ç¡®è®¤åçš„æ›´æ–°ç»“æœ

**é€‚ç”¨åœºæ™¯**:
- âœ… æ›´æ–°å•æ¡æ•°æ®è®°å½•
- âœ… éœ€è¦ç”¨æˆ·ç¡®è®¤çš„æ›´æ–°æ“ä½œ
- âœ… æ˜¾ç¤ºæ›´æ–°å‰åå¯¹æ¯”

**å®ç°ä½ç½®**: `tool-registry.service.ts:1245-1272`

---

### 3. `delete_data_record` - åˆ é™¤æ•°æ®è®°å½•

**æè¿°**: ğŸš€ å®‰å…¨æ•°æ®åˆ é™¤å·¥å…· - æ™ºèƒ½åˆ†æåˆ é™¤å½±å“,æ˜¾ç¤ºå…³è”æ•°æ®,ç”¨æˆ·ç¡®è®¤åæ‰§è¡Œåˆ é™¤

**å‚æ•°**:
```typescript
{
  table_name: string;           // ç›®æ ‡æ•°æ®è¡¨åç§°
  record_id: string;            // è¦åˆ é™¤çš„è®°å½•ID
  delete_type?: string;         // åˆ é™¤ç±»å‹: soft(è½¯åˆ é™¤)æˆ–hard(ç¡¬åˆ é™¤),é»˜è®¤soft
  description?: string;         // åˆ é™¤æ“ä½œçš„æè¿°,ç”¨äºç”¨æˆ·ç¡®è®¤
  force_delete?: boolean;       // æ˜¯å¦å¼ºåˆ¶åˆ é™¤(å¿½ç•¥å…³è”æ£€æŸ¥),é»˜è®¤false
}
```

**è¿”å›**:
- åˆ é™¤å½±å“åˆ†æ
- å…³è”æ•°æ®åˆ—è¡¨
- ç”¨æˆ·ç¡®è®¤åçš„åˆ é™¤ç»“æœ

**é€‚ç”¨åœºæ™¯**:
- âœ… å®‰å…¨åˆ é™¤æ•°æ®è®°å½•
- âœ… éœ€è¦ç”¨æˆ·ç¡®è®¤çš„åˆ é™¤æ“ä½œ
- âœ… æ˜¾ç¤ºåˆ é™¤å½±å“åˆ†æ

**å®ç°ä½ç½®**: `tool-registry.service.ts:1274-1303`

---

### 4. `batch_import_data` - æ‰¹é‡å¯¼å…¥æ•°æ®

**æè¿°**: ğŸš€ æ‰¹é‡æ•°æ®å¯¼å…¥å·¥å…· - æ™ºèƒ½è§£ææ–‡æ¡£å†…å®¹,è‡ªåŠ¨æ˜ å°„å­—æ®µ,æ‰¹é‡åˆ›å»ºæ•°æ®è®°å½•ã€‚æ”¯æŒCSVã€Excelã€JSONæ ¼å¼,æä¾›é¢„è§ˆç¡®è®¤æœºåˆ¶

**å‚æ•°**:
```typescript
{
  table_name: string;           // ç›®æ ‡æ•°æ®è¡¨åç§°
  file_content: string;         // æ–‡ä»¶å†…å®¹(CSVæ ¼å¼æˆ–JSONå­—ç¬¦ä¸²)
  file_type?: string;           // æ–‡ä»¶ç±»å‹: csvã€jsonã€excel,é»˜è®¤csv
  description?: string;         // å¯¼å…¥æ“ä½œçš„æè¿°,ç”¨äºç”¨æˆ·ç¡®è®¤
  batch_size?: number;          // æ‰¹é‡å¤„ç†å¤§å°,é»˜è®¤100,æœ€å¤§1000
  auto_confirm?: boolean;       // æ˜¯å¦è‡ªåŠ¨ç¡®è®¤,é»˜è®¤false
}
```

**è¿”å›**:
- å¯¼å…¥é¢„è§ˆ
- å­—æ®µæ˜ å°„ç»“æœ
- ç”¨æˆ·ç¡®è®¤åçš„å¯¼å…¥ç»“æœ

**é€‚ç”¨åœºæ™¯**:
- âœ… æ‰¹é‡å¯¼å…¥æ•°æ®
- âœ… æ–‡ä»¶æ•°æ®è§£æ
- âœ… è‡ªåŠ¨å­—æ®µæ˜ å°„

**å®ç°ä½ç½®**: `tool-registry.service.ts:1305-1341`

---

## ğŸ“Š å·¥å…·åˆ†ç±»å¯¹æ¯”

| å·¥å…·ç±»åˆ« | å·¥å…·æ•°é‡ | ä¸»è¦ç”¨é€” | æ€§èƒ½ç‰¹ç‚¹ |
|---------|---------|---------|---------|
| **æ™ºèƒ½æŸ¥è¯¢å·¥å…·** | 1ä¸ª | å¤æ‚æŸ¥è¯¢ã€AIç”ŸæˆSQL | æ…¢,éœ€è¦AIç”Ÿæˆ(~18ç§’) |
| **CRUDå·¥å…·** | 4ä¸ª | åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€å¯¼å…¥ | ä¸­ç­‰,éœ€è¦ç”¨æˆ·ç¡®è®¤ |
| **ä¸Šä¸‹æ–‡å·¥å…·** | 1ä¸ª | æä¾›æœºæ„èƒŒæ™¯ä¸Šä¸‹æ–‡ | å¿«é€Ÿ,ä½¿ç”¨ç¼“å­˜ |

---

## ğŸ¯ å·¥å…·é€‰æ‹©å»ºè®®

### æ‰€æœ‰æŸ¥è¯¢ â†’ ç»Ÿä¸€ä½¿ç”¨æ™ºèƒ½æŸ¥è¯¢å·¥å…·
- âœ… `any_query` - AIç”ŸæˆSQL,æ”¯æŒç®€å•å’Œå¤æ‚æŸ¥è¯¢

### CRUDæ“ä½œ â†’ ä½¿ç”¨CRUDå·¥å…·
- âœ… `create_data_record` - åˆ›å»º
- âœ… `update_data_record` - æ›´æ–°
- âœ… `delete_data_record` - åˆ é™¤
- âœ… `batch_import_data` - æ‰¹é‡å¯¼å…¥

---

## ğŸ“‹ ç»Ÿä¸€æ™ºèƒ½ä¸­å¿ƒ(UNIFIED_INTELLIGENCE)å·¥å…·åˆ—è¡¨

æ ¹æ®`tool-registry.service.ts:453-483`,ç»Ÿä¸€æ™ºèƒ½ä¸­å¿ƒå®é™…æ³¨å†Œçš„å·¥å…·:

1. `navigate_to_page` - é¡µé¢å¯¼èˆª
2. `capture_screen` - æˆªå›¾
3. **`any_query`** - **æ™ºèƒ½æŸ¥è¯¢(å”¯ä¸€çš„æŸ¥è¯¢å·¥å…·)**
4. `web_search` - ç½‘ç»œæœç´¢
5. `analyze_task_complexity` - ä»»åŠ¡å¤æ‚åº¦åˆ†æ
6. `create_todo_list` - åˆ›å»ºå¾…åŠæ¸…å•
7. `update_todo_task` - æ›´æ–°å¾…åŠä»»åŠ¡
8. `get_todo_list` - è·å–å¾…åŠæ¸…å•
9. `delete_todo_task` - åˆ é™¤å¾…åŠä»»åŠ¡
10. `render_component` - æ¸²æŸ“ç»„ä»¶
11. `get_expert_list` - è·å–ä¸“å®¶åˆ—è¡¨
12. `consult_recruitment_planner` - å’¨è¯¢æ‹›ç”Ÿç­–åˆ’å¸ˆ
13. `navigate_back` - é¡µé¢åé€€
14. **`create_data_record`** - **åˆ›å»ºæ•°æ®è®°å½•**
15. **`update_data_record`** - **æ›´æ–°æ•°æ®è®°å½•**
16. **`delete_data_record`** - **åˆ é™¤æ•°æ®è®°å½•**
17. **`batch_import_data`** - **æ‰¹é‡å¯¼å…¥æ•°æ®**

**æ€»è®¡**: 17ä¸ªå·¥å…·

**æŸ¥è¯¢ç›¸å…³å·¥å…·**: åªæœ‰ **`any_query`** 1ä¸ª

**CRUDå·¥å…·**: 4ä¸ª (`create_data_record`, `update_data_record`, `delete_data_record`, `batch_import_data`)

---

## âš ï¸ é‡è¦å˜æ›´è¯´æ˜

### 2025-10-09 ä¼˜åŒ–

**ç§»é™¤çš„å·¥å…·** (å·²åºŸå¼ƒ):
- âŒ `query_past_activities` - æŸ¥è¯¢å†å²æ´»åŠ¨æ•°æ®
- âŒ `get_activity_statistics` - è·å–æ´»åŠ¨ç»Ÿè®¡ä¿¡æ¯
- âŒ `query_enrollment_history` - æŸ¥è¯¢æ‹›ç”Ÿå†å²æ•°æ®
- âŒ `analyze_business_trends` - åˆ†æä¸šåŠ¡è¶‹åŠ¿
- âŒ `query_data` - é€šç”¨æ•°æ®æŸ¥è¯¢
- âŒ `execute_decomposed_query` - æ‰§è¡Œåˆ†è§£åçš„å¤æ‚æŸ¥è¯¢

**åŸå› **: è¿™äº›å·¥å…·åŠŸèƒ½é‡å¤,ç»Ÿä¸€ä½¿ç”¨`any_query`å·¥å…·å³å¯å®Œæˆæ‰€æœ‰æŸ¥è¯¢éœ€æ±‚

**ä¼˜åŠ¿**:
- âœ… å‡å°‘å·¥å…·æ•°é‡,é™ä½AIé€‰æ‹©å¤æ‚åº¦
- âœ… ç»Ÿä¸€æŸ¥è¯¢æ¥å£,ç®€åŒ–ç»´æŠ¤
- âœ… `any_query`æ”¯æŒä»»æ„è‡ªç„¶è¯­è¨€æŸ¥è¯¢,æ›´çµæ´»

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-10-11 01:20:00
**æ–‡æ¡£çŠ¶æ€**: âœ… å®Œæˆ

