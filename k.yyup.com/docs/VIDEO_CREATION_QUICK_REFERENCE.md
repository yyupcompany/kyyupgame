# 视频创作功能快速参考

## 🎬 7步视频创作流程

```
步骤1: 创意输入 → 步骤2: 脚本生成 → 步骤3: 配音合成 → 步骤4: 分镜生成 
→ 步骤5: 视频剪辑 → 步骤6: 预览调整 → 步骤7: 导出发布
```

---

## 📋 步骤详情

### 步骤1: 创意输入 💡

**输入**：
- 视频主题（必填）
- 发布平台（必填）：抖音/快手/视频号/小红书
- 视频类型（必填）：招生宣传/活动展示/课程介绍/园所风采
- 视频时长：短视频(15-30秒)/中视频(30-60秒)/长视频(1-3分钟)
- 关键要点（选填）

**输出**：项目ID

**操作**：
- 点击"开始创作"进入步骤2
- 点击"编辑创意"修改信息

---

### 步骤2: 脚本生成 📝

**输入**：步骤1的创意信息

**输出**：
- 视频标题
- 视频简介
- 场景列表（每个场景包含）：
  - 场景标题
  - 画面描述
  - 旁白文案
  - 字幕文本
  - 镜头角度
  - 镜头运动
  - 转场效果
  - 时长

**操作**：
- 点击"查看脚本"查看详情
- 点击"重新生成脚本"重新生成
- 自动进入步骤3

---

### 步骤3: 配音合成 🎤

**输入**：
- 脚本数据
- 配音风格（可选择）

**输出**：
- 配音列表（每个场景一个音频）：
  - 场景编号
  - 旁白文案
  - 音频URL
  - 音频时长

**操作**：
- 选择配音风格
- 点击"试听"预览音色
- 点击"生成配音"开始生成
- 点击播放按钮播放配音
- 点击"查看配音列表"查看所有配音
- 点击"重新生成配音"重新生成
- 点击"确认配音，继续下一步"进入步骤4

---

### 步骤4: 分镜生成 🎬

**输入**：
- 脚本数据（场景描述）

**输出**：
- 场景视频列表：
  - 场景编号
  - 场景标题
  - 视频URL

**操作**：
- 点击"生成分镜视频"开始生成
- 观看生成的场景视频
- 点击"重新生成分镜"重新生成
- 点击"确认分镜，继续"进入步骤5

---

### 步骤5: 视频剪辑 ✂️

**输入**：
- 场景视频列表
- 配音数据

**输出**：
- 最终合成视频URL

**处理流程**：
1. 合并所有场景视频
2. 添加配音音轨
3. 视频转码优化

**操作**：
- 点击"开始剪辑合成"开始合成
- 预览合成后的视频
- 点击"确认视频，继续"进入步骤6

---

### 步骤6: 预览调整 👁️

**输入**：最终视频URL

**输出**：确认的视频

**操作**：
- 预览最终视频
- 点击"重新生成"返回重新制作
- 点击"确认无误，继续"进入步骤7

---

### 步骤7: 导出发布 🚀

**输入**：最终视频URL

**操作**：
- 点击"下载视频"下载到本地
- 点击"发布到平台"发布视频（开发中）
- 点击"保存项目"保存项目
- 点击"创建新视频"开始新的创作

---

## 🔄 项目恢复机制

### 自动恢复条件
- 刷新页面时自动检查未完成项目
- 根据项目状态恢复到对应步骤

### 恢复状态映射

| 项目状态 | 恢复步骤 | 恢复数据 |
|---------|---------|---------|
| DRAFT（脚本完成） | 步骤2 | 主题信息 + 脚本数据 |
| DRAFT（配音完成） | 步骤3 | 主题信息 + 脚本数据 + 配音数据 |
| GENERATING_SCRIPT | 步骤2 | 主题信息 + 继续轮询 |
| GENERATING_AUDIO | 步骤3 | 主题信息 + 脚本数据 + 继续轮询 |
| GENERATING_VIDEO | 步骤4 | 主题信息 + 脚本数据 + 配音数据 + 继续轮询 |
| EDITING | 步骤5 | 主题信息 + 脚本数据 + 配音数据 + 分镜数据 + 继续轮询 |
| COMPLETED | 步骤7 | 所有数据 |

---

## 🔧 重新生成功能

### 重新生成脚本
- **触发位置**：步骤2完成后
- **清除数据**：脚本 + 配音 + 分镜 + 最终视频
- **保留数据**：主题信息
- **重置步骤**：步骤2

### 重新生成配音
- **触发位置**：步骤3完成后
- **清除数据**：配音 + 分镜 + 最终视频
- **保留数据**：主题信息 + 脚本
- **重置步骤**：步骤3

### 重新生成分镜
- **触发位置**：步骤4完成后
- **清除数据**：分镜 + 最终视频
- **保留数据**：主题信息 + 脚本 + 配音
- **重置步骤**：步骤4

---

## 📊 数据流转

```
步骤1: formData
  ↓
步骤2: formData → scriptData
  ↓
步骤3: scriptData → audioData[]
  ↓
步骤4: scriptData → sceneVideos[]
  ↓
步骤5: sceneVideos[] + audioData[] → finalVideoUrl
  ↓
步骤6: finalVideoUrl → 确认
  ↓
步骤7: finalVideoUrl → 下载/发布
```

---

## 🎯 关键字段说明

### formData（表单数据）
```typescript
{
  topic: string          // 视频主题
  platform: string       // 发布平台
  videoType: string      // 视频类型
  duration: string       // 视频时长
  keyPoints: string      // 关键要点
  voiceStyle: string     // 配音风格
}
```

### scriptData（脚本数据）
```typescript
{
  title: string                // 视频标题
  description: string          // 视频简介
  totalDuration: number        // 总时长（秒）
  scenes: Scene[]              // 场景列表
  visualStyle: string          // 视觉风格
  hashtags: string[]           // 话题标签
  callToAction: string         // 行动号召
}
```

### Scene（场景数据）
```typescript
{
  sceneTitle: string           // 场景标题
  visualDescription: string    // 画面描述
  narration: string            // 旁白文案
  subtitle: string             // 字幕文本
  cameraAngle: string          // 镜头角度
  cameraMovement: string       // 镜头运动
  transition: string           // 转场效果
  duration: number             // 时长（秒）
  emotionalTone: string        // 情感基调
  keyVisualElements: string[]  // 关键视觉元素
}
```

### audioData（配音数据）
```typescript
[
  {
    sceneNumber: number        // 场景编号
    narration: string          // 旁白文案
    audioUrl: string           // 音频URL
    duration: number           // 时长（秒）
  }
]
```

### sceneVideos（分镜数据）
```typescript
[
  {
    sceneIndex: number         // 场景索引
    sceneTitle: string         // 场景标题
    videoUrl: string           // 视频URL
  }
]
```

---

## 🐛 常见问题

### Q1: 提示"请填写完整信息"
**原因**：主题、平台、类型未填写  
**解决**：填写所有必填字段

### Q2: 提示"prompt参数不能为空"
**原因**：场景描述字段读取错误  
**解决**：已修复，确保使用最新代码

### Q3: 配音列表消失
**原因**：点击下一步后无法查看  
**解决**：点击"查看配音列表"按钮

### Q4: 视频没有配音
**原因**：音频数据传递错误  
**解决**：已修复，确保使用最新代码

### Q5: 项目恢复失败
**原因**：变量名错误  
**解决**：已修复，确保使用最新代码

---

## 📞 技术支持

如遇到问题，请检查：
1. 浏览器控制台错误信息
2. 后端服务日志
3. 网络请求状态
4. 数据格式是否正确

---

## 🔗 相关文档

- [完整测试指南](./VIDEO_CREATION_TIMELINE_TEST_GUIDE.md)
- [API文档](http://localhost:3000/api-docs)
- [项目README](../README.md)

