# 🎮 儿童脑力训练游戏系统 - 开发索引

## 📚 一、核心设计文档

### 1. 游戏大纲
**文件路径**: `docs/家长端游戏大厅/游戏大纲.md`

**内容**:
- 9个游戏的基本设计
- 游戏矩阵（3维度 × 3性别偏好）
  - 专注力：公主花园、太空寻宝、动物观察员
  - 记忆力：公主记忆、恐龙记忆、水果序列
  - 逻辑思维：娃娃屋、机器人工厂、颜色分类
- 每个游戏的玩法简介
- AI资源需求
- 开发优先级

### 2. 详细需求文档（⭐ 核心文档，1590行）
**文件路径**: `docs/家长端游戏大厅/详细需求文档.md`

**内容**:
- **目录结构规范** - uploads/games/ 完整结构
- **数据库设计** - 6张表的详细定义
- **UI/UX设计规范** - 每个元素的设计标准
  - 顶部栏（返回、暂停、设置、生命值、得分、计时）
  - 侧边栏（任务目标、奖励预览）
  - 底部工具栏（音效、音乐、提示、重来、下一关）
  - 暂停菜单、结果界面
- **动画系统** - 所有动画的详细定义
  - UI动画（按钮、面板、进度条）
  - 游戏内动画（物品、角色、特效）
  - 粒子系统（星星、烟花、光晕）
- **音频系统** - 三层混音架构
  - BGM（背景音乐）
  - Voice（语音提示）
  - SFX（音效）
- **具体游戏设计** - 公主花园、太空寻宝、机器人工厂详细设计
- **AI资源清单** - 500+张图片、200+条语音的详细列表
- **技术实现规范** - 技术栈、性能优化、响应式设计
- **开发里程碑** - 8-10周完整开发计划
- **质量标准** - 精品级验收标准

---

## 💾 二、后端代码

### 数据库（server/src/）

#### 迁移文件
- `migrations/20250131000003-create-game-system-tables.ts`
  - game_configs（游戏配置表）
  - game_levels（关卡表）
  - game_records（游戏记录表）
  - game_achievements（成就表）
  - user_achievements（用户成就表）
  - game_user_settings（用户设置表）

#### 种子数据
- `seeders/20250131000001-seed-game-data.ts`
  - 水果记忆大师游戏配置
  - 10个关卡（难度递增）
  - 3个成就

### 数据模型（server/src/models/）
- `game-config.model.ts` - 游戏配置模型
- `game-level.model.ts` - 关卡模型
- `game-record.model.ts` - 游戏记录模型
- `game-achievement.model.ts` - 成就模型
- `user-achievement.model.ts` - 用户成就模型
- `game-user-settings.model.ts` - 用户设置模型

### 服务层（server/src/services/）
- `games/game.service.ts` - 游戏服务
  - getGameList() - 获取游戏列表
  - getGameLevels() - 获取关卡列表
  - saveGameRecord() - 保存游戏记录
  - checkLevelUnlocked() - 检查关卡解锁
  - calculateStars() - 计算星级
  - checkAndUnlockAchievements() - 检查成就
  - getLeaderboard() - 获取排行榜
  - getUserSettings() - 获取用户设置

### 控制器（server/src/controllers/）
- `game.controller.ts` - 游戏控制器
  - 8个API接口

### 路由（server/src/routes/）
- `game.routes.ts` - 游戏路由
  - GET /api/games/list
  - GET /api/games/:gameKey
  - GET /api/games/:gameKey/levels
  - POST /api/games/record
  - GET /api/games/settings/user
  - PUT /api/games/settings/user
  - GET /api/games/statistics/user
  - GET /api/games/:gameKey/leaderboard

### AI资源生成脚本（server/src/scripts/）
- `generate-game-images.ts` - 批量生成游戏图片
- `test-generate-one-game-image.ts` - 测试单张图片生成
- `generate-game-voices.ts` - 批量生成游戏语音
- `regenerate-all-fruits-transparent.ts` - 重新生成透明水果图片

---

## 🎨 三、前端代码

### API封装（client/src/api/）
- `games.ts` - 游戏API封装
  - 所有游戏相关的API调用

### 页面组件（client/src/pages/parent-center/games/）
```
games/
├── index.vue                      # 游戏大厅（主页面）
├── components/
│   └── GameCard.vue              # 游戏卡片组件
├── play/
│   └── FruitSequence.vue         # 水果记忆大师游戏
└── utils/
    └── audioManager.ts           # 音频管理器（三层混音）
```

### 路由配置（client/src/router/）
- `parent-center-routes.ts` - 已添加游戏路由
  - /parent-center/games (游戏大厅)
  - /parent-center/games/play/fruit-sequence (水果记忆)

---

## 📁 四、资源文件

### 图片资源（uploads/games/images/）
```
games/images/
└── items/
    └── fruits/                    # 12张水果图片
        ├── apple.png             # 苹果（354K）
        ├── banana.png            # 香蕉（504K）
        ├── strawberry.png        # 草莓（405K）
        ├── grape.png             # 葡萄（452K）
        ├── orange.png            # 橙子（438K）
        ├── watermelon.png        # 西瓜（419K）
        ├── cherry.png            # 樱桃（443K）
        ├── pineapple.png         # 菠萝（506K）
        ├── peach.png             # 桃子（283K）
        ├── lemon.png             # 柠檬（352K）
        ├── kiwi.png              # 猕猴桃（428K）
        └── mango.png             # 芒果（457K）
```

**特性**:
- 格式：PNG，透明背景
- 尺寸：1024 × 1024
- 风格：3D卡通，统一视觉
- 质量：高清，无水印
- 总大小：5.0M

### 音频资源（uploads/games/audio/）
```
games/audio/
└── voices/                        # 23条游戏语音
    ├── game-start-1.mp3          # 游戏开始
    ├── game-start-2.mp3
    ├── game-start-3.mp3
    ├── encourage-1.mp3           # 鼓励语音（5条）
    ├── encourage-2.mp3
    ├── ...
    ├── hint-1.mp3                # 提示语音（3条）
    ├── hint-2.mp3
    ├── hint-3.mp3
    ├── complete-1.mp3            # 完成语音（3条）
    ├── complete-2.mp3
    ├── complete-3.mp3
    ├── fruit-demo-start.mp3      # 水果游戏专属（6条）
    ├── your-turn.mp3
    ├── try-again.mp3
    ├── level-complete.mp3
    ├── gameover.mp3
    ├── perfect-round.mp3
    ├── achievement-unlock.mp3    # 成就语音（3条）
    ├── star-earned.mp3
    └── level-up.mp3
```

**特性**:
- 格式：MP3
- 音色：温柔女声（zh_female_cancan_mars_bigtts）
- 语速：1.0（正常）
- 音质：HTTP TTS（稳定无杂音）
- 总大小：1.3M

---

## 📊 五、开发进度

### ✅ 已完成功能（Phase 1）

#### 游戏系统框架
- [x] 数据库表设计和迁移（6张表）
- [x] 数据模型创建（6个模型）
- [x] 后端服务层（GameService）
- [x] 后端控制器和路由（8个API）
- [x] 前端API封装（games.ts）
- [x] 游戏大厅页面（index.vue）
- [x] 游戏卡片组件（GameCard.vue）
- [x] 音频管理器（AudioManager）
- [x] 路由配置（前后端）

#### 第一个游戏（水果记忆大师）
- [x] 游戏组件开发（FruitSequence.vue）
- [x] 游戏逻辑实现（序列生成、玩家输入、星级计算）
- [x] UI界面（顶部栏、底部工具栏、设置面板、结果弹窗）
- [x] 动画系统（高亮、反馈、粒子）
- [x] 音频集成（BGM、语音、音效）
- [x] 数据保存（游戏记录、成就检查）

#### AI资源生成
- [x] 12张水果图片（透明PNG，留白边框策略）
- [x] 23条游戏语音（温柔女声）
- [x] 图片生成脚本（generate-game-images.ts）
- [x] 语音生成脚本（generate-game-voices.ts）

### ⏭️ 待开发功能（Phase 2-4）

#### Phase 2 - 扩展游戏（6个）
- [ ] 🌸 公主花园找不同（专注力 - 女孩）
- [ ] 🚀 太空寻宝（专注力 - 男孩）
- [ ] 🦁 动物观察员（专注力 - 中性）
- [ ] 💎 公主记忆宝盒（记忆力 - 女孩）
- [ ] 🦖 恐龙记忆挑战（记忆力 - 男孩）
- [ ] 🎨 颜色分类达人（逻辑 - 中性）

#### Phase 3 - 逻辑游戏（2个）
- [ ] 🏠 娃娃屋整理大师（逻辑 - 女孩）
- [ ] 🤖 机器人工厂（逻辑 - 男孩，3D）

#### Phase 4 - 系统完善
- [ ] 成就系统前端UI
- [ ] 成长追踪页面（能力雷达图）
- [ ] 排行榜页面
- [ ] 家长陪玩模式
- [ ] AI难度自适应
- [ ] 更多音效和背景音乐

---

## 🔍 六、快速查找

### 查看文档
```bash
# 游戏大纲
cat /home/zhgue/localhost:5173/docs/家长端游戏大厅/游戏大纲.md

# 详细需求（1590行）
cat /home/zhgue/localhost:5173/docs/家长端游戏大厅/详细需求文档.md

# 查看本索引
cat /home/zhgue/localhost:5173/docs/家长端游戏大厅/开发索引.md
```

### 查看代码
```bash
# 后端游戏服务
cat /home/zhgue/localhost:5173/server/src/services/games/game.service.ts

# 前端游戏组件
cat /home/zhgue/localhost:5173/client/src/pages/parent-center/games/play/FruitSequence.vue

# 音频管理器
cat /home/zhgue/localhost:5173/client/src/pages/parent-center/games/utils/audioManager.ts
```

### 查看资源
```bash
# 水果图片
ls -lh /home/zhgue/localhost:5173/uploads/games/images/items/fruits/

# 游戏语音
ls -lh /home/zhgue/localhost:5173/uploads/games/audio/voices/

# 查看某张图片
file /home/zhgue/localhost:5173/uploads/games/images/items/fruits/apple.png
```

### 数据库查询
```bash
# 查看游戏配置
cd /home/zhgue/localhost:5173/server && npx ts-node -e "
import { sequelize } from './src/init';
(async () => {
  await sequelize.authenticate();
  const [games] = await sequelize.query('SELECT * FROM game_configs');
  console.log(games);
  await sequelize.close();
})();
"

# 查看关卡
cd /home/zhgue/localhost:5173/server && npx ts-node -e "
import { sequelize } from './src/init';
(async () => {
  await sequelize.authenticate();
  const [levels] = await sequelize.query('SELECT * FROM game_levels');
  console.log(levels);
  await sequelize.close();
})();
"
```

---

## 📈 七、开发统计

### 代码统计
- **后端文件**: 14个
  - 迁移：1个
  - 种子数据：1个
  - 模型：6个
  - 服务：1个
  - 控制器：1个
  - 路由：1个
  - 脚本：3个

- **前端文件**: 5个
  - API：1个
  - 页面：1个
  - 组件：2个
  - 工具：1个

- **文档**: 3个
  - 游戏大纲
  - 详细需求
  - 开发索引

### 资源统计
- **图片**: 12张（透明PNG，5.0M）
- **语音**: 23条（MP3，1.3M）

### 数据库记录
- **游戏**: 1个（水果记忆大师）
- **关卡**: 10个
- **成就**: 3个

---

## 🎯 八、游戏系统架构

### 后端架构
```
┌─────────────────────────────────────────────┐
│  游戏路由（game.routes.ts）                  │
│  GET /api/games/list                        │
│  POST /api/games/record                     │
│  ...                                        │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│  游戏控制器（game.controller.ts）            │
│  请求验证、数据转换、响应封装                │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│  游戏服务（game.service.ts）                 │
│  核心业务逻辑：                              │
│  - 关卡解锁逻辑                              │
│  - 星级计算                                  │
│  - 成就检查                                  │
│  - 数据统计                                  │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│  数据模型（6个Model）                        │
│  GameConfig, GameLevel, GameRecord,         │
│  GameAchievement, UserAchievement,          │
│  GameUserSettings                           │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│  MySQL数据库（6张表）                        │
└─────────────────────────────────────────────┘
```

### 前端架构
```
┌─────────────────────────────────────────────┐
│  游戏大厅（games/index.vue）                 │
│  - 游戏列表展示                              │
│  - 分类筛选（专注力、记忆力、逻辑）          │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│  游戏卡片（GameCard.vue）                    │
│  - 游戏信息展示                              │
│  - 用户进度显示                              │
│  - 点击进入游戏                              │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│  具体游戏（FruitSequence.vue）               │
│  - 游戏逻辑                                  │
│  - UI界面                                    │
│  - 动画效果                                  │
│  - 音频控制                                  │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│  音频管理器（audioManager.ts）               │
│  - BGM控制（循环、淡入淡出）                 │
│  - 语音队列                                  │
│  - 音效播放                                  │
└──────────────┬──────────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────────┐
│  API服务（games.ts）                         │
│  - 调用后端API                               │
│  - 数据转换                                  │
└─────────────────────────────────────────────┘
```

---

## 🎮 九、水果记忆大师游戏详情

### 文件位置
**前端组件**: `client/src/pages/parent-center/games/play/FruitSequence.vue`

### 游戏特性
- **玩法**: Simon Says序列记忆
- **关卡**: 10关（难度递增）
- **水果**: 12种（透明PNG图片）
- **序列长度**: 3 → 12（随关卡递增）
- **水果数量**: 3 → 9（随关卡递增）
- **生命值**: 3条
- **星级**: 0-3星（根据失误次数）

### UI组件
- **顶部栏**: 返回、暂停、设置、生命值、得分、关卡
- **游戏区**: 水果网格（响应式布局）
- **状态提示**: 演示阶段、玩家输入、成功、失败
- **底部工具栏**: 音乐、音效、重来
- **设置面板**: 三层音量控制
- **结果弹窗**: 星级展示、得分、操作按钮

### 动画效果
- **水果高亮**: 缩放1.3倍 + 发光光晕 + 投影
- **正确反馈**: 绿色光晕 + 弹跳动画
- **错误反馈**: 红色光晕 + 震动动画
- **演示播放**: 依次高亮（0.8秒/个）
- **星星获得**: 弹出 + 旋转 + 闪光

### 音频系统
- **BGM**: 背景音乐循环（淡入淡出）
- **语音**: 23条语音提示（自动排队播放）
- **音效**: 点击、正确、错误、完成
- **混音**: 语音播放时自动降低BGM音量

### 游戏逻辑
1. 初始化：3种水果，序列长度3
2. 演示阶段：水果依次高亮
3. 玩家输入：按序列点击水果
4. 验证答案：正确/错误反馈
5. 关卡完成：进入下一关（水果+1，序列+1）
6. 失败条件：生命值归零
7. 记录保存：得分、星级、成就

---

## 🔗 十、相关链接

### 访问路径（前端）
- 游戏大厅: `http://localhost:5173/parent-center/games`
- 水果记忆: `http://localhost:5173/parent-center/games/play/fruit-sequence`

### API端点（后端）
- 游戏列表: `GET http://localhost:3000/api/games/list`
- 游戏详情: `GET http://localhost:3000/api/games/:gameKey`
- 保存记录: `POST http://localhost:3000/api/games/record`

---

## 📝 十一、开发说明

### 图片生成策略（留白边框）
1. **AI生成阶段**: 提示词加入"图片四周留白10%边距，主体居中"
2. **裁剪阶段**: Sharp裁剪5%边框（去除AI边缘瑕疵）
3. **优化阶段**: 转PNG、透明背景、压缩

### 音频生成策略
- 使用稳定的HTTP TTS（非WebSocket）
- 温柔女声（zh_female_cancan_mars_bigtts）
- 正常语速1.0（避免变音）
- 每批10条，间隔5秒

### 游戏开发规范
- **性能**: 60fps稳定帧率
- **响应**: 点击反馈<50ms
- **动画**: 每个元素都有动画
- **音频**: 三层独立控制
- **质量**: 精品级，非草稿

---

## ✅ 总结

**当前状态**: ✅ 第一个精品游戏已完整开发

**包含内容**:
- ✅ 完整的游戏系统框架
- ✅ 数据库和后端API
- ✅ 前端组件和UI
- ✅ 音频系统（三层混音）
- ✅ 动画系统
- ✅ AI资源生成脚本
- ✅ 12张水果图片 + 23条语音

**可以立即测试游戏！** 🎮

**后续扩展**: 按需求文档开发剩余8个游戏

