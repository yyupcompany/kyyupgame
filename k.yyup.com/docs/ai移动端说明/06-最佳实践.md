# ğŸ† å¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿ - æœ€ä½³å®è·µ

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æ±‡æ€»äº†å¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿå¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²å’Œç»´æŠ¤è¿‡ç¨‹ä¸­çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©å¼€å‘å›¢é˜Ÿæé«˜æ•ˆç‡ã€ä¿è¯è´¨é‡ã€ä¼˜åŒ–æ€§èƒ½ã€‚

### ğŸ¯ æœ€ä½³å®è·µç›®æ ‡
- âœ… æé«˜å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡
- âœ… ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§
- âœ… ä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½è¡¨ç°
- âœ… å»ºç«‹æ ‡å‡†åŒ–å¼€å‘æµç¨‹
- âœ… æå‡å›¢é˜Ÿåä½œæ•ˆç‡

## ğŸ—ï¸ æ¶æ„è®¾è®¡æœ€ä½³å®è·µ

### 1. æ¨¡å—åŒ–è®¾è®¡åŸåˆ™

```typescript
// âœ… å¥½çš„æ¨¡å—åŒ–è®¾è®¡
// æŒ‰ä¸šåŠ¡é¢†åŸŸåˆ’åˆ†æ¨¡å—
src/
â”œâ”€â”€ modules/
â”‚   â”œâ”€â”€ auth/              # è®¤è¯æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”œâ”€â”€ student/           # å­¦ç”Ÿç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â””â”€â”€ types/
â”‚   â””â”€â”€ ai/               # AIåŠŸèƒ½æ¨¡å—
â”‚       â”œâ”€â”€ components/
â”‚       â”œâ”€â”€ services/
â”‚       â”œâ”€â”€ stores/
â”‚       â””â”€â”€ types/

// âŒ é¿å…çš„è®¾è®¡
// æŒ‰æŠ€æœ¯ç±»å‹åˆ’åˆ†ï¼ˆå¯¼è‡´æ¨¡å—è€¦åˆï¼‰
src/
â”œâ”€â”€ components/           # æ‰€æœ‰ç»„ä»¶æ··åœ¨ä¸€èµ·
â”œâ”€â”€ services/            # æ‰€æœ‰æœåŠ¡æ··åœ¨ä¸€èµ·
â””â”€â”€ types/              # æ‰€æœ‰ç±»å‹æ··åœ¨ä¸€èµ·
```

### 2. ç»„ä»¶è®¾è®¡åŸåˆ™

```vue
<!-- âœ… å¥½çš„ç»„ä»¶è®¾è®¡ -->
<template>
  <div class="student-card" :class="cardClass">
    <!-- å•ä¸€èŒè´£ï¼šåªè´Ÿè´£å±•ç¤ºå­¦ç”Ÿä¿¡æ¯ -->
    <div class="student-card__avatar">
      <img :src="student.avatar || defaultAvatar" :alt="student.name">
    </div>
    
    <div class="student-card__content">
      <h3 class="student-card__name">{{ student.name }}</h3>
      <p class="student-card__class">{{ student.className }}</p>
      <p class="student-card__age">{{ calculateAge(student.birthday) }}å²</p>
    </div>
    
    <div class="student-card__actions">
      <slot name="actions" :student="student" />
    </div>
  </div>
</template>

<script setup lang="ts">
interface Props {
  student: Student
  size?: 'small' | 'medium' | 'large'
  interactive?: boolean
}

interface Emits {
  click: [student: Student]
  edit: [student: Student]
}

const props = withDefaults(defineProps<Props>(), {
  size: 'medium',
  interactive: true
})

const emit = defineEmits<Emits>()

// è®¡ç®—å±æ€§ï¼šçº¯å‡½æ•°ï¼Œæ˜“äºæµ‹è¯•
const cardClass = computed(() => [
  `student-card--${props.size}`,
  {
    'student-card--interactive': props.interactive
  }
])

// å·¥å…·å‡½æ•°ï¼šæå–åˆ°utilsä¸­å¤ç”¨
const calculateAge = (birthday: string): number => {
  return dayjs().diff(dayjs(birthday), 'year')
}
</script>
```

### 3. çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ

```typescript
// âœ… å¥½çš„çŠ¶æ€ç®¡ç†è®¾è®¡
// stores/student.store.ts
export const useStudentStore = defineStore('student', () => {
  // çŠ¶æ€ï¼šä½¿ç”¨refå’Œreactive
  const students = ref<Student[]>([])
  const currentStudent = ref<Student | null>(null)
  const loading = ref(false)
  const error = ref<string | null>(null)

  // è®¡ç®—å±æ€§ï¼šæ´¾ç”ŸçŠ¶æ€
  const activeStudents = computed(() => 
    students.value.filter(student => student.status === 'enrolled')
  )
  
  const studentsByClass = computed(() => 
    students.value.reduce((acc, student) => {
      const className = student.className || 'æœªåˆ†ç­'
      acc[className] = acc[className] || []
      acc[className].push(student)
      return acc
    }, {} as Record<string, Student[]>)
  )

  // åŠ¨ä½œï¼šä¸šåŠ¡é€»è¾‘
  const fetchStudents = async (params?: SearchParams) => {
    loading.value = true
    error.value = null
    
    try {
      const response = await studentService.getList(params)
      students.value = response.list
    } catch (err) {
      error.value = err instanceof Error ? err.message : 'è·å–å­¦ç”Ÿåˆ—è¡¨å¤±è´¥'
      throw err
    } finally {
      loading.value = false
    }
  }

  const createStudent = async (studentData: CreateStudentDTO) => {
    loading.value = true
    
    try {
      const newStudent = await studentService.create(studentData)
      students.value.unshift(newStudent) // æ·»åŠ åˆ°åˆ—è¡¨å¼€å¤´
      return newStudent
    } catch (err) {
      error.value = err instanceof Error ? err.message : 'åˆ›å»ºå­¦ç”Ÿå¤±è´¥'
      throw err
    } finally {
      loading.value = false
    }
  }

  const updateStudent = async (id: string, updates: UpdateStudentDTO) => {
    const index = students.value.findIndex(s => s.id === id)
    if (index === -1) throw new Error('å­¦ç”Ÿä¸å­˜åœ¨')

    try {
      const updatedStudent = await studentService.update(id, updates)
      students.value[index] = updatedStudent
      
      // å¦‚æœæ˜¯å½“å‰é€‰ä¸­çš„å­¦ç”Ÿï¼ŒåŒæ­¥æ›´æ–°
      if (currentStudent.value?.id === id) {
        currentStudent.value = updatedStudent
      }
      
      return updatedStudent
    } catch (err) {
      error.value = err instanceof Error ? err.message : 'æ›´æ–°å­¦ç”Ÿå¤±è´¥'
      throw err
    }
  }

  // æ¸…ç†å‡½æ•°
  const clearError = () => {
    error.value = null
  }

  const reset = () => {
    students.value = []
    currentStudent.value = null
    loading.value = false
    error.value = null
  }

  return {
    // çŠ¶æ€
    students: readonly(students),
    currentStudent: readonly(currentStudent),
    loading: readonly(loading),
    error: readonly(error),
    
    // è®¡ç®—å±æ€§
    activeStudents,
    studentsByClass,
    
    // åŠ¨ä½œ
    fetchStudents,
    createStudent,
    updateStudent,
    clearError,
    reset
  }
})
```

## ğŸ’» å¼€å‘æœ€ä½³å®è·µ

### 1. TypeScriptä½¿ç”¨è§„èŒƒ

```typescript
// âœ… å¥½çš„ç±»å‹å®šä¹‰
// ä½¿ç”¨æ¥å£æè¿°æ•°æ®ç»“æ„
interface Student {
  readonly id: string
  name: string
  gender: 'male' | 'female'
  birthday: string
  classId?: string
  parentId?: string
  status: StudentStatus
  createdAt: string
  updatedAt: string
}

// ä½¿ç”¨è”åˆç±»å‹å®šä¹‰æšä¸¾
type StudentStatus = 'enrolled' | 'graduated' | 'transferred' | 'suspended'

// ä½¿ç”¨æ³›å‹æé«˜å¤ç”¨æ€§
interface ApiResponse<TData> {
  code: number
  message: string
  data: TData
  success: boolean
  timestamp?: string
}

// ä½¿ç”¨å·¥å…·ç±»å‹
type CreateStudentDTO = Omit<Student, 'id' | 'createdAt' | 'updatedAt'>
type UpdateStudentDTO = Partial<Pick<Student, 'name' | 'classId' | 'status'>>

// âŒ é¿å…çš„åšæ³•
// è¿‡åº¦ä½¿ç”¨any
const data: any = fetchStudentData() // å¤±å»ç±»å‹å®‰å…¨

// ä¸å¿…è¦çš„ç±»å‹æ–­è¨€
const student = data as Student // å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯

// è¿‡äºå¤æ‚çš„ç±»å‹
type ComplexType<T, U, V> = T extends U ? V extends string ? T : U : never
```

### 2. ç»„åˆå¼APIæœ€ä½³å®è·µ

```typescript
// âœ… å¥½çš„ç»„åˆå¼å‡½æ•°è®¾è®¡
// composables/useStudentForm.ts
export const useStudentForm = (initialData?: Partial<Student>) => {
  // å“åº”å¼çŠ¶æ€
  const formData = reactive<CreateStudentDTO>({
    name: '',
    gender: 'male',
    birthday: '',
    classId: '',
    parentId: '',
    status: 'enrolled',
    ...initialData
  })

  const formRef = ref<FormInstance>()
  const loading = ref(false)
  const errors = ref<Record<string, string>>({})

  // éªŒè¯è§„åˆ™
  const rules = computed((): FormRules => ({
    name: [
      { required: true, message: 'è¯·è¾“å…¥å­¦ç”Ÿå§“å', trigger: 'blur' },
      { min: 2, max: 20, message: 'å§“åé•¿åº¦ä¸º2-20ä¸ªå­—ç¬¦', trigger: 'blur' }
    ],
    gender: [
      { required: true, message: 'è¯·é€‰æ‹©æ€§åˆ«', trigger: 'change' }
    ],
    birthday: [
      { required: true, message: 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ', trigger: 'change' },
      { 
        validator: (rule, value, callback) => {
          const age = dayjs().diff(dayjs(value), 'year')
          if (age < 2 || age > 6) {
            callback(new Error('å­¦ç”Ÿå¹´é¾„åº”åœ¨2-6å²ä¹‹é—´'))
          } else {
            callback()
          }
        }, 
        trigger: 'change' 
      }
    ]
  }))

  // éªŒè¯è¡¨å•
  const validate = async (): Promise<boolean> => {
    if (!formRef.value) return false
    
    try {
      await formRef.value.validate()
      return true
    } catch {
      return false
    }
  }

  // é‡ç½®è¡¨å•
  const reset = () => {
    if (formRef.value) {
      formRef.value.resetFields()
    }
    errors.value = {}
  }

  // æäº¤è¡¨å•
  const submit = async (onSuccess?: (student: Student) => void) => {
    const isValid = await validate()
    if (!isValid) return false

    loading.value = true
    
    try {
      const studentStore = useStudentStore()
      const newStudent = await studentStore.createStudent(formData)
      
      reset()
      onSuccess?.(newStudent)
      
      return true
    } catch (error) {
      // å¤„ç†æœåŠ¡å™¨éªŒè¯é”™è¯¯
      if (error instanceof Error && error.message.includes('validation')) {
        // è§£æéªŒè¯é”™è¯¯å¹¶æ˜¾ç¤º
        // errors.value = parseValidationError(error)
      }
      return false
    } finally {
      loading.value = false
    }
  }

  return {
    // çŠ¶æ€
    formData,
    formRef,
    loading: readonly(loading),
    errors: readonly(errors),
    
    // è®¡ç®—å±æ€§
    rules,
    
    // æ–¹æ³•
    validate,
    reset,
    submit
  }
}
```

### 3. é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

```typescript
// âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†ç­–ç•¥
// composables/useErrorHandler.ts
export const useErrorHandler = () => {
  const handleAsyncError = async <T>(
    asyncFn: () => Promise<T>,
    options: {
      showError?: boolean
      errorMessage?: string
      onError?: (error: Error) => void
      onFinally?: () => void
    } = {}
  ): Promise<T | null> => {
    const { 
      showError = true, 
      errorMessage = 'æ“ä½œå¤±è´¥',
      onError,
      onFinally
    } = options

    try {
      return await asyncFn()
    } catch (error) {
      console.error('Async operation failed:', error)
      
      const errorMsg = error instanceof Error ? error.message : errorMessage
      
      if (showError) {
        ElMessage.error(errorMsg)
      }
      
      onError?.(error instanceof Error ? error : new Error(errorMsg))
      
      return null
    } finally {
      onFinally?.()
    }
  }

  const withLoading = <T>(
    asyncFn: () => Promise<T>,
    loadingRef: Ref<boolean>
  ): Promise<T | null> => {
    return handleAsyncError(
      asyncFn,
      {
        onFinally: () => {
          loadingRef.value = false
        }
      }
    )
  }

  return {
    handleAsyncError,
    withLoading
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const { handleAsyncError } = useErrorHandler()

const deleteStudent = async (id: string) => {
  const result = await handleAsyncError(
    () => studentService.delete(id),
    {
      errorMessage: 'åˆ é™¤å­¦ç”Ÿå¤±è´¥',
      onError: (error) => {
        // è‡ªå®šä¹‰é”™è¯¯å¤„ç†
        console.error('Delete student error:', error)
      }
    }
  )
  
  if (result !== null) {
    ElMessage.success('åˆ é™¤æˆåŠŸ')
    await refreshStudentList()
  }
}
```

## ğŸ¨ æ ·å¼å’ŒUIæœ€ä½³å®è·µ

### 1. CSSç»„ç»‡ç»“æ„

```scss
// âœ… å¥½çš„æ ·å¼ç»„ç»‡
// styles/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ reset.scss          # CSSé‡ç½®
â”‚   â”œâ”€â”€ typography.scss     # å­—ä½“æ’ç‰ˆ
â”‚   â””â”€â”€ variables.scss      # å˜é‡å®šä¹‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ buttons.scss        # æŒ‰é’®æ ·å¼
â”‚   â”œâ”€â”€ forms.scss         # è¡¨å•æ ·å¼
â”‚   â””â”€â”€ cards.scss         # å¡ç‰‡æ ·å¼
â”œâ”€â”€ layout/
â”‚   â”œâ”€â”€ header.scss        # å¤´éƒ¨æ ·å¼
â”‚   â”œâ”€â”€ sidebar.scss       # ä¾§è¾¹æ æ ·å¼
â”‚   â””â”€â”€ main.scss          # ä¸»ä½“å¸ƒå±€
â”œâ”€â”€ themes/
â”‚   â”œâ”€â”€ light.scss         # æµ…è‰²ä¸»é¢˜
â”‚   â””â”€â”€ dark.scss          # æ·±è‰²ä¸»é¢˜
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ mixins.scss        # æ··å…¥å‡½æ•°
â”‚   â””â”€â”€ helpers.scss       # å·¥å…·ç±»
â””â”€â”€ index.scss             # å…¥å£æ–‡ä»¶
```

### 2. å“åº”å¼è®¾è®¡è§„èŒƒ

```scss
// âœ… å¥½çš„å“åº”å¼è®¾è®¡
.student-card {
  padding: 16px;
  border-radius: 8px;
  background: var(--color-bg-primary);
  box-shadow: var(--shadow-base);
  
  // ç§»åŠ¨ç«¯ä¼˜å…ˆ
  @media (min-width: 768px) {
    padding: 24px;
    border-radius: 12px;
  }
  
  @media (min-width: 1024px) {
    padding: 32px;
  }
  
  // äº¤äº’çŠ¶æ€
  @media (hover: hover) and (pointer: fine) {
    &:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }
  }
  
  // è§¦æ‘¸è®¾å¤‡ä¼˜åŒ–
  @media (pointer: coarse) {
    min-height: 44px; // ç¡®ä¿è§¦æ‘¸ç›®æ ‡è¶³å¤Ÿå¤§
    
    &:active {
      transform: scale(0.98);
    }
  }
  
  // é«˜å¯¹æ¯”åº¦æ”¯æŒ
  @media (prefers-contrast: high) {
    border: 2px solid var(--color-border-base);
  }
  
  // åŠ¨ç”»åå¥½è®¾ç½®
  @media (prefers-reduced-motion: no-preference) {
    transition: all 0.2s ease;
  }
}
```

### 3. CSSå˜é‡å’Œä¸»é¢˜ç³»ç»Ÿ

```scss
// âœ… ç³»ç»ŸåŒ–çš„è®¾è®¡ä»¤ç‰Œ
:root {
  // é¢œè‰²ç³»ç»Ÿ - è¯­ä¹‰åŒ–å‘½å
  --color-primary-50: #eff6ff;
  --color-primary-100: #dbeafe;
  --color-primary-500: #3b82f6;
  --color-primary-600: #2563eb;
  --color-primary-700: #1d4ed8;
  
  // åŠŸèƒ½æ€§é¢œè‰²
  --color-success: #10b981;
  --color-warning: #f59e0b;
  --color-error: #ef4444;
  --color-info: #6b7280;
  
  // æ–‡æœ¬é¢œè‰² - è¯­ä¹‰åŒ–å±‚æ¬¡
  --color-text-primary: #111827;
  --color-text-secondary: #6b7280;
  --color-text-tertiary: #9ca3af;
  --color-text-quaternary: #d1d5db;
  
  // é—´è·ç³»ç»Ÿ - 8pxåŸºç¡€ç½‘æ ¼
  --space-1: 0.25rem; /* 4px */
  --space-2: 0.5rem;  /* 8px */
  --space-3: 0.75rem; /* 12px */
  --space-4: 1rem;    /* 16px */
  --space-5: 1.25rem; /* 20px */
  --space-6: 1.5rem;  /* 24px */
  --space-8: 2rem;    /* 32px */
  --space-10: 2.5rem; /* 40px */
  
  // å­—ä½“ç³»ç»Ÿ
  --font-size-xs: 0.75rem;   /* 12px */
  --font-size-sm: 0.875rem;  /* 14px */
  --font-size-base: 1rem;    /* 16px */
  --font-size-lg: 1.125rem;  /* 18px */
  --font-size-xl: 1.25rem;   /* 20px */
  --font-size-2xl: 1.5rem;   /* 24px */
  
  // è¡Œé«˜ç³»ç»Ÿ
  --line-height-tight: 1.25;
  --line-height-normal: 1.5;
  --line-height-relaxed: 1.75;
  
  // é˜´å½±ç³»ç»Ÿ
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-base: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
  
  // è¿‡æ¸¡ç³»ç»Ÿ
  --transition-fast: 150ms ease;
  --transition-base: 250ms ease;
  --transition-slow: 350ms ease;
}

// æš—è‰²ä¸»é¢˜
[data-theme='dark'] {
  --color-text-primary: #f9fafb;
  --color-text-secondary: #d1d5db;
  --color-text-tertiary: #9ca3af;
  --color-text-quaternary: #6b7280;
  
  --color-bg-primary: #111827;
  --color-bg-secondary: #1f2937;
  --color-bg-tertiary: #374151;
}
```

## ğŸ“± ç§»åŠ¨ç«¯æœ€ä½³å®è·µ

### 1. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

```typescript
// âœ… å›¾ç‰‡æ‡’åŠ è½½å’Œä¼˜åŒ–
// composables/useLazyImage.ts
export const useLazyImage = () => {
  const loadImage = (src: string): Promise<HTMLImageElement> => {
    return new Promise((resolve, reject) => {
      const img = new Image()
      img.onload = () => resolve(img)
      img.onerror = reject
      img.src = src
    })
  }

  const optimizeImageUrl = (
    url: string,
    options: {
      width?: number
      height?: number
      quality?: number
      format?: 'webp' | 'jpeg'
    } = {}
  ): string => {
    if (!url) return ''
    
    const { width, height, quality = 80, format = 'webp' } = options
    const params = new URLSearchParams()
    
    if (width) params.set('w', width.toString())
    if (height) params.set('h', height.toString())
    if (quality) params.set('q', quality.toString())
    if (format) params.set('f', format)
    
    const separator = url.includes('?') ? '&' : '?'
    return params.toString() ? `${url}${separator}${params}` : url
  }

  return {
    loadImage,
    optimizeImageUrl
  }
}

// ä½¿ç”¨Intersection Observerå®ç°æ‡’åŠ è½½
export const useLazyLoading = (callback: () => void) => {
  const targetRef = ref<HTMLElement>()
  const isVisible = ref(false)

  onMounted(() => {
    if (!targetRef.value) return

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            isVisible.value = true
            callback()
            observer.unobserve(entry.target)
          }
        })
      },
      {
        rootMargin: '100px', // æå‰100pxå¼€å§‹åŠ è½½
        threshold: 0.1
      }
    )

    observer.observe(targetRef.value)

    onUnmounted(() => {
      observer.disconnect()
    })
  })

  return {
    targetRef,
    isVisible
  }
}
```

### 2. è§¦æ‘¸äº¤äº’ä¼˜åŒ–

```vue
<!-- âœ… ç§»åŠ¨ç«¯å‹å¥½çš„ç»„ä»¶ -->
<template>
  <div 
    class="touch-card"
    :class="touchClass"
    @touchstart="handleTouchStart"
    @touchmove="handleTouchMove"
    @touchend="handleTouchEnd"
    @touchcancel="handleTouchCancel"
  >
    <div class="touch-card__content">
      <slot />
    </div>
    
    <!-- è§¦æ‘¸åé¦ˆæŒ‡ç¤ºå™¨ -->
    <div 
      v-if="showRipple" 
      class="touch-card__ripple"
      :style="rippleStyle"
    ></div>
  </div>
</template>

<script setup lang="ts">
interface TouchState {
  startX: number
  startY: number
  currentX: number
  currentY: number
  startTime: number
  isTouch: boolean
}

const touchState = reactive<TouchState>({
  startX: 0,
  startY: 0,
  currentX: 0,
  currentY: 0,
  startTime: 0,
  isTouch: false
})

const showRipple = ref(false)
const rippleStyle = ref({})

const emit = defineEmits<{
  tap: [event: TouchEvent]
  longPress: [event: TouchEvent]
  swipe: [direction: 'left' | 'right' | 'up' | 'down', event: TouchEvent]
}>()

const touchClass = computed(() => ({
  'touch-card--touching': touchState.isTouch
}))

const handleTouchStart = (event: TouchEvent) => {
  const touch = event.touches[0]
  
  touchState.startX = touch.clientX
  touchState.startY = touch.clientY
  touchState.currentX = touch.clientX
  touchState.currentY = touch.clientY
  touchState.startTime = Date.now()
  touchState.isTouch = true

  // åˆ›å»ºæ³¢çº¹æ•ˆæœ
  const rect = (event.currentTarget as HTMLElement).getBoundingClientRect()
  const x = touch.clientX - rect.left
  const y = touch.clientY - rect.top
  
  showRipple.value = true
  rippleStyle.value = {
    left: x + 'px',
    top: y + 'px'
  }

  // é•¿æŒ‰æ£€æµ‹
  setTimeout(() => {
    if (touchState.isTouch && Date.now() - touchState.startTime >= 500) {
      emit('longPress', event)
      // è§¦è§‰åé¦ˆï¼ˆå¦‚æœæ”¯æŒï¼‰
      if ('vibrate' in navigator) {
        navigator.vibrate(50)
      }
    }
  }, 500)
}

const handleTouchMove = (event: TouchEvent) => {
  if (!touchState.isTouch) return

  const touch = event.touches[0]
  touchState.currentX = touch.clientX
  touchState.currentY = touch.clientY
}

const handleTouchEnd = (event: TouchEvent) => {
  if (!touchState.isTouch) return

  const deltaX = touchState.currentX - touchState.startX
  const deltaY = touchState.currentY - touchState.startY
  const deltaTime = Date.now() - touchState.startTime
  const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY)

  // åˆ¤æ–­æ˜¯å¦ä¸ºç‚¹å‡»
  if (distance < 10 && deltaTime < 500) {
    emit('tap', event)
  }
  // åˆ¤æ–­æ˜¯å¦ä¸ºæ»‘åŠ¨
  else if (distance > 30) {
    const absDeltaX = Math.abs(deltaX)
    const absDeltaY = Math.abs(deltaY)
    
    if (absDeltaX > absDeltaY) {
      emit('swipe', deltaX > 0 ? 'right' : 'left', event)
    } else {
      emit('swipe', deltaY > 0 ? 'down' : 'up', event)
    }
  }

  touchState.isTouch = false
  
  // å»¶è¿Ÿç§»é™¤æ³¢çº¹æ•ˆæœ
  setTimeout(() => {
    showRipple.value = false
  }, 300)
}

const handleTouchCancel = () => {
  touchState.isTouch = false
  showRipple.value = false
}
</script>

<style lang="scss" scoped>
.touch-card {
  position: relative;
  overflow: hidden;
  border-radius: 8px;
  background: white;
  cursor: pointer;
  user-select: none;
  transition: var(--transition-fast);
  
  &--touching {
    transform: scale(0.98);
    opacity: 0.8;
  }
  
  &__ripple {
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.1);
    transform: translate(-50%, -50%) scale(0);
    animation: ripple 0.6s ease-out;
  }
}

@keyframes ripple {
  to {
    transform: translate(-50%, -50%) scale(4);
    opacity: 0;
  }
}
</style>
```

### 3. PWAæ”¯æŒ

```typescript
// âœ… PWAé…ç½®å’ŒæœåŠ¡å·¥ä½œè€…
// vite.config.ts
import { VitePWA } from 'vite-plugin-pwa'

export default defineConfig({
  plugins: [
    VitePWA({
      registerType: 'autoUpdate',
      workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg,woff2}'],
        runtimeCaching: [
          {
            urlPattern: /^https:\/\/api\./,
            handler: 'NetworkFirst',
            options: {
              cacheName: 'api-cache',
              cacheableResponse: {
                statuses: [0, 200]
              },
              networkTimeoutSeconds: 10
            }
          },
          {
            urlPattern: /\.(?:png|jpg|jpeg|svg|gif|webp)$/,
            handler: 'CacheFirst',
            options: {
              cacheName: 'images-cache',
              expiration: {
                maxEntries: 100,
                maxAgeSeconds: 30 * 24 * 60 * 60 // 30 days
              }
            }
          }
        ]
      },
      manifest: {
        name: 'å¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿ',
        short_name: 'å¹¼å„¿å›­ç®¡ç†',
        description: 'ä¸“ä¸šçš„å¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿç§»åŠ¨ç«¯åº”ç”¨',
        theme_color: '#1890ff',
        background_color: '#ffffff',
        display: 'standalone',
        orientation: 'portrait-primary',
        scope: '/',
        start_url: '/',
        icons: [
          {
            src: '/icons/icon-72x72.png',
            sizes: '72x72',
            type: 'image/png'
          },
          {
            src: '/icons/icon-96x96.png',
            sizes: '96x96',
            type: 'image/png'
          },
          {
            src: '/icons/icon-128x128.png',
            sizes: '128x128',
            type: 'image/png'
          },
          {
            src: '/icons/icon-144x144.png',
            sizes: '144x144',
            type: 'image/png'
          },
          {
            src: '/icons/icon-152x152.png',
            sizes: '152x152',
            type: 'image/png'
          },
          {
            src: '/icons/icon-192x192.png',
            sizes: '192x192',
            type: 'image/png'
          },
          {
            src: '/icons/icon-384x384.png',
            sizes: '384x384',
            type: 'image/png'
          },
          {
            src: '/icons/icon-512x512.png',
            sizes: '512x512',
            type: 'image/png'
          }
        ]
      }
    })
  ]
})

// åº”ç”¨æ›´æ–°æç¤º
// composables/usePWA.ts
export const usePWA = () => {
  const updateAvailable = ref(false)
  const registration = ref<ServiceWorkerRegistration>()

  const checkForUpdates = async () => {
    if ('serviceWorker' in navigator) {
      try {
        const reg = await navigator.serviceWorker.register('/sw.js')
        registration.value = reg

        reg.addEventListener('updatefound', () => {
          const newWorker = reg.installing
          if (newWorker) {
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                updateAvailable.value = true
              }
            })
          }
        })
      } catch (error) {
        console.error('Service worker registration failed:', error)
      }
    }
  }

  const updateApp = async () => {
    if (registration.value) {
      registration.value.waiting?.postMessage({ type: 'SKIP_WAITING' })
      window.location.reload()
    }
  }

  onMounted(() => {
    checkForUpdates()
  })

  return {
    updateAvailable,
    updateApp
  }
}
```

## ğŸ§ª æµ‹è¯•æœ€ä½³å®è·µ

### 1. å•å…ƒæµ‹è¯•è§„èŒƒ

```typescript
// âœ… å¥½çš„å•å…ƒæµ‹è¯•
// tests/unit/components/StudentCard.test.ts
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { mount, VueWrapper } from '@vue/test-utils'
import { createTestingPinia } from '@pinia/testing'
import StudentCard from '@/components/StudentCard.vue'
import type { Student } from '@/types/student'

describe('StudentCard', () => {
  let wrapper: VueWrapper<any>
  
  const mockStudent: Student = {
    id: '1',
    name: 'å¼ å°æ˜',
    gender: 'male',
    birthday: '2018-05-15',
    classId: 'class-1',
    className: 'å¤§ç­Aç»„',
    status: 'enrolled',
    createdAt: '2023-01-01T00:00:00Z',
    updatedAt: '2023-01-01T00:00:00Z'
  }

  beforeEach(() => {
    wrapper = mount(StudentCard, {
      props: {
        student: mockStudent
      },
      global: {
        plugins: [createTestingPinia({ createSpy: vi.fn })]
      }
    })
  })

  describe('æ¸²æŸ“æµ‹è¯•', () => {
    it('åº”è¯¥æ­£ç¡®æ˜¾ç¤ºå­¦ç”ŸåŸºæœ¬ä¿¡æ¯', () => {
      expect(wrapper.find('.student-card__name').text()).toBe('å¼ å°æ˜')
      expect(wrapper.find('.student-card__class').text()).toBe('å¤§ç­Aç»„')
    })

    it('åº”è¯¥æ ¹æ®ç”Ÿæ—¥è®¡ç®—å¹¶æ˜¾ç¤ºå¹´é¾„', () => {
      const ageText = wrapper.find('.student-card__age').text()
      expect(ageText).toMatch(/\d+å²/)
    })

    it('åº”è¯¥æ ¹æ®æ€§åˆ«æ˜¾ç¤ºæ­£ç¡®çš„å¤´åƒ', () => {
      const avatar = wrapper.find('.student-card__avatar img')
      expect(avatar.attributes('alt')).toBe('å¼ å°æ˜')
    })
  })

  describe('äº¤äº’æµ‹è¯•', () => {
    it('ç‚¹å‡»å¡ç‰‡åº”è¯¥è§¦å‘clickäº‹ä»¶', async () => {
      await wrapper.trigger('click')
      expect(wrapper.emitted('click')).toBeTruthy()
      expect(wrapper.emitted('click')?.[0]).toEqual([mockStudent])
    })

    it('åœ¨éäº¤äº’æ¨¡å¼ä¸‹ä¸åº”è¯¥å“åº”ç‚¹å‡»', async () => {
      await wrapper.setProps({ interactive: false })
      await wrapper.trigger('click')
      expect(wrapper.emitted('click')).toBeFalsy()
    })
  })

  describe('æ ·å¼æµ‹è¯•', () => {
    it('åº”è¯¥æ ¹æ®size propåº”ç”¨æ­£ç¡®çš„æ ·å¼ç±»', async () => {
      await wrapper.setProps({ size: 'large' })
      expect(wrapper.classes()).toContain('student-card--large')
    })

    it('åœ¨äº¤äº’æ¨¡å¼ä¸‹åº”è¯¥æœ‰interactiveæ ·å¼ç±»', () => {
      expect(wrapper.classes()).toContain('student-card--interactive')
    })
  })

  describe('è¾¹ç•Œæƒ…å†µæµ‹è¯•', () => {
    it('åº”è¯¥å¤„ç†ç¼ºå¤±çš„å¯é€‰å­—æ®µ', async () => {
      const studentWithoutClass = { ...mockStudent, classId: undefined, className: undefined }
      await wrapper.setProps({ student: studentWithoutClass })
      
      expect(wrapper.find('.student-card__class').text()).toBe('æœªåˆ†ç­')
    })

    it('åº”è¯¥å¤„ç†æ— æ•ˆçš„ç”Ÿæ—¥æ ¼å¼', async () => {
      const studentWithInvalidBirthday = { ...mockStudent, birthday: 'invalid-date' }
      await wrapper.setProps({ student: studentWithInvalidBirthday })
      
      // åº”è¯¥æ˜¾ç¤ºé»˜è®¤å€¼æˆ–é”™è¯¯å¤„ç†
      expect(wrapper.find('.student-card__age').text()).toBe('æœªçŸ¥')
    })
  })
})
```

### 2. E2Eæµ‹è¯•è§„èŒƒ

```typescript
// âœ… å¥½çš„E2Eæµ‹è¯•
// tests/e2e/student-management.spec.ts
import { test, expect, Page } from '@playwright/test'

class StudentManagementPage {
  constructor(private page: Page) {}

  // é¡µé¢å¯¹è±¡æ¨¡å¼
  get addButton() { return this.page.locator('[data-testid="add-student-btn"]') }
  get searchInput() { return this.page.locator('[data-testid="search-input"]') }
  get studentList() { return this.page.locator('[data-testid="student-list"]') }
  get studentCard() { return this.page.locator('[data-testid="student-card"]') }

  async navigateTo() {
    await this.page.goto('/students')
    await this.page.waitForLoadState('networkidle')
  }

  async searchStudent(name: string) {
    await this.searchInput.fill(name)
    await this.page.keyboard.press('Enter')
    await this.page.waitForResponse('/api/students*')
  }

  async addStudent(studentData: {
    name: string
    gender: 'male' | 'female'
    birthday: string
    className?: string
  }) {
    await this.addButton.click()
    
    const dialog = this.page.locator('[data-testid="student-form-dialog"]')
    await expect(dialog).toBeVisible()

    await this.page.fill('[data-testid="name-input"]', studentData.name)
    await this.page.selectOption('[data-testid="gender-select"]', studentData.gender)
    await this.page.fill('[data-testid="birthday-input"]', studentData.birthday)
    
    if (studentData.className) {
      await this.page.selectOption('[data-testid="class-select"]', studentData.className)
    }

    await this.page.click('[data-testid="submit-btn"]')
    await this.page.waitForResponse('/api/students', { status: 201 })
  }
}

test.describe('å­¦ç”Ÿç®¡ç†', () => {
  let studentPage: StudentManagementPage

  test.beforeEach(async ({ page }) => {
    studentPage = new StudentManagementPage(page)
    
    // ç™»å½•
    await page.goto('/login')
    await page.fill('[data-testid="username"]', 'admin')
    await page.fill('[data-testid="password"]', 'admin123')
    await page.click('[data-testid="login-btn"]')
    await page.waitForURL('/dashboard')
  })

  test('åº”è¯¥èƒ½å¤ŸæŸ¥çœ‹å­¦ç”Ÿåˆ—è¡¨', async () => {
    await studentPage.navigateTo()
    
    await expect(studentPage.studentList).toBeVisible()
    await expect(studentPage.studentCard.first()).toBeVisible()
    
    // éªŒè¯åˆ—è¡¨é¡¹åŒ…å«å¿…è¦ä¿¡æ¯
    const firstCard = studentPage.studentCard.first()
    await expect(firstCard.locator('.student-name')).not.toBeEmpty()
    await expect(firstCard.locator('.student-class')).toBeVisible()
  })

  test('åº”è¯¥èƒ½å¤Ÿæœç´¢å­¦ç”Ÿ', async () => {
    await studentPage.navigateTo()
    
    const originalCount = await studentPage.studentCard.count()
    await studentPage.searchStudent('å¼ ')
    
    const filteredCount = await studentPage.studentCard.count()
    expect(filteredCount).toBeLessThanOrEqual(originalCount)
    
    // éªŒè¯æœç´¢ç»“æœåŒ…å«æœç´¢å…³é”®è¯
    const studentNames = await studentPage.studentCard
      .locator('.student-name')
      .allTextContents()
    
    studentNames.forEach(name => {
      expect(name).toContain('å¼ ')
    })
  })

  test('åº”è¯¥èƒ½å¤Ÿæ·»åŠ æ–°å­¦ç”Ÿ', async () => {
    await studentPage.navigateTo()
    
    const originalCount = await studentPage.studentCard.count()
    
    await studentPage.addStudent({
      name: 'æµ‹è¯•å­¦ç”Ÿ',
      gender: 'male',
      birthday: '2019-01-01',
      className: 'å¤§ç­Aç»„'
    })

    // éªŒè¯æˆåŠŸæ¶ˆæ¯
    await expect(page.locator('.el-message--success')).toBeVisible()
    
    // éªŒè¯åˆ—è¡¨æ›´æ–°
    await expect(studentPage.studentCard).toHaveCount(originalCount + 1)
    
    // éªŒè¯æ–°å­¦ç”Ÿå‡ºç°åœ¨åˆ—è¡¨ä¸­
    await expect(studentPage.studentCard.locator('text=æµ‹è¯•å­¦ç”Ÿ')).toBeVisible()
  })

  test('ç§»åŠ¨ç«¯å“åº”å¼æµ‹è¯•', async ({ page }) => {
    // åˆ‡æ¢åˆ°ç§»åŠ¨ç«¯è§†çª—
    await page.setViewportSize({ width: 375, height: 667 })
    
    await studentPage.navigateTo()
    
    // éªŒè¯ç§»åŠ¨ç«¯å¸ƒå±€
    await expect(studentPage.studentList).toBeVisible()
    
    // éªŒè¯å¡ç‰‡åœ¨ç§»åŠ¨ç«¯çš„æ˜¾ç¤º
    const card = studentPage.studentCard.first()
    const cardBox = await card.boundingBox()
    expect(cardBox?.width).toBeLessThan(400) // é€‚åº”å°å±å¹•
    
    // éªŒè¯è§¦æ‘¸äº¤äº’
    await card.tap()
    // æ ¹æ®å®é™…äº¤äº’éªŒè¯ç»“æœ
  })

  test('ç¦»çº¿æ¨¡å¼æµ‹è¯•', async ({ page, context }) => {
    await studentPage.navigateTo()
    
    // æ¨¡æ‹Ÿç¦»çº¿çŠ¶æ€
    await context.setOffline(true)
    
    // å°è¯•æœç´¢ï¼ˆåº”è¯¥æ˜¾ç¤ºç¦»çº¿æç¤ºï¼‰
    await studentPage.searchStudent('test')
    
    // éªŒè¯ç¦»çº¿æç¤º
    await expect(page.locator('[data-testid="offline-notice"]')).toBeVisible()
    
    // æ¢å¤åœ¨çº¿çŠ¶æ€
    await context.setOffline(false)
    
    // éªŒè¯åŠŸèƒ½æ¢å¤
    await expect(page.locator('[data-testid="offline-notice"]')).not.toBeVisible()
  })
})
```

## ğŸš€ éƒ¨ç½²æœ€ä½³å®è·µ

### 1. æ„å»ºä¼˜åŒ–é…ç½®

```typescript
// âœ… ç”Ÿäº§ç¯å¢ƒæ„å»ºé…ç½®
// vite.config.prod.ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'
import { visualizer } from 'rollup-plugin-visualizer'
import { compression } from 'vite-plugin-compression'

export default defineConfig({
  plugins: [
    vue(),
    // Gzipå‹ç¼©
    compression({
      algorithm: 'gzip',
      threshold: 10240, // 10KBä»¥ä¸Šçš„æ–‡ä»¶æ‰å‹ç¼©
      deleteOriginFile: false
    }),
    // Brotliå‹ç¼©
    compression({
      algorithm: 'brotliCompress',
      ext: '.br',
      threshold: 10240,
      deleteOriginFile: false
    }),
    // æ„å»ºåˆ†æ
    visualizer({
      filename: 'dist/report.html',
      open: false,
      gzipSize: true,
      brotliSize: true
    })
  ],

  build: {
    target: 'es2015',
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false, // ç”Ÿäº§ç¯å¢ƒä¸ç”Ÿæˆsourcemap
    minify: 'terser',
    
    terserOptions: {
      compress: {
        drop_console: true, // ç§»é™¤console
        drop_debugger: true, // ç§»é™¤debugger
        pure_funcs: ['console.log'] // ç§»é™¤ç‰¹å®šå‡½æ•°è°ƒç”¨
      }
    },

    rollupOptions: {
      output: {
        // æ‰‹åŠ¨åˆ†åŒ…
        manualChunks: {
          // Vueç”Ÿæ€
          'vue-vendor': ['vue', 'vue-router', 'pinia'],
          
          // UIåº“
          'ui-vendor': ['element-plus', '@element-plus/icons-vue'],
          
          // å·¥å…·åº“
          'utils-vendor': ['axios', 'dayjs', 'lodash-es'],
          
          // å›¾è¡¨åº“
          'chart-vendor': ['echarts'],
          
          // AIç›¸å…³ï¼ˆå¤§å‹åŠŸèƒ½å•ç‹¬åˆ†åŒ…ï¼‰
          'ai-feature': [
            './src/pages/ai/AIAssistantPage.vue',
            './src/pages/ai/ChatInterface.vue',
            './src/components/ai'
          ]
        },
        
        // æ–‡ä»¶å‘½å
        chunkFileNames: (chunkInfo) => {
          const facadeModuleId = chunkInfo.facadeModuleId
          if (facadeModuleId) {
            return 'js/[name]-[hash].js'
          }
          return 'js/chunk-[hash].js'
        },
        entryFileNames: 'js/[name]-[hash].js',
        assetFileNames: (assetInfo) => {
          const info = assetInfo.name.split('.')
          const ext = info[info.length - 1]
          
          if (['png', 'jpg', 'jpeg', 'gif', 'svg', 'webp'].includes(ext)) {
            return `images/[name]-[hash].[ext]`
          }
          if (['woff', 'woff2', 'ttf', 'eot'].includes(ext)) {
            return `fonts/[name]-[hash].[ext]`
          }
          if (ext === 'css') {
            return `css/[name]-[hash].[ext]`
          }
          return `assets/[name]-[hash].[ext]`
        }
      }
    },

    // æ„å»ºæ€§èƒ½ä¼˜åŒ–
    chunkSizeWarningLimit: 1000, // 1MBè­¦å‘Šé˜ˆå€¼
    
    // é¢„åŠ è½½
    rollupOptions: {
      ...rollupOptions,
      external: [], // å¤–éƒ¨ä¾èµ–
    }
  },

  // é¢„æ„å»ºä¼˜åŒ–
  optimizeDeps: {
    include: [
      'vue',
      'vue-router', 
      'pinia',
      'element-plus',
      'axios'
    ],
    exclude: ['@vueuse/core'] // å¤§å‹ä¾èµ–å»¶è¿ŸåŠ è½½
  }
})
```

### 2. CI/CDæµæ°´çº¿

```yaml
# âœ… GitHub Actionså·¥ä½œæµ
# .github/workflows/deploy.yml
name: éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  NODE_VERSION: '18'
  REGISTRY: ghcr.io
  IMAGE_NAME: kindergarten-system

jobs:
  # ä»£ç è´¨é‡æ£€æŸ¥
  quality-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: è®¾ç½®Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
      
      - name: å®‰è£…ä¾èµ–
        run: |
          npm ci
          cd client && npm ci
          cd ../server && npm ci
      
      - name: ä»£ç æ ¼å¼æ£€æŸ¥
        run: |
          npm run lint
          npm run typecheck
      
      - name: å•å…ƒæµ‹è¯•
        run: npm run test:unit
        
      - name: æµ‹è¯•è¦†ç›–ç‡
        run: npm run test:coverage
      
      - name: ä¸Šä¼ è¦†ç›–ç‡æŠ¥å‘Š
        uses: codecov/codecov-action@v3
        with:
          files: ./coverage/coverage-final.json

  # E2Eæµ‹è¯•
  e2e-test:
    runs-on: ubuntu-latest
    needs: quality-check
    
    services:
      mysql:
        image: mysql:8.0
        env:
          MYSQL_ROOT_PASSWORD: test123
          MYSQL_DATABASE: kindergarten_test
        ports:
          - 3306:3306
        options: >-
          --health-cmd="mysqladmin ping"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=3

    steps:
      - uses: actions/checkout@v3
      
      - name: è®¾ç½®Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
      
      - name: å®‰è£…ä¾èµ–
        run: |
          npm ci
          cd client && npm ci
          cd ../server && npm ci
      
      - name: å®‰è£…Playwright
        run: cd client && npx playwright install --with-deps
      
      - name: å¯åŠ¨æœåŠ¡
        run: |
          cd server && npm run db:migrate
          npm run dev &
          sleep 10
        env:
          NODE_ENV: test
          DB_HOST: localhost
          DB_PASSWORD: test123
          DB_NAME: kindergarten_test
      
      - name: è¿è¡ŒE2Eæµ‹è¯•
        run: cd client && npm run test:e2e
      
      - name: ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
        uses: actions/upload-artifact@v3
        if: always()
        with:
          name: playwright-report
          path: client/playwright-report/

  # æ„å»ºå’Œéƒ¨ç½²
  build-and-deploy:
    runs-on: ubuntu-latest
    needs: [quality-check, e2e-test]
    if: github.ref == 'refs/heads/main'
    
    steps:
      - uses: actions/checkout@v3
      
      - name: è®¾ç½®Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
      
      - name: å®‰è£…ä¾èµ–
        run: |
          npm ci
          cd client && npm ci
          cd ../server && npm ci
      
      - name: æ„å»ºå‰ç«¯
        run: cd client && npm run build:prod
        env:
          VITE_API_BASE_URL: ${{ secrets.API_BASE_URL }}
          VITE_APP_VERSION: ${{ github.sha }}
      
      - name: æ„å»ºåç«¯
        run: cd server && npm run build
      
      - name: ç™»å½•åˆ°å®¹å™¨ä»“åº“
        uses: docker/login-action@v2
        with:
          registry: ${{ env.REGISTRY }}
          username: ${{ github.actor }}
          password: ${{ secrets.GITHUB_TOKEN }}
      
      - name: æ„å»ºDockeré•œåƒ
        run: |
          docker build -t ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest .
          docker build -t ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }} .
      
      - name: æ¨é€Dockeré•œåƒ
        run: |
          docker push ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:latest
          docker push ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}:${{ github.sha }}
      
      - name: éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
        uses: appleboy/ssh-action@v0.1.5
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.PRIVATE_KEY }}
          script: |
            cd /opt/kindergarten-system
            docker-compose pull
            docker-compose up -d
            docker image prune -f

  # å¥åº·æ£€æŸ¥
  health-check:
    runs-on: ubuntu-latest
    needs: build-and-deploy
    steps:
      - name: ç­‰å¾…æœåŠ¡å¯åŠ¨
        run: sleep 60
      
      - name: å¥åº·æ£€æŸ¥
        run: |
          curl -f ${{ secrets.APP_URL }}/api/health || exit 1
          curl -f ${{ secrets.APP_URL }} || exit 1
      
      - name: é€šçŸ¥éƒ¨ç½²ç»“æœ
        uses: 8398a7/action-slack@v3
        with:
          status: ${{ job.status }}
          channel: '#deployments'
          webhook_url: ${{ secrets.SLACK_WEBHOOK }}
        if: always()
```

### 3. ç”Ÿäº§ç¯å¢ƒç›‘æ§

```typescript
// âœ… åº”ç”¨ç›‘æ§é…ç½®
// utils/monitoring.ts
interface MonitoringConfig {
  enableErrorTracking: boolean
  enablePerformanceTracking: boolean
  sampleRate: number
  environment: string
}

class ApplicationMonitor {
  private config: MonitoringConfig

  constructor(config: MonitoringConfig) {
    this.config = config
    this.initializeMonitoring()
  }

  private initializeMonitoring() {
    // é”™è¯¯ç›‘æ§
    if (this.config.enableErrorTracking) {
      this.setupErrorTracking()
    }

    // æ€§èƒ½ç›‘æ§
    if (this.config.enablePerformanceTracking) {
      this.setupPerformanceTracking()
    }

    // ç”¨æˆ·è¡Œä¸ºç›‘æ§
    this.setupUserBehaviorTracking()
  }

  private setupErrorTracking() {
    // å…¨å±€é”™è¯¯å¤„ç†
    window.addEventListener('error', (event) => {
      this.reportError({
        type: 'javascript',
        message: event.message,
        filename: event.filename,
        lineno: event.lineno,
        colno: event.colno,
        stack: event.error?.stack,
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        url: window.location.href
      })
    })

    // Promiseé”™è¯¯å¤„ç†
    window.addEventListener('unhandledrejection', (event) => {
      this.reportError({
        type: 'promise',
        message: event.reason?.message || 'Unhandled Promise Rejection',
        stack: event.reason?.stack,
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        url: window.location.href
      })
    })

    // Vueé”™è¯¯å¤„ç†
    app.config.errorHandler = (err, vm, info) => {
      this.reportError({
        type: 'vue',
        message: err.message,
        stack: err.stack,
        componentInfo: info,
        timestamp: new Date().toISOString(),
        userAgent: navigator.userAgent,
        url: window.location.href
      })
    }
  }

  private setupPerformanceTracking() {
    // é¡µé¢åŠ è½½æ€§èƒ½
    window.addEventListener('load', () => {
      setTimeout(() => {
        const perfData = performance.getEntriesByType('navigation')[0] as PerformanceNavigationTiming
        
        this.reportMetric({
          type: 'performance',
          metrics: {
            loadTime: perfData.loadEventEnd - perfData.navigationStart,
            domContentLoaded: perfData.domContentLoadedEventEnd - perfData.navigationStart,
            firstPaint: this.getFirstPaint(),
            firstContentfulPaint: this.getFirstContentfulPaint(),
            largestContentfulPaint: this.getLargestContentfulPaint()
          },
          timestamp: new Date().toISOString(),
          url: window.location.href
        })
      }, 0)
    })

    // èµ„æºåŠ è½½æ€§èƒ½
    this.monitorResourcePerformance()

    // APIè¯·æ±‚æ€§èƒ½ï¼ˆåœ¨axiosæ‹¦æˆªå™¨ä¸­å®ç°ï¼‰
    this.monitorApiPerformance()
  }

  private setupUserBehaviorTracking() {
    // é¡µé¢è®¿é—®ç»Ÿè®¡
    this.trackPageView()

    // ç”¨æˆ·äº¤äº’ç»Ÿè®¡
    this.trackUserInteractions()

    // ä¼šè¯æ—¶é•¿ç»Ÿè®¡
    this.trackSessionDuration()
  }

  private reportError(error: any) {
    if (Math.random() > this.config.sampleRate) return

    // å‘é€åˆ°ç›‘æ§æœåŠ¡
    fetch('/api/monitoring/error', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        ...error,
        environment: this.config.environment,
        sessionId: this.getSessionId(),
        userId: this.getUserId()
      })
    }).catch(console.error)
  }

  private reportMetric(metric: any) {
    if (Math.random() > this.config.sampleRate) return

    fetch('/api/monitoring/metric', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        ...metric,
        environment: this.config.environment,
        sessionId: this.getSessionId(),
        userId: this.getUserId()
      })
    }).catch(console.error)
  }

  // æ€§èƒ½æŒ‡æ ‡è·å–æ–¹æ³•
  private getFirstPaint(): number | null {
    const entries = performance.getEntriesByType('paint')
    const fp = entries.find(entry => entry.name === 'first-paint')
    return fp ? fp.startTime : null
  }

  private getFirstContentfulPaint(): number | null {
    const entries = performance.getEntriesByType('paint')
    const fcp = entries.find(entry => entry.name === 'first-contentful-paint')
    return fcp ? fcp.startTime : null
  }

  private getLargestContentfulPaint(): Promise<number | null> {
    return new Promise((resolve) => {
      if ('PerformanceObserver' in window) {
        const observer = new PerformanceObserver((list) => {
          const entries = list.getEntries()
          const lastEntry = entries[entries.length - 1]
          resolve(lastEntry ? lastEntry.startTime : null)
          observer.disconnect()
        })
        observer.observe({ entryTypes: ['largest-contentful-paint'] })
        
        // 10ç§’åè¶…æ—¶
        setTimeout(() => {
          observer.disconnect()
          resolve(null)
        }, 10000)
      } else {
        resolve(null)
      }
    })
  }

  private getSessionId(): string {
    return sessionStorage.getItem('sessionId') || 'anonymous'
  }

  private getUserId(): string {
    const userStore = useUserStore()
    return userStore.userInfo?.id || 'anonymous'
  }
}

// åˆå§‹åŒ–ç›‘æ§
export const initMonitoring = () => {
  const monitor = new ApplicationMonitor({
    enableErrorTracking: true,
    enablePerformanceTracking: true,
    sampleRate: import.meta.env.PROD ? 0.1 : 1, // ç”Ÿäº§ç¯å¢ƒé‡‡æ ·10%
    environment: import.meta.env.MODE
  })
  
  return monitor
}
```

## ğŸ“‹ ä»£ç å®¡æŸ¥æœ€ä½³å®è·µ

### 1. ä»£ç å®¡æŸ¥æ¸…å•

```markdown
## âœ… ä»£ç å®¡æŸ¥æ¸…å•

### åŠŸèƒ½æ€§æ£€æŸ¥
- [ ] åŠŸèƒ½å®ç°æ˜¯å¦ç¬¦åˆéœ€æ±‚æ–‡æ¡£
- [ ] è¾¹ç•Œæ¡ä»¶å’Œé”™è¯¯æƒ…å†µæ˜¯å¦å¤„ç†
- [ ] ç”¨æˆ·è¾“å…¥æ˜¯å¦ç»è¿‡éªŒè¯
- [ ] APIè°ƒç”¨æ˜¯å¦åŒ…å«é”™è¯¯å¤„ç†

### ä»£ç è´¨é‡æ£€æŸ¥
- [ ] å˜é‡å’Œå‡½æ•°å‘½åæ˜¯å¦æ¸…æ™°æ˜ç¡®
- [ ] ä»£ç æ˜¯å¦éµå¾ªé¡¹ç›®çš„ç¼–ç è§„èŒƒ
- [ ] æ˜¯å¦å­˜åœ¨é‡å¤ä»£ç ï¼Œèƒ½å¦æŠ½å–å¤ç”¨
- [ ] å¤æ‚é€»è¾‘æ˜¯å¦æœ‰æ³¨é‡Šè¯´æ˜

### æ€§èƒ½æ£€æŸ¥
- [ ] æ˜¯å¦å­˜åœ¨ä¸å¿…è¦çš„é‡å¤è®¡ç®—
- [ ] åˆ—è¡¨æ¸²æŸ“æ˜¯å¦ä½¿ç”¨äº†key
- [ ] å¤§å‹ç»„ä»¶æ˜¯å¦å®ç°äº†æ‡’åŠ è½½
- [ ] å›¾ç‰‡å’Œèµ„æºæ˜¯å¦è¿›è¡Œäº†ä¼˜åŒ–

### å®‰å…¨æ€§æ£€æŸ¥
- [ ] ç”¨æˆ·è¾“å…¥æ˜¯å¦ç»è¿‡sanitize
- [ ] æ•æ„Ÿä¿¡æ¯æ˜¯å¦æš´éœ²åœ¨å®¢æˆ·ç«¯
- [ ] APIæƒé™æ˜¯å¦æ­£ç¡®é…ç½®
- [ ] XSSå’ŒCSRFé˜²æŠ¤æ˜¯å¦åˆ°ä½

### å¯ç»´æŠ¤æ€§æ£€æŸ¥
- [ ] ç»„ä»¶èŒè´£æ˜¯å¦å•ä¸€
- [ ] æ˜¯å¦æœ‰å……åˆ†çš„é”™è¯¯å¤„ç†
- [ ] æ˜¯å¦åŒ…å«å¿…è¦çš„å•å…ƒæµ‹è¯•
- [ ] ä»£ç æ˜¯å¦æ˜“äºç†è§£å’Œä¿®æ”¹

### ç§»åŠ¨ç«¯æ£€æŸ¥
- [ ] å“åº”å¼è®¾è®¡æ˜¯å¦æ­£ç¡®å®ç°
- [ ] è§¦æ‘¸äº¤äº’æ˜¯å¦å‹å¥½
- [ ] åœ¨å°å±å¹•è®¾å¤‡ä¸Šæ˜¯å¦æ­£å¸¸æ˜¾ç¤º
- [ ] æ˜¯å¦è€ƒè™‘äº†ç½‘ç»œä¸ç¨³å®šçš„æƒ…å†µ
```

### 2. è‡ªåŠ¨åŒ–ä»£ç æ£€æŸ¥

```json
// âœ… ESLinté…ç½®è§„åˆ™
// .eslintrc.json
{
  "extends": [
    "@vue/eslint-config-typescript",
    "@vue/eslint-config-prettier"
  ],
  "rules": {
    // Vueç›¸å…³è§„åˆ™
    "vue/component-name-in-template-casing": ["error", "PascalCase"],
    "vue/component-definition-name-casing": ["error", "PascalCase"],
    "vue/prop-name-casing": ["error", "camelCase"],
    "vue/custom-event-name-casing": ["error", "kebab-case"],
    "vue/no-unused-vars": "error",
    "vue/no-unused-components": "warn",
    
    // TypeScriptç›¸å…³è§„åˆ™
    "@typescript-eslint/no-unused-vars": ["error", { "argsIgnorePattern": "^_" }],
    "@typescript-eslint/explicit-function-return-type": "off",
    "@typescript-eslint/no-explicit-any": "warn",
    "@typescript-eslint/prefer-const": "error",
    
    // ä»£ç è´¨é‡è§„åˆ™
    "no-console": ["warn", { "allow": ["warn", "error"] }],
    "no-debugger": "error",
    "prefer-const": "error",
    "no-var": "error",
    "eqeqeq": ["error", "always"],
    "curly": ["error", "all"],
    
    // å¤æ‚åº¦æ§åˆ¶
    "complexity": ["warn", 10],
    "max-depth": ["warn", 4],
    "max-lines-per-function": ["warn", 50],
    
    // å¯¼å…¥è§„åˆ™
    "import/order": ["error", {
      "groups": [
        "builtin",
        "external", 
        "internal",
        "parent",
        "sibling",
        "index"
      ],
      "newlines-between": "always"
    }]
  }
}
```

---

## ğŸ“ æ€»ç»“

æœ¬æ–‡æ¡£æ¶µç›–äº†å¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿå¼€å‘çš„å„ä¸ªæ–¹é¢çš„æœ€ä½³å®è·µï¼š

### âœ… æ ¸å¿ƒå®è·µè¦ç‚¹

1. **æ¶æ„è®¾è®¡** - æ¨¡å—åŒ–ã€ç»„ä»¶åŒ–ã€çŠ¶æ€ç®¡ç†æœ€ä½³å®è·µ
2. **å¼€å‘è§„èŒƒ** - TypeScriptä½¿ç”¨ã€ç»„åˆå¼APIã€é”™è¯¯å¤„ç†
3. **UI/UXä¼˜åŒ–** - å“åº”å¼è®¾è®¡ã€ç§»åŠ¨ç«¯é€‚é…ã€PWAæ”¯æŒ
4. **æ€§èƒ½ä¼˜åŒ–** - æ‡’åŠ è½½ã€ç¼“å­˜ç­–ç•¥ã€æ„å»ºä¼˜åŒ–
5. **è´¨é‡ä¿è¯** - å•å…ƒæµ‹è¯•ã€E2Eæµ‹è¯•ã€ä»£ç å®¡æŸ¥
6. **éƒ¨ç½²è¿ç»´** - CI/CDæµæ°´çº¿ã€ç›‘æ§å‘Šè­¦ã€å¥åº·æ£€æŸ¥

### ğŸ¯ å…³é”®æ”¶ç›Š

1. **æé«˜å¼€å‘æ•ˆç‡** - æ ‡å‡†åŒ–æµç¨‹å’Œå·¥å…·é“¾
2. **ä¿è¯ä»£ç è´¨é‡** - è§„èŒƒçº¦æŸå’Œè‡ªåŠ¨åŒ–æ£€æŸ¥
3. **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ** - æ€§èƒ½ä¼˜åŒ–å’Œç§»åŠ¨ç«¯é€‚é…
4. **ç¡®ä¿ç³»ç»Ÿç¨³å®š** - å®Œå–„çš„æµ‹è¯•å’Œç›‘æ§ä½“ç³»
5. **ä¾¿äºå›¢é˜Ÿåä½œ** - æ¸…æ™°çš„è§„èŒƒå’Œæ–‡æ¡£

### ğŸš€ æŒç»­æ”¹è¿›

1. **å®šæœŸå›é¡¾** - æ¯æœˆå›é¡¾å’Œä¼˜åŒ–æœ€ä½³å®è·µ
2. **æŠ€æœ¯æ›´æ–°** - è·Ÿè¿›æ–°æŠ€æœ¯å’Œæœ€ä½³å®è·µ
3. **å›¢é˜Ÿåˆ†äº«** - åˆ†äº«ç»éªŒå’Œæ•™è®­
4. **å·¥å…·å‡çº§** - æŒç»­ä¼˜åŒ–å¼€å‘å·¥å…·é“¾
5. **æ€§èƒ½ç›‘æ§** - åŸºäºæ•°æ®æŒç»­ä¼˜åŒ–

é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥ç¡®ä¿å¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿå…·æœ‰é«˜è´¨é‡ã€é«˜æ€§èƒ½ã€æ˜“ç»´æŠ¤çš„ç‰¹ç‚¹ï¼Œä¸ºç”¨æˆ·æä¾›ä¼˜ç§€çš„ä½¿ç”¨ä½“éªŒã€‚

---

**æ–‡æ¡£å®Œæˆï¼** ğŸ‰

è¿™å¥—ç§»åŠ¨ç«¯å¼€å‘æ–‡æ¡£æ¶µç›–äº†ï¼š
1. **ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ** - æ•´ä½“æ¶æ„å’Œè®¾è®¡ç†å¿µ
2. **æŠ€æœ¯æ ˆè¯¦è§£** - å…·ä½“æŠ€æœ¯é€‰å‹å’Œé…ç½®
3. **å¿«é€Ÿå¼€å§‹æŒ‡å—** - ç¯å¢ƒæ­å»ºå’Œå¯åŠ¨æµç¨‹  
4. **ç»„ä»¶å¼€å‘æŒ‡å—** - ç»„ä»¶è®¾è®¡å’Œå¼€å‘è§„èŒƒ
5. **APIé›†æˆè¯´æ˜** - å‰åç«¯é›†æˆæ–¹æ¡ˆ
6. **æœ€ä½³å®è·µ** - å¼€å‘ã€æµ‹è¯•ã€éƒ¨ç½²çš„å®Œæ•´å®è·µ

å¸Œæœ›è¿™å¥—æ–‡æ¡£èƒ½å¤Ÿå¸®åŠ©å¼€å‘å›¢é˜Ÿå¿«é€Ÿä¸Šæ‰‹å’Œè§„èŒƒå¼€å‘ï¼

*æ–‡æ¡£ç‰ˆæœ¬: v1.0.0*  
*æ›´æ–°æ—¶é—´: 2025-08-10*  
*æ¶µç›–å®Œæ•´å¼€å‘ç”Ÿå‘½å‘¨æœŸ*