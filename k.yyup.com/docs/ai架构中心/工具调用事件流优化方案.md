# å·¥å…·è°ƒç”¨äº‹ä»¶æµä¼˜åŒ–æ–¹æ¡ˆ

## ğŸ“‹ ä¼˜åŒ–ç›®æ ‡

åŸºäºå¯¹å½“å‰å®ç°çš„æ·±åº¦åˆ†æï¼Œåˆ¶å®šå…·ä½“çš„ä¼˜åŒ–æ–¹æ¡ˆï¼Œæå‡å·¥å…·è°ƒç”¨çš„ç”¨æˆ·ä½“éªŒå’Œä¿¡æ¯å±•ç¤ºæ•ˆæœã€‚

## ğŸ¯ æ ¸å¿ƒé—®é¢˜åˆ†æ

### é—®é¢˜1ï¼štool_intent äº‹ä»¶æœªå……åˆ†åˆ©ç”¨ âŒ
**ç°çŠ¶**ï¼š
- åç«¯æ­£ç¡®å‘é€ `tool_intent` äº‹ä»¶ï¼ŒåŒ…å«å·¥å…·è°ƒç”¨æ„å›¾
- å‰ç«¯åªåœ¨consoleä¸­è¾“å‡ºï¼Œç”¨æˆ·çœ‹ä¸åˆ°AIçš„å·¥å…·è°ƒç”¨æ„å›¾
- æµªè´¹äº†å®è´µçš„ç”¨æˆ·ä½“éªŒæå‡æœºä¼š

**å½±å“**ï¼š
- ç”¨æˆ·ä¸çŸ¥é“AIä¸ºä»€ä¹ˆè¦è°ƒç”¨è¿™ä¸ªå·¥å…·
- ç¼ºå°‘AIæ€è€ƒè¿‡ç¨‹çš„é€æ˜åº¦
- å·¥å…·è°ƒç”¨æ˜¾å¾—çªå…€ï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡

### é—®é¢˜2ï¼šå·¥å…·ä¿¡æ¯å±•ç¤ºä¸å¤Ÿä¸°å¯Œ ğŸ“Š
**ç°çŠ¶**ï¼š
- å·¥å…·è°ƒç”¨å¡ç‰‡ä¿¡æ¯ç›¸å¯¹ç®€å•
- æ„å›¾ã€æè¿°ã€é¢„æœŸç»“æœç­‰ä¿¡æ¯æ²¡æœ‰å……åˆ†å±•ç¤º
- ç”¨æˆ·å¯¹å·¥å…·è°ƒç”¨çš„ç†è§£æœ‰é™

**å½±å“**ï¼š
- ç”¨æˆ·ä½“éªŒä¸å¤Ÿä¸°å¯Œ
- å·¥å…·è°ƒç”¨çš„ä»·å€¼æ²¡æœ‰å……åˆ†ä½“ç°
- ç¼ºå°‘æ•™è‚²æ€§å’Œé€æ˜åº¦

### é—®é¢˜3ï¼šå¤šå·¥å…·è°ƒç”¨ç¼ºå°‘æ•´ä½“è§†è§’ ğŸ”„
**ç°çŠ¶**ï¼š
- æ¯ä¸ªå·¥å…·è°ƒç”¨éƒ½æ˜¯ç‹¬ç«‹å±•ç¤º
- ç¼ºå°‘æ•´ä½“è¿›åº¦å’Œåºå·æŒ‡ç¤º
- ç”¨æˆ·ä¸çŸ¥é“æ€»å…±æœ‰å¤šå°‘å·¥å…·è¦æ‰§è¡Œ

**å½±å“**ï¼š
- ç”¨æˆ·å¯¹æ•´ä½“è¿›åº¦ç¼ºå°‘æ„ŸçŸ¥
- å¤šå·¥å…·è°ƒç”¨æ—¶ä½“éªŒæ··ä¹±
- ç¼ºå°‘å®Œæˆåº¦çš„å¿ƒç†é¢„æœŸ

## ğŸš€ ä¼˜åŒ–æ–¹æ¡ˆè®¾è®¡

### æ–¹æ¡ˆ1ï¼šå……åˆ†åˆ©ç”¨ tool_intent äº‹ä»¶ (é«˜ä¼˜å…ˆçº§)

#### 1.1 åœ¨æ€è€ƒè¿‡ç¨‹ä¸­æ˜¾ç¤ºå·¥å…·æ„å›¾
```typescript
// å‰ç«¯äº‹ä»¶å¤„ç†ä¼˜åŒ–
case 'tool_intent':
  if (event.data?.message) {
    // ğŸ¯ åœ¨æ€è€ƒè¿‡ç¨‹ä¸­æ˜¾ç¤ºå·¥å…·æ„å›¾
    const intentText = `ğŸ’­ ${event.data.message}\n\nå‡†å¤‡è°ƒç”¨å·¥å…·...`
    
    // ä½¿ç”¨æ‰“å­—æœºæ•ˆæœæ˜¾ç¤ºæ„å›¾
    showToolThinkingWithTyping(intentText).catch(err => {
      console.warn('æ„å›¾æ˜¾ç¤ºå¤±è´¥:', err)
    })
    
    // å­˜å‚¨æ„å›¾ï¼Œä¾›åç»­ä½¿ç”¨
    pendingToolIntent.value = event.data.message
    pendingToolName.value = event.data.toolName
  }
  break
```

#### 1.2 åœ¨å·¥å…·è°ƒç”¨å¡ç‰‡ä¸­æ˜¾ç¤ºæ„å›¾
```typescript
case 'tool_call_start':
  const callData = {
    callId,
    name: event.data.name,
    friendlyName: toolDisplayName,
    intent: event.data.intent || pendingToolIntent.value, // ğŸ¯ æ˜¾ç¤ºæ„å›¾
    description: event.data.description,
    status: 'running',
    params: event.data.arguments || {},
    executionSteps: [
      `ğŸ’­ è°ƒç”¨æ„å›¾ï¼š${event.data.intent || pendingToolIntent.value}`, // ğŸ¯ æ„å›¾æ­¥éª¤
      `ğŸ”§ å·¥å…·æè¿°ï¼š${event.data.description}`,                      // ğŸ¯ æè¿°æ­¥éª¤
      `âš™ï¸ å¼€å§‹æ‰§è¡Œ...`                                              // ğŸ¯ æ‰§è¡Œæ­¥éª¤
    ],
    startTime: Date.now()
  }
```

### æ–¹æ¡ˆ2ï¼šå¢å¼ºå·¥å…·è°ƒç”¨å¡ç‰‡ä¿¡æ¯å±•ç¤º (ä¸­ä¼˜å…ˆçº§)

#### 2.1 æ‰©å±•å·¥å…·è°ƒç”¨æ•°æ®ç»“æ„
```typescript
interface EnhancedFunctionCallState {
  // ç°æœ‰å­—æ®µ
  callId: string
  name: string
  status: 'pending' | 'running' | 'completed' | 'failed'
  
  // ğŸ¯ æ–°å¢å­—æ®µ
  intent: string              // å·¥å…·è°ƒç”¨æ„å›¾
  friendlyName: string        // å‹å¥½åç§°
  description: string         // è¯¦ç»†æè¿°
  expectedOutcome: string     // é¢„æœŸç»“æœ
  category: string            // å·¥å…·åˆ†ç±»
  estimatedTime: number       // é¢„ä¼°æ‰§è¡Œæ—¶é—´
  actualTime?: number         // å®é™…æ‰§è¡Œæ—¶é—´
  
  // è¿›åº¦ç›¸å…³
  sequence: number            // å½“å‰åºå·
  total: number              // æ€»å·¥å…·æ•°
  overallProgress: number     // æ•´ä½“è¿›åº¦ç™¾åˆ†æ¯”
  
  // æ‰§è¡Œè¯¦æƒ…
  executionSteps: string[]    // æ‰§è¡Œæ­¥éª¤
  progressSteps: Array<{      // è¿›åº¦æ­¥éª¤
    step: string
    status: 'pending' | 'running' | 'completed'
    timestamp?: number
  }>
}
```

#### 2.2 å·¥å…·åˆ†ç±»å’Œé¢„æœŸç»“æœæ˜ å°„
```typescript
// å·¥å…·åˆ†ç±»æ˜ å°„
const TOOL_CATEGORIES = {
  'query_past_activities': 'æ•°æ®æŸ¥è¯¢',
  'get_activity_statistics': 'ç»Ÿè®¡åˆ†æ',
  'analyze_task_complexity': 'ä»»åŠ¡åˆ†æ',
  'generate_activity_plan': 'æ–¹æ¡ˆç”Ÿæˆ',
  // ... æ›´å¤šåˆ†ç±»
}

// é¢„æœŸç»“æœæ˜ å°„
const EXPECTED_OUTCOMES = {
  'query_past_activities': 'è·å–å†å²æ´»åŠ¨æ•°æ®ï¼Œä¸ºå†³ç­–æä¾›å‚è€ƒ',
  'get_activity_statistics': 'ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Šï¼Œåˆ†ææ´»åŠ¨æ•ˆæœ',
  'analyze_task_complexity': 'è¯„ä¼°ä»»åŠ¡éš¾åº¦ï¼Œåˆ¶å®šæ‰§è¡Œè®¡åˆ’',
  // ... æ›´å¤šé¢„æœŸç»“æœ
}
```

### æ–¹æ¡ˆ3ï¼šå¤šå·¥å…·è°ƒç”¨æ•´ä½“è¿›åº¦ç®¡ç† (ä½ä¼˜å…ˆçº§)

#### 3.1 æ·»åŠ å·¥å…·è°ƒç”¨ä¼šè¯ç®¡ç†
```typescript
// å·¥å…·è°ƒç”¨ä¼šè¯çŠ¶æ€
interface ToolCallSession {
  sessionId: string
  totalTools: number
  completedTools: number
  currentTool: number
  startTime: number
  estimatedTotalTime: number
  tools: EnhancedFunctionCallState[]
}

// ä¼šè¯ç®¡ç†
const currentToolSession = ref<ToolCallSession | null>(null)
```

#### 3.2 æ•´ä½“è¿›åº¦æŒ‡ç¤ºå™¨
```vue
<!-- å¤šå·¥å…·è°ƒç”¨è¿›åº¦æŒ‡ç¤ºå™¨ -->
<div v-if="currentToolSession && currentToolSession.totalTools > 1" class="tool-session-progress">
  <div class="progress-header">
    <span class="progress-title">å·¥å…·è°ƒç”¨è¿›åº¦</span>
    <span class="progress-count">{{ currentToolSession.currentTool }}/{{ currentToolSession.totalTools }}</span>
  </div>
  <el-progress 
    :percentage="(currentToolSession.completedTools / currentToolSession.totalTools) * 100"
    :show-text="false"
    :stroke-width="4"
    color="var(--el-color-primary)"
  />
  <div class="progress-details">
    <span>é¢„è®¡å‰©ä½™æ—¶é—´ï¼š{{ formatRemainingTime(currentToolSession) }}</span>
  </div>
</div>
```

## ğŸ› ï¸ å…·ä½“å®ç°æ­¥éª¤

### é˜¶æ®µ1ï¼štool_intent äº‹ä»¶ä¼˜åŒ– (1-2å¤©)

#### æ­¥éª¤1ï¼šå‰ç«¯çŠ¶æ€ç®¡ç†
```typescript
// åœ¨ useAIResponse.ts ä¸­æ·»åŠ 
const pendingToolIntent = ref<string>('')
const pendingToolName = ref<string>('')

// æ¸…ç†æ–¹æ³•
const clearPendingToolInfo = () => {
  pendingToolIntent.value = ''
  pendingToolName.value = ''
}
```

#### æ­¥éª¤2ï¼šäº‹ä»¶å¤„ç†ä¼˜åŒ–
```typescript
// åœ¨ AIAssistantRefactored.vue ä¸­ä¿®æ”¹äº‹ä»¶å¤„ç†
const handleToolIntentEvent = (event: any) => {
  if (event.data?.message) {
    // æ˜¾ç¤ºåœ¨æ€è€ƒè¿‡ç¨‹ä¸­
    const intentText = `ğŸ’­ ${event.data.message}\n\nğŸ”§ å‡†å¤‡è°ƒç”¨å·¥å…·ï¼š${event.data.toolName || 'æœªçŸ¥å·¥å…·'}`
    
    // ä½¿ç”¨æ‰“å­—æœºæ•ˆæœ
    aiResponse.showThinkingPhase(intentText)
    
    // å­˜å‚¨æ„å›¾ä¿¡æ¯
    pendingToolIntent.value = event.data.message
    pendingToolName.value = event.data.toolName
  }
}
```

#### æ­¥éª¤3ï¼šå·¥å…·è°ƒç”¨å¡ç‰‡å¢å¼º
```typescript
// åœ¨ FunctionCallItem.vue ä¸­æ·»åŠ æ„å›¾æ˜¾ç¤º
<div v-if="functionCall.intent" class="function-intent">
  <el-icon><BulbFilled /></el-icon>
  <span class="intent-label">è°ƒç”¨æ„å›¾ï¼š</span>
  <span class="intent-text">{{ functionCall.intent }}</span>
</div>
```

### é˜¶æ®µ2ï¼šå·¥å…·ä¿¡æ¯å±•ç¤ºå¢å¼º (2-3å¤©)

#### æ­¥éª¤1ï¼šæ‰©å±•ç±»å‹å®šä¹‰
```typescript
// åœ¨ types/aiAssistant.ts ä¸­æ‰©å±•
interface FunctionCallState {
  // ... ç°æœ‰å­—æ®µ
  intent?: string
  friendlyName?: string
  category?: string
  expectedOutcome?: string
  estimatedTime?: number
  actualTime?: number
}
```

#### æ­¥éª¤2ï¼šå·¥å…·ä¿¡æ¯æ˜ å°„
```typescript
// åœ¨ utils/toolInfoMapping.ts ä¸­åˆ›å»º
export const getToolCategory = (toolName: string): string => {
  return TOOL_CATEGORIES[toolName] || 'å…¶ä»–å·¥å…·'
}

export const getExpectedOutcome = (toolName: string): string => {
  return EXPECTED_OUTCOMES[toolName] || 'æ‰§è¡Œå·¥å…·æ“ä½œ'
}

export const getEstimatedTime = (toolName: string): number => {
  return ESTIMATED_TIMES[toolName] || 5000 // é»˜è®¤5ç§’
}
```

#### æ­¥éª¤3ï¼šUIç»„ä»¶å¢å¼º
```vue
<!-- åœ¨ FunctionCallItem.vue ä¸­æ·»åŠ æ›´å¤šä¿¡æ¯ -->
<div class="function-call-details">
  <div class="detail-row">
    <span class="detail-label">åˆ†ç±»ï¼š</span>
    <span class="detail-value">{{ functionCall.category }}</span>
  </div>
  <div class="detail-row">
    <span class="detail-label">é¢„æœŸç»“æœï¼š</span>
    <span class="detail-value">{{ functionCall.expectedOutcome }}</span>
  </div>
  <div v-if="functionCall.estimatedTime" class="detail-row">
    <span class="detail-label">é¢„è®¡è€—æ—¶ï¼š</span>
    <span class="detail-value">{{ formatTime(functionCall.estimatedTime) }}</span>
  </div>
</div>
```

### é˜¶æ®µ3ï¼šå¤šå·¥å…·è°ƒç”¨è¿›åº¦ç®¡ç† (3-4å¤©)

#### æ­¥éª¤1ï¼šä¼šè¯ç®¡ç†å®ç°
```typescript
// åœ¨ useAIResponse.ts ä¸­æ·»åŠ ä¼šè¯ç®¡ç†
const createToolSession = (totalTools: number): ToolCallSession => {
  return {
    sessionId: `session-${Date.now()}`,
    totalTools,
    completedTools: 0,
    currentTool: 0,
    startTime: Date.now(),
    estimatedTotalTime: 0,
    tools: []
  }
}
```

#### æ­¥éª¤2ï¼šè¿›åº¦ç»„ä»¶å®ç°
```vue
<!-- åˆ›å»º ToolSessionProgress.vue -->
<template>
  <div class="tool-session-progress">
    <div class="progress-header">
      <h4>å·¥å…·è°ƒç”¨è¿›åº¦</h4>
      <span class="progress-count">{{ session.currentTool }}/{{ session.totalTools }}</span>
    </div>
    
    <el-progress 
      :percentage="progressPercentage"
      :show-text="false"
      :stroke-width="6"
      color="var(--el-color-primary)"
    />
    
    <div class="progress-details">
      <span>å·²å®Œæˆï¼š{{ session.completedTools }} ä¸ªå·¥å…·</span>
      <span>é¢„è®¡å‰©ä½™ï¼š{{ formatRemainingTime() }}</span>
    </div>
    
    <div class="tool-list">
      <div 
        v-for="(tool, index) in session.tools" 
        :key="tool.callId"
        class="tool-item"
        :class="tool.status"
      >
        <span class="tool-number">{{ index + 1 }}</span>
        <span class="tool-name">{{ tool.friendlyName }}</span>
        <span class="tool-status">{{ getStatusText(tool.status) }}</span>
      </div>
    </div>
  </div>
</template>
```

## ğŸ“Š é¢„æœŸæ•ˆæœ

### ç”¨æˆ·ä½“éªŒæå‡
1. **é€æ˜åº¦æå‡**ï¼šç”¨æˆ·èƒ½æ¸…æ¥šçœ‹åˆ°AIçš„å·¥å…·è°ƒç”¨æ„å›¾
2. **ä¿¡æ¯ä¸°å¯Œ**ï¼šå·¥å…·è°ƒç”¨å¡ç‰‡åŒ…å«æ›´å¤šæœ‰ç”¨ä¿¡æ¯
3. **è¿›åº¦æ„ŸçŸ¥**ï¼šå¤šå·¥å…·è°ƒç”¨æ—¶æœ‰æ¸…æ™°çš„è¿›åº¦æŒ‡ç¤º
4. **æ•™è‚²ä»·å€¼**ï¼šç”¨æˆ·èƒ½å­¦ä¹ åˆ°AIçš„æ€è€ƒè¿‡ç¨‹

### æŠ€æœ¯æ”¶ç›Š
1. **ä»£ç ç»“æ„ä¼˜åŒ–**ï¼šæ›´æ¸…æ™°çš„äº‹ä»¶å¤„ç†é€»è¾‘
2. **ç»„ä»¶å¤ç”¨æ€§**ï¼šå¯å¤ç”¨çš„å·¥å…·ä¿¡æ¯å±•ç¤ºç»„ä»¶
3. **æ‰©å±•æ€§æå‡**ï¼šæ˜“äºæ·»åŠ æ–°çš„å·¥å…·ä¿¡æ¯å±•ç¤º
4. **ç»´æŠ¤æ€§æ”¹å–„**ï¼šç»“æ„åŒ–çš„å·¥å…·ä¿¡æ¯ç®¡ç†

## ğŸ“‹ å®æ–½è®¡åˆ’

### ç¬¬1å‘¨ï¼štool_intent äº‹ä»¶ä¼˜åŒ–
- [ ] å‰ç«¯çŠ¶æ€ç®¡ç†å®ç°
- [ ] äº‹ä»¶å¤„ç†é€»è¾‘ä¼˜åŒ–
- [ ] æ€è€ƒè¿‡ç¨‹æ˜¾ç¤ºå¢å¼º
- [ ] å·¥å…·è°ƒç”¨å¡ç‰‡æ„å›¾æ˜¾ç¤º

### ç¬¬2å‘¨ï¼šå·¥å…·ä¿¡æ¯å±•ç¤ºå¢å¼º
- [ ] ç±»å‹å®šä¹‰æ‰©å±•
- [ ] å·¥å…·ä¿¡æ¯æ˜ å°„å®ç°
- [ ] UIç»„ä»¶å¢å¼º
- [ ] æ ·å¼ä¼˜åŒ–

### ç¬¬3å‘¨ï¼šå¤šå·¥å…·è°ƒç”¨è¿›åº¦ç®¡ç†
- [ ] ä¼šè¯ç®¡ç†å®ç°
- [ ] è¿›åº¦ç»„ä»¶å¼€å‘
- [ ] æ•´ä½“è¿›åº¦æŒ‡ç¤ºå™¨
- [ ] æµ‹è¯•å’Œä¼˜åŒ–

### ç¬¬4å‘¨ï¼šæµ‹è¯•å’Œå®Œå–„
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] æ–‡æ¡£æ›´æ–°

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

1. **åŠŸèƒ½æŒ‡æ ‡**ï¼š
   - tool_intent äº‹ä»¶100%åœ¨UIä¸­å±•ç¤º
   - å·¥å…·è°ƒç”¨å¡ç‰‡ä¿¡æ¯ä¸°å¯Œåº¦æå‡50%
   - å¤šå·¥å…·è°ƒç”¨è¿›åº¦å¯è§†åŒ–

2. **ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**ï¼š
   - ç”¨æˆ·å¯¹å·¥å…·è°ƒç”¨ç†è§£åº¦æå‡
   - å·¥å…·è°ƒç”¨è¿‡ç¨‹é€æ˜åº¦æå‡
   - æ•´ä½“ä½¿ç”¨æ»¡æ„åº¦æå‡

3. **æŠ€æœ¯æŒ‡æ ‡**ï¼š
   - ä»£ç å¯ç»´æŠ¤æ€§æå‡
   - ç»„ä»¶å¤ç”¨æ€§æå‡
   - æ‰©å±•æ€§æå‡

---

**æ–¹æ¡ˆåˆ¶å®šæ—¶é—´**: 2025-01-10  
**é¢„è®¡å®æ–½å‘¨æœŸ**: 4å‘¨  
**ä¼˜å…ˆçº§**: é«˜ (tool_intent) > ä¸­ (ä¿¡æ¯å±•ç¤º) > ä½ (è¿›åº¦ç®¡ç†)
