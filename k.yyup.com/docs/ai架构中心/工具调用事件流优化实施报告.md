# å·¥å…·è°ƒç”¨äº‹ä»¶æµä¼˜åŒ–å®æ–½æŠ¥å‘Š

## ğŸ“‹ å®æ–½æ¦‚è§ˆ

**å®æ–½æ—¶é—´**: 2025-01-10  
**å®æ–½é˜¶æ®µ**: ç¬¬1é˜¶æ®µ - tool_intent äº‹ä»¶ä¼˜åŒ–  
**å®æ–½çŠ¶æ€**: âœ… å·²å®Œæˆ  

## ğŸ¯ å®æ–½ç›®æ ‡

ä¼˜åŒ–AIåŠ©æ‰‹çš„å·¥å…·è°ƒç”¨äº‹ä»¶æµï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿæ¸…æ¥šåœ°çœ‹åˆ°AIçš„å·¥å…·è°ƒç”¨æ„å›¾ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œé€æ˜åº¦ã€‚

## ğŸ”§ å…·ä½“ä¿®æ”¹å†…å®¹

### 1. âœ… useAIResponse.ts - æ·»åŠ çŠ¶æ€å˜é‡
**æ–‡ä»¶**: `client/src/components/ai-assistant/composables/useAIResponse.ts`

**ä¿®æ”¹å†…å®¹**:
```typescript
// ğŸ¯ æ–°å¢ï¼šå¾…å¤„ç†çš„å·¥å…·æ„å›¾ä¿¡æ¯
const pendingToolIntent = ref<string>('')
const pendingToolName = ref<string>('')

// æ¸…ç†å¾…å¤„ç†çš„å·¥å…·æ„å›¾ä¿¡æ¯
const clearPendingToolInfo = () => {
  pendingToolIntent.value = ''
  pendingToolName.value = ''
}

// åœ¨returnä¸­æ·»åŠ 
return {
  // ... ç°æœ‰è¿”å›å€¼
  pendingToolIntent,
  pendingToolName,
  clearPendingToolInfo
}
```

**ä½œç”¨**: ä¸ºå·¥å…·æ„å›¾ä¿¡æ¯æä¾›çŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒè·¨äº‹ä»¶çš„æ„å›¾ä¿¡æ¯ä¼ é€’ã€‚

### 2. âœ… useMultiRoundToolCalling.ts - äº‹ä»¶è½¬å‘ä¼˜åŒ–
**æ–‡ä»¶**: `client/src/composables/useMultiRoundToolCalling.ts`

**ä¿®æ”¹å†…å®¹**:
```typescript
// ğŸ¯ å¤„ç†å·¥å…·æ„å›¾äº‹ä»¶
if (event.type === 'tool_intent') {
  console.log(`ğŸ’­ [å¤šè½®è°ƒç”¨] å·¥å…·æ„å›¾ (ç¬¬${currentRound}è½®):`, event.data?.message)
  // ç›´æ¥è½¬å‘å·¥å…·æ„å›¾äº‹ä»¶ï¼Œè®©ä¸Šå±‚å¤„ç†
}
```

**ä½œç”¨**: ç¡®ä¿ `tool_intent` äº‹ä»¶èƒ½å¤Ÿæ­£ç¡®è½¬å‘åˆ°ä¸Šå±‚ç»„ä»¶è¿›è¡Œå¤„ç†ã€‚

### 3. âœ… AIAssistantCore.vue - äº‹ä»¶å¤„ç†å¢å¼º
**æ–‡ä»¶**: `client/src/components/ai-assistant/core/AIAssistantCore.vue`

**ä¿®æ”¹å†…å®¹**:
```typescript
case 'tool_intent':
  // ğŸ¯ å¤„ç†å·¥å…·æ„å›¾äº‹ä»¶
  if (event.data?.message) {
    console.log('ğŸ’­ [æ ¸å¿ƒ] å·¥å…·è°ƒç”¨æ„å›¾:', event.data.message)
    
    // åœ¨æ€è€ƒè¿‡ç¨‹ä¸­æ˜¾ç¤ºå·¥å…·æ„å›¾
    const intentText = `ğŸ’­ ${event.data.message}\n\nğŸ”§ å‡†å¤‡è°ƒç”¨å·¥å…·ï¼š${event.data.toolName || 'æœªçŸ¥å·¥å…·'}...`
    
    // ä½¿ç”¨AIå“åº”å¤„ç†å™¨æ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹
    aiResponse.showThinkingPhase(intentText)
    
    // å­˜å‚¨æ„å›¾ä¿¡æ¯ä¾›åç»­ä½¿ç”¨
    aiResponse.pendingToolIntent.value = event.data.message
    aiResponse.pendingToolName.value = event.data.toolName
  }
  break
```

**ä½œç”¨**: 
- åœ¨æ€è€ƒè¿‡ç¨‹ä¸­æ˜¾ç¤ºå·¥å…·æ„å›¾
- å­˜å‚¨æ„å›¾ä¿¡æ¯ä¾›å·¥å…·è°ƒç”¨æ—¶ä½¿ç”¨
- æä¾›ç”¨æˆ·å‹å¥½çš„æ„å›¾å±•ç¤º

### 4. âœ… å·¥å…·è°ƒç”¨åˆ›å»ºé€»è¾‘ä¼˜åŒ–
**æ–‡ä»¶**: `client/src/components/ai-assistant/core/AIAssistantCore.vue`

**ä¿®æ”¹å†…å®¹**:
```typescript
case 'tool_call_start':
  // ğŸ¯ ä¼˜å…ˆä½¿ç”¨äº‹ä»¶ä¸­çš„æ„å›¾ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨ä¹‹å‰å­˜å‚¨çš„æ„å›¾
  const toolIntent = event.data?.intent || aiResponse.pendingToolIntent.value || ''
  
  // ğŸ¯ åˆ›å»ºå¢å¼ºçš„å·¥å…·è°ƒç”¨å¯¹è±¡ï¼ŒåŒ…å«æ„å›¾ä¿¡æ¯
  const toolCallData = {
    // ... ç°æœ‰å­—æ®µ
    intent: toolIntent,
    friendlyName: toolDisplayName,
    executionSteps: [
      toolIntent ? `ğŸ’­ æ„å›¾ï¼š${toolIntent}` : '',
      `ğŸ”§ æè¿°ï¼š${toolDescription}`,
      `âš™ï¸ å¼€å§‹æ‰§è¡Œï¼š${toolDisplayName}`
    ].filter(Boolean)
  }
  
  // æ¸…ç†å·²ä½¿ç”¨çš„æ„å›¾ä¿¡æ¯
  aiResponse.clearPendingToolInfo()
```

**ä½œç”¨**:
- å°†æ„å›¾ä¿¡æ¯é›†æˆåˆ°å·¥å…·è°ƒç”¨å¯¹è±¡ä¸­
- åœ¨æ‰§è¡Œæ­¥éª¤ä¸­æ˜¾ç¤ºæ„å›¾ä¿¡æ¯
- æ¸…ç†å·²ä½¿ç”¨çš„æ„å›¾ä¿¡æ¯

### 5. âœ… ç±»å‹å®šä¹‰æ‰©å±•
**æ–‡ä»¶**: `client/src/components/ai-assistant/types/aiAssistant.ts`

**ä¿®æ”¹å†…å®¹**:
```typescript
export interface FunctionCallState {
  // ... ç°æœ‰å­—æ®µ
  // ğŸ¯ æ–°å¢ï¼šå·¥å…·æ„å›¾ç›¸å…³å­—æ®µ
  intent?: string        // å·¥å…·è°ƒç”¨æ„å›¾ï¼ˆ"æˆ‘å°†è¦åšä»€ä¹ˆ"ï¼‰
  friendlyName?: string  // å‹å¥½åç§°
}
```

**ä½œç”¨**: ä¸ºå·¥å…·è°ƒç”¨çŠ¶æ€æ·»åŠ æ„å›¾å­—æ®µæ”¯æŒï¼Œç¡®ä¿ç±»å‹å®‰å…¨ã€‚

### 6. âœ… æ ·å¼æ–‡ä»¶æ·»åŠ 
**æ–‡ä»¶**: `client/src/components/ai-assistant/styles/ai-response.scss`

**ä¿®æ”¹å†…å®¹**:
```scss
// ğŸ¯ å·¥å…·æ„å›¾æ˜¾ç¤ºæ ·å¼
.function-intent {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--el-color-info-light-9);
  border: 1px solid var(--el-color-info-light-7);
  border-radius: 8px;
  margin-bottom: 12px;
  font-size: 13px;
  color: var(--el-color-info);
  transition: all 0.3s ease;

  .el-icon {
    font-size: 14px;
    color: var(--el-color-warning);
  }

  &:hover {
    background: var(--el-color-info-light-8);
    border-color: var(--el-color-info-light-6);
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  }

  span {
    flex: 1;
    font-style: italic;
    line-height: 1.4;
    word-break: break-word;
  }
}

// æš—è‰²ä¸»é¢˜é€‚é…
.theme-dark {
  .function-intent {
    background: var(--el-fill-color-darker);
    border-color: var(--el-border-color-dark);
    color: var(--el-text-color-primary);
  }
}
```

**ä½œç”¨**: ä¸ºå·¥å…·æ„å›¾æ˜¾ç¤ºæä¾›ç¾è§‚çš„æ ·å¼ï¼Œæ”¯æŒäº®è‰²å’Œæš—è‰²ä¸»é¢˜ã€‚

## ğŸ“Š å®æ–½æ•ˆæœ

### ğŸ¯ ç”¨æˆ·ä½“éªŒæå‡
1. **é€æ˜åº¦æå‡**: ç”¨æˆ·ç°åœ¨èƒ½çœ‹åˆ°AIä¸ºä»€ä¹ˆè¦è°ƒç”¨æŸä¸ªå·¥å…·
2. **æ€è€ƒè¿‡ç¨‹å¯è§†åŒ–**: å·¥å…·æ„å›¾åœ¨æ€è€ƒè¿‡ç¨‹ä¸­æ˜¾ç¤ºï¼Œå¢å¼ºAIæ€è€ƒçš„é€æ˜åº¦
3. **ä¿¡æ¯ä¸°å¯Œ**: å·¥å…·è°ƒç”¨å¡ç‰‡ç°åœ¨åŒ…å«æ„å›¾ä¿¡æ¯ï¼Œæä¾›æ›´å¤šä¸Šä¸‹æ–‡

### ğŸ”§ æŠ€æœ¯æ”¹è¿›
1. **äº‹ä»¶æµå®Œæ•´**: tool_intent äº‹ä»¶ç°åœ¨å¾—åˆ°å®Œæ•´å¤„ç†
2. **çŠ¶æ€ç®¡ç†ä¼˜åŒ–**: æ„å›¾ä¿¡æ¯åœ¨ç»„ä»¶é—´æ­£ç¡®ä¼ é€’
3. **ç±»å‹å®‰å…¨**: æ–°å¢å­—æ®µæœ‰å®Œæ•´çš„TypeScriptç±»å‹æ”¯æŒ
4. **æ ·å¼ç»Ÿä¸€**: æ„å›¾æ˜¾ç¤ºä¸æ•´ä½“UIé£æ ¼ä¿æŒä¸€è‡´

### ğŸ“ˆ åŠŸèƒ½å¢å¼º
1. **æ„å›¾æ˜¾ç¤º**: æ¯ä¸ªå·¥å…·è°ƒç”¨éƒ½æœ‰æ¸…æ™°çš„æ„å›¾è¯´æ˜
2. **æ‰§è¡Œæ­¥éª¤**: å·¥å…·è°ƒç”¨çš„æ‰§è¡Œæ­¥éª¤åŒ…å«æ„å›¾ä¿¡æ¯
3. **æ€è€ƒè¿‡ç¨‹**: AIçš„æ€è€ƒè¿‡ç¨‹æ›´åŠ è¯¦ç»†å’Œé€æ˜

## ğŸ” éªŒè¯æ–¹æ³•

### 1. åŠŸèƒ½éªŒè¯
- [ ] å‘é€éœ€è¦å·¥å…·è°ƒç”¨çš„æ¶ˆæ¯
- [ ] è§‚å¯Ÿæ€è€ƒè¿‡ç¨‹ä¸­æ˜¯å¦æ˜¾ç¤ºå·¥å…·æ„å›¾
- [ ] æ£€æŸ¥å·¥å…·è°ƒç”¨å¡ç‰‡æ˜¯å¦æ˜¾ç¤ºæ„å›¾ä¿¡æ¯
- [ ] éªŒè¯æ‰§è¡Œæ­¥éª¤æ˜¯å¦åŒ…å«æ„å›¾è¯´æ˜

### 2. æ ·å¼éªŒè¯
- [ ] æ£€æŸ¥å·¥å…·æ„å›¾æ˜¾ç¤ºçš„æ ·å¼æ˜¯å¦æ­£ç¡®
- [ ] éªŒè¯äº®è‰²å’Œæš—è‰²ä¸»é¢˜ä¸‹çš„æ˜¾ç¤ºæ•ˆæœ
- [ ] æµ‹è¯•hoveræ•ˆæœå’ŒåŠ¨ç”»

### 3. å…¼å®¹æ€§éªŒè¯
- [ ] ç¡®ä¿ç°æœ‰åŠŸèƒ½ä¸å—å½±å“
- [ ] éªŒè¯å¤šå·¥å…·è°ƒç”¨æ—¶çš„è¡¨ç°
- [ ] æµ‹è¯•é”™è¯¯æƒ…å†µä¸‹çš„å¤„ç†

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç¬¬2é˜¶æ®µï¼šå·¥å…·ä¿¡æ¯å±•ç¤ºå¢å¼º (è®¡åˆ’ä¸­)
1. åˆ›å»ºå·¥å…·ä¿¡æ¯æ˜ å°„æ–‡ä»¶
2. æ·»åŠ å·¥å…·åˆ†ç±»å’Œé¢„æœŸç»“æœ
3. å¢å¼ºå·¥å…·è°ƒç”¨å¡ç‰‡ä¿¡æ¯æ˜¾ç¤º

### ç¬¬3é˜¶æ®µï¼šå¤šå·¥å…·è°ƒç”¨è¿›åº¦ç®¡ç† (è®¡åˆ’ä¸­)
1. æ·»åŠ å·¥å…·è°ƒç”¨ä¼šè¯ç®¡ç†
2. å®ç°æ•´ä½“è¿›åº¦æŒ‡ç¤ºå™¨
3. ä¼˜åŒ–å¤šå·¥å…·è°ƒç”¨ç”¨æˆ·ä½“éªŒ

## ğŸ“‹ æ€»ç»“

ç¬¬1é˜¶æ®µçš„ä¼˜åŒ–æˆåŠŸå®ç°äº† tool_intent äº‹ä»¶çš„å®Œæ•´å¤„ç†ï¼Œæ˜¾è‘—æå‡äº†ç”¨æˆ·å¯¹AIå·¥å…·è°ƒç”¨è¿‡ç¨‹çš„ç†è§£ã€‚ä¸»è¦æˆæœåŒ…æ‹¬ï¼š

1. **å®Œæ•´çš„äº‹ä»¶æµå¤„ç†**: tool_intent äº‹ä»¶ç°åœ¨å¾—åˆ°å®Œæ•´å¤„ç†å’Œå±•ç¤º
2. **ç”¨æˆ·ä½“éªŒæå‡**: ç”¨æˆ·èƒ½æ¸…æ¥šçœ‹åˆ°AIçš„å·¥å…·è°ƒç”¨æ„å›¾
3. **ä»£ç ç»“æ„ä¼˜åŒ–**: çŠ¶æ€ç®¡ç†æ›´åŠ æ¸…æ™°ï¼Œç±»å‹å®šä¹‰æ›´åŠ å®Œæ•´
4. **æ ·å¼ç»Ÿä¸€**: æ–°åŠŸèƒ½ä¸ç°æœ‰UIé£æ ¼ä¿æŒä¸€è‡´

è¿™æ¬¡ä¼˜åŒ–ä¸ºåç»­çš„å·¥å…·ä¿¡æ¯å±•ç¤ºå¢å¼ºå’Œå¤šå·¥å…·è°ƒç”¨è¿›åº¦ç®¡ç†å¥ å®šäº†åšå®çš„åŸºç¡€ã€‚

---

**å®æ–½äººå‘˜**: AIåŠ©æ‰‹  
**å®¡æ ¸çŠ¶æ€**: å¾…éªŒè¯  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
