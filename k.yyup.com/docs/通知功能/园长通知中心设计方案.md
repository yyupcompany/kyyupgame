# å›­é•¿é€šçŸ¥ä¸­å¿ƒè®¾è®¡æ–¹æ¡ˆ

**åˆ›å»ºæ—¥æœŸ**: 2025-01-09  
**è®¾è®¡äººå‘˜**: AI Assistant

---

## ğŸ“‹ éœ€æ±‚åˆ†æ

### æ ¸å¿ƒéœ€æ±‚

å›­é•¿é€šçŸ¥ä¸­å¿ƒéœ€è¦æä¾›**ç»Ÿè®¡ä¸ºä¸»ã€è¯¦æƒ…ä¸ºè¾…**çš„åŠŸèƒ½ï¼š

1. **ç»Ÿè®¡è§†å›¾**
   - æŸ¥çœ‹æ‰€æœ‰å·²å‘é€çš„é€šçŸ¥
   - æ¯æ¡é€šçŸ¥æ˜¾ç¤ºï¼šæ€»æ¥æ”¶äººæ•°ã€å·²è¯»äººæ•°ã€æœªè¯»äººæ•°ã€é˜…è¯»ç‡
   - æ”¯æŒæŒ‰æ—¶é—´ã€ç±»å‹ã€çŠ¶æ€ç­›é€‰

2. **è¯¦æƒ…è§†å›¾**
   - ç‚¹å‡»é€šçŸ¥æŸ¥çœ‹è¯¦ç»†çš„é˜…è¯»æƒ…å†µ
   - æ˜¾ç¤ºå·²è¯»ç”¨æˆ·åˆ—è¡¨ï¼ˆå§“åã€è§’è‰²ã€é˜…è¯»æ—¶é—´ï¼‰
   - æ˜¾ç¤ºæœªè¯»ç”¨æˆ·åˆ—è¡¨ï¼ˆå§“åã€è§’è‰²ï¼‰
   - æ”¯æŒå¯¼å‡ºé˜…è¯»æŠ¥å‘Š

3. **å‘é€é€šçŸ¥**
   - åˆ›å»ºæ–°é€šçŸ¥
   - é€‰æ‹©æ¥æ”¶äººï¼ˆæŒ‰è§’è‰²ã€éƒ¨é—¨ã€ç­çº§ç­›é€‰ï¼‰
   - è®¾ç½®ä¼˜å…ˆçº§å’Œç±»å‹
   - å®šæ—¶å‘é€

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### å½“å‰è¡¨ç»“æ„

**notificationsè¡¨**ï¼ˆå·²å­˜åœ¨ï¼‰:
```sql
CREATE TABLE notifications (
  id INT PRIMARY KEY AUTO_INCREMENT,
  title VARCHAR(255) NOT NULL COMMENT 'é€šçŸ¥æ ‡é¢˜',
  content TEXT NOT NULL COMMENT 'é€šçŸ¥å†…å®¹',
  type ENUM('system', 'message', 'activity') NOT NULL DEFAULT 'system' COMMENT 'é€šçŸ¥ç±»å‹',
  status ENUM('draft', 'published', 'cancelled', 'unread', 'read', 'deleted') NOT NULL DEFAULT 'unread' COMMENT 'é€šçŸ¥çŠ¶æ€',
  user_id INT NOT NULL COMMENT 'æ¥æ”¶ç”¨æˆ·ID',
  source_id INT NULL COMMENT 'å…³è”çš„æºæ•°æ®ID',
  source_type VARCHAR(50) NULL COMMENT 'å…³è”çš„æºæ•°æ®ç±»å‹',
  read_at DATETIME NULL COMMENT 'è¯»å–æ—¶é—´',
  total_count INT NOT NULL DEFAULT 0 COMMENT 'é€šçŸ¥æ€»æ¥æ”¶äººæ•°',
  read_count INT NOT NULL DEFAULT 0 COMMENT 'å·²è¯»äººæ•°',
  cancelled_at DATETIME NULL COMMENT 'å–æ¶ˆæ—¶é—´',
  cancelled_by INT NULL COMMENT 'å–æ¶ˆäººID',
  cancel_reason VARCHAR(255) NULL COMMENT 'å–æ¶ˆåŸå› ',
  send_at DATETIME NULL COMMENT 'å‘é€æ—¶é—´',
  sender_id INT NULL COMMENT 'å‘é€äººID',
  created_at DATETIME NOT NULL,
  updated_at DATETIME NOT NULL,
  deleted_at DATETIME NULL,
  FOREIGN KEY (user_id) REFERENCES users(id),
  INDEX idx_user_id (user_id),
  INDEX idx_status (status),
  INDEX idx_type (type),
  INDEX idx_source (source_type, source_id),
  INDEX idx_created_at (created_at)
);
```

### è®¾è®¡è¯´æ˜

**å½“å‰è®¾è®¡ç‰¹ç‚¹**:
- æ¯ä¸ªç”¨æˆ·ä¸€æ¡é€šçŸ¥è®°å½•
- ç¾¤å‘é€šçŸ¥ä¼šåˆ›å»ºå¤šæ¡è®°å½•ï¼ˆç›¸åŒçš„titleã€contentã€sender_idï¼‰
- æ¯æ¡è®°å½•ç‹¬ç«‹è¿½è¸ªé˜…è¯»çŠ¶æ€ï¼ˆstatusã€read_atï¼‰

**ä¼˜ç‚¹**:
- ç®€å•ç›´è§‚
- æ¯ä¸ªç”¨æˆ·çš„é€šçŸ¥çŠ¶æ€ç‹¬ç«‹ç®¡ç†
- æŸ¥è¯¢å•ä¸ªç”¨æˆ·çš„é€šçŸ¥å¾ˆå¿«

**ç¼ºç‚¹**:
- ç¾¤å‘é€šçŸ¥ä¼šåˆ›å»ºå¤§é‡è®°å½•
- total_countå’Œread_countå­—æ®µåœ¨æ¯æ¡è®°å½•ä¸­å†—ä½™
- ç»Ÿè®¡é˜…è¯»æƒ…å†µéœ€è¦èšåˆæŸ¥è¯¢

### ä¼˜åŒ–å»ºè®®

ä¸ºäº†æ›´å¥½åœ°æ”¯æŒå›­é•¿ç»Ÿè®¡åŠŸèƒ½ï¼Œå»ºè®®æ·»åŠ ä¸€ä¸ª**é€šçŸ¥æ¨¡æ¿è¡¨**ï¼š

```sql
CREATE TABLE notification_templates (
  id INT PRIMARY KEY AUTO_INCREMENT,
  title VARCHAR(255) NOT NULL COMMENT 'é€šçŸ¥æ ‡é¢˜',
  content TEXT NOT NULL COMMENT 'é€šçŸ¥å†…å®¹',
  type ENUM('system', 'announcement', 'class', 'personal') NOT NULL DEFAULT 'system' COMMENT 'é€šçŸ¥ç±»å‹',
  priority ENUM('urgent', 'important', 'normal') NOT NULL DEFAULT 'normal' COMMENT 'ä¼˜å…ˆçº§',
  sender_id INT NOT NULL COMMENT 'å‘é€äººID',
  send_at DATETIME NULL COMMENT 'å‘é€æ—¶é—´',
  total_recipients INT NOT NULL DEFAULT 0 COMMENT 'æ€»æ¥æ”¶äººæ•°',
  read_recipients INT NOT NULL DEFAULT 0 COMMENT 'å·²è¯»äººæ•°',
  status ENUM('draft', 'published', 'cancelled') NOT NULL DEFAULT 'draft' COMMENT 'çŠ¶æ€',
  created_at DATETIME NOT NULL,
  updated_at DATETIME NOT NULL,
  deleted_at DATETIME NULL,
  FOREIGN KEY (sender_id) REFERENCES users(id),
  INDEX idx_sender_id (sender_id),
  INDEX idx_status (status),
  INDEX idx_send_at (send_at)
);
```

ç„¶ååœ¨notificationsè¡¨ä¸­æ·»åŠ template_idå­—æ®µï¼š

```sql
ALTER TABLE notifications 
ADD COLUMN template_id INT NULL COMMENT 'é€šçŸ¥æ¨¡æ¿ID',
ADD FOREIGN KEY (template_id) REFERENCES notification_templates(id);
```

---

## ğŸ”Œ APIè®¾è®¡

### å›­é•¿é€šçŸ¥ä¸­å¿ƒAPI

**åŸºç¡€è·¯å¾„**: `/api/principal/notifications`

#### 1. è·å–é€šçŸ¥ç»Ÿè®¡åˆ—è¡¨

```typescript
GET /api/principal/notifications/statistics

Queryå‚æ•°:
- page: number (é¡µç )
- pageSize: number (æ¯é¡µæ•°é‡)
- type: string (é€šçŸ¥ç±»å‹)
- startDate: string (å¼€å§‹æ—¥æœŸ)
- endDate: string (ç»“æŸæ—¥æœŸ)
- keyword: string (å…³é”®è¯æœç´¢)

å“åº”:
{
  success: true,
  data: {
    items: [
      {
        templateId: number,
        title: string,
        content: string,
        type: string,
        priority: string,
        senderName: string,
        sendAt: string,
        totalRecipients: number,
        readRecipients: number,
        unreadRecipients: number,
        readRate: number, // é˜…è¯»ç‡ç™¾åˆ†æ¯”
        createdAt: string
      }
    ],
    total: number,
    page: number,
    pageSize: number
  }
}
```

#### 2. è·å–é€šçŸ¥è¯¦ç»†é˜…è¯»æƒ…å†µ

```typescript
GET /api/principal/notifications/:templateId/readers

Queryå‚æ•°:
- status: 'read' | 'unread' | 'all' (ç­›é€‰çŠ¶æ€)
- page: number
- pageSize: number

å“åº”:
{
  success: true,
  data: {
    notification: {
      title: string,
      content: string,
      type: string,
      priority: string,
      sendAt: string,
      totalRecipients: number,
      readRecipients: number,
      unreadRecipients: number,
      readRate: number
    },
    readers: [
      {
        userId: number,
        userName: string,
        userRole: string,
        department: string,
        status: 'read' | 'unread',
        readAt: string | null
      }
    ],
    total: number,
    page: number,
    pageSize: number
  }
}
```

#### 3. åˆ›å»ºå¹¶å‘é€é€šçŸ¥

```typescript
POST /api/principal/notifications

è¯·æ±‚ä½“:
{
  title: string,
  content: string,
  type: 'system' | 'announcement' | 'class' | 'personal',
  priority: 'urgent' | 'important' | 'normal',
  recipients: {
    roles?: string[], // æŒ‰è§’è‰²ç­›é€‰
    departments?: number[], // æŒ‰éƒ¨é—¨ç­›é€‰
    classes?: number[], // æŒ‰ç­çº§ç­›é€‰
    userIds?: number[] // æŒ‡å®šç”¨æˆ·ID
  },
  sendAt?: string // å®šæ—¶å‘é€æ—¶é—´ï¼Œä¸å¡«åˆ™ç«‹å³å‘é€
}

å“åº”:
{
  success: true,
  data: {
    templateId: number,
    totalRecipients: number,
    message: string
  }
}
```

#### 4. è·å–é€šçŸ¥ç»Ÿè®¡æ¦‚è§ˆ

```typescript
GET /api/principal/notifications/overview

å“åº”:
{
  success: true,
  data: {
    totalNotifications: number, // æ€»é€šçŸ¥æ•°
    todayNotifications: number, // ä»Šæ—¥é€šçŸ¥æ•°
    totalRecipients: number, // æ€»æ¥æ”¶äººæ¬¡
    averageReadRate: number, // å¹³å‡é˜…è¯»ç‡
    urgentUnread: number, // ç´§æ€¥æœªè¯»æ•°
    recentNotifications: [ // æœ€è¿‘5æ¡é€šçŸ¥
      {
        templateId: number,
        title: string,
        sendAt: string,
        readRate: number
      }
    ]
  }
}
```

#### 5. å¯¼å‡ºé˜…è¯»æŠ¥å‘Š

```typescript
POST /api/principal/notifications/:templateId/export

å“åº”:
{
  success: true,
  data: {
    downloadUrl: string,
    fileName: string
  }
}
```

---

## ğŸ¨ å‰ç«¯é¡µé¢è®¾è®¡

### é¡µé¢ç»“æ„

**æ–‡ä»¶**: `client/src/pages/centers/NotificationCenter.vue`

#### 1. é¡µé¢å¤´éƒ¨
- é¡µé¢æ ‡é¢˜ï¼š"é€šçŸ¥ä¸­å¿ƒ"
- æ“ä½œæŒ‰é’®ï¼š
  - åˆ›å»ºé€šçŸ¥
  - åˆ·æ–°

#### 2. ç»Ÿè®¡å¡ç‰‡åŒºåŸŸï¼ˆ4ä¸ªå¡ç‰‡ï¼‰
- æ€»é€šçŸ¥æ•°
- ä»Šæ—¥é€šçŸ¥æ•°
- å¹³å‡é˜…è¯»ç‡
- ç´§æ€¥æœªè¯»æ•°

#### 3. ç­›é€‰åŒºåŸŸ
- é€šçŸ¥ç±»å‹ï¼ˆå…¨éƒ¨/ç³»ç»Ÿ/å…¬å‘Š/ç­çº§/ä¸ªäººï¼‰
- æ—¥æœŸèŒƒå›´é€‰æ‹©
- å…³é”®è¯æœç´¢

#### 4. é€šçŸ¥åˆ—è¡¨
- è¡¨æ ¼å±•ç¤ºï¼š
  - é€šçŸ¥æ ‡é¢˜
  - ç±»å‹
  - ä¼˜å…ˆçº§
  - å‘é€äºº
  - å‘é€æ—¶é—´
  - æ€»æ¥æ”¶äººæ•°
  - å·²è¯»äººæ•°
  - æœªè¯»äººæ•°
  - é˜…è¯»ç‡ï¼ˆè¿›åº¦æ¡ï¼‰
  - æ“ä½œï¼ˆæŸ¥çœ‹è¯¦æƒ…ã€å¯¼å‡ºæŠ¥å‘Šï¼‰

#### 5. è¯¦æƒ…å¯¹è¯æ¡†
- é€šçŸ¥ä¿¡æ¯
- Tabåˆ‡æ¢ï¼š
  - å·²è¯»ç”¨æˆ·åˆ—è¡¨
  - æœªè¯»ç”¨æˆ·åˆ—è¡¨
- å¯¼å‡ºæŒ‰é’®

#### 6. åˆ›å»ºé€šçŸ¥å¯¹è¯æ¡†
- é€šçŸ¥æ ‡é¢˜
- é€šçŸ¥å†…å®¹ï¼ˆå¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼‰
- é€šçŸ¥ç±»å‹
- ä¼˜å…ˆçº§
- æ¥æ”¶äººé€‰æ‹©ï¼ˆå¤šç§ç­›é€‰æ–¹å¼ï¼‰
- å®šæ—¶å‘é€è®¾ç½®

---

## ğŸ“Š æ•°æ®æµç¨‹

### å‘é€é€šçŸ¥æµç¨‹

1. å›­é•¿åˆ›å»ºé€šçŸ¥ï¼Œé€‰æ‹©æ¥æ”¶äºº
2. åç«¯åˆ›å»ºnotification_templateè®°å½•
3. æ ¹æ®æ¥æ”¶äººç­›é€‰æ¡ä»¶ï¼ŒæŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„ç”¨æˆ·åˆ—è¡¨
4. ä¸ºæ¯ä¸ªç”¨æˆ·åˆ›å»ºä¸€æ¡notificationè®°å½•
5. æ›´æ–°templateçš„total_recipientså­—æ®µ
6. è¿”å›æˆåŠŸå“åº”

### ç»Ÿè®¡æŸ¥è¯¢æµç¨‹

1. æŸ¥è¯¢æ‰€æœ‰notification_templateè®°å½•ï¼ˆåˆ†é¡µï¼‰
2. å¯¹äºæ¯ä¸ªtemplateï¼ŒèšåˆæŸ¥è¯¢å¯¹åº”çš„notificationsè®°å½•
3. è®¡ç®—å·²è¯»äººæ•°ã€æœªè¯»äººæ•°ã€é˜…è¯»ç‡
4. è¿”å›ç»Ÿè®¡æ•°æ®

### è¯¦æƒ…æŸ¥è¯¢æµç¨‹

1. æ ¹æ®templateIdæŸ¥è¯¢notification_template
2. æŸ¥è¯¢æ‰€æœ‰å…³è”çš„notificationsè®°å½•
3. å…³è”userè¡¨è·å–ç”¨æˆ·ä¿¡æ¯
4. æŒ‰å·²è¯»/æœªè¯»åˆ†ç»„
5. è¿”å›è¯¦ç»†åˆ—è¡¨

---

## ğŸ” æƒé™æ§åˆ¶

### è§’è‰²æƒé™

- **å›­é•¿/ç®¡ç†å‘˜**:
  - æŸ¥çœ‹æ‰€æœ‰é€šçŸ¥ç»Ÿè®¡
  - æŸ¥çœ‹æ‰€æœ‰é€šçŸ¥è¯¦æƒ…
  - åˆ›å»ºå’Œå‘é€é€šçŸ¥
  - å¯¼å‡ºé˜…è¯»æŠ¥å‘Š

- **æ•™å¸ˆ**:
  - åªèƒ½æŸ¥çœ‹è‡ªå·±æ”¶åˆ°çš„é€šçŸ¥
  - ä¸èƒ½æŸ¥çœ‹ç»Ÿè®¡æ•°æ®
  - ä¸èƒ½åˆ›å»ºé€šçŸ¥

---

## ğŸ“ å®æ–½è®¡åˆ’

### Phase 1: æ•°æ®åº“ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰
- [ ] åˆ›å»ºnotification_templatesè¡¨
- [ ] æ·»åŠ è¿ç§»è„šæœ¬
- [ ] æ›´æ–°Sequelizeæ¨¡å‹

### Phase 2: åç«¯APIå¼€å‘
- [ ] åˆ›å»ºNotificationCenterController
- [ ] å®ç°ç»Ÿè®¡æŸ¥è¯¢é€»è¾‘
- [ ] å®ç°è¯¦æƒ…æŸ¥è¯¢é€»è¾‘
- [ ] å®ç°åˆ›å»ºé€šçŸ¥é€»è¾‘
- [ ] å®ç°å¯¼å‡ºæŠ¥å‘Šé€»è¾‘

### Phase 3: å‰ç«¯é¡µé¢å¼€å‘
- [ ] åˆ›å»ºNotificationCenter.vue
- [ ] å®ç°ç»Ÿè®¡å¡ç‰‡
- [ ] å®ç°é€šçŸ¥åˆ—è¡¨
- [ ] å®ç°è¯¦æƒ…å¯¹è¯æ¡†
- [ ] å®ç°åˆ›å»ºé€šçŸ¥å¯¹è¯æ¡†

### Phase 4: æµ‹è¯•å’Œä¼˜åŒ–
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] UI/UXä¼˜åŒ–

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-09

