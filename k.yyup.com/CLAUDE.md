# CLAUDE.md
This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

**è¯·ä½¿ç”¨ä¸­æ–‡å›å¤ã€‚Please respond in Chinese.**


## ğŸš¨ é‡è¦è§„åˆ™
### æµ‹è¯•ç”¨ä¾‹ä¸¥æ ¼éªŒè¯è§„åˆ™
**å¼ºåˆ¶æ‰§è¡Œ**: ç¼–å†™æˆ–ä¿®å¤APIæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œå¿…é¡»éµå¾ªä¸¥æ ¼éªŒè¯æ ‡å‡†ã€‚
è¯¦è§ï¼š`.augment/rules/STRICT_TEST_VALIDATION.md`
**æ ¸å¿ƒè¦æ±‚**:
1. âœ… **æ•°æ®ç»“æ„éªŒè¯** - éªŒè¯APIè¿”å›çš„æ•°æ®æ ¼å¼
2. âœ… **å­—æ®µç±»å‹éªŒè¯** - éªŒè¯æ‰€æœ‰å­—æ®µçš„æ•°æ®ç±»å‹
3. âœ… **å¿…å¡«å­—æ®µéªŒè¯** - éªŒè¯æ‰€æœ‰å¿…å¡«å­—æ®µå­˜åœ¨
4. âœ… **æ§åˆ¶å°é”™è¯¯æ£€æµ‹** - æ•è·æ‰€æœ‰æ§åˆ¶å°é”™è¯¯
**ç¦æ­¢**: åªä½¿ç”¨ `expect(result).toEqual(mockResponse)` çš„æµ…å±‚éªŒè¯
**å¿…é¡»**: ä½¿ç”¨ `validateRequiredFields`, `validateFieldTypes` ç­‰å·¥å…·è¿›è¡Œä¸¥æ ¼éªŒè¯
---
## ğŸ—ï¸ ç»Ÿä¸€ç§Ÿæˆ·æ¶æ„

### ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ
æœ¬é¡¹ç›®é‡‡ç”¨**ç»Ÿä¸€ç§Ÿæˆ·ç®¡ç†æ¶æ„**ï¼ŒåŒ…å«ä¸¤ä¸ªç‹¬ç«‹çš„ç³»ç»Ÿï¼š

#### 1. ç»Ÿä¸€ç§Ÿæˆ·ç®¡ç†ä¸­å¿ƒ (`/home/zhgue/kyyupgame/unified-tenant-system/`)
- **åŠŸèƒ½**: è´Ÿè´£ç§Ÿæˆ·è´¦å·çš„åˆ›å»ºã€æŸ¥çœ‹ã€åˆ é™¤ã€ç»Ÿè®¡
- **ç®¡ç†å¯¹è±¡**: ç§Ÿæˆ·è´¦å·ã€OSSç©ºé—´åˆ†é…ã€åŸŸåç»‘å®š
- **æƒé™**: è¶…çº§ç®¡ç†å‘˜ç®¡ç†æ‰€æœ‰ç§Ÿæˆ·
- **åŸŸå**: `rent.yyup.cc` (ç»Ÿä¸€ç§Ÿæˆ·ç®¡ç†)

#### 2. ç§Ÿæˆ·ä¸šåŠ¡ç³»ç»Ÿ (`/home/zhgue/kyyupgame/k.yyup.com/`)
- **åŠŸèƒ½**: ç‹¬ç«‹çš„å¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿï¼Œä½¿ç”¨åˆ†é…çš„OSSç©ºé—´è¿›è¡Œä¸šåŠ¡æ“ä½œ
- **ç®¡ç†å¯¹è±¡**: æ–‡æœ¬ã€å›¾ç‰‡ã€å¤šåª’ä½“æ–‡ä»¶çš„å¢åˆ æ”¹æŸ¥ã€ä¸šåŠ¡æ•°æ®
- **æƒé™**: ç§Ÿæˆ·å†…éƒ¨ç”¨æˆ·ç®¡ç†è‡ªå·±çš„ä¸šåŠ¡æ•°æ®
- **åŸŸå**: `k.yyup.cc` (å•ä¸ªç§Ÿæˆ·ä¸šåŠ¡ç³»ç»Ÿ)

### ç»Ÿä¸€è®¤è¯æµç¨‹
1. **ç”¨æˆ·æ³¨å†Œ**: é€šè¿‡ç»Ÿä¸€ç§Ÿæˆ·ä¸­å¿ƒåˆ›å»ºè´¦å·
2. **ç§Ÿæˆ·åˆ†é…**: è¶…çº§ç®¡ç†å‘˜ä¸ºç”¨æˆ·åˆ†é…OSSç©ºé—´å’ŒåŸŸå
3. **è·¨ç§Ÿæˆ·ç™»å½•**: æ”¯æŒç”¨æˆ·åœ¨ä¸åŒç§Ÿæˆ·é—´åˆ‡æ¢
4. **æƒé™éš”ç¦»**: æ¯ä¸ªç§Ÿæˆ·æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®å’Œé…ç½®

### ç›®å½•ç»“æ„
```
/home/zhgue/kyyupgame/
â”œâ”€â”€ unified-tenant-system/    # ç»Ÿä¸€ç§Ÿæˆ·ç®¡ç†ä¸­å¿ƒ (rent.yyup.cc)
â”‚   â”œâ”€â”€ client/              # å‰ç«¯ç•Œé¢
â”‚   â””â”€â”€ server/              # åç«¯API
â””â”€â”€ k.yyup.com/              # ç§Ÿæˆ·ä¸šåŠ¡ç³»ç»Ÿ (k.yyup.cc)
    â”œâ”€â”€ client/              # å‰ç«¯ç•Œé¢
    â””â”€â”€ server/              # åç«¯API
```

## é¡¹ç›®æ¦‚è§ˆ
å¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿï¼ŒVue 3 + Express.jså…¨æ ˆæ¶æ„ï¼ŒåŠ¨æ€æƒé™ç³»ç»Ÿï¼ŒAIé›†æˆã€‚
**è§„æ¨¡**: 80+Vueç»„ä»¶ï¼Œ162+é¡µé¢ï¼Œ155+APIç«¯ç‚¹ï¼Œ73+æ•°æ®æ¨¡å‹ï¼Œ95+æƒé™è®°å½•ï¼Œ~150kè¡Œä»£ç 
**å½“å‰é¡¹ç›®**: `k.yyup.com` (ç§Ÿæˆ·ä¸šåŠ¡ç³»ç»Ÿ)
**è®¿é—®åœ°å€**: `http://localhost:5173` (æ˜ å°„localhost:5173)ï¼ŒAPI: `http://localhost:3000`

## ğŸš¨ APIç«¯ç‚¹é‡å¤é—®é¢˜æ£€æµ‹
### é—®é¢˜æè¿°
é¡¹ç›®å­˜åœ¨ä¸¥é‡çš„å‰åç«¯APIé‡å¤å®šä¹‰é—®é¢˜ï¼Œå·²æ£€æµ‹å‡º221ä¸ªæ½œåœ¨å†²çªï¼Œå…¶ä¸­42ä¸ªä¸¥é‡é‡å¤ã€‚

### æ£€æµ‹å·¥å…·
**è„šæœ¬**: `scripts/api-endpoint-duplicate-scanner.js` - APIç«¯ç‚¹é‡å¤æ£€æµ‹å·¥å…·
**ä½¿ç”¨æ–¹æ³•**:
```bash
node scripts/api-endpoint-duplicate-scanner.js
```

### ä¸¥é‡é‡å¤APIç«¯ç‚¹
- `/tasks` - ä»»åŠ¡ç›¸å…³APIåœ¨å‰åç«¯å¤šå¤„é‡å¤å®šä¹‰
- `/classes` - ç­çº§ç®¡ç†APIåˆ†æ•£åœ¨å¤šä¸ªåç«¯æœåŠ¡ä¸­
- `/activities` - æ´»åŠ¨ç›¸å…³APIåœ¨ç»Ÿè®¡ã€ä»ªè¡¨æ¿ç­‰å¤šä¸ªæ¨¡å—é‡å¤
- `/system/settings` - ç³»ç»Ÿè®¾ç½®APIé‡å¤å®šä¹‰

### æ£€æµ‹ç»“æœ
- **å‰ç«¯æ–‡ä»¶**: 131ä¸ªï¼ŒåŒ…å«1127ä¸ªAPIè°ƒç”¨
- **åç«¯æ–‡ä»¶**: 387ä¸ªï¼ŒåŒ…å«3080ä¸ªAPIå®šä¹‰
- **æ½œåœ¨å†²çª**: 221ä¸ªï¼ˆ42ä¸ªå®Œå…¨é‡å¤ï¼Œ179ä¸ªç›¸ä¼¼ç«¯ç‚¹ï¼‰

### ä¿®å¤å»ºè®®
1. **APIç½‘å…³ç»Ÿä¸€ç®¡ç†** - å»ºç«‹ç»Ÿä¸€çš„APIè·¯ç”±ç®¡ç†
2. **ç«¯ç‚¹å‘½åè§„èŒƒ** - åˆ¶å®šä¸¥æ ¼çš„APIå‘½åè§„èŒƒ
3. **æœåŠ¡æ‹†åˆ†** - æŒ‰ä¸šåŠ¡åŸŸæ‹†åˆ†å¾®æœåŠ¡
4. **ä»£ç å®¡æŸ¥** - å»ºç«‹APIè®¾è®¡çš„ä»£ç å®¡æŸ¥æµç¨‹

### ç›¸å…³æ–‡ä»¶
- `API_ENDPOINT_DUPLICATE_REPORT.md` - è¯¦ç»†æ£€æµ‹æŠ¥å‘Šï¼ˆ33000+è¡Œï¼‰
- `API_DUPLICATE_ANALYSIS_SUMMARY.md` - é—®é¢˜åˆ†æå’Œä¿®å¤å»ºè®®
## æ ¸å¿ƒæ¶æ„
### å‰ç«¯ (`client/`)
- Vue 3 + TypeScript + Vite + Element Plus + Pinia
- åŠ¨æ€æƒé™è·¯ç”±ã€RBACè®¿é—®æ§åˆ¶ã€å“åº”å¼è®¾è®¡
- Vitest + Playwrightæµ‹è¯•
### åç«¯ (`server/`)  
- Express.js + TypeScript + Sequelize + MySQL
- JWTè®¤è¯ã€RBACæƒé™ã€APIéªŒè¯
- Controller-Service-Modelæ¨¡å¼ï¼ŒSwaggeræ–‡æ¡£
### ä¸šåŠ¡é¢†åŸŸ
ç”¨æˆ·ç®¡ç†ã€æ‹›ç”Ÿç³»ç»Ÿã€æ•™è‚²ç®¡ç†ã€æ´»åŠ¨ç®¡ç†ã€AIæœåŠ¡ã€è¥é”€ç®¡ç†
## åŠ¨æ€è·¯ç”±æƒé™ç³»ç»Ÿ
### ä¸‰çº§æƒé™å±‚æ¬¡
- ä¸€çº§ç±»ç›®(9ä¸ª) â†’ äºŒçº§é¡µé¢(74ä¸ª) â†’ ä¸‰çº§ç»„ä»¶(2ä¸ª)
### å‰ç«¯åŠ¨æ€è·¯ç”±
**æ ¸å¿ƒæ–‡ä»¶**: `client/src/router/index.ts`, `dynamic-routes.ts`, `optimized-routes.ts`
**æµç¨‹**: è°ƒç”¨æƒé™API â†’ è½¬æ¢è·¯ç”±æ ‘ â†’ ç»„ä»¶æ˜ å°„ â†’ è·¯ç”±æ³¨å†Œ
### åç«¯æƒé™API
```typescript
GET /api/dynamic-permissions/dynamic-routes
GET /api/dynamic-permissions/user-permissions  
POST /api/dynamic-permissions/check-permission
```
## å¼€å‘å‘½ä»¤
### å¯åŠ¨
**æ³¨æ„ï¼šclientå’Œserveræ˜¯ç‹¬ç«‹çš„é¡¹ç›®ç›®å½•ï¼Œéœ€è¦åˆ†åˆ«åœ¨å„è‡ªç›®å½•ä¸‹å¯åŠ¨**
**æ¨èå¯åŠ¨æ–¹å¼ï¼š**
```bash
# åŒæ—¶å¯åŠ¨å‰ç«¯å’Œåç«¯ï¼ˆæ¨èï¼‰
npm run start:all           # å¹¶å‘å¯åŠ¨å‰åç«¯æœåŠ¡
# åˆ†åˆ«å¯åŠ¨ï¼ˆåœ¨ä¸åŒç»ˆç«¯ï¼‰
npm run start:frontend      # å‰ç«¯å¼€å‘æœåŠ¡å™¨(5173ç«¯å£)
npm run start:backend       # åç«¯å¼€å‘æœåŠ¡å™¨(3000ç«¯å£)
```
**å…¶ä»–å¯åŠ¨é€‰é¡¹ï¼š**
```bash
# æ ¹ç›®å½•å¯åŠ¨æ–¹å¼
npm start                   # è‡ªåŠ¨å¯åŠ¨æ‰€æœ‰æœåŠ¡
npm run dev                 # å¼€å‘æ¨¡å¼ï¼ˆç¼–è¯‘+å¯åŠ¨åç«¯ï¼‰
# åœ¨å„è‡ªç›®å½•å¯åŠ¨
cd client && npm run dev    # å‰ç«¯å¼€å‘æœåŠ¡å™¨
cd server && npm run dev    # åç«¯å¼€å‘æœåŠ¡å™¨
```
**é‡è¦æç¤ºï¼š**
- æ¨èä½¿ç”¨æ ¹ç›®å½•çš„ `npm run start:all` å¹¶å‘å¯åŠ¨å‰åç«¯
- å¯ä»¥ä½¿ç”¨ `npm run status` æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€
- å¦‚éœ€åœæ­¢æ‰€æœ‰æœåŠ¡ï¼Œä½¿ç”¨ `npm run stop`
- å‰ç«¯åŸŸåæ˜ å°„ï¼š`http://localhost:5173` (æŒ‡å‘localhost:5173)
- åç«¯APIåœ°å€ï¼š`http://localhost:3000`
### æ•°æ®åº“ç®¡ç†
```bash
# æ•°æ®åˆå§‹åŒ–å’Œç§å­æ•°æ®
npm run seed-data:complete   # å®Œæ•´åˆå§‹åŒ–æ•°æ®åº“å’Œæµ‹è¯•æ•°æ®
npm run seed-data:all        # è¿è¡Œæ‰€æœ‰ç§å­æ•°æ®è„šæœ¬
npm run seed-data:basic      # åŸºç¡€æ•°æ®åˆå§‹åŒ–
# æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–
npm run db:diagnose          # æ•°æ®åº“æ€§èƒ½è¯Šæ–­
npm run db:optimize          # æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–
npm run db:indexes           # ä¼˜åŒ–æ•°æ®åº“ç´¢å¼•
npm run db:slow-queries      # ç›‘æ§æ…¢æŸ¥è¯¢
npm run db:monitor           # æ•°æ®åº“æ€§èƒ½ç›‘æ§
# ç‰¹å®šä¸šåŠ¡æ•°æ®ç§å­
npm run seed-data:teacher    # æ•™å¸ˆæ•°æ®
npm run seed-data:student    # å­¦ç”Ÿæ•°æ®
npm run seed-data:activity   # æ´»åŠ¨æ•°æ®
npm run seed-data:marketing  # è¥é”€æ•°æ®
npm run seed-data:parent     # å®¶é•¿æ•°æ®
# æ³¨æ„ï¼šæ•°æ®åº“è¿ç§»é€šè¿‡serverç›®å½•çš„Sequelize CLIç®¡ç†
# cd server && npx sequelize-cli db:migrate
```
### æµ‹è¯•æ„å»º
```bash
# ç»¼åˆæµ‹è¯•
npm test                     # è¿è¡Œé›†æˆæµ‹è¯•å¥—ä»¶
npm run test:all            # è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:ci             # CIæ¨¡å¼è¿è¡Œæ‰€æœ‰æµ‹è¯•
# åˆ†ç±»æµ‹è¯•
npm run test:unit           # è¿è¡Œå•å…ƒæµ‹è¯• (å‰ç«¯+åç«¯)
npm run test:integration    # è¿è¡Œé›†æˆæµ‹è¯•
npm run test:e2e           # è¿è¡ŒE2Eæµ‹è¯• (Playwright)
npm run test:backend        # åç«¯æµ‹è¯•
npm run test:frontend       # å‰ç«¯æµ‹è¯•
npm run test:api            # APIæµ‹è¯•å¥—ä»¶
npm run test:apitest        # è¿è¡ŒAPItestç›®å½•æµ‹è¯•
# ä¸“é¡¹æµ‹è¯•
npm run test:ai-assistant   # AIåŠ©æ‰‹åŠŸèƒ½æµ‹è¯•
npm run test:smart-agent    # æ™ºèƒ½ä»£ç†åŠŸèƒ½æ£€æµ‹
npm run test:e2e:comprehensive # ç»¼åˆE2Eæµ‹è¯•
# æµ‹è¯•è¦†ç›–ç‡
npm run test:coverage       # ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
npm run coverage:monitor    # ç›‘æ§æµ‹è¯•è¦†ç›–ç‡
npm run test:report         # ç”Ÿæˆå®Œæ•´æµ‹è¯•æŠ¥å‘Š
# æ„å»ºå’ŒéªŒè¯
npm run build               # ç”Ÿäº§æ„å»º (å‰ç«¯+åç«¯)
npm run validate            # ä»£ç éªŒè¯ (TS+ESLint+å•å…ƒæµ‹è¯•)
npm run quality:check       # å®Œæ•´è´¨é‡æ£€æŸ¥
# ä»£ç æ£€æŸ¥
npm run lint                # ä»£ç é£æ ¼æ£€æŸ¥
npm run typecheck           # TypeScriptç±»å‹æ£€æŸ¥
# æ¸…ç†
npm run clean               # æ¸…ç†æ„å»ºæ–‡ä»¶
npm run clean:all           # æ¸…ç†æ‰€æœ‰ä¾èµ–å’Œæ„å»ºæ–‡ä»¶
```
## å…³é”®æ¶æ„æ¨¡å¼
### APIæ¶æ„
- **ç«¯ç‚¹**: `client/src/api/endpoints/` æŒ‰ä¸šåŠ¡åŸŸåˆ†ç±»
- **æœåŠ¡**: `client/src/api/modules/` ç‰¹å®šåŠŸèƒ½API
- **è¯·æ±‚**: `@/utils/request` HTTPå®¢æˆ·ç«¯
- **ç±»å‹**: `ApiResponse<T>` æ¥å£æ¨¡å¼
### æ•°æ®åº“å…³ç³»
- ç”¨æˆ·: User â†” Role â†” Permission
- æ•™è‚²: Student â†” Class â†” Teacher  
- æ‹›ç”Ÿ: Application â†’ Interview â†’ Admission
- æ´»åŠ¨: Activity â†’ Registration â†’ Evaluation
### AIé›†æˆ
- è®°å¿†ç³»ç»Ÿ: å…­ç»´è®°å¿†æ¨¡å‹ï¼Œå‘é‡ç›¸ä¼¼æ€§æœç´¢
- æ¨¡å‹ç®¡ç†: å¯é…ç½®AIæ¨¡å‹ï¼Œæ”¯æŒå¤šæä¾›å•†
- æœåŠ¡å±‚: æ™ºèƒ½åŠ©æ‰‹APIé›†æˆ (`/api/ai`, `/api/ai-query`)
- MCPé›†æˆ: æ”¯æŒModel Context Protocolï¼Œé…ç½®Playwrightæµè§ˆå™¨è‡ªåŠ¨åŒ–
- æ™ºèƒ½ä»£ç†: å·¥å…·é“¾æ‰§è¡Œï¼Œæ”¯æŒæ´»åŠ¨æ–¹æ¡ˆç”Ÿæˆå’Œå·¥ä½œæµæ‰§è¡Œ
## ç›®å½•ç»“æ„
### å‰ç«¯ (`client/src/`)
```
components/    # 80+ç»„ä»¶
pages/         # 162+é¡µé¢  
stores/        # PiniaçŠ¶æ€
api/           # APIå®¢æˆ·ç«¯
router/        # è·¯ç”±é…ç½®
utils/         # å·¥å…·å‡½æ•°
styles/        # å…¨å±€æ ·å¼
```
### åç«¯ (`server/src/`)
```
controllers/   # 73+æ§åˆ¶å™¨
models/        # 73+æ•°æ®æ¨¡å‹
routes/        # 155+ç«¯ç‚¹
services/      # ä¸šåŠ¡é€»è¾‘
middlewares/   # ä¸­é—´ä»¶
config/        # é…ç½®
utils/         # å·¥å…·å‡½æ•°
```
## æ ¸å¿ƒAPIè·¯ç”±
### ç³»ç»Ÿ
- `/auth` - è®¤è¯ (login/logout/refresh)
- `/dashboard` - ä»ªè¡¨æ¿ (stats/overview/charts)
### ä¸šåŠ¡
- `/users`,`/roles`,`/permissions` - ç”¨æˆ·æƒé™
- `/teachers`,`/students`,`/parents`,`/classes` - æ•™è‚²ç®¡ç†
- `/enrollment-*` - æ‹›ç”Ÿç®¡ç†
- `/activities`,`/activity-*` - æ´»åŠ¨ç®¡ç†  
- `/ai`,`/ai-query` - AIæœåŠ¡
- `/system`,`/system-*` - ç³»ç»Ÿç®¡ç†
- `/advertisements`,`/marketing-campaigns` - è¥é”€
- `/customer-pool` - å®¢æˆ·æ± 
- `/notifications`,`/schedules`,`/todos` - åŠŸèƒ½æœåŠ¡
## å¼€å‘åŸåˆ™
### APIå¼€å‘
- ä½¿ç”¨ `@/utils/request` è¿›è¡Œè°ƒç”¨
- éµå¾ª `ApiResponse<T>` æ¨¡å¼  
- `ErrorHandler` ç±»é›†ä¸­é”™è¯¯å¤„ç†
### æ•°æ®åº“
- Sequelize ORMç®¡ç†æ¶æ„å˜æ›´
- TypeScriptæ¥å£å¼ºç±»å‹
- å¼€å‘å‰è¿è¡Œ `npm run seed-data:complete` åˆå§‹åŒ–æ•°æ®
- æ¨¡å‹å…³è”åœ¨ `server/src/models/index.ts` ä¸­ç»Ÿä¸€ç®¡ç†
### æƒé™
- å¯¼èˆªå®ˆå«æƒé™éªŒè¯
- ä¸­é—´ä»¶æƒé™æ£€æŸ¥
- æ•°æ®åº“é©±åŠ¨è·¯ç”±ç”Ÿæˆ
### æ€§èƒ½
- å‰ç«¯: ä»£ç åˆ†å‰²ã€æ‡’åŠ è½½
- åç«¯: è¿æ¥æ± ã€ç´¢å¼•ä¼˜åŒ–
### æµ‹è¯•
- Jest/Vitest 70%è¦†ç›–ç‡
- Playwright E2Eå¤šæµè§ˆå™¨ (å¿…é¡»ä½¿ç”¨æ— å¤´æ¨¡å¼)
- 155+ç«¯ç‚¹å‚æ•°éªŒè¯
- **Playwrighté…ç½®**: æ‰€æœ‰æµ‹è¯•å¿…é¡»è®¾ç½® `headless: true`
## å‘½åçº¦å®š
- **ç»„ä»¶**: PascalCase - `StudentEditDialog.vue`
- **é¡µé¢**: kebab-case - `student-management.vue`  
- **API**: `/api/resource` é›†åˆ, `/api/resource/:id` å•é¡¹
- **æ•°æ®åº“**: snake_caseè¡¨å, camelCaseå±æ€§
## é‡è¦æ¶æ„è¯´æ˜
### åŠ¨æ€è·¯ç”±ç³»ç»Ÿ
- æ ¸å¿ƒæ–‡ä»¶: `client/src/router/dynamic-routes.ts` - 1300+è¡Œæ ¸å¿ƒè·¯ç”±ç”Ÿæˆå™¨
- ç»„ä»¶æ˜ å°„: é¢„å®šä¹‰160+ç»„ä»¶æ˜ å°„ï¼Œæ”¯æŒåŠ¨æ€å¯¼å…¥å’Œé”™è¯¯å¤„ç†
- æƒé™é›†æˆ: ä¸åç«¯æƒé™APIå®Œå…¨é›†æˆï¼Œæ”¯æŒç»†ç²’åº¦æƒé™æ§åˆ¶
- æ€§èƒ½ä¼˜åŒ–: è·¯ç”±ç¼“å­˜ã€æ‡’åŠ è½½ã€é”™è¯¯é™çº§æœºåˆ¶
### æ•°æ®åº“æ¨¡å‹ç³»ç»Ÿ  
- æ¨¡å‹æ€»æ•°: 73+æ•°æ®æ¨¡å‹ï¼Œè¦†ç›–æ‰€æœ‰ä¸šåŠ¡é¢†åŸŸ
- å…³è”å…³ç³»: å¤æ‚çš„å¤šå¯¹å¤šå…³ç³»ç®¡ç†ï¼ˆUser-Role-Permissionï¼‰
- åˆå§‹åŒ–: `server/src/models/index.ts`ç»Ÿä¸€ç®¡ç†æ¨¡å‹å’Œå…³è”
- Sequelize ORM: å®Œæ•´çš„è¿ç§»å’Œç§å­æ•°æ®ç³»ç»Ÿ
### å‰ç«¯ç»„ä»¶æ¶æ„
- é¡µé¢æ€»æ•°: 113ä¸ªVueæ–‡ä»¶
- åŠŸèƒ½é¡µé¢: 32ä¸ªç‹¬ç«‹ä¸šåŠ¡é¡µé¢
- ç»„ä»¶åŒ–é¡µé¢: 67ä¸ªå¯å¤ç”¨åŠŸèƒ½ç»„ä»¶  
- ä¸­å¿ƒåŒ–è®¾è®¡: 9ä¸ªä¸­å¿ƒé¡µé¢æ•´åˆä¸šåŠ¡åŠŸèƒ½
### AIé›†æˆæ¶æ„
- è®°å¿†ç³»ç»Ÿ: å…­ç»´è®°å¿†æ¨¡å‹æ›¿ä»£ä¼ ç»Ÿè®°å¿†ç³»ç»Ÿ
- æ¨¡å‹ç®¡ç†: å¯é…ç½®å¤šæä¾›å•†AIæ¨¡å‹
- æ™ºèƒ½åˆ†æ: AIæ¸—é€åˆ°æ‹›ç”Ÿã€æ•™å­¦ã€ç®¡ç†å„ç¯èŠ‚
- æ€§èƒ½ç›‘æ§: AIä½¿ç”¨é‡ç»Ÿè®¡å’Œæ€§èƒ½ç›‘æ§
## å¼€å‘å·¥ä½œæµ
### æ·»åŠ æ–°åŠŸèƒ½
1. æ•°æ®åº“: åˆ›å»ºæ¨¡å‹å’Œè¿ç§»æ–‡ä»¶ (`server/src/models/`, `server/src/migrations/`)
2. åç«¯: æ·»åŠ æ§åˆ¶å™¨ã€æœåŠ¡ã€è·¯ç”± (`server/src/controllers/`, `server/src/services/`, `server/src/routes/`)
3. å‰ç«¯: åˆ›å»ºé¡µé¢ç»„ä»¶å’ŒAPIè°ƒç”¨ (`client/src/pages/`, `client/src/api/`)
4. æƒé™: åœ¨åŠ¨æ€æƒé™ç³»ç»Ÿä¸­é…ç½®æƒé™ (`server/src/controllers/dynamic-permissions.ts`)
5. æµ‹è¯•: ç¼–å†™å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
6. éªŒè¯: è¿è¡Œ `npm run validate` ç¡®ä¿ä»£ç è´¨é‡
### é¡¹ç›®åˆå§‹åŒ–æµç¨‹
1. å®‰è£…ä¾èµ–: `npm run install:all`
2. æ•°æ®åº“åˆå§‹åŒ–: `npm run seed-data:complete`
3. å¯åŠ¨å¼€å‘ç¯å¢ƒ: `npm run start:all`
4. éªŒè¯å®‰è£…: è®¿é—® http://localhost:5173 å’Œ http://localhost:3000/api-docs
### è°ƒè¯•æƒé™é—®é¢˜
1. æ£€æŸ¥ `/api/dynamic-permissions/user-permissions` æ¥å£
2. éªŒè¯è·¯ç”±æƒé™é…ç½®
3. æŸ¥çœ‹ `client/src/router/dynamic-routes.ts` ä¸­çš„ç»„ä»¶æ˜ å°„
4. ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·æ£€æŸ¥è·¯ç”±ç”Ÿæˆè¿‡ç¨‹
### æ€§èƒ½ä¼˜åŒ–
- å‰ç«¯: ç»„ä»¶æ‡’åŠ è½½å·²å®ç°ï¼Œè·¯ç”±çº§ä»£ç åˆ†å‰²
- åç«¯: æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–ï¼Œè¿æ¥æ± é…ç½®  
- AI: æŸ¥è¯¢ç¼“å­˜å’Œå“åº”ä¼˜åŒ–
- ç›‘æ§: ä½¿ç”¨ `npm run db:diagnose` è¿›è¡Œæ•°æ®åº“æ€§èƒ½è¯Šæ–­
## ç³»ç»Ÿè¦æ±‚
- **Node.js**: >= 18.0.0
- **npm**: >= 8.0.0
- **MySQL**: >= 8.0
- **æ“ä½œç³»ç»Ÿ**: Linux, macOS, Windows
- **æµè§ˆå™¨**: Chrome, Firefox, Safari (ç”¨äºE2Eæµ‹è¯•)
- **å†…å­˜**: å»ºè®® >= 8GB (ç”¨äºAIåŠŸèƒ½å’Œå¤§å‹æ•°æ®é›†)
## æµ‹è¯•ä½“ç³»
### æµ‹è¯•è¦†ç›–ç‡è¦æ±‚
é¡¹ç›®å®ç°äº†å®Œæ•´çš„æµ‹è¯•ä½“ç³»ï¼Œç¡®ä¿ä»£ç è´¨é‡ï¼š
| ç»„ä»¶ | è¯­å¥è¦†ç›–ç‡ | åˆ†æ”¯è¦†ç›–ç‡ | å‡½æ•°è¦†ç›–ç‡ | è¡Œè¦†ç›–ç‡ |
|------|------------|------------|------------|----------|
| å®¢æˆ·ç«¯ | â‰¥85% | â‰¥80% | â‰¥85% | â‰¥85% |
| æœåŠ¡ç«¯ | â‰¥95% | â‰¥90% | â‰¥95% | â‰¥95% |
| å…¨å±€ | â‰¥90% | â‰¥85% | â‰¥90% | â‰¥90% |
### æµ‹è¯•å·¥å…·é…ç½®
| æµ‹è¯•ç±»å‹ | å·¥å…· | é…ç½®æ–‡ä»¶ |
|---------|------|----------|
| å•å…ƒæµ‹è¯• (å®¢æˆ·ç«¯) | Vitest | `client/vitest.config.ts` |
| å•å…ƒæµ‹è¯• (æœåŠ¡ç«¯) | Jest | `server/jest.config.js` |
| ç«¯åˆ°ç«¯æµ‹è¯• | Playwright | `client/playwright.config.ts` |
| è¦†ç›–ç‡ç›‘æ§ | è‡ªå®šä¹‰è„šæœ¬ | `scripts/coverage-monitor.js` |
### Playwright æ— å¤´æµè§ˆå™¨é…ç½®
**é‡è¦**: æ‰€æœ‰Playwrightæµ‹è¯•å¿…é¡»ä½¿ç”¨æ— å¤´æµè§ˆå™¨æ¨¡å¼
**é…ç½®è¯´æ˜**:
- âœ… **å¿…é¡»**: `headless: true` - æ‰€æœ‰ç¯å¢ƒéƒ½ä½¿ç”¨æ— å¤´æ¨¡å¼
- âŒ **ç¦æ­¢**: `headless: false` - ä¸å…è®¸ä½¿ç”¨æœ‰å¤´æµè§ˆå™¨
- âŒ **ç¦æ­¢**: `headless: process.env.CI ? true : false` - ä¸å…è®¸æ¡ä»¶åˆ¤æ–­
**é…ç½®æ–‡ä»¶**:
- `client/playwright.config.ts` - ä¸»é…ç½®æ–‡ä»¶
- `client/playwright.config.chromium.ts` - Chromiumé…ç½®
- `client/tests/**/*.test.ts` - æµ‹è¯•æ–‡ä»¶ä¸­çš„æµè§ˆå™¨å¯åŠ¨
**ç¤ºä¾‹**:
```typescript
// âœ… æ­£ç¡®åšæ³•
const browser = await chromium.launch({
  headless: true,
  devtools: false
});
// âŒ é”™è¯¯åšæ³•
const browser = await chromium.launch({
  headless: false,  // ä¸å…è®¸
  devtools: true    // ä¸å…è®¸
});
```
**ä¼˜åŠ¿**:
- âœ… æµ‹è¯•é€Ÿåº¦æå‡ 30-50%
- âœ… ç³»ç»Ÿèµ„æºå ç”¨é™ä½ 40-60%
- âœ… æ›´ç¨³å®šçš„æµ‹è¯•ç»“æœ
- âœ… é€‚åˆCI/CDç¯å¢ƒ
### æ•…éšœæ’é™¤
å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆï¼š
**æ•°æ®åº“è¿æ¥å¤±è´¥**ï¼š
```bash
# æ£€æŸ¥æ•°æ®åº“é…ç½®å¹¶æµ‹è¯•è¿æ¥
cat server/.env
cd server && npm run db:migrate
```
**ç«¯å£å ç”¨é—®é¢˜**ï¼š
```bash
# æ£€æŸ¥ç«¯å£å ç”¨å¹¶æ€æ­»è¿›ç¨‹
lsof -i :3000
lsof -i :5173
npm run clean
```
**ä¾èµ–å®‰è£…å¤±è´¥**ï¼š
```bash
# æ¸…ç†å¹¶é‡æ–°å®‰è£…ä¾èµ–
npm run clean:all
npm run install:all
```
**æœåŠ¡å¯åŠ¨å¤±è´¥**ï¼š
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
npm run status
# åœæ­¢æ‰€æœ‰æœåŠ¡åé‡æ–°å¯åŠ¨
npm run stop
npm run start:all
# æ£€æŸ¥ç«¯å£å ç”¨å¹¶å¼ºåˆ¶æ¸…ç†
cd client && npm run dev:cross  # è·¨å¹³å°ç«¯å£æ¸…ç†
```
**Playwrightæµ‹è¯•å¤±è´¥**ï¼š
```bash
# æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æœ‰å¤´æµè§ˆå™¨
grep -r "headless.*false" client/
# ç¡®ä¿æ‰€æœ‰é…ç½®éƒ½æ˜¯ headless: true
grep -r "headless:" client/playwright.config.ts
grep -r "headless:" client/tests/
# è¿è¡ŒE2Eæµ‹è¯•
npm run test:e2e
# å¦‚æœæµ‹è¯•ä»ç„¶å¤±è´¥ï¼Œæ£€æŸ¥æµè§ˆå™¨é…ç½®
# ç¡®ä¿æ²¡æœ‰ devtools: true æˆ–å…¶ä»–æœ‰å¤´é…ç½®
```
**æ•°æ®åˆå§‹åŒ–é—®é¢˜**ï¼š
```bash
# å¦‚æœä¿®å¤é”™è¯¯æ—¶å‘ç°æ˜¯æ•°æ®åˆå§‹åŒ–çš„é—®é¢˜
# éœ€è¦æŸ¥çœ‹ server/src/init/ ç›®å½•ä¸‹çš„ README.md
# æ³¨æ„ï¼šæˆ‘ä»¬ä½¿ç”¨é™æ€å¯¼å…¥ï¼Œä¸è¦å¼•èµ·æ–°çš„é”™è¯¯
# æŸ¥çœ‹åˆå§‹åŒ–æ–‡æ¡£
cat server/src/init/README.md
# é‡æ–°åˆå§‹åŒ–æ•°æ®
npm run seed-data:complete
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
cd server && npm run db:migrate
```
**é‡è¦æç¤º**:
- âš ï¸ æ•°æ®åˆå§‹åŒ–ä½¿ç”¨**é™æ€å¯¼å…¥**æ–¹å¼
- âš ï¸ ä¿®æ”¹åˆå§‹åŒ–ä»£ç æ—¶è¦è°¨æ…ï¼Œé¿å…å¼•èµ·æ–°çš„é”™è¯¯
- âœ… å‚è€ƒ `server/src/init/README.md` äº†è§£è¯¦ç»†è¯´æ˜
- âœ… é‡åˆ°é—®é¢˜æ—¶å…ˆæŸ¥çœ‹è¯¥æ–‡æ¡£
## Gitå·¥ä½œæµç¨‹
é¡¹ç›®ä½¿ç”¨æ ‡å‡†çš„Gitå·¥ä½œæµç¨‹ï¼š
- **ä¸»åˆ†æ”¯**: `master` - ç”¨äºåˆ›å»ºPRå’Œç”Ÿäº§éƒ¨ç½²
- **å¼€å‘åˆ†æ”¯**: åŸºäºåŠŸèƒ½åˆ›å»ºåˆ†æ”¯ï¼Œå®Œæˆåå‘masteræäº¤PR
- **æäº¤è§„èŒƒ**: ä½¿ç”¨è¯­ä¹‰åŒ–æäº¤ä¿¡æ¯
## APIæ–‡æ¡£
å¯åŠ¨åç«¯æœåŠ¡åï¼Œå¯è®¿é—®ï¼š
- **Swagger UI**: http://localhost:3000/api-docs
- **API JSON**: http://localhost:3000/api-docs.json
- **å‰ç«¯åº”ç”¨**: http://localhost:5173 (æ˜ å°„åˆ°localhost:5173)
- **å¼€å‘çŠ¶æ€**: ä½¿ç”¨ `npm run status` æ£€æŸ¥æœåŠ¡çŠ¶æ€
## CI/CDé…ç½®
é¡¹ç›®é…ç½®äº†GitHub Actionsè‡ªåŠ¨åŒ–æµç¨‹ï¼š
### å·¥ä½œæµæ–‡ä»¶
- `.github/workflows/ci-cd.yml` - ä¸»è¦CI/CDæµæ°´çº¿
- `.github/workflows/test.yml` - æµ‹è¯•æµæ°´çº¿
### è´¨é‡é—¨æ§
CI/CDæµç¨‹åŒ…å«ä»¥ä¸‹è´¨é‡æ£€æŸ¥ï¼š
- âœ… TypeScriptç±»å‹æ£€æŸ¥
- âœ… ESLintä»£ç æ£€æŸ¥
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾åˆ°é˜ˆå€¼
- âœ… å®‰å…¨æ¼æ´æ‰«æ
- âœ… æ„å»ºæˆåŠŸ
### éƒ¨ç½²æµç¨‹
- è‡ªåŠ¨æ„å»ºå‰ç«¯å’Œåç«¯
- ç¯å¢ƒç‰¹å®šé…ç½®ç®¡ç†
- æ”¯æŒå›æ»šæœºåˆ¶
- å®Œæ•´CIè„šæœ¬: `npm run ci:full` (å®‰è£…+éªŒè¯+æµ‹è¯•+æ„å»º)

## ğŸ”‘ å¿«æ·ç™»å½•é…ç½®

ç³»ç»Ÿå†…ç½®äº†å››ä¸ªè§’è‰²çš„å¿«æ·ç™»å½•ï¼Œç”¨äºå¼€å‘å’Œæµ‹è¯•ï¼š

| è§’è‰² | ç”¨æˆ·å | å¯†ç  |
|------|--------|------|
| ç®¡ç†å‘˜ | test_admin | 123456 |
| å›­é•¿ | principal | 123456 |
| æ•™å¸ˆ | teacher | 123456 |
| å®¶é•¿ | test_parent | 123456 |

### å¿«æ·ç™»å½•ä½ç½®

**PCç«¯**: è®¿é—® `http://localhost:5173/login` é¡µé¢ï¼Œç‚¹å‡»å¯¹åº”è§’è‰²çš„å¿«æ·ç™»å½•æŒ‰é’®

**ç§»åŠ¨ç«¯**: è®¿é—® `http://localhost:5173/mobile/login` é¡µé¢ï¼Œç‚¹å‡»å¯¹åº”è§’è‰²çš„å¿«æ·ç™»å½•æŒ‰é’®

---

## ğŸ” æ•°æ®åº“é…ç½®è¯´æ˜

### è¿œç¨‹æ•°æ®åº“ä¿¡æ¯
| é…ç½®é¡¹ | å€¼ |
|--------|-----|
| ä¸»æœº | `dbconn.sealoshzh.site` |
| ç«¯å£ | `43906` |
| æ•°æ®åº“å | `kargerdensales` |
| ç”¨æˆ·å | `root` |
| **å¯†ç ** | `pwk5ls7j` |

### é…ç½®ä½ç½®
æ•°æ®åº“å¯†ç é…ç½®åœ¨ `server/.env` æ–‡ä»¶ä¸­ï¼š
```bash
DB_HOST=dbconn.sealoshzh.site
DB_PORT=43906
DB_USER=root
DB_PASSWORD=pwk5ls7j  # â† æ•°æ®åº“å¯†ç 
DB_NAME=kargerdensales
```

### å®‰å…¨è¯´æ˜
- âš ï¸ **å¯†ç å·²æš´éœ²åœ¨ .env æ–‡ä»¶ä¸­**ï¼Œå¦‚éœ€æé«˜å®‰å…¨æ€§ï¼Œè¯·è€ƒè™‘ï¼š
  1. ä½¿ç”¨ç¯å¢ƒå˜é‡ä»£æ›¿æ˜æ–‡å¯†ç 
  2. ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ (KMS)
  3. åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ .env.local æ–‡ä»¶å¹¶æ·»åŠ åˆ° .gitignore

### è¿æ¥æµ‹è¯•
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -h dbconn.sealoshzh.site -P 43906 -u root -ppwk5ls7j kargerdensales -e "SELECT 1;"
```
## ğŸš€ è¿œç«¯æœåŠ¡å™¨éƒ¨ç½²

### æœåŠ¡å™¨ä¿¡æ¯
- **æœåŠ¡å™¨IP**: `47.94.82.59`
- **SSHç”¨æˆ·**: `root`
- **SSHå¯†é’¥**: `~/.ssh/yyup_server_key`
- **éƒ¨ç½²ç›®å½•**: `/var/www/kyyup/k.yyup.com/`
- **åŸŸå**: `https://k.yyup.cc`

### å¸¸è§é—®é¢˜æ’æŸ¥

#### 1. API URLé‡å¤ `/api/api/`
**ç—‡çŠ¶**: æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºè¯·æ±‚ `https://k.yyup.cc/api/api/auth/login`

**åŸå› **: `.env.production` ä¸­ `VITE_API_BASE_URL` è®¾ç½®ä¸º `https://k.yyup.cc/api`ï¼Œè€Œ endpoints å·²ç»åŒ…å« `/api` å‰ç¼€

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä¿®æ”¹ client/.env.production
VITE_API_BASE_URL=https://k.yyup.cc  # å»æ‰ /api åç¼€
```

#### 2. Nginxè¿”å›æ—§ç‰ˆæœ¬å‰ç«¯æ–‡ä»¶
**ç—‡çŠ¶**: æµè§ˆå™¨åŠ è½½æ—§çš„JSæ–‡ä»¶ï¼Œä½†è¿œç«¯distç›®å½•å·²æ˜¯æ–°ç‰ˆæœ¬

**åŸå› **: Nginxçš„rooté…ç½®æŒ‡å‘ `/var/www/kyyup/k.yyup.com/client`ï¼Œè€Œä¸æ˜¯ `client/dist`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä¿®æ”¹ /etc/nginx/sites-enabled/kyyup.cc
sed -i 's|root /var/www/kyyup/k.yyup.com/client;|root /var/www/kyyup/k.yyup.com/client/dist;|g' /etc/nginx/sites-enabled/kyyup.cc
nginx -t && systemctl reload nginx
```

#### 3. åŠ å¯†phoneå­—æ®µç™»å½•å¤±è´¥
**ç—‡çŠ¶**: ä½¿ç”¨æ‰‹æœºå·ç™»å½•æ—¶è¿”å›"ç”¨æˆ·ä¸å­˜åœ¨"

**åŸå› **: æ•°æ®åº“phoneå­—æ®µè¢«åŠ å¯†å­˜å‚¨ï¼ˆç­‰ä¿è¦æ±‚ï¼‰

**è§£å†³æ–¹æ¡ˆ**: âœ… å·²ä¿®å¤ - æ”¯æŒusernameç›´æ¥æŸ¥è¯¢å’Œphoneè§£å¯†åŒ¹é…

### éƒ¨ç½²æµç¨‹
```bash
# 1. æœ¬åœ°ç¼–è¯‘
cd /home/zhgue/kyyupgame/k.yyup.com
npm run build

# 2. åŒæ­¥å‰ç«¯
rsync -avz --delete -e "ssh -i ~/.ssh/yyup_server_key" \
  client/dist/ root@47.94.82.59:/var/www/kyyup/k.yyup.com/client/dist/

# 3. åŒæ­¥åç«¯
rsync -avz --delete -e "ssh -i ~/.ssh/yyup_server_key" \
  server/dist/ root@47.94.82.59:/var/www/kyyup/k.yyup.com/server/dist/

# 4. é‡å¯æœåŠ¡
ssh -i ~/.ssh/yyup_server_key root@47.94.82.59 "pm2 restart k-yyup-backend && systemctl reload nginx"

# 5. éªŒè¯éƒ¨ç½²
curl -s https://k.yyup.cc/ | grep -o 'index-[a-f0-9]*\.js'
```
