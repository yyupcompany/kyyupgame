# ğŸ“‹ äººå‘˜æ·»åŠ æµç¨‹åˆ†ææŠ¥å‘Š

**åˆ†ææ—¥æœŸ**: 2025-10-28  
**åˆ†æèŒƒå›´**: äººå‘˜ä¸­å¿ƒæ·»åŠ äººå‘˜çš„å®Œæ•´æµç¨‹  
**åˆ†æçŠ¶æ€**: âš ï¸ **éƒ¨åˆ†å®ç°ï¼Œç¼ºå¤±å…³é”®åŠŸèƒ½**

---

## ğŸ” å½“å‰çš„æ·»åŠ äººå‘˜æµç¨‹

### æ·»åŠ æ•™å¸ˆçš„æµç¨‹ï¼ˆteachers.routes.tsï¼‰

**å½“å‰å®ç°**ï¼š
```typescript
router.post('/', async (req, res) => {
  const transaction = await sequelize.transaction();
  
  try {
    const { realName, phone, email, teacherNo, position, hireDate, education, major } = req.body;
    const kindergartenId = (req.user as any)?.kindergartenId;  // âœ… è·å–å¹¼å„¿å›­ID
    const creatorId = (req.user as any)?.id;
    
    // 1. åˆ›å»º User è®°å½•
    const user = await User.create({
      username: phone,
      password: await bcrypt.hash('123456', 10),
      realName,
      phone,
      email,
      role: 'teacher' as any,
      status: 'active' as any
    }, { transaction });
    
    // 2. åˆ›å»º Teacher è®°å½•
    const teacher = await Teacher.create({
      userId: user.id,
      kindergartenId,  // âœ… ç»‘å®šå¹¼å„¿å›­ID
      teacherNo,
      position,
      hireDate,
      education,
      major,
      creatorId,
      status: 1
    }, { transaction });
    
    await transaction.commit();
    return ApiResponse.success(res, teacher, 'åˆ›å»ºæ•™å¸ˆæˆåŠŸ');
  } catch (error) {
    await transaction.rollback();
  }
});
```

**ç”Ÿæˆçš„è®°å½•**ï¼š
- âœ… User è¡¨ï¼š1æ¡è®°å½•ï¼ˆusername, password, realName, phone, email, role, statusï¼‰
- âœ… Teacher è¡¨ï¼š1æ¡è®°å½•ï¼ˆuserId, kindergartenId, teacherNo, positionç­‰ï¼‰
- âŒ user_roles è¡¨ï¼š0æ¡è®°å½•ï¼ˆ**ç¼ºå¤±**ï¼‰
- âŒ group_idï¼šæœªç»‘å®šï¼ˆ**ç¼ºå¤±**ï¼‰

---

## âŒ å‘ç°çš„é—®é¢˜

### é—®é¢˜1ï¼šæ²¡æœ‰åˆ›å»º user_roles å…³è”

**å½“å‰çŠ¶æ€**ï¼š
- âŒ åˆ›å»º User æ—¶æ²¡æœ‰ç»‘å®šè§’è‰²
- âŒ æ²¡æœ‰åœ¨ user_roles è¡¨ä¸­åˆ›å»ºå…³è”è®°å½•
- âŒ ç”¨æˆ·æ²¡æœ‰æ˜ç¡®çš„è§’è‰²æƒé™

**åº”è¯¥çš„åšæ³•**ï¼š
```typescript
// åˆ›å»º user_roles å…³è”
await db.query(
  `INSERT INTO user_roles (user_id, role_id, created_at, updated_at) 
   VALUES (:userId, :roleId, NOW(), NOW())`,
  {
    replacements: { userId: user.id, roleId: teacherRoleId },
    transaction
  }
);
```

### é—®é¢˜2ï¼šæ²¡æœ‰ç»‘å®š group_id

**å½“å‰çŠ¶æ€**ï¼š
- âŒ Teacher è¡¨ä¸­æ²¡æœ‰ group_id å­—æ®µ
- âŒ æ— æ³•è¿½è¸ªæ•™å¸ˆå±äºå“ªä¸ªé›†å›¢
- âŒ æ— æ³•å®ç°é›†å›¢çº§æ•°æ®éš”ç¦»

**åº”è¯¥çš„åšæ³•**ï¼š
```typescript
// 1. ä» kindergarten è¡¨æŸ¥è¯¢ group_id
const kindergarten = await Kindergarten.findByPk(kindergartenId);
const groupId = kindergarten?.groupId;

// 2. åœ¨åˆ›å»º Teacher æ—¶ç»‘å®š group_id
const teacher = await Teacher.create({
  userId: user.id,
  kindergartenId,
  groupId,  // âœ… ç»‘å®šé›†å›¢ID
  teacherNo,
  position,
  hireDate,
  education,
  major,
  creatorId,
  status: 1
}, { transaction });
```

### é—®é¢˜3ï¼šæ²¡æœ‰éªŒè¯ group_id å’Œ kindergartenId çš„å…³ç³»

**å½“å‰çŠ¶æ€**ï¼š
- âŒ æ²¡æœ‰éªŒè¯å¹¼å„¿å›­æ˜¯å¦å±äºè¯¥é›†å›¢
- âŒ å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´

**åº”è¯¥çš„åšæ³•**ï¼š
```typescript
// éªŒè¯å¹¼å„¿å›­æ˜¯å¦å±äºè¯¥é›†å›¢
const kindergarten = await Kindergarten.findByPk(kindergartenId);
if (!kindergarten || kindergarten.groupId !== groupId) {
  throw new Error('å¹¼å„¿å›­ä¸å±äºè¯¥é›†å›¢');
}
```

---

## âœ… å®Œæ•´çš„æ·»åŠ äººå‘˜æµç¨‹

### åº”è¯¥çš„æµç¨‹

```
1. è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
   â”œâ”€â”€ kindergartenIdï¼ˆå¹¼å„¿å›­IDï¼‰
   â””â”€â”€ groupIdï¼ˆé›†å›¢IDï¼‰

2. éªŒè¯æ•°æ®
   â”œâ”€â”€ éªŒè¯å¹¼å„¿å›­æ˜¯å¦å­˜åœ¨
   â”œâ”€â”€ éªŒè¯å¹¼å„¿å›­æ˜¯å¦å±äºè¯¥é›†å›¢
   â””â”€â”€ éªŒè¯ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨

3. åˆ›å»º User è®°å½•
   â”œâ”€â”€ usernameï¼ˆæ‰‹æœºå·ï¼‰
   â”œâ”€â”€ passwordï¼ˆåŠ å¯†å¯†ç ï¼‰
   â”œâ”€â”€ realNameï¼ˆçœŸå®å§“åï¼‰
   â”œâ”€â”€ phoneï¼ˆç”µè¯ï¼‰
   â”œâ”€â”€ emailï¼ˆé‚®ç®±ï¼‰
   â”œâ”€â”€ roleï¼ˆè§’è‰²ï¼‰
   â””â”€â”€ statusï¼ˆçŠ¶æ€ï¼‰

4. åˆ›å»º user_roles å…³è”
   â”œâ”€â”€ user_idï¼ˆç”¨æˆ·IDï¼‰
   â””â”€â”€ role_idï¼ˆè§’è‰²IDï¼‰

5. åˆ›å»º Teacher è®°å½•
   â”œâ”€â”€ userIdï¼ˆç”¨æˆ·IDï¼‰
   â”œâ”€â”€ kindergartenIdï¼ˆå¹¼å„¿å›­IDï¼‰
   â”œâ”€â”€ groupIdï¼ˆé›†å›¢IDï¼‰âœ… æ–°å¢
   â”œâ”€â”€ teacherNoï¼ˆæ•™å¸ˆç¼–å·ï¼‰
   â”œâ”€â”€ positionï¼ˆèŒä½ï¼‰
   â”œâ”€â”€ hireDateï¼ˆå…¥èŒæ—¥æœŸï¼‰
   â”œâ”€â”€ educationï¼ˆå­¦å†ï¼‰
   â”œâ”€â”€ majorï¼ˆä¸“ä¸šï¼‰
   â”œâ”€â”€ creatorIdï¼ˆåˆ›å»ºäººIDï¼‰
   â””â”€â”€ statusï¼ˆçŠ¶æ€ï¼‰

6. è¿”å›å®Œæ•´è®°å½•
   â”œâ”€â”€ User ä¿¡æ¯
   â”œâ”€â”€ Teacher ä¿¡æ¯
   â”œâ”€â”€ Role ä¿¡æ¯
   â””â”€â”€ Group ä¿¡æ¯
```

---

## ğŸ“Š ä¿®å¤æ¸…å•

### ç«‹å³éœ€è¦ä¿®å¤ (ä¼˜å…ˆçº§ï¼šğŸ”´ é«˜)

- [ ] åœ¨ teachers.routes.ts ä¸­æ·»åŠ  user_roles åˆ›å»ºé€»è¾‘
- [ ] åœ¨ teachers.routes.ts ä¸­æ·»åŠ  group_id ç»‘å®šé€»è¾‘
- [ ] åœ¨ teachers.routes.ts ä¸­æ·»åŠ æ•°æ®éªŒè¯é€»è¾‘
- [ ] ä¿®æ”¹ Teacher æ¨¡å‹ï¼Œæ·»åŠ  group_id å­—æ®µ

### éœ€è¦æ£€æŸ¥çš„å…¶ä»–äººå‘˜ç±»å‹ (ä¼˜å…ˆçº§ï¼šğŸŸ¡ ä¸­)

- [ ] æ·»åŠ ç®¡ç†å‘˜æ—¶æ˜¯å¦æœ‰ç›¸åŒé—®é¢˜
- [ ] æ·»åŠ å›­é•¿æ—¶æ˜¯å¦æœ‰ç›¸åŒé—®é¢˜
- [ ] æ·»åŠ å…¶ä»–å‘˜å·¥æ—¶æ˜¯å¦æœ‰ç›¸åŒé—®é¢˜

### éœ€è¦æ›´æ–°çš„æ–‡ä»¶ (ä¼˜å…ˆçº§ï¼šğŸŸ¡ ä¸­)

- [ ] server/src/routes/teachers.routes.ts
- [ ] server/src/models/teacher.model.ts
- [ ] server/src/migrations/ - æ·»åŠ  group_id å­—æ®µè¿ç§»
- [ ] server/src/controllers/personnel-center.controller.ts

---

## ğŸ¯ å»ºè®®

### çŸ­æœŸ (1-2å¤©)
1. ä¿®æ”¹ teachers.routes.tsï¼Œæ·»åŠ  user_roles å’Œ group_id ç»‘å®š
2. ä¿®æ”¹ Teacher æ¨¡å‹ï¼Œæ·»åŠ  group_id å­—æ®µ
3. æµ‹è¯•æ·»åŠ æ•™å¸ˆçš„å®Œæ•´æµç¨‹

### ä¸­æœŸ (3-5å¤©)
1. ä¸ºå…¶ä»–äººå‘˜ç±»å‹ï¼ˆç®¡ç†å‘˜ã€å›­é•¿ç­‰ï¼‰æ·»åŠ ç›¸åŒçš„é€»è¾‘
2. æ·»åŠ æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†
3. ç¼–å†™æµ‹è¯•ç”¨ä¾‹

### é•¿æœŸ (1-2å‘¨)
1. å®ç°å®Œæ•´çš„æƒé™ç³»ç»Ÿ
2. æ·»åŠ å®¡è®¡æ—¥å¿—
3. æ€§èƒ½ä¼˜åŒ–

---

## ğŸ“ æ€»ç»“

**å½“å‰çŠ¶æ€**ï¼š
- âœ… åˆ›å»ºäº† User å’Œ Teacher ä¸¤ä¸ªè®°å½•
- âŒ æ²¡æœ‰åˆ›å»º user_roles å…³è”
- âŒ æ²¡æœ‰ç»‘å®š group_id
- âŒ æ²¡æœ‰å®Œæ•´çš„æ•°æ®éš”ç¦»

**éœ€è¦ä¿®å¤**ï¼š
- æ·»åŠ  user_roles åˆ›å»ºé€»è¾‘
- æ·»åŠ  group_id ç»‘å®šé€»è¾‘
- æ·»åŠ æ•°æ®éªŒè¯é€»è¾‘
- ä¿®æ”¹ Teacher æ¨¡å‹

---

**è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ç¼ºé™·ï¼Œéœ€è¦ç«‹å³ä¿®å¤ï¼** ğŸš¨


