# 🧪 AI意图判断快速测试指南

## 🎯 测试目标

验证豆包AI模型的意图判断准确性，确保：
- 简单问题不调用工具
- 需要数据的问题正确调用工具
- 复杂问题能够多轮处理

## 🚀 快速开始

### 1. 启动服务
```bash
# 启动后端服务
npm run start:backend

# 启动前端服务（新终端）
npm run start:frontend
```

### 2. 访问测试页面
```
http://localhost:5173/aiassistant
```

### 3. 执行测试
直接在AI助手中输入以下测试提示词，观察响应：

## 📋 测试场景

### 🟢 简单回复测试（10个）

**期望行为**: 直接回复，不调用任何工具，收到 `content` 事件

1. **"你好"** - 基础问候
2. **"早上好"** - 时间问候
3. **"谢谢"** - 礼貌用语
4. **"再见"** - 告别语
5. **"你是谁"** - 身份询问
6. **"今天天气怎么样"** - 常识问题
7. **"现在几点了"** - 时间问题
8. **"我很开心"** - 情感表达
9. **"帮我加油打气"** - 情感支持
10. **"周末愉快"** - 祝福语

**🔍 观察点**:
- 应该只收到 `thinking` 和 `content` 事件
- 不应该收到 `tool_call` 事件
- 响应时间应该 < 3秒

### 🟡 工具调用测试（10个）

**期望行为**: 调用相应工具，收到 `tool_call` → `tool_result` → `content` 事件

1. **"查询当前在园人数"**
   - 期望工具: `query_data_record`
   - 期望参数: `{"table": "students", "conditions": {"status": "active"}}`

2. **"显示所有教师信息"**
   - 期望工具: `read_data_record`
   - 期望参数: `{"table": "teachers"}`

3. **"查看今天的课程安排"**
   - 期望工具: `query_data_record`
   - 期望参数: 查询当天的课程表

4. **"统计各班级学生数量"**
   - 期望工具: `any_query`
   - 期望参数: 统计查询语句

5. **"新增一个学生张三"**
   - 期望工具: `create_data_record`
   - 期望参数: 创建学生记录

6. **"更新李四的班级为大一班"**
   - 期望工具: `update_data_record`
   - 期望参数: 更新班级信息

7. **"删除已毕业的学生记录"**
   - 期望工具: `update_data_record`
   - 期望参数: 标记删除状态

8. **"查看最近的家长反馈"**
   - 期望工具: `read_data_record`
   - 期望参数: 查询家长反馈

9. **"生成今天的考勤报告"**
   - 期望工具: `any_query`
   - 期望参数: 考勤统计查询

10. **"检查哪些孩子今天请假了"**
    - 期望工具: `query_data_record`
    - 期望参数: 查询请假记录

**🔍 观察点**:
- 必须收到 `tool_call` 事件
- 工具选择是否正确
- 工具参数是否合理
- 工具执行后是否基于结果回答

### 🔴 复杂工具调用测试（10个）

**期望行为**: 多个工具调用或复杂处理流程

1. **"生成月度出勤统计报告并制作图表"**
   - 期望工具: `any_query` → `render_component`
   - 流程: 查询数据 → 生成图表

2. **"分析各年龄段孩子的身高体重分布并生成对比图表"**
   - 期望工具: `any_query` → `render_component`
   - 流程: 数据分析 → 可视化

3. **"查看本月收入情况并生成财务报表"**
   - 期望工具: `any_query` → `render_component`
   - 流程: 查询收入 → 生成报表

4. **"制作学生信息总览表，包含基本信息、出勤情况和家长联系方式"**
   - 期望工具: 多个查询工具
   - 流程: 综合数据查询

5. **"查看活跃教师的工作量统计和绩效评估"**
   - 期望工具: `any_query` → 数据分析
   - 流程: 工作量统计

6. **"为新入园的孩子自动分配班级并通知相关老师"**
   - 期望工具: 多步骤处理
   - 流程: 查询班级 → 分配 → 通知

7. **"处理退园流程：更新状态、计算费用、生成退园证明"**
   - 期望工具: `update_data_record` → `any_query`
   - 流程: 状态更新 → 费用计算

8. **"分析近半年的招生趋势，包含来源渠道、转化率和推荐统计"**
   - 期望工具: `any_query` → `render_component`
   - 流程: 趋势分析 → 图表展示

9. **"评估教师教学效果：学生进步、家长满意度、课程完成率"**
   - 期望工具: 多个数据源
   - 流程: 综合评估分析

10. **"进行系统健康检查：用户活跃度、数据完整性、性能指标分析"**
    - 期望工具: `any_query` → 监控分析
    - 流程: 系统状态检查

**🔍 观察点**:
- 是否有多个 `tool_call` 事件
- 工具调用顺序是否合理
- 是否有 `thinking` 事件
- 复杂度处理是否正确

## 📊 事件流示例

### ✅ 简单回复 (正确)
```
thinking → content (直接回答)
```

### ✅ 工具调用 (正确)
```
thinking → tool_call → tool_result → content (基于工具结果回答)
```

### ✅ 复杂调用 (正确)
```
thinking → tool_call → tool_result → thinking → tool_call → tool_result → content
```

### ❌ 错误示例
```
thinking → tool_call (简单问题调用工具 - 错误)
thinking → content (需要工具却直接回答 - 错误)
```

## 🎯 评分标准

### 优秀 (90-100%)
- 简单回复准确率 ≥ 95%
- 工具调用准确率 ≥ 90%
- 复杂调用准确率 ≥ 85%

### 良好 (80-89%)
- 简单回复准确率 ≥ 90%
- 工具调用准确率 ≥ 80%
- 复杂调用准确率 ≥ 75%

### 需要优化 (<80%)
- 任何类别准确率 < 80%
- 需要优化提示词和工具描述

## 🔧 问题排查

### 如果简单问题调用了工具
1. 检查提示词是否过于强调工具使用
2. 调整系统提示词，明确区分简单问答和数据查询

### 如果需要工具的问题没有调用
1. 检查工具描述是否清晰
2. 验证工具权限设置
3. 确认前端 `enableTools` 参数

### 如果工具选择错误
1. 优化工具描述，使其更具体
2. 调整工具名称，使其更具描述性
3. 在提示词中明确工具使用场景

## 📝 记录测试结果

使用以下表格记录测试结果：

### 简单回复测试
| 序号 | 提示词 | 期望行为 | 实际行为 | 是否正确 | 备注 |
|------|--------|----------|----------|----------|------|
| 1 | 你好 | direct_reply | | | | |

### 工具调用测试
| 序号 | 提示词 | 期望工具 | 实际工具 | 参数正确 | 是否正确 |
|------|--------|----------|----------|----------|----------|
| 1 | 查询在园人数 | query_data_record | | | | |

### 复杂调用测试
| 序号 | 提示词 | 期望工具数 | 实际工具数 | 流程正确 | 是否正确 |
|------|--------|------------|------------|----------|----------|
| 1 | 月度报告 | 2-3个 | | | | |

## 🚀 自动化测试

对于批量测试，可以运行自动化脚本：
```bash
node test-ai-intent-accuracy.cjs
```

这将自动测试所有30个场景并生成详细报告。