# å¯¹è¯å¼æ­¥éª¤é€šçŸ¥ç”¨æˆ·ä½“éªŒæ–¹æ¡ˆåˆ†æ

## ğŸ¯ ç”¨æˆ·éœ€æ±‚ç†è§£

### ğŸ“‹ **ç†æƒ³äº¤äº’æµç¨‹**
```
ç”¨æˆ·: "å¸®æˆ‘æŸ¥è¯¢ä¸€ä¸‹æˆ‘ä»¬å¹¼å„¿å›­æœ‰å¤šå°‘ä¸ªå­©å­ã€å¤šå°‘ä¸ªè€å¸ˆ"

AI: ğŸ¤” æ­£åœ¨æ€è€ƒå¦‚ä½•å¸®åŠ©æ‚¨æŸ¥è¯¢...
    (æ€è€ƒè¿‡ç¨‹æ˜¾ç¤º)

AI: ğŸ“ æˆ‘éœ€è¦å…ˆåˆ†æä¸€ä¸‹æ‚¨çš„æŸ¥è¯¢éœ€æ±‚
    (å·¥å…·æ„å›¾è¯´æ˜)

AI: ğŸ”§ æˆ‘æ¥ä½¿ç”¨æ™ºèƒ½æŸ¥è¯¢å·¥å…·ï¼Œå¸®æ‚¨å¿«é€Ÿè·å–æ•°æ®
    (è°ƒç”¨å·¥å…·è¯´æ˜)

AI: âœ… å¤ªå¥½äº†ï¼æˆ‘å·²ç»æ‰¾åˆ°äº†å­©å­ä»¬çš„ç»Ÿè®¡æ•°æ®ï¼Œç°åœ¨è®©æˆ‘ç»§ç»­æŸ¥æ‰¾è€å¸ˆçš„ä¿¡æ¯
    (å·¥å…·ç»“æœè¯´æ˜ + ä¸‹ä¸€æ­¥æ„å›¾)

AI: ğŸ”§ ç°åœ¨æˆ‘éœ€è¦ä½¿ç”¨æ•™å¸ˆä¿¡æ¯æŸ¥è¯¢å·¥å…·
    (è°ƒç”¨ä¸‹ä¸€ä¸ªå·¥å…·)

AI: ğŸ“‹ æŸ¥è¯¢å®ŒæˆæŠ¥å‘Š
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    âœ… **å­©å­æ•°é‡**: 250å
    âœ… **æ•™å¸ˆæ•°é‡**: 18å
    âœ… **æŸ¥è¯¢çŠ¶æ€**: å…¨éƒ¨å®Œæˆ
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
    (Markdownæ ¼å¼åŒ–æŠ¥å‘Š)
```

### ğŸ¨ **æ ¸å¿ƒè®¾è®¡åŸåˆ™**
1. **å¯¹è¯å¼ä½“éªŒ**: æ¯ä¸ªæ­¥éª¤éƒ½åƒå¯¹è¯ä¸€æ ·è‡ªç„¶
2. **æŒç»­åé¦ˆ**: å¯¹è¯æ¡†ä¸€ç›´åœ¨åŠ¨ï¼Œç”¨æˆ·æœ‰å‚ä¸æ„Ÿ
3. **å›­é•¿å‹å¥½**: ä½¿ç”¨å¹¼å„¿å›­å›­é•¿èƒ½ç†è§£çš„è¯­è¨€
4. **æˆå°±æ„Ÿ**: æ¯ä¸ªæ­¥éª¤éƒ½æœ‰æ˜ç¡®çš„æˆåŠŸæ ‡è¯†
5. **MarkdownæŠ¥å‘Š**: æœ€ç»ˆç»™ç”¨æˆ·å¸¦âœ…çš„æ¼‚äº®æŠ¥å‘Š

---

## ğŸ” ç°çŠ¶åˆ†æ

### âœ… **å·²å®ç°çš„åŠŸèƒ½**
1. **å¤šè½®å·¥å…·è°ƒç”¨æ¡†æ¶** - `useMultiRoundToolCalling.ts`
2. **SSEæµå¼äº‹ä»¶æ¨é€** - `streaming.service.ts`
3. **å·¥å…·æ‰§è¡Œå™¨** - `tool-executor.module.ts`
4. **å‰ç«¯äº‹ä»¶æ¥æ”¶** - å·²æ”¯æŒ`tool_call_start`, `tool_call_complete`
5. **æ€è€ƒè¿‡ç¨‹æ˜¾ç¤º** - å·²æ”¯æŒ`reasoning_content`
6. **Markdownæ¸²æŸ“** - å‰ç«¯å·²æ”¯æŒMarkdownæ ¼å¼

### âŒ **ç¼ºå¤±çš„åŠŸèƒ½**
1. **å·¥å…·æ„å›¾è¯´æ˜äº‹ä»¶** - ç¼ºå°‘"æˆ‘éœ€è¦åšä»€ä¹ˆ"çš„è¯´æ˜
2. **å·¥å…·ç»“æœæ€»ç»“äº‹ä»¶** - ç¼ºå°‘"æˆ‘æ‰¾åˆ°äº†ä»€ä¹ˆ"çš„æ€»ç»“
3. **ä¸‹ä¸€æ­¥è®¡åˆ’è¯´æ˜** - ç¼ºå°‘"æ¥ä¸‹æ¥æˆ‘è¦åšä»€ä¹ˆ"çš„å¼•å¯¼
4. **å›­é•¿å‹å¥½è¯­è¨€è½¬æ¢** - ç¼ºå°‘ä¸“ä¸šæœ¯è¯­åˆ°æ—¥å¸¸è¯­è¨€çš„æ˜ å°„
5. **åˆ†æ­¥éª¤æŠ¥å‘Šç”Ÿæˆ** - ç¼ºå°‘å¸¦âœ…çš„MarkdownæŠ¥å‘Šç”Ÿæˆ
6. **è¿ç»­å¯¹è¯æµç¨‹** - ç¼ºå°‘è®©å¯¹è¯"ä¸€ç›´åœ¨åŠ¨"çš„æœºåˆ¶

### ğŸ¯ **ç°æœ‰äº‹ä»¶ç±»å‹**
```typescript
// ç°æœ‰SSEäº‹ä»¶
- 'start'                    // å¼€å§‹
- 'tool_call_start'         // å·¥å…·å¼€å§‹
- 'tool_call_complete'      // å·¥å…·å®Œæˆ
- 'final_answer'           // æœ€ç»ˆç­”æ¡ˆ
- 'complete'               // å®Œæˆ
- 'reasoning_content'      // æ€è€ƒå†…å®¹ âœ… (å·²å®ç°)
```

### ğŸš¨ **éœ€è¦æ–°å¢çš„äº‹ä»¶ç±»å‹**
```typescript
// éœ€è¦æ–°å¢çš„äº‹ä»¶ç±»å‹
- 'tool_intent_explain'     // å·¥å…·æ„å›¾è¯´æ˜ "æˆ‘éœ€è¦åšä»€ä¹ˆ"
- 'tool_result_summary'     // å·¥å…·ç»“æœæ€»ç»“ "æˆ‘æ‰¾åˆ°äº†ä»€ä¹ˆ"
- 'next_step_plan'         // ä¸‹ä¸€æ­¥è®¡åˆ’ "æ¥ä¸‹æ¥åšä»€ä¹ˆ"
- 'progress_report'        // è¿›åº¦æŠ¥å‘Š "å½“å‰çŠ¶æ€å¦‚ä½•"
- 'final_summary_report'   // æœ€ç»ˆæ€»ç»“æŠ¥å‘Š (Markdownæ ¼å¼)
```

---

## ğŸ’¡ **å®Œæ•´è§£å†³æ–¹æ¡ˆè®¾è®¡**

### ğŸ¯ **æ–°å¢äº‹ä»¶ç±»å‹å®šä¹‰**
```typescript
// æ–°å¢å¯¹è¯å¼æ­¥éª¤äº‹ä»¶
export const CONVERSATION_EVENTS = {
  // å·¥å…·æ„å›¾è¯´æ˜ (å›­é•¿å‹å¥½è¯­è¨€)
  'tool_intent_explain': {
    'any_query': 'ğŸ” æˆ‘éœ€è¦å…ˆåˆ†æä¸€ä¸‹æ‚¨çš„æŸ¥è¯¢éœ€æ±‚ï¼Œæ‰¾åˆ°æœ€åˆé€‚çš„æŸ¥è¯¢æ–¹æ³•',
    'read_data_record': 'ğŸ“‹ æˆ‘æ¥å¸®æ‚¨æŸ¥çœ‹ç›¸å…³çš„è®°å½•ä¿¡æ¯',
    'navigate_to_page': 'ğŸ§­ æˆ‘éœ€è¦å…ˆè·³è½¬åˆ°ç›¸åº”çš„é¡µé¢',
    'generate_pdf_report': 'ğŸ“„ æˆ‘æ¥ä¸ºæ‚¨ç”Ÿæˆä¸€ä»½æ¼‚äº®çš„PDFæŠ¥å‘Š',
    'create_todo_list': 'ğŸ“ æˆ‘æ¥å¸®æ‚¨åˆ›å»ºä¸€ä¸ªå¾…åŠäº‹é¡¹æ¸…å•'
  },

  // å·¥å…·è°ƒç”¨è¯´æ˜ (å›­é•¿å‹å¥½è¯­è¨€)
  'tool_call_explain': {
    'any_query': 'ğŸ”§ ç°åœ¨æˆ‘æ¥ä½¿ç”¨æ™ºèƒ½æŸ¥è¯¢å·¥å…·ï¼Œå¸®æ‚¨å¿«é€Ÿè·å–æ•°æ®',
    'read_data_record': 'ğŸ“š è®©æˆ‘æ¥æŸ¥æ‰¾ç›¸å…³çš„è®°å½•ä¿¡æ¯',
    'navigate_to_page': 'ğŸš€ ç°åœ¨è·³è½¬åˆ°ç›¸åº”çš„é¡µé¢ä¸ºæ‚¨æŸ¥çœ‹',
    'generate_pdf_report': 'âœ¨ å¼€å§‹ç”Ÿæˆç²¾ç¾çš„PDFæŠ¥å‘Š',
    'create_todo_list': 'ğŸ“‹ å¼€å§‹åˆ›å»ºæ‚¨çš„å¾…åŠäº‹é¡¹'
  },

  // å·¥å…·ç»“æœæ€»ç»“ (å›­é•¿å‹å¥½è¯­è¨€)
  'tool_result_summary': {
    'any_query': 'âœ… å¤ªå¥½äº†ï¼æˆ‘å·²ç»æ‰¾åˆ°äº†ç›¸å…³æ•°æ®',
    'read_data_record': 'ğŸ“‹ å¾ˆå¥½ï¼æˆ‘å·²ç»æ‰¾åˆ°äº†æ‚¨éœ€è¦çš„è®°å½•',
    'navigate_to_page': 'ğŸ¯ é¡µé¢å·²å‡†å¤‡å°±ç»ªï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹äº†',
    'generate_pdf_report': 'ğŸ“„ æŠ¥å‘Šå·²æˆåŠŸç”Ÿæˆï¼Œè¯·æŸ¥æ”¶',
    'create_todo_list': 'ğŸ“ å¾…åŠæ¸…å•å·²åˆ›å»ºå®Œæˆ'
  },

  // ä¸‹ä¸€æ­¥è®¡åˆ’è¯´æ˜
  'next_step_plan': {
    'any_query': 'ğŸ” ç°åœ¨è®©æˆ‘ä¸ºæ‚¨æ•´ç†ä¸€ä¸‹è¿™äº›æ•°æ®',
    'read_data_record': 'ğŸ“Š æ¥ä¸‹æ¥æˆ‘éœ€è¦åˆ†æè¿™äº›è®°å½•',
    'navigate_to_page': 'ğŸ‘€ è¯·æŸ¥çœ‹é¡µé¢å†…å®¹ï¼Œæˆ‘ä¼šç»§ç»­ååŠ©æ‚¨',
    'generate_pdf_report': 'ğŸ“‹ æŠ¥å‘Šå·²ç”Ÿæˆï¼Œè®©æˆ‘ä¸ºæ‚¨æ€»ç»“ä¸€ä¸‹',
    'create_todo_list': 'âœ… ä»»åŠ¡å·²åˆ›å»ºï¼Œæˆ‘ä»¬ç»§ç»­ä¸‹ä¸€æ­¥'
  }
};
```

### ğŸ”§ **åç«¯å®ç°æ–¹æ¡ˆ**

#### 1. **æ‰©å±•å·¥å…·æ‰§è¡Œå™¨**
```typescript
// tool-executor.module.ts æ‰©å±•
export class ToolExecutorModule {
  async executeFunctionTool(
    toolCall: ToolCall,
    request: UserRequest,
    progressCallback?: (status: string, details?: any) => void,
    conversationCallback?: (eventType: string, message: string, details?: any) => void // ğŸ†• æ–°å¢å¯¹è¯å›è°ƒ
  ): Promise<ToolExecutionResult> {

    const toolName = toolCall.function?.name || toolCall.name;
    const args = this.prepareArguments(toolCall, request);

    // ğŸ†• å‘é€å·¥å…·æ„å›¾è¯´æ˜
    const intentMessage = this.getToolFriendlyMessage(toolName, 'tool_intent_explain');
    conversationCallback?.('tool_intent_explain', intentMessage, { toolName });

    // ğŸ†• å‘é€å·¥å…·è°ƒç”¨è¯´æ˜
    const callMessage = this.getToolFriendlyMessage(toolName, 'tool_call_explain');
    conversationCallback?.('tool_call_explain', callMessage, { toolName });

    try {
      // æ‰§è¡Œå·¥å…·
      const result = await this.executeTool(toolName, args);

      // ğŸ†• å‘é€å·¥å…·ç»“æœæ€»ç»“
      const summaryMessage = this.getToolFriendlyMessage(toolName, 'tool_result_summary');
      conversationCallback?.('tool_result_summary', summaryMessage, {
        toolName,
        result: result.result
      });

      // ğŸ†• å‘é€ä¸‹ä¸€æ­¥è®¡åˆ’
      const nextStepMessage = this.getToolFriendlyMessage(toolName, 'next_step_plan');
      conversationCallback?.('next_step_plan', nextStepMessage, {
        toolName,
        result: result.result
      });

      return result;

    } catch (error) {
      conversationCallback?.('tool_error', `âŒ æŠ±æ­‰ï¼Œ${this.getToolFriendlyName(toolName)}æ‰§è¡Œå¤±è´¥äº†: ${error.message}`, { toolName, error });
      throw error;
    }
  }

  // ğŸ†• è·å–å›­é•¿å‹å¥½çš„å·¥å…·æ¶ˆæ¯
  private getToolFriendlyMessage(toolName: string, eventType: string): string {
    const toolMap = {
      'any_query': {
        'tool_intent_explain': 'ğŸ” æˆ‘éœ€è¦å…ˆåˆ†æä¸€ä¸‹æ‚¨çš„æŸ¥è¯¢éœ€æ±‚ï¼Œæ‰¾åˆ°æœ€åˆé€‚çš„æŸ¥è¯¢æ–¹æ³•',
        'tool_call_explain': 'ğŸ”§ ç°åœ¨æˆ‘æ¥ä½¿ç”¨æ™ºèƒ½æŸ¥è¯¢å·¥å…·ï¼Œå¸®æ‚¨å¿«é€Ÿè·å–æ•°æ®',
        'tool_result_summary': 'âœ… å¤ªå¥½äº†ï¼æˆ‘å·²ç»æ‰¾åˆ°äº†ç›¸å…³æ•°æ®',
        'next_step_plan': 'ğŸ” ç°åœ¨è®©æˆ‘ä¸ºæ‚¨æ•´ç†ä¸€ä¸‹è¿™äº›æ•°æ®'
      },
      'read_data_record': {
        'tool_intent_explain': 'ğŸ“‹ æˆ‘æ¥å¸®æ‚¨æŸ¥çœ‹ç›¸å…³çš„è®°å½•ä¿¡æ¯',
        'tool_call_explain': 'ğŸ“š è®©æˆ‘æ¥æŸ¥æ‰¾ç›¸å…³çš„è®°å½•ä¿¡æ¯',
        'tool_result_summary': 'ğŸ“‹ å¾ˆå¥½ï¼æˆ‘å·²ç»æ‰¾åˆ°äº†æ‚¨éœ€è¦çš„è®°å½•',
        'next_step_plan': 'ğŸ“Š æ¥ä¸‹æ¥æˆ‘éœ€è¦åˆ†æè¿™äº›è®°å½•'
      },
      'navigate_to_page': {
        'tool_intent_explain': 'ğŸ§­ æˆ‘éœ€è¦å…ˆè·³è½¬åˆ°ç›¸åº”çš„é¡µé¢',
        'tool_call_explain': 'ğŸš€ ç°åœ¨è·³è½¬åˆ°ç›¸åº”çš„é¡µé¢ä¸ºæ‚¨æŸ¥çœ‹',
        'tool_result_summary': 'ğŸ¯ é¡µé¢å·²å‡†å¤‡å°±ç»ªï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹äº†',
        'next_step_plan': 'ğŸ‘€ è¯·æŸ¥çœ‹é¡µé¢å†…å®¹ï¼Œæˆ‘ä¼šç»§ç»­ååŠ©æ‚¨'
      },
      'generate_pdf_report': {
        'tool_intent_explain': 'ğŸ“„ æˆ‘æ¥ä¸ºæ‚¨ç”Ÿæˆä¸€ä»½æ¼‚äº®çš„PDFæŠ¥å‘Š',
        'tool_call_explain': 'âœ¨ å¼€å§‹ç”Ÿæˆç²¾ç¾çš„PDFæŠ¥å‘Š',
        'tool_result_summary': 'ğŸ“„ æŠ¥å‘Šå·²æˆåŠŸç”Ÿæˆï¼Œè¯·æŸ¥æ”¶',
        'next_step_plan': 'ğŸ“‹ æŠ¥å‘Šå·²ç”Ÿæˆï¼Œè®©æˆ‘ä¸ºæ‚¨æ€»ç»“ä¸€ä¸‹'
      },
      'create_todo_list': {
        'tool_intent_explain': 'ğŸ“ æˆ‘æ¥å¸®æ‚¨åˆ›å»ºä¸€ä¸ªå¾…åŠäº‹é¡¹æ¸…å•',
        'tool_call_explain': 'ğŸ“‹ å¼€å§‹åˆ›å»ºæ‚¨çš„å¾…åŠäº‹é¡¹',
        'tool_result_summary': 'ğŸ“ å¾…åŠæ¸…å•å·²åˆ›å»ºå®Œæˆ',
        'next_step_plan': 'âœ… ä»»åŠ¡å·²åˆ›å»ºï¼Œæˆ‘ä»¬ç»§ç»­ä¸‹ä¸€æ­¥'
      }
    };

    return toolMap[toolName]?.[eventType] || 'ğŸ”§ æˆ‘æ­£åœ¨ä¸ºæ‚¨å¤„ç†ç›¸å…³ä»»åŠ¡...';
  }

  // ğŸ†• è·å–å›­é•¿å‹å¥½çš„å·¥å…·åç§°
  private getToolFriendlyName(toolName: string): string {
    const nameMap = {
      'any_query': 'æ™ºèƒ½æŸ¥è¯¢å·¥å…·',
      'read_data_record': 'è®°å½•æŸ¥çœ‹å·¥å…·',
      'navigate_to_page': 'é¡µé¢è·³è½¬å·¥å…·',
      'generate_pdf_report': 'PDFæŠ¥å‘Šç”Ÿæˆå·¥å…·',
      'create_todo_list': 'å¾…åŠäº‹é¡¹å·¥å…·'
    };
    return nameMap[toolName] || 'æ™ºèƒ½å·¥å…·';
  }
}
```

#### 2. **ä¿®æ”¹unified-intelligenceä¸»æœåŠ¡**
```typescript
// unified-intelligence.service.ts ä¿®æ”¹
export class UnifiedIntelligenceService {
  async processRequest(request: UserRequest, options: any = {}) {
    // ... ç°æœ‰ä»£ç 

    // ğŸ†• åˆ›å»ºå¯¹è¯å›è°ƒå‡½æ•°
    const conversationCallback = (eventType: string, message: string, details?: any) => {
      // é€šè¿‡SSEæ¨é€åˆ°å‰ç«¯
      if (res && !res.writableEnded) {
        streamingService.sendSSE(res, eventType, {
          type: eventType,
          message: message,
          details: details,
          timestamp: new Date().toISOString()
        });
      }
    };

    // ä¼ é€’å¯¹è¯å›è°ƒåˆ°å·¥å…·æ‰§è¡Œå™¨
    const toolExecutorOptions = {
      ...options,
      conversationCallback: conversationCallback
    };

    // ... å·¥å…·æ‰§è¡Œé€»è¾‘
  }
}
```

#### 3. **ç”Ÿæˆæœ€ç»ˆMarkdownæŠ¥å‘Š**
```typescript
// report-generator.service.ts (æ–°å»º)
export class ReportGeneratorService {
  generateFinalReport(toolResults: any[], userQuery: string): string {
    let report = `## ğŸ“‹ æŸ¥è¯¢å®ŒæˆæŠ¥å‘Š\n\n`;
    report += `**æ‚¨çš„æŸ¥è¯¢**: ${userQuery}\n\n`;
    report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;

    toolResults.forEach((result, index) => {
      const toolName = result.name;
      const friendlyName = this.getFriendlyToolName(toolName);

      if (result.status === 'success') {
        report += `âœ… **${friendlyName}**: æ‰§è¡ŒæˆåŠŸ\n`;

        // æ ¹æ®å·¥å…·ç±»å‹æ·»åŠ å…·ä½“ç»“æœ
        if (toolName === 'any_query' && result.result?.result) {
          const data = result.result.result;
          if (data.data && Array.isArray(data.data) && data.data.length > 0) {
            const firstItem = data.data[0];
            Object.entries(firstItem).forEach(([key, value]) => {
              const friendlyKey = this.getFriendlyFieldName(key);
              report += `   - **${friendlyKey}**: ${value}\n`;
            });
          }
        }
      } else {
        report += `âŒ **${friendlyName}**: æ‰§è¡Œå¤±è´¥\n`;
        report += `   - é”™è¯¯ä¿¡æ¯: ${result.error}\n`;
      }
      report += `\n`;
    });

    report += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
    report += `ğŸ‰ **æŸ¥è¯¢çŠ¶æ€**: å…¨éƒ¨å®Œæˆ\n`;
    report += `ğŸ“… **å®Œæˆæ—¶é—´**: ${new Date().toLocaleString('zh-CN')}\n`;
    report += `ğŸ’¡ **æç¤º**: å¦‚éœ€æ›´å¤šä¿¡æ¯ï¼Œè¯·éšæ—¶è¯¢é—®ï¼`;

    return report;
  }

  private getFriendlyToolName(toolName: string): string {
    const nameMap = {
      'any_query': 'æ™ºèƒ½æ•°æ®æŸ¥è¯¢',
      'read_data_record': 'è®°å½•ä¿¡æ¯æŸ¥çœ‹',
      'navigate_to_page': 'é¡µé¢å¯¼èˆªè·³è½¬',
      'generate_pdf_report': 'PDFæŠ¥å‘Šç”Ÿæˆ',
      'create_todo_list': 'å¾…åŠäº‹é¡¹åˆ›å»º'
    };
    return nameMap[toolName] || 'å·¥å…·æ‰§è¡Œ';
  }

  private getFriendlyFieldName(field: string): string {
    const fieldMap = {
      'student_total': 'å­©å­æ€»æ•°',
      'teacher_total': 'æ•™å¸ˆæ€»æ•°',
      'class_total': 'ç­çº§æ€»æ•°',
      'activity_total': 'æ´»åŠ¨æ€»æ•°',
      'name': 'åç§°',
      'count': 'æ•°é‡',
      'status': 'çŠ¶æ€'
    };
    return fieldMap[field] || field;
  }
}
```

### ğŸ¨ **å‰ç«¯å®ç°æ–¹æ¡ˆ**

#### 1. **æ‰©å±•å‰ç«¯äº‹ä»¶å¤„ç†**
```typescript
// useMultiRoundToolCalling.ts æ‰©å±•
async function executeMultiRound(...) {
  // åœ¨äº‹ä»¶å¤„ç†ä¸­å¢åŠ å¯¹è¯å¼äº‹ä»¶
  onEvent: (event: any) => {
    // ğŸ†• å¤„ç†å·¥å…·æ„å›¾è¯´æ˜
    if (event.type === 'tool_intent_explain') {
      console.log(`ğŸ’¬ [å·¥å…·æ„å›¾] ${event.message}`);
      // æ·»åŠ åˆ°å¯¹è¯å†å²
      state.value.conversationHistory.push({
        role: 'assistant',
        content: event.message,
        eventType: 'tool_intent'
      });
    }

    // ğŸ†• å¤„ç†å·¥å…·è°ƒç”¨è¯´æ˜
    if (event.type === 'tool_call_explain') {
      console.log(`ğŸ”§ [å·¥å…·è°ƒç”¨] ${event.message}`);
      state.value.conversationHistory.push({
        role: 'assistant',
        content: event.message,
        eventType: 'tool_call'
      });
    }

    // ğŸ†• å¤„ç†å·¥å…·ç»“æœæ€»ç»“
    if (event.type === 'tool_result_summary') {
      console.log(`âœ… [å·¥å…·ç»“æœ] ${event.message}`);
      state.value.conversationHistory.push({
        role: 'assistant',
        content: event.message,
        eventType: 'tool_result'
      });
    }

    // ğŸ†• å¤„ç†ä¸‹ä¸€æ­¥è®¡åˆ’
    if (event.type === 'next_step_plan') {
      console.log(`ğŸ“ [ä¸‹ä¸€æ­¥] ${event.message}`);
      state.value.conversationHistory.push({
        role: 'assistant',
        content: event.message,
        eventType: 'next_step'
      });
    }

    // ğŸ†• å¤„ç†æœ€ç»ˆæŠ¥å‘Š
    if (event.type === 'final_summary_report') {
      console.log(`ğŸ“‹ [æœ€ç»ˆæŠ¥å‘Š] ${event.message}`);
      state.value.conversationHistory.push({
        role: 'assistant',
        content: event.message,
        eventType: 'final_report',
        isMarkdown: true
      });
    }
  }
}
```

#### 2. **UIç»„ä»¶æ”¯æŒ**
```vue
<!-- MessageItem.vue æ‰©å±• -->
<template>
  <div class="message-item" :class="messageClass">
    <!-- æ€è€ƒè¿‡ç¨‹æ˜¾ç¤º -->
    <div v-if="message.eventType === 'thinking'" class="thinking-message">
      ğŸ¤” {{ message.content }}
    </div>

    <!-- å·¥å…·æ„å›¾è¯´æ˜ -->
    <div v-else-if="message.eventType === 'tool_intent'" class="intent-message">
      ğŸ’¬ {{ message.content }}
    </div>

    <!-- å·¥å…·è°ƒç”¨è¯´æ˜ -->
    <div v-else-if="message.eventType === 'tool_call'" class="tool-call-message">
      ğŸ”§ {{ message.content }}
    </div>

    <!-- å·¥å…·ç»“æœæ€»ç»“ -->
    <div v-else-if="message.eventType === 'tool_result'" class="tool-result-message">
      âœ… {{ message.content }}
    </div>

    <!-- ä¸‹ä¸€æ­¥è®¡åˆ’ -->
    <div v-else-if="message.eventType === 'next_step'" class="next-step-message">
      ğŸ“ {{ message.content }}
    </div>

    <!-- æœ€ç»ˆæŠ¥å‘Š (Markdownæ¸²æŸ“) -->
    <div v-else-if="message.eventType === 'final_report'" class="final-report-message">
      <div v-html="renderedMarkdown"></div>
    </div>

    <!-- æ™®é€šæ¶ˆæ¯ -->
    <div v-else class="regular-message">
      {{ message.content }}
    </div>
  </div>
</template>

<style scoped>
.thinking-message {
  color: #666;
  font-style: italic;
  padding: 8px 12px;
  background: #f5f5f5;
  border-radius: 8px;
}

.intent-message {
  color: #2196F3;
  padding: 8px 12px;
  background: #E3F2FD;
  border-radius: 8px;
  border-left: 4px solid #2196F3;
}

.tool-call-message {
  color: #FF9800;
  padding: 8px 12px;
  background: #FFF3E0;
  border-radius: 8px;
  border-left: 4px solid #FF9800;
}

.tool-result-message {
  color: #4CAF50;
  padding: 8px 12px;
  background: #E8F5E8;
  border-radius: 8px;
  border-left: 4px solid #4CAF50;
}

.next-step-message {
  color: #9C27B0;
  padding: 8px 12px;
  background: #F3E5F5;
  border-radius: 8px;
  border-left: 4px solid #9C27B0;
}

.final-report-message {
  color: #333;
  padding: 16px;
  background: #F9F9F9;
  border-radius: 8px;
  border: 1px solid #E0E0E0;
}

.final-report-message :deep(h3) {
  color: #2196F3;
  margin-top: 16px;
  margin-bottom: 8px;
}

.final-report-message :deep(.success-item) {
  color: #4CAF50;
  font-weight: bold;
}
</style>
```

---

## ğŸ¯ **å®ç°ä¼˜å…ˆçº§**

### ğŸš€ **Phase 1: æ ¸å¿ƒå¯¹è¯æµç¨‹ (2-3å¤©)**
1. **æ‰©å±•SSEäº‹ä»¶ç±»å‹** - æ·»åŠ 4ä¸ªæ–°äº‹ä»¶ç±»å‹
2. **ä¿®æ”¹å·¥å…·æ‰§è¡Œå™¨** - æ”¯æŒå¯¹è¯å›è°ƒ
3. **å‰ç«¯äº‹ä»¶å¤„ç†** - å¤„ç†æ–°çš„å¯¹è¯äº‹ä»¶
4. **UIç»„ä»¶æ›´æ–°** - æ”¯æŒä¸åŒç±»å‹çš„æ¶ˆæ¯æ˜¾ç¤º

### ğŸ”§ **Phase 2: è¯­è¨€ä¼˜åŒ– (1-2å¤©)**
1. **ä¸“ä¸šæœ¯è¯­æ˜ å°„** - å»ºç«‹å›­é•¿å‹å¥½è¯æ±‡è¡¨
2. **å·¥å…·æ¶ˆæ¯æ¨¡æ¿** - ä¸ºæ¯ä¸ªå·¥å…·åˆ›å»ºå‹å¥½æ¶ˆæ¯
3. **æµ‹è¯•éªŒè¯** - ç¡®ä¿å¯¹è¯æµç•…è‡ªç„¶

### ğŸ¨ **Phase 3: æŠ¥å‘Šç”Ÿæˆ (1-2å¤©)**
1. **MarkdownæŠ¥å‘Šæ¨¡æ¿** - åˆ›å»ºå¸¦âœ…çš„æ¼‚äº®æŠ¥å‘Š
2. **ç»“æœæ•°æ®æ˜ å°„** - ä¸“ä¸šå­—æ®µè½¬å‹å¥½åç§°
3. **å‰ç«¯Markdownæ¸²æŸ“** - æ”¯æŒå¯Œæ–‡æœ¬æ˜¾ç¤º

---

## ğŸ“Š **é¢„æœŸæ•ˆæœ**

### âœ… **ç”¨æˆ·ä½“éªŒæå‡**
- **æŒç»­åé¦ˆ**: å¯¹è¯æ¡†ä¸€ç›´åœ¨åŠ¨ï¼Œç”¨æˆ·æœ‰å‚ä¸æ„Ÿ
- **è¯­è¨€å‹å¥½**: "SQLç”Ÿæˆ" â†’ "ç”ŸæˆæŸ¥è¯¢å·¥å…·"ï¼Œå›­é•¿ç§’æ‡‚
- **æˆå°±æ„Ÿ**: æ¯ä¸ªæ­¥éª¤éƒ½æœ‰æ˜ç¡®çš„æˆåŠŸæ ‡è¯†
- **ä¸“ä¸šæŠ¥å‘Š**: æœ€ç»ˆç»™ç”¨æˆ·å¸¦âœ…çš„æ¼‚äº®æŠ¥å‘Š

### ğŸ¯ **æŠ€æœ¯æ•ˆæœ**
- **æ— éœ€æ”¹å˜å¾ªç¯**: ä¿æŒç°æœ‰å¤šè½®è°ƒç”¨æœºåˆ¶
- **æ¸è¿›å¢å¼º**: åªå¢åŠ å¯¹è¯äº‹ä»¶ï¼Œä¸å½±å“æ ¸å¿ƒé€»è¾‘
- **å¯æ‰©å±•**: æ˜“äºä¸ºå…¶ä»–å·¥å…·æ·»åŠ å¯¹è¯æ”¯æŒ

### ğŸ’¡ **å•†ä¸šä»·å€¼**
- **ç”¨æˆ·ç²˜æ€§**: å¯¹è¯å¼ä½“éªŒè®©ç”¨æˆ·æ„Ÿè§‰"æ™ºèƒ½"
- **ä¿¡ä»»åº¦**: é€æ˜çš„æ­¥éª¤å»ºç«‹ç”¨æˆ·ä¿¡ä»»
- **å·®å¼‚åŒ–**: ç‹¬ç‰¹çš„å¯¹è¯å¼AIä½“éªŒ

è¿™ä¸ªæ–¹æ¡ˆå®Œå…¨ç¬¦åˆä½ çš„éœ€æ±‚ï¼Œå¯ä»¥è®©å¹¼å„¿å›­å›­é•¿åœ¨ä½¿ç”¨AIæ—¶æ„Ÿåˆ°éå¸¸èˆ’æœå’Œæœ‰æŒæ§æ„Ÿï¼ä½ è§‰å¾—è¿™ä¸ªåˆ†æå¦‚ä½•ï¼Ÿæˆ‘ä»¬å¼€å§‹å®æ–½å“ªä¸ªéƒ¨åˆ†ï¼Ÿ