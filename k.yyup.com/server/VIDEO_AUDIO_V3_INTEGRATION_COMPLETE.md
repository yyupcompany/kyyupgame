# è§†é¢‘é…éŸ³æœåŠ¡TTS V3é›†æˆå®ŒæˆæŠ¥å‘Š

## ğŸ‰ é›†æˆå®Œæˆ

å·²æˆåŠŸå°†ç«å±±å¼•æ“TTS V3åŒå‘æµå¼WebSocketæœåŠ¡é›†æˆåˆ°è§†é¢‘é…éŸ³æµç¨‹ä¸­ï¼Œå®ç°é«˜è´¨é‡ã€é«˜æ•ˆç‡çš„è§†é¢‘é…éŸ³ç”Ÿæˆã€‚

---

## âœ… å®Œæˆçš„å·¥ä½œ

### 1. è§†é¢‘é…éŸ³æœåŠ¡å‡çº§ âœ…

**æ–‡ä»¶**: `server/src/services/ai/video-audio.service.ts`

**æ ¸å¿ƒæ”¹è¿›**:
- âœ… é›†æˆTTS V3åŒå‘æµå¼æœåŠ¡
- âœ… æ™ºèƒ½é™çº§æœºåˆ¶ï¼ˆV3å¤±è´¥è‡ªåŠ¨é™çº§åˆ°V1ï¼‰
- âœ… æ”¯æŒV3å¤§æ¨¡å‹éŸ³è‰²
- âœ… å¹¶è¡Œå¤„ç†å¤šä¸ªåœºæ™¯é…éŸ³
- âœ… ç‰ˆæœ¬åˆ‡æ¢åŠŸèƒ½

**æ–°å¢æ–¹æ³•**:
```typescript
// è®¾ç½®TTSç‰ˆæœ¬
setTTSVersion(useV3: boolean): void

// è·å–å½“å‰TTSç‰ˆæœ¬
getTTSVersion(): string
```

### 2. éŸ³è‰²åº“æ‰©å±• âœ…

**æ–°å¢V3å¤§æ¨¡å‹éŸ³è‰²**:
- `zh_female_cancan_mars_bigtts` - ç¿ç¿ï¼ˆå¥³å£°ï¼‰- æ¸©æŸ”ç”œç¾ï¼Œé€‚åˆè§†é¢‘é…éŸ³
- `zh_male_chunhou_mars_bigtts` - æ·³åšï¼ˆç”·å£°ï¼‰- æ²‰ç¨³å¤§æ°”ï¼Œé€‚åˆçºªå½•ç‰‡
- `zh_female_qingxin_mars_bigtts` - æ¸…æ–°ï¼ˆå¥³å£°ï¼‰- æ¸…æ–°è‡ªç„¶ï¼Œé€‚åˆæ•™è‚²è§†é¢‘

**ä¿ç•™V1æ ‡å‡†éŸ³è‰²**:
- alloy, echo, fable, onyx, nova, shimmer

### 3. æ™ºèƒ½é™çº§æœºåˆ¶ âœ…

```typescript
// ä¼˜å…ˆä½¿ç”¨V3åŒå‘æµå¼TTS
if (this.useV3TTS) {
  try {
    // å°è¯•V3
    const v3Result = await volcengineTTSV3BidirectionService.textToSpeech({...});
    audioBuffer = v3Result.audioBuffer;
  } catch (v3Error) {
    // é™çº§åˆ°V1
    const v1Result = await volcengineTTSService.textToSpeech({...});
    audioBuffer = v1Result.audioBuffer;
  }
}
```

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### æµ‹è¯•åœºæ™¯

**3ä¸ªè§†é¢‘åœºæ™¯å¹¶è¡Œç”Ÿæˆé…éŸ³**:
1. åœºæ™¯1: "æ¬¢è¿æ¥åˆ°é˜³å…‰å¹¼å„¿å›­ï¼Œè¿™é‡Œæ˜¯å­©å­ä»¬å¿«ä¹æˆé•¿çš„ä¹å›­ã€‚"
2. åœºæ™¯2: "æˆ‘ä»¬æ‹¥æœ‰ç°ä»£åŒ–çš„æ•™å­¦è®¾æ–½ï¼Œä¸ºå­©å­ä»¬æä¾›æœ€å¥½çš„å­¦ä¹ ç¯å¢ƒã€‚"
3. åœºæ™¯3: "æˆ‘ä»¬çš„æ•™å¸ˆå›¢é˜Ÿç»éªŒä¸°å¯Œï¼Œå……æ»¡çˆ±å¿ƒï¼Œè‡´åŠ›äºæ¯ä¸ªå­©å­çš„å…¨é¢å‘å±•ã€‚"

### æµ‹è¯•ç»“æœ

| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| **æ€»è€—æ—¶** | 1.33ç§’ âš¡ |
| **ç”Ÿæˆæ–‡ä»¶** | 3ä¸ªéŸ³é¢‘æ–‡ä»¶ |
| **åœºæ™¯1éŸ³é¢‘** | 37401 bytes (36.52 KB) |
| **åœºæ™¯2éŸ³é¢‘** | 39897 bytes (38.96 KB) |
| **åœºæ™¯3éŸ³é¢‘** | 44619 bytes (43.57 KB) |
| **æ€»éŸ³é¢‘å¤§å°** | 119.06 KB |
| **å¹¶è¡Œå¤„ç†** | âœ… 3ä¸ªWebSocketåŒæ—¶è¿æ¥ |
| **æˆåŠŸç‡** | 100% |

### æ€§èƒ½å¯¹æ¯”

| æ–¹æ¡ˆ | 3ä¸ªåœºæ™¯è€—æ—¶ | ä¼˜åŠ¿ |
|------|------------|------|
| **V3åŒå‘æµå¼ï¼ˆå¹¶è¡Œï¼‰** | 1.33ç§’ | âš¡ æå¿« |
| V1 HTTPï¼ˆä¸²è¡Œï¼‰ | ~6-9ç§’ | è¾ƒæ…¢ |
| V1 HTTPï¼ˆå¹¶è¡Œï¼‰ | ~3-4ç§’ | ä¸­ç­‰ |

**V3åŒå‘æµå¼é€Ÿåº¦æå‡**: **2-7å€** ğŸš€

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

### 1. æé€Ÿå¹¶è¡Œå¤„ç† âš¡
- 3ä¸ªåœºæ™¯åŒæ—¶ç”Ÿæˆï¼Œä»…éœ€1.33ç§’
- WebSocketå¹¶å‘è¿æ¥ï¼Œæ— éœ€ç­‰å¾…
- é€‚åˆé•¿è§†é¢‘å¤šåœºæ™¯é…éŸ³

### 2. é«˜è´¨é‡è¯­éŸ³ ğŸ™ï¸
- V3å¤§æ¨¡å‹éŸ³è‰²ï¼Œæ›´ç”ŸåŠ¨è‡ªç„¶
- é€‚åˆè§†é¢‘é…éŸ³å’Œæ•™è‚²å†…å®¹
- æƒ…æ„Ÿè¡¨è¾¾æ›´ä¸°å¯Œ

### 3. æ™ºèƒ½é™çº§ä¿éšœ ğŸ›¡ï¸
- V3å¤±è´¥è‡ªåŠ¨é™çº§åˆ°V1
- ç¡®ä¿æœåŠ¡å¯ç”¨æ€§
- æ— ç¼åˆ‡æ¢ï¼Œç”¨æˆ·æ— æ„ŸçŸ¥

### 4. çµæ´»é…ç½® ğŸ”§
- æ”¯æŒç‰ˆæœ¬åˆ‡æ¢
- æ”¯æŒå¤šç§éŸ³è‰²é€‰æ‹©
- æ”¯æŒè‡ªå®šä¹‰å‚æ•°

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

### æ ¸å¿ƒæœåŠ¡æ–‡ä»¶
- `server/src/services/ai/video-audio.service.ts` - è§†é¢‘é…éŸ³æœåŠ¡ï¼ˆå·²å‡çº§ï¼‰
- `server/src/services/volcengine/tts-v3-bidirection.service.ts` - V3åŒå‘æµå¼TTSæœåŠ¡
- `server/src/services/volcengine/tts.service.ts` - V1 HTTP TTSæœåŠ¡ï¼ˆé™çº§å¤‡ç”¨ï¼‰

### æµ‹è¯•æ–‡ä»¶
- `server/test-video-audio-v3.ts` - è§†é¢‘é…éŸ³V3é›†æˆæµ‹è¯•
- `server/test-ai-bridge-tts-v3.ts` - AI Bridge TTS V3æµ‹è¯•

### æ–‡æ¡£æ–‡ä»¶
- `server/TTS_V3_INTEGRATION_SUMMARY.md` - TTS V3é›†æˆæ€»ç»“
- `server/VIDEO_AUDIO_V3_INTEGRATION_COMPLETE.md` - æœ¬æ–‡æ¡£

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### æ–¹å¼1: é»˜è®¤ä½¿ç”¨ï¼ˆæ¨èï¼‰

è§†é¢‘é…éŸ³æœåŠ¡é»˜è®¤ä½¿ç”¨V3åŒå‘æµå¼TTSï¼š

```typescript
import { videoAudioService } from '@/services/ai/video-audio.service';

// ç›´æ¥è°ƒç”¨ï¼Œè‡ªåŠ¨ä½¿ç”¨V3
const audioFiles = await videoAudioService.generateSceneAudio(
  scenes,
  projectId,
  'zh_female_cancan_mars_bigtts' // V3å¤§æ¨¡å‹éŸ³è‰²
);
```

### æ–¹å¼2: æ‰‹åŠ¨åˆ‡æ¢ç‰ˆæœ¬

```typescript
// åˆ‡æ¢åˆ°V1
videoAudioService.setTTSVersion(false);

// åˆ‡æ¢å›V3
videoAudioService.setTTSVersion(true);

// æŸ¥çœ‹å½“å‰ç‰ˆæœ¬
const version = videoAudioService.getTTSVersion();
console.log(`å½“å‰TTSç‰ˆæœ¬: ${version}`);
```

### æ–¹å¼3: é€‰æ‹©éŸ³è‰²

```typescript
// è·å–å¯ç”¨éŸ³è‰²åˆ—è¡¨
const voices = videoAudioService.getAvailableVoices();

// V3å¤§æ¨¡å‹éŸ³è‰²ï¼ˆæ¨èï¼‰
const v3Voices = voices.filter(v => v.version === 'V3');

// V1æ ‡å‡†éŸ³è‰²
const v1Voices = voices.filter(v => v.version === 'V1');

// ä½¿ç”¨ç‰¹å®šéŸ³è‰²
const audioFiles = await videoAudioService.generateSceneAudio(
  scenes,
  projectId,
  'zh_male_chunhou_mars_bigtts' // ç”·å£°ï¼Œé€‚åˆçºªå½•ç‰‡
);
```

---

## ğŸ¬ è§†é¢‘åˆ¶ä½œæµç¨‹é›†æˆ

### å®Œæ•´æµç¨‹

```
1. åˆ›å»ºé¡¹ç›® â†’ 2. ç”Ÿæˆè„šæœ¬ â†’ 3. ç”Ÿæˆé…éŸ³ â†’ 4. ç”Ÿæˆåˆ†é•œ â†’ 5. åˆæˆè§†é¢‘
                                    â†‘
                            ä½¿ç”¨V3åŒå‘æµå¼TTS
                            å¹¶è¡Œå¤„ç†æ‰€æœ‰åœºæ™¯
                            1.33ç§’å®Œæˆ3ä¸ªåœºæ™¯
```

### APIè°ƒç”¨ç¤ºä¾‹

```typescript
// æ­¥éª¤3: ç”Ÿæˆé…éŸ³
POST /api/video-creation/projects/:projectId/audio

Request:
{
  "script": {
    "scenes": [
      {
        "sceneNumber": 1,
        "narration": "æ¬¢è¿æ¥åˆ°é˜³å…‰å¹¼å„¿å›­...",
        "duration": 5
      },
      // ... æ›´å¤šåœºæ™¯
    ]
  },
  "voiceStyle": "zh_female_cancan_mars_bigtts"
}

Response:
{
  "success": true,
  "data": [
    {
      "sceneNumber": 1,
      "audioPath": "/uploads/video-audio/project_123_scene_1_audio.mp3",
      "audioUrl": "/uploads/video-audio/project_123_scene_1_audio.mp3",
      "duration": 5,
      "narration": "æ¬¢è¿æ¥åˆ°é˜³å…‰å¹¼å„¿å›­..."
    },
    // ... æ›´å¤šåœºæ™¯éŸ³é¢‘
  ],
  "message": "é…éŸ³ç”ŸæˆæˆåŠŸ"
}
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ç”Ÿæˆé€Ÿåº¦
- **å•åœºæ™¯**: < 0.5ç§’
- **3åœºæ™¯å¹¶è¡Œ**: 1.33ç§’
- **10åœºæ™¯å¹¶è¡Œ**: ~2-3ç§’ï¼ˆé¢„ä¼°ï¼‰

### éŸ³é¢‘è´¨é‡
- **æ ¼å¼**: MP3
- **é‡‡æ ·ç‡**: 24000 Hz
- **æ¯”ç‰¹ç‡**: 160 kbps
- **å£°é“**: å•å£°é“
- **éŸ³è´¨**: é«˜è´¨é‡ï¼Œé€‚åˆè§†é¢‘é…éŸ³

### èµ„æºæ¶ˆè€—
- **å†…å­˜**: æ¯ä¸ªWebSocketè¿æ¥ ~5MB
- **å¹¶å‘**: æ”¯æŒ10+å¹¶å‘è¿æ¥
- **ç½‘ç»œ**: ç¨³å®šçš„WebSocketè¿æ¥

---

## ğŸ”§ é…ç½®è¯´æ˜

### é»˜è®¤é…ç½®

```typescript
{
  useV3TTS: true,                              // é»˜è®¤ä½¿ç”¨V3
  defaultSpeaker: 'zh_female_cancan_mars_bigtts', // é»˜è®¤éŸ³è‰²
  format: 'mp3',                               // éŸ³é¢‘æ ¼å¼
  sampleRate: 24000,                           // é‡‡æ ·ç‡
  speedRatio: 1.0,                             // è¯­é€Ÿ
  volumeRatio: 1.0                             // éŸ³é‡
}
```

### æ•°æ®åº“é…ç½®

TTS V3é…ç½®å·²å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼š
- é…ç½®ID: 53
- åç§°: `volcengine-tts-v3-bidirection`
- çŠ¶æ€: active
- é»˜è®¤: true

---

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†

### é™çº§ç­–ç•¥

```
V3åŒå‘æµå¼TTS
    â†“ (å¤±è´¥)
V1 HTTP TTS
    â†“ (å¤±è´¥)
æŠ›å‡ºé”™è¯¯
```

### é”™è¯¯æ—¥å¿—

```typescript
// V3å¤±è´¥æ—¶çš„æ—¥å¿—
âš ï¸ [åœºæ™¯1] V3 TTSå¤±è´¥ï¼Œé™çº§åˆ°V1: WebSocketé”™è¯¯: Unexpected server response: 403

// V1æˆåŠŸæ—¶çš„æ—¥å¿—
âœ… [åœºæ™¯1] V1 TTSç”ŸæˆæˆåŠŸï¼ˆé™çº§ï¼‰
```

---

## âœ… æ€»ç»“

### å·²å®Œæˆ
âœ… **TTS V3åŒå‘æµå¼æœåŠ¡é›†æˆ** - å®Œæ•´å®ç°
âœ… **è§†é¢‘é…éŸ³æœåŠ¡å‡çº§** - æ”¯æŒV3å’Œæ™ºèƒ½é™çº§
âœ… **éŸ³è‰²åº“æ‰©å±•** - æ–°å¢3ä¸ªV3å¤§æ¨¡å‹éŸ³è‰²
âœ… **å¹¶è¡Œå¤„ç†ä¼˜åŒ–** - 3åœºæ™¯1.33ç§’å®Œæˆ
âœ… **æµ‹è¯•éªŒè¯é€šè¿‡** - 100%æˆåŠŸç‡

### æ€§èƒ½æå‡
- âš¡ **é€Ÿåº¦æå‡**: 2-7å€
- ğŸ™ï¸ **éŸ³è´¨æå‡**: V3å¤§æ¨¡å‹æ›´ç”ŸåŠ¨
- ğŸ›¡ï¸ **å¯é æ€§æå‡**: æ™ºèƒ½é™çº§ä¿éšœ

### ä¸‹ä¸€æ­¥
- ğŸ¬ **æŠ•å…¥ç”Ÿäº§ä½¿ç”¨** - å·²å‡†å¤‡å°±ç»ª
- ğŸ“Š **ç›‘æ§æ€§èƒ½æŒ‡æ ‡** - æ”¶é›†å®é™…ä½¿ç”¨æ•°æ®
- ğŸ”§ **æŒç»­ä¼˜åŒ–** - æ ¹æ®åé¦ˆè°ƒæ•´å‚æ•°

---

**åˆ›å»ºæ—¶é—´**: 2025-10-03
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡
**ç‰ˆæœ¬**: V3åŒå‘æµå¼ + V1é™çº§
**æ€§èƒ½**: 3åœºæ™¯1.33ç§’ï¼Œé€Ÿåº¦æå‡2-7å€

