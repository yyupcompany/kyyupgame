/**
 * 关联查询规划模板
 * 在第二阶段详细API说明中，引导Think进行智能关联查询规划
 */

export const correlatedQueryPlanningTemplate = {
  name: 'correlated_query_planning',
  description: '关联查询智能规划 - 基于选定工具和API说明进行关联数据查询规划',
  variables: [],

  template: `## 🔗 关联查询智能规划模式

基于您的工具选择和详细的API说明，现在进行**智能关联查询规划**：

### 📋 已选择工具
\`\`\`
{{selectedTools}}
\`\`\`

### 🎯 用户核心查询
\`\`\`
{{userQuery}}
\`\`\`

---

## 📊 主查询策略设计

### 核心数据路径规划
- **主要数据表**：[基于用户查询确定的主要数据源]
- **查询方式**：[使用最合适的工具进行查询]
- **查询条件**：[优化查询参数，确保数据准确性和完整性]
- **预期结果**：[明确主查询应该返回的核心数据]

### API参数优化策略
基于详细的API说明，优化查询参数：
- **过滤条件**：[设置合适的过滤条件，避免无关数据]
- **排序规则**：[选择最合适的排序字段和顺序]
- **分页策略**：[如果数据量大，设置合理的分页参数]
- **字段选择**：[只选择必要的字段，提高查询效率]

---

## 🔍 关联数据查询规划

### 历史数据对比查询
#### 时间维度对比
- **同期对比**：
  - 上周同期：[查询上周同一天或同周的数据]
  - 上月同期：[查询上月同一天或同月的数据]
  - 去年同期：[查询去年同期的数据，用于年度对比]

- **趋势分析**：
  - 近7天趋势：[查询最近7天的数据变化趋势]
  - 近30天趋势：[查询最近30天的数据变化趋势]
  - 季度趋势：[查询最近一个季度的数据变化]

#### 关联历史查询工具调用
\`\`\`
// 示例：考勤历史对比查询
{
  "tool": "any_query",
  "parameters": {
    "entity": "attendance",
    "operation": "query",
    "filters": {
      "date_gte": "{{last_week_date}}",
      "date_lte": "{{today_date}}"
    },
    "aggregations": ["count", "group_by:date"],
    "order": { "date": "ASC" }
  }
}
\`\`\`

### 关联数据查询策略

#### 根据查询类型自动关联
**如果查询考勤数据**：
- 学员基本信息：关联出勤率低的学员详情
- 班级信息：查询各班级的考勤对比
- 教师信息：关联教师和班级的考勤情况

**如果查询活动数据**：
- 招生数据：关联活动的招生转化效果
- 家长反馈：关联活动后的家长满意度
- 学员参与：关联学员参与活动的详细情况

**如果查询人数数据**：
- 历史人数对比：各时间段的人数变化趋势
- 班级容量：各班级的实际容量和利用率
- 招生数据：相关的招生咨询和转化数据

#### 关联查询模板
\`\`\`
// 示例：考勤关联查询规划
{
  "primary_query": {
    "tool": "any_query",
    "entity": "attendance",
    "filters": { "date": "today" }
  },

  "correlated_queries": [
    {
      "description": "历史考勤对比",
      "tool": "any_query",
      "entity": "attendance",
      "filters": {
        "date_gte": "{{last_month_date}}",
        "date_lte": "{{today_date}}"
      },
      "aggregations": ["count", "group_by:date"]
    },

    {
      "description": "低出勤率学员识别",
      "tool": "any_query",
      "entity": "students",
      "relations": ["attendance"],
      "filters": {
        "attendance_rate_lt": 0.85,
        "period": "last_30_days"
      }
    },

    {
      "description": "班级考勤排名",
      "tool": "any_query",
      "entity": "classes",
      "relations": ["attendance", "students"],
      "aggregations": ["avg_attendance_rate"],
      "order": { "avg_attendance_rate": "DESC" }
    }
  ]
}
\`\`\`

---

## ⚠️ 异常检测和风险识别

### 数据异常检测算法
- **阈值监控**：[设置关键指标的预警阈值]
- **趋势异常**：[检测与历史趋势不符的数据点]
- **关联异常**：[发现数据之间的异常关联模式]
- **质量检测**：[识别数据完整性和准确性问题]

### 关键指标监控
#### 考勤异常指标
- 出勤率 < 85% 的班级或学员
- 连续3天以上缺席的学员
- 突然大幅下降的出勤率
- 特定时间模式的异常缺勤

#### 活动异常指标
- 参与率异常低的活动
- 满意度评分低的活动
- 成本异常高的活动
- 招生转化率异常低的活动

#### 人数异常指标
- 人数突然大幅增减
- 班级容量超载或利用率过低
- 特殊年龄段的人数异常
- 招生转化率的异常变化

---

## 📈 智能洞察生成策略

### 数据分析维度
#### 对比分析
- **环比分析**：与上一个周期的对比变化
- **同比分析**：与去年同期的对比变化
- **横向对比**：同类项目之间的对比
- **目标对比**：与设定目标的对比差距

#### 趋势识别
- **增长趋势**：数据持续增长的模式识别
- **下降趋势**：数据持续下降的风险识别
- **周期性模式**：数据的周期性变化规律
- **异常波动**：不规律的数据变化识别

### 业务价值挖掘
#### 问题诊断
- **根本原因分析**：数据异常背后的深层原因
- **影响范围评估**：问题波及的范围和程度
- **紧急程度评估**：问题的处理优先级

#### 机会发现
- **改进机会**：可以优化的环节和方法
- **增长机会**：可以扩展的领域和方向
- **效率提升**：可以节省资源和时间的途径

---

## 🎯 响应格式优化策略

### 数据价值最大化展示
#### 结构化数据展示
- **核心数据突出**：重点数据用颜色和格式强调
- **对比数据清晰**：历史对比数据用表格和图表展示
- **异常数据醒目**：异常情况用警示符号和颜色标注
- **趋势数据直观**：趋势变化用图表和箭头标识

#### 专业报告格式
\`\`\`
# 📊 [业务主题]智能分析报告

## 📈 核心数据概览
- **主要指标**：[核心业务指标的当前值]
- **变化趋势**：[与历史对比的变化情况]
- **关键发现**：[最重要的数据发现]

## 📊 历史趋势对比
| 时间维度 | 当前值 | 对比值 | 变化率 | 趋势 |
|----------|--------|--------|--------|------|
| 今日 | [值] | [对比值] | [+X%] | 📈 |
| 本周 | [值] | [对比值] | [+X%] | 📈 |
| 本月 | [值] | [对比值] | [+X%] | 📈 |

## 🔍 关键发现洞察
### ✅ 正面发现
- [积极的业务发现和亮点]

### ⚠️ 需要关注
- [需要关注的问题和风险]

## 🎯 具体行动建议
### 立即行动（今日）
1. [具体可执行的行动项]
2. [具体可执行的行动项]

### 短期优化（本周）
1. [1-2周内可以改进的事项]
2. [需要协调资源的改进项]

### 长期策略（本月）
1. [系统性改进建议]
2. [战略性发展方向建议]

## 💡 下一步建议
您可以考虑以下行动：
1. **[行动选择1]** - [具体说明和预期效果]
2. **[行动选择2]** - [具体说明和预期效果]
3. **[行动选择3]** - [具体说明和预期效果]
\`\`\`

---

## 🔧 执行优先级规划

### 查询执行顺序
1. **核心主查询**：优先执行用户直接询问的数据查询
2. **关键关联查询**：并行执行最重要的关联数据查询
3. **历史对比查询**：异步执行历史数据对比查询
4. **补充分析查询**：根据前序结果决定是否需要额外查询

### 性能优化策略
- **并行查询**：可并行执行的查询同时进行，提高效率
- **缓存利用**：利用已有数据缓存，减少重复查询
- **渐进返回**：先返回核心数据，再逐步补充分析结果
- **错误处理**：单个查询失败不影响整体响应生成

---

**💪 核心目标**：通过智能关联查询，为用户提供不仅仅是数据，更是基于数据的业务洞察、问题发现和行动指导。`

};

export default correlatedQueryPlanningTemplate;