# ç¡¬ç¼–ç æ•°æ®ä¿®å¤æ–¹æ¡ˆ

## ğŸ¯ ä¿®å¤ç›®æ ‡

å°†æ‰€æœ‰ä½¿ç”¨ç¡¬ç¼–ç æ•°æ®çš„ç»„ä»¶è½¬æ¢ä¸ºä½¿ç”¨çœŸå®APIè°ƒç”¨ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸ“‹ å…·ä½“ä¿®å¤æ¸…å•

### 1. éœ€è¦ä¿®å¤çš„ç»„ä»¶æ¨¡å¼

#### A. è¡¨æ ¼æ•°æ®ç»„ä»¶
**è¯†åˆ«æ¨¡å¼**ï¼š
```vue
<el-table :data="staticList">
```

**é—®é¢˜ç‰¹å¾**ï¼š
- `:data` ç»‘å®šåˆ°é™æ€æ•°ç»„
- ç¼ºå°‘ `v-loading` çŠ¶æ€
- æ²¡æœ‰é”™è¯¯å¤„ç†æœºåˆ¶
- æ•°æ®ç»“æ„ç¡¬ç¼–ç 

#### B. é€‰æ‹©å™¨é€‰é¡¹ç»„ä»¶
**è¯†åˆ«æ¨¡å¼**ï¼š
```vue
<el-select v-model="form.type">
  <el-option
    v-for="item in staticOptions"
    :key="item.value"
    :label="item.label"
    :value="item.value"
  />
</el-select>
```

**é—®é¢˜ç‰¹å¾**ï¼š
- é€‰é¡¹æ•°æ®ç¡¬ç¼–ç åœ¨ç»„ä»¶ä¸­
- ç¼ºå°‘åŠ¨æ€åŠ è½½èƒ½åŠ›
- æ— æ³•æ ¹æ®ç”¨æˆ·æƒé™æˆ–ä¸šåŠ¡çŠ¶æ€å˜åŒ–

#### C. å›¾è¡¨æ•°æ®ç»„ä»¶
**è¯†åˆ«æ¨¡å¼**ï¼š
```vue
<echarts :options="chartOptions" />
```

**é—®é¢˜ç‰¹å¾**ï¼š
- å›¾è¡¨æ•°æ®ç¡¬ç¼–ç 
- æ— æ³•åæ˜ çœŸå®ä¸šåŠ¡æ•°æ®
- ç¼ºå°‘å®æ—¶æ›´æ–°æœºåˆ¶

## ğŸ”§ æ ‡å‡†ä¿®å¤æ¨¡å¼

### 1. æ•°æ®è·å–Composable

åˆ›å»ºç»Ÿä¸€çš„æ•°æ®è·å–é€»è¾‘ï¼š

```typescript
// composables/useApiData.ts
import { ref, onMounted } from 'vue'
import { request } from '@/utils/request'
import { ElMessage } from 'element-plus'

interface ApiDataOptions<T> {
  endpoint: string
  immediate?: boolean
  transform?: (data: any) => T
  onError?: (error: Error) => void
}

export function useApiData<T = any>({
  endpoint,
  immediate = true,
  transform,
  onError
}: ApiDataOptions<T>) {
  const data = ref<T[]>([])
  const loading = ref(false)
  const error = ref('')

  const load = async () => {
    try {
      loading.value = true
      error.value = ''

      const response = await request.get(endpoint)

      if (response.success) {
        const items = response.data?.items || response.data || []
        data.value = transform ? items.map(transform) : items
      } else {
        throw new Error(response.message || 'æ•°æ®åŠ è½½å¤±è´¥')
      }
    } catch (err) {
      const errorMessage = err.message || 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•'
      error.value = errorMessage

      if (onError) {
        onError(err as Error)
      } else {
        ElMessage.error(errorMessage)
      }

      console.error('APIæ•°æ®åŠ è½½å¤±è´¥:', err)
    } finally {
      loading.value = false
    }
  }

  const refresh = () => load()

  if (immediate) {
    onMounted(() => load())
  }

  return {
    data,
    loading,
    error,
    load,
    refresh
  }
}
```

### 2. é€‰é¡¹æ•°æ®Composable

```typescript
// composables/useOptions.ts
import { ref, computed } from 'vue'
import { useApiData } from './useApiData'

interface Option {
  value: string | number
  label: string
  disabled?: boolean
  [key: string]: any
}

export function useOptions(endpoint: string, immediate = true) {
  const { data, loading, error, load, refresh } = useApiData<Option>({
    endpoint,
    immediate,
    transform: (item: any) => ({
      value: item.id || item.value,
      label: item.name || item.label,
      disabled: item.disabled || false,
      ...item
    })
  })

  const options = computed(() => [
    { value: '', label: 'å…¨éƒ¨', disabled: false },
    ...data.value
  ])

  return {
    options,
    loading,
    error,
    load,
    refresh
  }
}
```

## ğŸ“ å…·ä½“ä¿®å¤ç¤ºä¾‹

### 1. ä¿®å¤è¡¨æ ¼ç»„ä»¶

**ä¿®å¤å‰**ï¼š
```vue
<template>
  <div class="user-list">
    <el-table :data="userList">
      <el-table-column prop="name" label="å§“å" />
      <el-table-column prop="email" label="é‚®ç®±" />
      <el-table-column prop="role" label="è§’è‰²" />
    </el-table>
  </div>
</template>

<script setup>
import { ref } from 'vue'

const userList = ref([
  { id: 1, name: 'å¼ ä¸‰', email: 'zhangsan@example.com', role: 'ç®¡ç†å‘˜' },
  { id: 2, name: 'æå››', email: 'lisi@example.com', role: 'ç”¨æˆ·' },
  { id: 3, name: 'ç‹äº”', email: 'wangwu@example.com', role: 'ç¼–è¾‘' }
])
</script>
```

**ä¿®å¤å**ï¼š
```vue
<template>
  <div class="user-list">
    <!-- åŠ è½½çŠ¶æ€ -->
    <div v-if="loading" class="loading-container">
      <el-loading-component />
    </div>

    <!-- é”™è¯¯çŠ¶æ€ -->
    <div v-else-if="error" class="error-container">
      <el-alert type="error" :title="error" show-icon />
      <div class="error-actions">
        <el-button @click="refresh">é‡è¯•</el-button>
      </div>
    </div>

    <!-- ç©ºæ•°æ®çŠ¶æ€ -->
    <div v-else-if="!data.length" class="empty-container">
      <el-empty description="æš‚æ— ç”¨æˆ·æ•°æ®">
        <el-button type="primary" @click="refresh">åˆ·æ–°</el-button>
      </el-empty>
    </div>

    <!-- æ­£å¸¸æ•°æ® -->
    <el-table v-else :data="data" v-loading="loading">
      <el-table-column prop="name" label="å§“å" />
      <el-table-column prop="email" label="é‚®ç®±" />
      <el-table-column prop="role" label="è§’è‰²">
        <template #default="{ row }">
          <el-tag :type="getRoleType(row.role)">{{ row.role }}</el-tag>
        </template>
      </el-table-column>
      <el-table-column label="æ“ä½œ" width="150">
        <template #default="{ row }">
          <el-button size="small" @click="handleEdit(row)">ç¼–è¾‘</el-button>
          <el-button size="small" type="danger" @click="handleDelete(row)">åˆ é™¤</el-button>
        </template>
      </el-table-column>
    </el-table>
  </div>
</template>

<script setup>
import { useApiData } from '@/composables/useApiData'
import { ElMessage, ElMessageBox } from 'element-plus'

const { data, loading, error, refresh } = useApiData({
  endpoint: '/api/users',
  onError: (err) => {
    console.error('ç”¨æˆ·æ•°æ®åŠ è½½å¤±è´¥:', err)
  }
})

const getRoleType = (role: string) => {
  const roleTypes: Record<string, string> = {
    'ç®¡ç†å‘˜': 'danger',
    'ç¼–è¾‘': 'warning',
    'ç”¨æˆ·': 'info'
  }
  return roleTypes[role] || 'info'
}

const handleEdit = (user: any) => {
  // ç¼–è¾‘é€»è¾‘
}

const handleDelete = async (user: any) => {
  try {
    await ElMessageBox.confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· ${user.name} å—ï¼Ÿ`, 'ç¡®è®¤åˆ é™¤')

    // è°ƒç”¨åˆ é™¤API
    const response = await request.delete(`/api/users/${user.id}`)

    if (response.success) {
      ElMessage.success('åˆ é™¤æˆåŠŸ')
      refresh() // åˆ·æ–°æ•°æ®
    }
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('åˆ é™¤å¤±è´¥')
    }
  }
}
</script>

<style scoped>
.loading-container,
.error-container,
.empty-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 200px;
}

.error-actions {
  margin-top: 16px;
  text-align: center;
}
</style>
```

### 2. ä¿®å¤é€‰æ‹©å™¨ç»„ä»¶

**ä¿®å¤å‰**ï¼š
```vue
<template>
  <el-form-item label="è§’è‰²">
    <el-select v-model="form.role" placeholder="è¯·é€‰æ‹©è§’è‰²">
      <el-option label="ç®¡ç†å‘˜" value="admin" />
      <el-option label="ç¼–è¾‘" value="editor" />
      <el-option label="ç”¨æˆ·" value="user" />
    </el-select>
  </el-form-item>
</template>
```

**ä¿®å¤å**ï¼š
```vue
<template>
  <el-form-item label="è§’è‰²">
    <el-select
      v-model="form.role"
      placeholder="è¯·é€‰æ‹©è§’è‰²"
      v-loading="loading"
      :disabled="loading"
    >
      <el-option
        v-for="option in options"
        :key="option.value"
        :label="option.label"
        :value="option.value"
        :disabled="option.disabled"
      />
    </el-select>
    <div v-if="error" class="error-text">
      {{ error }}
    </div>
  </el-form-item>
</template>

<script setup>
import { useOptions } from '@/composables/useOptions'

const props = defineProps<{
  modelValue: string
}>()

const emit = defineEmits<{
  'update:modelValue': [value: string]
}>()

const form = computed({
  get: () => props.modelValue,
  set: (value) => emit('update:modelValue', value)
})

const { options, loading, error } = useOptions('/api/roles')
</script>

<style scoped>
.error-text {
  color: var(--el-color-danger);
  font-size: 12px;
  margin-top: 4px;
}
</style>
```

### 3. ä¿®å¤ä»ªè¡¨æ¿ç»„ä»¶

**ä¿®å¤å‰**ï¼š
```vue
<template>
  <div class="dashboard-stats">
    <div class="stat-card">
      <div class="stat-value">150</div>
      <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
    </div>
    <div class="stat-card">
      <div class="stat-value">25</div>
      <div class="stat-label">æ´»è·ƒç”¨æˆ·</div>
    </div>
  </div>
</template>
```

**ä¿®å¤å**ï¼š
```vue
<template>
  <div class="dashboard-stats">
    <div v-if="loading" class="loading-stats">
      <el-skeleton :rows="4" animated />
    </div>
    <div v-else-if="error" class="error-stats">
      <el-alert type="error" :title="error" show-icon />
    </div>
    <div v-else class="stats-grid">
      <div
        v-for="stat in stats"
        :key="stat.key"
        class="stat-card"
        :class="stat.type"
      >
        <div class="stat-value">{{ formatValue(stat.value) }}</div>
        <div class="stat-label">{{ stat.label }}</div>
        <div v-if="stat.trend" class="stat-trend" :class="stat.trend.type">
          <el-icon>
            <component :is="getTrendIcon(stat.trend.type)" />
          </el-icon>
          {{ stat.trend.value }}
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useApiData } from '@/composables/useApiData'
import { TrendCharts, ArrowUp, ArrowDown } from '@element-plus/icons-vue'

const { data: statsData, loading, error, refresh } = useApiData({
  endpoint: '/api/dashboard/stats',
  transform: (item: any) => ({
    key: item.key,
    label: item.label,
    value: item.value,
    type: item.type || 'primary',
    trend: item.trend,
    format: item.format || 'number'
  })
})

const stats = computed(() => statsData.value || [])

const formatValue = (value: any, format?: string) => {
  if (format === 'percentage') {
    return `${(value * 100).toFixed(1)}%`
  }
  if (format === 'currency') {
    return `Â¥${value.toLocaleString()}`
  }
  return value.toLocaleString()
}

const getTrendIcon = (type: string) => {
  return type === 'up' ? ArrowUp : ArrowDown
}

// å®šæœŸåˆ·æ–°æ•°æ®ï¼ˆå¯é€‰ï¼‰
const refreshInterval = setInterval(refresh, 60000) // æ¯åˆ†é’Ÿåˆ·æ–°

onUnmounted(() => {
  clearInterval(refreshInterval)
})
</script>

<style scoped>
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
}

.stat-card {
  padding: 20px;
  border-radius: 8px;
  background: white;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.stat-card.primary {
  border-left: 4px solid var(--el-color-primary);
}

.stat-card.success {
  border-left: 4px solid var(--el-color-success);
}

.stat-card.warning {
  border-left: 4px solid var(--el-color-warning);
}

.stat-card.danger {
  border-left: 4px solid var(--el-color-danger);
}

.stat-value {
  font-size: 24px;
  font-weight: bold;
  margin-bottom: 8px;
}

.stat-label {
  color: var(--el-text-color-secondary);
  margin-bottom: 8px;
}

.stat-trend {
  font-size: 12px;
  display: flex;
  align-items: center;
  gap: 4px;
}

.stat-trend.up {
  color: var(--el-color-success);
}

.stat-trend.down {
  color: var(--el-color-danger);
}

.loading-stats,
.error-stats {
  padding: 20px;
}
</style>
```

## ğŸš€ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåˆ›å»ºåŸºç¡€Composables
1. å®ç° `useApiData`
2. å®ç° `useOptions`
3. åˆ›å»ºé”™è¯¯å¤„ç†å·¥å…·
4. æ·»åŠ åŠ è½½çŠ¶æ€ç»„ä»¶

### ç¬¬äºŒé˜¶æ®µï¼šä¿®å¤æ ¸å¿ƒç»„ä»¶
1. ä¿®å¤ç”¨æˆ·ç®¡ç†ç›¸å…³ç»„ä»¶
2. ä¿®å¤ä»ªè¡¨æ¿ç»Ÿè®¡ç»„ä»¶
3. ä¿®å¤æ•°æ®è¡¨æ ¼ç»„ä»¶
4. æ·»åŠ ç›¸åº”çš„APIç«¯ç‚¹

### ç¬¬ä¸‰é˜¶æ®µï¼šå…¨é¢æ’æŸ¥
1. æ‰«ææ‰€æœ‰Vueæ–‡ä»¶
2. ä¿®å¤ç¡¬ç¼–ç é€‰é¡¹æ•°æ®
3. ä¼˜åŒ–é”™è¯¯å¤„ç†
4. æ·»åŠ æµ‹è¯•ç”¨ä¾‹

### ç¬¬å››é˜¶æ®µï¼šæµ‹è¯•éªŒè¯
1. å•å…ƒæµ‹è¯•
2. é›†æˆæµ‹è¯•
3. çœŸå®APIæµ‹è¯•
4. æ€§èƒ½æµ‹è¯•

## ğŸ“Š éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½è¦æ±‚
- âœ… æ‰€æœ‰æ•°æ®æ¥æºäºçœŸå®API
- âœ… å®Œæ•´çš„åŠ è½½çŠ¶æ€æ˜¾ç¤º
- âœ… å‹å¥½çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- âœ… ç©ºæ•°æ®çŠ¶æ€çš„ä¼˜é›…æ˜¾ç¤º

### æ€§èƒ½è¦æ±‚
- âœ… APIå“åº”æ—¶é—´ < 2ç§’
- âœ… ç»„ä»¶æ¸²æŸ“æ—¶é—´ < 500ms
- âœ… å†…å­˜ä½¿ç”¨ç¨³å®šï¼Œæ— æ³„æ¼

### æµ‹è¯•è¦æ±‚
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90%
- âœ… é›†æˆæµ‹è¯•è¦†ç›–ä¸»è¦åœºæ™¯
- âœ… çœŸå®APIæµ‹è¯•é€šè¿‡
- âœ… é”™è¯¯åœºæ™¯æµ‹è¯•è¦†ç›–

## ğŸ¯ é¢„æœŸæ”¶ç›Š

1. **æå‡ç”¨æˆ·ä½“éªŒ**ï¼šæ•°æ®æ›´å‡†ç¡®ï¼Œé”™è¯¯å¤„ç†æ›´å‹å¥½
2. **å¢å¼ºå¯ç»´æŠ¤æ€§**ï¼šç»Ÿä¸€çš„æ•°æ®è·å–æ¨¡å¼ï¼Œä¾¿äºç»´æŠ¤
3. **æé«˜æµ‹è¯•è´¨é‡**ï¼šçœŸå®APIæµ‹è¯•ï¼Œæ›´æ¥è¿‘ç”Ÿäº§ç¯å¢ƒ
4. **é™ä½é£é™©**ï¼šé¿å…ç¡¬ç¼–ç æ•°æ®å¯¼è‡´çš„ç”Ÿäº§ç¯å¢ƒé—®é¢˜

é€šè¿‡ç³»ç»Ÿæ€§åœ°ä¿®å¤ç¡¬ç¼–ç æ•°æ®é—®é¢˜ï¼Œæˆ‘ä»¬å°†æ˜¾è‘—æå‡åº”ç”¨çš„ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒã€‚