# åŠ¨æ€å¯¼å…¥å…¨é¢æ£€æŸ¥æŠ¥å‘Š

## æ£€æŸ¥æ—¶é—´
2025å¹´1æœˆ

## æ£€æŸ¥èŒƒå›´
- `server/src/controllers` - æ§åˆ¶å™¨æ–‡ä»¶
- `server/src/routes` - è·¯ç”±æ–‡ä»¶
- `server/src/services` - æœåŠ¡æ–‡ä»¶

## æ£€æŸ¥ç»“æœ

### âœ… æ§åˆ¶å™¨æ–‡ä»¶ï¼ˆå·²ä¿®å¤ï¼‰
- `personnel-center.controller.ts` - âœ… å·²ä¿®å¤
- `poster-template.controller.ts` - âœ… å·²ä¿®å¤
- `inspection-ai.controller.ts` - âœ… å·²ä¿®å¤
- `auth-permissions.controller.ts` - âœ… å·²ä¿®å¤
- `ai-assistant-optimized.controller.ts` - âœ… å·²ä¿®å¤

### âš ï¸ æ§åˆ¶å™¨æ–‡ä»¶ä¸­ä»ä½¿ç”¨ require() çš„æ–‡ä»¶

#### 1. teacher-dashboard.controller.ts
**é—®é¢˜ï¼š** å¤§é‡ä½¿ç”¨ `require()` åŠ¨æ€å¯¼å…¥æ¨¡å‹
- ç¬¬32è¡Œï¼š`const { Teacher } = require('../models')`
- ç¬¬81è¡Œï¼š`const { Teacher } = require('../models')`
- ç¬¬126è¡Œï¼š`const { Teacher } = require('../models')`
- ç¬¬139è¡Œï¼š`const { sequelize } = require('../init')`
- ç¬¬140è¡Œï¼š`const { QueryTypes } = require('sequelize')`
- ... è¿˜æœ‰æ›´å¤šå¤„

**å»ºè®®ï¼š** æ”¹ä¸ºé™æ€å¯¼å…¥

#### 2. å…¶ä»–æ§åˆ¶å™¨æ–‡ä»¶
- `ai-assistant-optimized.controller.ts` - ç¬¬922è¡Œï¼š`const axios = require('axios')`
- `ai.controller.ts` - ç¬¬494è¡Œï¼š`const conversationId = require('uuid').v4()`
- `role-permission.controller.ts` - ç¬¬6è¡Œï¼š`const Joi = require('joi')`
- `user-role.controller.ts` - ç¬¬6è¡Œï¼š`const Joi = require('joi')`
- `advertisement.controller.ts` - ç¬¬7è¡Œï¼š`const Joi = require('joi')`
- `teacher.controller.ts` - ç¬¬66è¡Œï¼š`const password = await require('bcrypt').hash(...)`
- `errors.controller.ts` - ç¬¬117ã€121è¡Œï¼š`require('sequelize').Op`

### âš ï¸ è·¯ç”±æ–‡ä»¶ä¸­çš„åŠ¨æ€å¯¼å…¥

#### 1. poster-templates.routes.ts
**é—®é¢˜ï¼š** æœ‰3å¤„åŠ¨æ€å¯¼å…¥ `PosterCategory`
- ç¬¬118è¡Œï¼š`const { PosterCategory } = await import('../models/poster-category.model')`
- ç¬¬148è¡Œï¼š`const { PosterCategory } = await import('../models/poster-category.model')`
- ç¬¬178è¡Œï¼š`const { PosterCategory } = await import('../models/poster-category.model')`

**å»ºè®®ï¼š** æ”¹ä¸ºé™æ€å¯¼å…¥ï¼ˆä¸æ§åˆ¶å™¨ä¿®å¤æ–¹å¼ç›¸åŒï¼‰

#### 2. ai-assistant-optimized.routes.ts
**é—®é¢˜ï¼š** æœ‰3å¤„åŠ¨æ€å¯¼å…¥æœåŠ¡
- ç¬¬319è¡Œï¼š`const { directResponseService } = await import('../services/ai/direct-response.service')`
- ç¬¬375è¡Œï¼š`const { queryRouterService } = await import('../services/ai/query-router.service')`
- ç¬¬412è¡Œï¼š`const { queryRouterService } = await import('../services/ai/query-router.service')`

**å»ºè®®ï¼š** æ”¹ä¸ºé™æ€å¯¼å…¥

#### 3. routes/ai/unified-intelligence.routes.ts
**é—®é¢˜ï¼š** æœ‰å¤§é‡åŠ¨æ€å¯¼å…¥ï¼ˆ20+å¤„ï¼‰
- åŒ…æ‹¬ `textModelService`, `MessageRole`, `UnifiedIntelligenceService`, `ModelType`, `MessageService`, `aiBridgeService` ç­‰

**å»ºè®®ï¼š** è¯„ä¼°æ˜¯å¦æœ‰å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œå¦‚æ— åˆ™æ”¹ä¸ºé™æ€å¯¼å…¥

#### 4. å…¶ä»–è·¯ç”±æ–‡ä»¶
- `routes/ai.ts` - 2å¤„åŠ¨æ€å¯¼å…¥ `AutoImageGenerationService`
- `routes/index.ts` - 2å¤„åŠ¨æ€å¯¼å…¥ `init-system-settings`
- `routes/ai/smart-expert.routes.ts` - 1å¤„åŠ¨æ€å¯¼å…¥ `aiBridgeService`
- `routes/ai/function-tools.routes.ts` - 3å¤„åŠ¨æ€å¯¼å…¥
- `routes/ai/video.routes.ts` - 1å¤„åŠ¨æ€å¯¼å…¥ `AIModelConfig`
- `routes/ai/message.routes.ts` - 1å¤„åŠ¨æ€å¯¼å…¥ `MessageService`

### ğŸ“Š æœåŠ¡æ–‡ä»¶ä¸­çš„åŠ¨æ€å¯¼å…¥

æœåŠ¡æ–‡ä»¶ä¸­æœ‰å¤§é‡åŠ¨æ€å¯¼å…¥ï¼ˆ100+å¤„ï¼‰ï¼Œä¸»è¦é›†ä¸­åœ¨ï¼š
- `services/ai-operator/unified-intelligence.service.ts` - 14å¤„
- `services/ai/bridge/ai-bridge.service.ts` - 11å¤„
- `services/ai/direct-response.service.ts` - 11å¤„
- `services/ai/text-model.service.ts` - 2å¤„
- `services/ai/tool-calling.service.ts` - 2å¤„
- ... ä»¥åŠå…¶ä»–AIç›¸å…³æœåŠ¡

**è¯„ä¼°ï¼š** æœåŠ¡æ–‡ä»¶ä¸­çš„åŠ¨æ€å¯¼å…¥å¯èƒ½æ˜¯ä¸ºäº†é¿å…å¾ªç¯ä¾èµ–ï¼Œéœ€è¦é€ä¸ªè¯„ä¼°ã€‚

## ä¼˜å…ˆçº§å»ºè®®

### ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆåº”è¯¥ç«‹å³ä¿®å¤ï¼‰

1. **teacher-dashboard.controller.ts**
   - åŸå› ï¼šå¤§é‡ä½¿ç”¨ `require()` åŠ¨æ€å¯¼å…¥ï¼Œå½±å“æ€§èƒ½
   - å½±å“ï¼šé¢‘ç¹è°ƒç”¨çš„æ§åˆ¶å™¨
   - é£é™©ï¼šä½ï¼ˆæ”¹ä¸ºé™æ€å¯¼å…¥ï¼‰

2. **poster-templates.routes.ts**
   - åŸå› ï¼šä¸å·²ä¿®å¤çš„æ§åˆ¶å™¨é€»è¾‘ä¸€è‡´ï¼Œåº”è¯¥ç»Ÿä¸€
   - å½±å“ï¼šæµ·æŠ¥æ¨¡æ¿ç›¸å…³è·¯ç”±
   - é£é™©ï¼šä½ï¼ˆä¸æ§åˆ¶å™¨ä¿®å¤æ–¹å¼ç›¸åŒï¼‰

3. **ai-assistant-optimized.routes.ts**
   - åŸå› ï¼šä¸å·²ä¿®å¤çš„æ§åˆ¶å™¨é€»è¾‘ä¸€è‡´
   - å½±å“ï¼šAIåŠ©æ‰‹ä¼˜åŒ–è·¯ç”±
   - é£é™©ï¼šä½ï¼ˆæœåŠ¡å·²åœ¨æ§åˆ¶å™¨ä¸­é™æ€å¯¼å…¥ï¼‰

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆéœ€è¦è¯„ä¼°ï¼‰

4. **å…¶ä»–æ§åˆ¶å™¨æ–‡ä»¶ä¸­çš„ require()**
   - åŸå› ï¼šä½¿ç”¨ `require()` è€Œé `import`ï¼Œä½†å¯èƒ½æ˜¯æœ‰æ„ä¸ºä¹‹
   - å½±å“ï¼šç›¸å…³æ§åˆ¶å™¨
   - é£é™©ï¼šä¸­ï¼ˆéœ€è¦ç¡®è®¤æ˜¯å¦ä¸ºæœ‰æ„è®¾è®¡ï¼‰

5. **routes/ai/unified-intelligence.routes.ts**
   - åŸå› ï¼šå¤§é‡åŠ¨æ€å¯¼å…¥ï¼Œéœ€è¦æ£€æŸ¥å¾ªç¯ä¾èµ–
   - å½±å“ï¼šç»Ÿä¸€æ™ºèƒ½è·¯ç”±
   - é£é™©ï¼šä¸­ï¼ˆå¯èƒ½æœ‰å¾ªç¯ä¾èµ–ï¼‰

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆéœ€è¦è¯¦ç»†è¯„ä¼°ï¼‰

6. **æœåŠ¡æ–‡ä»¶ä¸­çš„åŠ¨æ€å¯¼å…¥**
   - åŸå› ï¼šå¯èƒ½æ˜¯æœ‰æ„é¿å…å¾ªç¯ä¾èµ–
   - å½±å“ï¼šæœåŠ¡å±‚æ€§èƒ½
   - é£é™©ï¼šé«˜ï¼ˆéœ€è¦é€ä¸ªè¯„ä¼°ï¼Œé¿å…ç ´åç°æœ‰æ¶æ„ï¼‰

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… ä¿®å¤ `teacher-dashboard.controller.ts`
2. âœ… ä¿®å¤ `poster-templates.routes.ts`
3. âœ… ä¿®å¤ `ai-assistant-optimized.routes.ts`
4. âš ï¸ è¯„ä¼°å¹¶ä¿®å¤å…¶ä»–æ§åˆ¶å™¨æ–‡ä»¶ä¸­çš„ `require()`
5. âš ï¸ è¯„ä¼° `routes/ai/unified-intelligence.routes.ts` çš„å¾ªç¯ä¾èµ–






