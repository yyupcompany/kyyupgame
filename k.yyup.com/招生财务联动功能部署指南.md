# æ‹›ç”Ÿè´¢åŠ¡è”åŠ¨åŠŸèƒ½éƒ¨ç½²æŒ‡å—

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

æœ¬æ¬¡å¼€å‘å®Œæˆäº†æ‹›ç”Ÿè´¢åŠ¡è”åŠ¨åŠŸèƒ½çš„æ ¸å¿ƒAPIï¼ŒåŒ…æ‹¬ï¼š

### âœ… å·²å®Œæˆçš„åŠŸèƒ½
1. **æ”¶æ¬¾ç¡®è®¤åŠŸèƒ½** - å›­é•¿è§’è‰²ç¡®è®¤æ”¶æ¬¾
2. **å‘é€ç¼´è´¹æé†’åŠŸèƒ½** - å‘é€é€šçŸ¥ç»™ç­çº§è€å¸ˆ  
3. **æ‹›ç”Ÿæµç¨‹æŸ¥çœ‹åŠŸèƒ½** - å…³è”ç¼´è´¹ä¿¡æ¯çš„æµç¨‹è¯¦æƒ…
4. **è´¹ç”¨å¥—é¤æ¨¡æ¿ç®¡ç†** - æ¨¡æ¿æ•°æ®å’ŒAPI
5. **æ‰¹é‡ç”Ÿæˆç¼´è´¹å•åŠŸèƒ½** - æ‰¹é‡å¤„ç†ç¼´è´¹å•
6. **ç»Ÿè®¡æ•°æ®è·å–** - è´¢åŠ¡ç»Ÿè®¡ä¿¡æ¯
7. **é…ç½®ç®¡ç†** - æ‹›ç”Ÿè´¢åŠ¡é…ç½®

### ğŸ“ æ–°å¢æ–‡ä»¶
- `server/src/routes/enrollment-finance.routes.ts` - æ‹›ç”Ÿè´¢åŠ¡è”åŠ¨è·¯ç”±
- `server/src/controllers/enrollment-finance.controller.ts` - æ§åˆ¶å™¨å®ç°
- `server/src/migrations/20250621000000-add-enrollment-finance-fields.js` - æ•°æ®åº“è¿ç§»
- `server/src/seeders/20250621000000-fee-package-templates.js` - ç§å­æ•°æ®

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. é‡å¯åç«¯æœåŠ¡å™¨
```bash
# è¿›å…¥serverç›®å½•
cd server

# åœæ­¢å½“å‰æœåŠ¡å™¨
npm run stop  # æˆ–è€… Ctrl+C

# é‡æ–°å¯åŠ¨æœåŠ¡å™¨
npm run dev
```

### 2. è¿è¡Œæ•°æ®åº“è¿ç§»
```bash
# åœ¨serverç›®å½•ä¸‹æ‰§è¡Œ
node -r ts-node/register src/migrations/20250621000000-add-enrollment-finance-fields.js

# æˆ–è€…ä½¿ç”¨è¿ç§»å‘½ä»¤ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
npm run db:migrate
```

### 3. æ’å…¥ç§å­æ•°æ®
```bash
# æ’å…¥è´¹ç”¨å¥—é¤æ¨¡æ¿æ•°æ®
node -r ts-node/register src/seeders/20250621000000-fee-package-templates.js

# æˆ–è€…ä½¿ç”¨ç§å­å‘½ä»¤
npm run db:seed
```

### 4. éªŒè¯APIç«¯ç‚¹
è®¿é—®ä»¥ä¸‹URLéªŒè¯APIæ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```
# æµ‹è¯•ç«¯ç‚¹ï¼ˆä¸éœ€è¦è®¤è¯ï¼‰
GET http://localhost:3000/api/enrollment-finance/test

# éœ€è¦è®¤è¯çš„ç«¯ç‚¹
GET http://localhost:3000/api/enrollment-finance/statistics
GET http://localhost:3000/api/enrollment-finance/fee-templates
GET http://localhost:3000/api/enrollment-finance/linkages
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

### å‰ç«¯æµ‹è¯•
1. æ‰“å¼€æ‹›ç”Ÿè´¢åŠ¡è”åŠ¨é¡µé¢
2. æµ‹è¯•æ‰€æœ‰æŒ‰é’®åŠŸèƒ½ï¼š
   - âœ… åˆ·æ–°æŒ‰é’®
   - âœ… ç¡®è®¤æ”¶æ¬¾æŒ‰é’®
   - âœ… å‘é€æé†’æŒ‰é’®
   - âœ… æŸ¥çœ‹æµç¨‹æŒ‰é’®
   - âœ… æœç´¢åŠŸèƒ½

### APIæµ‹è¯•
è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š
```bash
node test-enrollment-finance-api.js
```

## ğŸ“Š APIç«¯ç‚¹è¯´æ˜

### åŸºç¡€æ•°æ®è·å–
- `GET /api/enrollment-finance/statistics` - è·å–ç»Ÿè®¡æ•°æ®
- `GET /api/enrollment-finance/linkages` - è·å–æ‹›ç”Ÿè´¢åŠ¡å…³è”åˆ—è¡¨
- `GET /api/enrollment-finance/fee-templates` - è·å–è´¹ç”¨å¥—é¤æ¨¡æ¿

### æ ¸å¿ƒåŠŸèƒ½
- `POST /api/enrollment-finance/confirm-payment` - ç¡®è®¤æ”¶æ¬¾ï¼ˆå›­é•¿æƒé™ï¼‰
- `POST /api/enrollment-finance/send-payment-reminder` - å‘é€ç¼´è´¹æé†’
- `GET /api/enrollment-finance/process/:id` - è·å–æ‹›ç”Ÿæµç¨‹è¯¦æƒ…

### é«˜çº§åŠŸèƒ½
- `POST /api/enrollment-finance/generate-bill` - ç”Ÿæˆç¼´è´¹å•
- `POST /api/enrollment-finance/batch-generate-bills` - æ‰¹é‡ç”Ÿæˆç¼´è´¹å•
- `GET /api/enrollment-finance/config` - è·å–é…ç½®

## ğŸ—„ï¸ æ•°æ®åº“è¡¨ç»“æ„

### æ–°å¢è¡¨
1. **fee_package_templates** - è´¹ç”¨å¥—é¤æ¨¡æ¿è¡¨
2. **payment_bills** - ç¼´è´¹å•è¡¨
3. **payment_confirmations** - æ”¶æ¬¾ç¡®è®¤è®°å½•è¡¨

### ä¿®æ”¹è¡¨
1. **enrollment_applications** - æ·»åŠ ç¼´è´¹ç›¸å…³å­—æ®µï¼š
   - `payment_status` - ç¼´è´¹çŠ¶æ€
   - `payment_amount` - ç¼´è´¹é‡‘é¢
   - `payment_date` - ç¼´è´¹æ—¥æœŸ
   - `payment_method` - ç¼´è´¹æ–¹å¼
   - `payment_confirmed_by` - æ”¶æ¬¾ç¡®è®¤äºº

## ğŸ”§ æƒé™é…ç½®

ç¡®ä¿ä»¥ä¸‹æƒé™å·²é…ç½®ï¼š
- `FINANCE_ENROLLMENT_LINKAGE_VIEW` - æŸ¥çœ‹æ‹›ç”Ÿè´¢åŠ¡è”åŠ¨
- å›­é•¿è§’è‰² (`principal`) - ç¡®è®¤æ”¶æ¬¾æƒé™
- ç®¡ç†å‘˜è§’è‰² (`admin`) - æ‰€æœ‰æƒé™

## ğŸ¯ å‰ç«¯é›†æˆ

å‰ç«¯APIè°ƒç”¨å·²ç»å®ç°ï¼Œè·¯å¾„ä»ï¼š
```javascript
// æ—§è·¯å¾„ï¼ˆ404é”™è¯¯ï¼‰
/enrollment-finance/linkages

// æ–°è·¯å¾„ï¼ˆæ­£å¸¸å·¥ä½œï¼‰
/api/enrollment-finance/linkages
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æœåŠ¡å™¨é‡å¯å¿…éœ€** - æ–°è·¯ç”±éœ€è¦é‡å¯æœåŠ¡å™¨æ‰èƒ½ç”Ÿæ•ˆ
2. **æ•°æ®åº“è¿ç§»** - å¿…é¡»è¿è¡Œè¿ç§»åˆ›å»ºæ–°è¡¨ç»“æ„
3. **æƒé™æ£€æŸ¥** - ç¡®ä¿ç”¨æˆ·æœ‰ç›¸åº”çš„æƒé™è®¿é—®API
4. **é”™è¯¯å¤„ç†** - APIåŒ…å«å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## ğŸ” æ•…éšœæ’é™¤

### 404é”™è¯¯
- æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦é‡å¯
- ç¡®è®¤è·¯ç”±æ–‡ä»¶å·²æ­£ç¡®å¯¼å…¥åˆ°ä¸»è·¯ç”±

### 401é”™è¯¯
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
- ç¡®è®¤ç”¨æˆ·æœ‰ç›¸åº”æƒé™

### 500é”™è¯¯
- æ£€æŸ¥æ•°æ®åº“è¿æ¥
- ç¡®è®¤è¡¨ç»“æ„å·²åˆ›å»º
- æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

## ğŸ“ˆ åç»­ä¼˜åŒ–å»ºè®®

1. **å®æ—¶é€šçŸ¥** - é›†æˆWebSocketå®ç°å®æ—¶ç¼´è´¹æé†’
2. **æ”¯ä»˜é›†æˆ** - é›†æˆç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°
3. **æŠ¥è¡¨åŠŸèƒ½** - å¢åŠ è¯¦ç»†çš„è´¢åŠ¡æŠ¥è¡¨
4. **è‡ªåŠ¨åŒ–æµç¨‹** - å®ç°è‡ªåŠ¨åŒ–çš„ç¼´è´¹æµç¨‹ç®¡ç†

## ğŸ‰ å®ŒæˆçŠ¶æ€

- âœ… åç«¯APIå¼€å‘å®Œæˆ
- âœ… æ•°æ®åº“ç»“æ„è®¾è®¡å®Œæˆ
- âœ… è·¯ç”±é…ç½®å®Œæˆ
- âœ… æ§åˆ¶å™¨é€»è¾‘å®ç°å®Œæˆ
- â³ ç­‰å¾…æœåŠ¡å™¨é‡å¯å’Œæ•°æ®åº“è¿ç§»
- â³ ç­‰å¾…å‰ç«¯é›†æˆæµ‹è¯•
