# 暗黑模式卡片边框硬编码问题修复建议

## 问题总结

测试结果显示，所有4个统计卡片在暗黑模式下都使用了硬编码的边框颜色 `rgba(99, 102, 241, 0.12)`，而没有正确切换到暗黑模式的边框颜色变量。

## 根本原因分析

1. **变量定义问题**：在设计令牌文件中，`--border-color-light` 被直接硬编码为 `rgba(99, 102, 241, 0.12)`。

2. **主题切换逻辑不完整**：虽然代码中包含了暗黑模式下切换边框颜色的逻辑，但实际效果并不完整：
   ```scss
   /* 设计令牌中定义的主题切换 */
   .dark {
     --border-color: var(--border-color-dark);
     --el-border-color: var(--el-border-color-dark);
   }
   ```

3. **可能的样式优先级问题**：某些样式可能覆盖了主题切换后的边框颜色变量。

## 修复方案

### 1. 优化测试脚本确保主题完整切换

修改测试脚本，确保暗黑模式被正确激活：

```javascript
await page.evaluate(() => {
  // 确保所有主题类都被正确应用
  document.documentElement.classList.add('dark');
  document.body.classList.add('dark');
  // 移除可能冲突的类
  document.documentElement.classList.remove('light');
  document.body.classList.remove('light');
  // 更新本地存储
  localStorage.setItem('theme', 'dark');
  // 检查并输出当前主题变量
  console.log('当前border-color:', getComputedStyle(document.documentElement).getPropertyValue('--border-color'));
  console.log('当前border-color-dark:', getComputedStyle(document.documentElement).getPropertyValue('--border-color-dark'));
  console.log('当前dark类是否存在:', document.documentElement.classList.contains('dark'));
});
```

### 2. 检查并修复样式优先级

确保 `.dark` 类中的样式能够正确覆盖基础样式。可以通过在暗黑模式类中添加 `!important` 来测试：

```scss
.dark {
  --border-color: var(--border-color-dark) !important;
  --el-border-color: var(--el-border-color-dark) !important;
}
```

### 3. 优化变量定义和使用

将所有边框颜色变量基于基础变量动态生成，避免硬编码：

```scss
/* 基础边框样式 */
:root {
  --border-width: 1px;
  --border-style: solid;

  /* 浅色主题边框颜色 */
  --border-color-base: #6366f1; /* 主色调 */
  --border-color-light: rgba(var(--border-color-base), 0.12);

  /* 暗黑主题边框颜色 */
  --border-color-dark: rgba(255, 255, 255, 0.08);
  --border-color-darker: rgba(255, 255, 255, 0.12);

  /* 默认主题 */
  --border-color: var(--border-color-light);
}

/* 暗黑模式应用 */
.dark {
  --border-color: var(--border-color-dark);
}
```

### 4. 检查组件样式是否有硬编码

确保所有卡片组件都使用统一的变量：

```scss
.stat-card {
  // 确保使用变量而不是硬编码
  border: var(--border-width) var(--border-style) var(--border-color);
}
```

## 验证修复效果

修复完成后，重新运行测试脚本检查：

```bash
node check-dark-theme-borders.cjs
```

确保所有卡片的边框颜色在暗黑模式下都切换为 `rgba(255, 255, 255, 0.08)` 或其他符合暗黑模式设计的颜色。

## 长期优化建议

1. **建立完整的主题测试体系**：确保所有组件在不同主题模式下都能正确渲染。

2. **使用CSS变量的继承机制**：避免在每个组件中重复定义样式，提高样式的一致性和可维护性。

3. **定期审计样式变量**：确保所有颜色都通过变量定义，避免硬编码。

4. **建立设计系统文档**：明确各种主题模式下的样式规范和变量使用方式。
