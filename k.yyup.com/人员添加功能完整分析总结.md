# ğŸ“Š äººå‘˜æ·»åŠ åŠŸèƒ½å®Œæ•´åˆ†ææ€»ç»“

**åˆ†ææ—¥æœŸ**: 2025-10-28  
**åˆ†æèŒƒå›´**: äººå‘˜ä¸­å¿ƒæ·»åŠ äººå‘˜çš„å®Œæ•´æµç¨‹  
**æ€»ä½“è¯„ä¼°**: âš ï¸ **éƒ¨åˆ†å®ç°ï¼Œéœ€è¦å®Œå–„**

---

## ğŸ¯ æ ¸å¿ƒé—®é¢˜

### ç”¨æˆ·çš„é—®é¢˜
> "åœ¨äººå‘˜è¿™é‡Œæ·»åŠ çš„æ—¶å€™ï¼Œæ˜¯åªç”Ÿæˆäº†ä¸€ä¸ªè®°å½•ï¼Œè¿˜æ˜¯ç”Ÿæˆäº†ä¸€ä¸ªç”¨æˆ·idå’Œè§’è‰²å’Œé›†å›¢idå’Œåˆ†å›­idå’Œè®°å½•å‘¢ï¼Ÿ"

### ç­”æ¡ˆ
**åªç”Ÿæˆäº†éƒ¨åˆ†è®°å½•**ï¼š

| é¡¹ç›® | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| User è®°å½• | âœ… | å·²ç”Ÿæˆ |
| Teacher è®°å½• | âœ… | å·²ç”Ÿæˆ |
| user_roles å…³è” | âŒ | **ç¼ºå¤±** |
| group_id ç»‘å®š | âŒ | **ç¼ºå¤±** |
| è§’è‰²ç»‘å®š | âŒ | **ç¼ºå¤±** |

---

## ğŸ“‹ å½“å‰çš„æ·»åŠ æ•™å¸ˆæµç¨‹

### ä»£ç ä½ç½®
`server/src/routes/teachers.routes.ts` (ç¬¬53-104è¡Œ)

### å½“å‰ç”Ÿæˆçš„è®°å½•

**1. User è¡¨** âœ…
```
id: 123
username: 13800138000 (æ‰‹æœºå·)
password: åŠ å¯†å¯†ç 
realName: å¼ ä¸‰
phone: 13800138000
email: zhangsan@example.com
role: teacher
status: active
```

**2. Teacher è¡¨** âœ…
```
id: 456
userId: 123
kindergartenId: 1
teacherNo: T001
position: 5 (æ™®é€šæ•™å¸ˆ)
hireDate: 2025-10-28
education: 3 (æœ¬ç§‘)
major: å­¦å‰æ•™è‚²
creatorId: 121
status: 1 (åœ¨èŒ)
```

**3. user_roles è¡¨** âŒ **ç¼ºå¤±**
```
åº”è¯¥ç”Ÿæˆï¼š
user_id: 123
role_id: 3 (æ•™å¸ˆè§’è‰²)
```

**4. group_id** âŒ **ç¼ºå¤±**
```
åº”è¯¥åœ¨ Teacher è¡¨ä¸­æ·»åŠ ï¼š
group_id: 1 (é›†å›¢ID)
```

---

## âŒ ç¼ºå¤±çš„åŠŸèƒ½

### é—®é¢˜1ï¼šæ²¡æœ‰åˆ›å»º user_roles å…³è”

**å½±å“**ï¼š
- ç”¨æˆ·æ²¡æœ‰æ˜ç¡®çš„è§’è‰²æƒé™
- æƒé™ç³»ç»Ÿæ— æ³•æ­£å¸¸å·¥ä½œ
- æ— æ³•é€šè¿‡ user_roles è¡¨æŸ¥è¯¢ç”¨æˆ·çš„è§’è‰²

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// åœ¨åˆ›å»º User åï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç 
await sequelize.query(
  `INSERT INTO user_roles (user_id, role_id, created_at, updated_at) 
   VALUES (:userId, :roleId, NOW(), NOW())`,
  { replacements: { userId: user.id, roleId: teacherRoleId }, transaction }
);
```

### é—®é¢˜2ï¼šæ²¡æœ‰ç»‘å®š group_id

**å½±å“**ï¼š
- æ— æ³•è¿½è¸ªæ•™å¸ˆå±äºå“ªä¸ªé›†å›¢
- æ— æ³•å®ç°é›†å›¢çº§æ•°æ®éš”ç¦»
- æ— æ³•è¿›è¡Œé›†å›¢çº§æƒé™æ§åˆ¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// 1. ä» kindergarten è¡¨æŸ¥è¯¢ group_id
const kindergarten = await sequelize.query(
  `SELECT group_id FROM kindergartens WHERE id = :kindergartenId`,
  { replacements: { kindergartenId }, type: 'SELECT', transaction }
);

// 2. åœ¨åˆ›å»º Teacher æ—¶ç»‘å®š group_id
const teacher = await Teacher.create({
  userId: user.id,
  kindergartenId,
  groupId: kindergarten[0].group_id,  // âœ… ç»‘å®šé›†å›¢ID
  teacherNo,
  position,
  hireDate,
  education,
  major,
  creatorId,
  status: 1
}, { transaction });
```

### é—®é¢˜3ï¼šTeacher æ¨¡å‹ç¼ºå°‘ group_id å­—æ®µ

**å½“å‰çŠ¶æ€**ï¼š
- Teacher æ¨¡å‹ä¸­æ²¡æœ‰ group_id å­—æ®µ
- æ•°æ®åº“è¡¨ä¸­ä¹Ÿæ²¡æœ‰ group_id åˆ—
- æ— æ³•å­˜å‚¨é›†å›¢ID

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// 1. ä¿®æ”¹ Teacher æ¨¡å‹
declare groupId: ForeignKey<Group['id']> | null;

// 2. æ·»åŠ å­—æ®µå®šä¹‰
groupId: {
  type: DataTypes.INTEGER,
  allowNull: true,
  field: 'group_id',
  comment: 'æ‰€å±é›†å›¢ID',
  references: { model: 'groups', key: 'id' }
}

// 3. åˆ›å»ºæ•°æ®åº“è¿ç§»
ALTER TABLE teachers ADD COLUMN group_id INT;
```

---

## âœ… å®Œæ•´çš„ä¿®å¤æ–¹æ¡ˆ

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

1. **server/src/models/teacher.model.ts**
   - æ·»åŠ  groupId å­—æ®µå£°æ˜
   - æ·»åŠ  groupId å­—æ®µå®šä¹‰

2. **server/src/migrations/20250110000004-add-group-id-to-teachers.js**
   - åˆ›å»ºæ–°çš„è¿ç§»æ–‡ä»¶
   - æ·»åŠ  group_id åˆ—åˆ° teachers è¡¨

3. **server/src/routes/teachers.routes.ts**
   - è·å– kindergarten çš„ group_id
   - åˆ›å»º user_roles å…³è”
   - åœ¨åˆ›å»º Teacher æ—¶ç»‘å®š group_id

### ä¿®å¤åçš„æµç¨‹

```
1. è·å–å½“å‰ç”¨æˆ·çš„ kindergartenId
2. æŸ¥è¯¢ kindergarten è¡¨è·å– group_id
3. åˆ›å»º User è®°å½•
4. åˆ›å»º user_roles å…³è” âœ… æ–°å¢
5. åˆ›å»º Teacher è®°å½•ï¼ˆåŒ…å« group_idï¼‰âœ… æ–°å¢
6. è¿”å›å®Œæ•´çš„è®°å½•
```

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰
```
æ·»åŠ æ•™å¸ˆæ—¶ç”Ÿæˆçš„è®°å½•ï¼š
â”œâ”€â”€ User è¡¨: 1æ¡
â”œâ”€â”€ Teacher è¡¨: 1æ¡
â”œâ”€â”€ user_roles è¡¨: 0æ¡ âŒ
â””â”€â”€ group_id: æœªç»‘å®š âŒ
```

### ä¿®å¤å
```
æ·»åŠ æ•™å¸ˆæ—¶ç”Ÿæˆçš„è®°å½•ï¼š
â”œâ”€â”€ User è¡¨: 1æ¡ âœ…
â”œâ”€â”€ user_roles è¡¨: 1æ¡ âœ…
â”œâ”€â”€ Teacher è¡¨: 1æ¡ âœ…
â””â”€â”€ group_id: å·²ç»‘å®š âœ…
```

---

## ğŸ¯ ä¿®å¤ä¼˜å…ˆçº§

### ç«‹å³éœ€è¦ (1-2å¤©)
- [ ] ä¿®æ”¹ Teacher æ¨¡å‹ï¼Œæ·»åŠ  group_id å­—æ®µ
- [ ] åˆ›å»ºæ•°æ®åº“è¿ç§»æ–‡ä»¶
- [ ] ä¿®æ”¹ teachers.routes.tsï¼Œæ·»åŠ  user_roles å’Œ group_id ç»‘å®š
- [ ] è¿è¡Œæ•°æ®åº“è¿ç§»
- [ ] æµ‹è¯•æ·»åŠ æ•™å¸ˆçš„å®Œæ•´æµç¨‹

### éœ€è¦æ£€æŸ¥ (3-5å¤©)
- [ ] æ£€æŸ¥å…¶ä»–äººå‘˜ç±»å‹ï¼ˆç®¡ç†å‘˜ã€å›­é•¿ç­‰ï¼‰æ˜¯å¦æœ‰ç›¸åŒé—®é¢˜
- [ ] ä¸ºå…¶ä»–äººå‘˜ç±»å‹æ·»åŠ ç›¸åŒçš„ä¿®å¤

### é•¿æœŸè§„åˆ’ (1-2å‘¨)
- [ ] å®Œå–„æƒé™ç³»ç»Ÿ
- [ ] æ·»åŠ å®¡è®¡æ—¥å¿—
- [ ] ç¼–å†™æµ‹è¯•ç”¨ä¾‹

---

## ğŸ“ æ€»ç»“

**å½“å‰çŠ¶æ€**ï¼š
- âœ… åˆ›å»ºäº† User å’Œ Teacher ä¸¤ä¸ªè®°å½•
- âŒ æ²¡æœ‰åˆ›å»º user_roles å…³è”
- âŒ æ²¡æœ‰ç»‘å®š group_id
- âŒ æ²¡æœ‰å®Œæ•´çš„æƒé™å’Œéš”ç¦»

**éœ€è¦ä¿®å¤**ï¼š
- æ·»åŠ  user_roles åˆ›å»ºé€»è¾‘
- æ·»åŠ  group_id ç»‘å®šé€»è¾‘
- ä¿®æ”¹ Teacher æ¨¡å‹
- åˆ›å»ºæ•°æ®åº“è¿ç§»

**ä¿®å¤åçš„ä¼˜åŠ¿**ï¼š
- âœ… å®Œæ•´çš„ç”¨æˆ·è®°å½•
- âœ… æ­£ç¡®çš„æƒé™ç»‘å®š
- âœ… é›†å›¢æ•°æ®éš”ç¦»
- âœ… æ•°æ®ä¸€è‡´æ€§

---

**è¿™æ˜¯ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½ç¼ºé™·ï¼Œå»ºè®®ç«‹å³ä¿®å¤ï¼** ğŸš¨


