# 后端硬编码数据检查报告

## 检查概述

本报告针对幼儿园管理系统后端代码中的硬编码数据进行了全面检查，主要关注那些应该使用数据库存储但目前硬编码在代码中的数据。

## 发现的硬编码数据

### 1. 角色和权限配置 (server/src/config/role-mapping.ts)

**问题描述**: 角色定义、权限定义和角色权限映射完全硬编码在配置文件中。

**具体内容**:
- 角色定义: ADMIN, PRINCIPAL, TEACHER, PARENT, SUPER_ADMIN, MARKETING, ENROLLMENT, FINANCE, STAFF
- 权限定义: 包含用户管理、角色管理、班级管理、学生管理、教师管理、家长管理、活动管理、招生计划、招生管理、申请管理、客户管理、统计分析、AI功能、数据查询、系统配置等权限
- 角色权限映射: 每个角色对应的权限列表
- 中心权限代码定义: 14个中心模块的权限代码
- 角色-中心访问权限映射: 不同角色可访问的中心模块
- 中心权限ID映射: 中心权限代码与数据库ID的映射

**建议**: 应该将角色、权限和角色权限关系存储在数据库中，并提供管理界面进行配置。

### 2. 业务状态枚举

**问题描述**: 多个业务状态使用枚举硬编码，而不是从数据库动态获取。

**具体内容**:
- ApplicationStatus (报名申请状态): PENDING, APPROVED, REJECTED
- TeacherStatus (教师状态)
- StudentStatus (学生状态)
- ActivityPlanStatus (活动计划状态)
- TodoStatus (待办事项状态): pending, in_progress, completed, cancelled, overdue
- NotificationStatus (通知状态)
- ModelStatus (模型状态): active, inactive, testing

**建议**: 考虑将这些状态配置化，存储在数据库中，便于系统扩展。

### 3. 数据导入类型 (server/src/controllers/data-import.controller.ts)

**问题描述**: 支持的数据导入类型硬编码为数组。

**具体内容**:
```typescript
const types = ['student', 'parent', 'teacher'];
```

**建议**: 应该从数据库的系统配置表中获取支持的导入类型。

### 4. 仪表板模拟数据 (server/src/controllers/dashboard.controller.ts)

**问题描述**: 当数据库查询失败时，使用硬编码的模拟数据作为降级方案。

**具体内容**:
- 固定的默认值: totalStudents=1250, totalTeachers=85, totalClasses=42, totalActivities=156
- 硬编码的数据分类: ['招生数据', '活动数据', '教师数据', '学生数据', '家长数据']

**建议**: 应该从系统配置表中获取这些默认值，而不是硬编码。

### 5. AI模型配置

**问题描述**: AI模型的能力和类型部分硬编码。

**具体内容**:
- 模型能力列表: ['text_generation', 'code_generation', 'text_analysis', 'reasoning']
- 支付方式: ['credit_card', 'alipay', 'wechat_pay', 'bank_transfer']

**建议**: 应该从数据库的模型配置表中获取这些信息。

## 优先级建议

### 高优先级
1. **角色和权限配置**: 这是最核心的系统配置，应该完全数据库化，并提供管理界面。
2. **业务状态枚举**: 将业务状态配置化，提高系统灵活性。

### 中优先级
1. **数据导入类型**: 从系统配置表获取，便于扩展新的导入类型。
2. **仪表板默认值**: 从系统配置表获取，便于调整默认统计值。

### 低优先级
1. **AI模型配置**: 可以考虑将模型配置完全数据库化，但当前实现影响不大。

## 实施建议

1. **创建系统配置表**: 设计一个灵活的系统配置表，存储各种键值对配置。
2. **创建角色权限管理表**: 设计角色表、权限表和角色权限关联表。
3. **创建状态配置表**: 设计业务状态配置表，存储各种业务状态及其含义。
4. **提供管理界面**: 为系统配置、角色权限等提供管理界面。
5. **逐步迁移**: 分阶段将硬编码数据迁移到数据库，避免一次性改动过大。

## 风险评估

1. **数据一致性**: 确保迁移过程中数据的一致性。
2. **性能影响**: 数据库查询可能比内存中的硬编码数据慢，需要考虑缓存策略。
3. **向后兼容**: 确保API接口的向后兼容性。

## 结论

后端代码中存在大量硬编码数据，特别是角色权限配置和业务状态定义。建议优先处理角色权限配置的数据库化，这将大大提高系统的灵活性和可维护性。其他硬编码数据可以根据实际需要逐步迁移到数据库中。