# 📅 督查中心时间编辑器设计方案

**需求来源**: 园长反馈  
**核心需求**: 可视化调整检查计划的日期和顺序  
**业务场景**: 不同地区检查要求不同，需要灵活调整  

---

## 🎯 功能需求分析

### 用户场景

**场景1: 年初调整年度计划**
```
园长：系统自动生成了年度计划，但我们这边的要求不太一样

需求：
- 3月的"保教质量检查"要调到4月
- 9月的两个检查间隔太近，要分散
- 某些检查要调整到上级要求的日期
```

**场景2: 应对突发调整**
```
教育局通知：消防检查从10月15日改到10月20日

需求：
- 快速调整日期
- 不影响其他检查
- 保持时间轴清晰
```

**场景3: 批量调整**
```
园长：上半年的检查都要往后推一周

需求：
- 批量选择1-6月的检查
- 统一延后7天
- 自动避免冲突
```

---

## 🎨 设计方案

### 方案一：拖拽式月度日历（推荐）⭐⭐⭐⭐⭐

**界面设计**：

```
┌─────────────────────────────────────────────────────┐
│  调整检查计划时间                           [×]      │
├─────────────────────────────────────────────────────┤
│  2025年                                             │
│  [◀ 上月]  [一月]  [下月 ▶]    [保存]  [取消]        │
├─────────────────────────────────────────────────────┤
│  日  一  二  三  四  五  六                            │
│  ──────────────────────────────────────────────     │
│  29  30  31   1   2   3   4                         │
│   5   6   7   8   9  10  11                         │
│  12  13  14  15  16  17  18                         │
│                    ↓                                │
│         [消防安全检查] ← 可拖拽卡片                  │
│                                                     │
│  19  20  21  22  23  24  25                         │
│          ↓                                          │
│   [卫生保健检查] ← 可拖拽卡片                        │
│                                                     │
│  26  27  28  29  30  31                             │
│      ↓                                              │
│  [开学准备检查] ← 可拖拽卡片                         │
│      [教学质量检查]                                  │
│                                                     │
└─────────────────────────────────────────────────────┘

操作方式：
1. 拖拽检查卡片到新的日期
2. 日期格子高亮显示可放置区域
3. 释放鼠标完成移动
4. 自动保存新日期
```

**优点**：
- ✅ 直观可视化，类似Google Calendar
- ✅ 拖拽操作，符合用户习惯
- ✅ 按月展示，不拥挤
- ✅ 实时预览效果

**技术实现**：
- 使用Vue Draggable或自定义拖拽
- Element Plus Calendar组件作为基础
- 月度切换导航

**适用场景**: 
- 调整单个检查日期
- 月度内调整
- 视觉化展示

---

### 方案二：树形列表编辑（备选）⭐⭐⭐⭐

**界面设计**：

```
┌─────────────────────────────────────────────────────┐
│  批量调整检查计划                           [×]      │
├─────────────────────────────────────────────────────┤
│  选择调整方式：                                      │
│  ⚪ 逐个调整  ⚪ 批量延后  ⚪ 批量提前               │
├─────────────────────────────────────────────────────┤
│  📅 2025年                                          │
│  ├─ 📁 一月 (26个检查)                              │
│  │  ├─ ☐ [2025-01-15] 消防安全检查  [📅 改期]      │
│  │  ├─ ☐ [2025-01-20] 卫生保健检查  [📅 改期]      │
│  │  └─ ☐ [2025-01-25] 教学质量检查  [📅 改期]      │
│  ├─ 📁 二月 (2个检查)                               │
│  │  ├─ ☐ [2025-02-10] 开学准备检查  [📅 改期]      │
│  │  └─ ☐ [2025-02-28] 月度总结检查  [📅 改期]      │
│  └─ 📁 三月 (4个检查)                               │
│     └─ ...                                          │
├─────────────────────────────────────────────────────┤
│  批量操作：                                          │
│  [选中项延后_天] [选中项提前_天]  [应用]            │
│                                                     │
│                          [取消]  [保存所有更改]      │
└─────────────────────────────────────────────────────┘
```

**优点**：
- ✅ 树形结构，层次清晰
- ✅ 支持批量操作
- ✅ 精确日期选择
- ✅ 可展开/折叠

**技术实现**：
- Element Plus Tree组件
- Date Picker日期选择
- 批量操作逻辑

**适用场景**:
- 批量调整日期
- 精确指定日期
- 大量检查调整

---

### 方案三：混合方案（最佳）⭐⭐⭐⭐⭐

**设计思路**: 结合方案一和方案二的优点

**界面设计**：

```
┌──────────────────────────────────────────────────────┐
│  📅 检查计划时间调整                        [×]       │
├──────────────────────────────────────────────────────┤
│  视图模式：⚪ 日历拖拽  ⚪ 列表编辑                    │
├──────────────────────────────────────────────────────┤
│                                                      │
│  === 日历拖拽模式 ===                                 │
│                                                      │
│  2025年 一月         [◀ 上月] [下月 ▶]               │
│  ┌─────────────────────────────────────────────┐   │
│  │  日  一  二  三  四  五  六                    │   │
│  │  ─────────────────────────────────────────   │   │
│  │   5   6   7   8   9  10  11                 │   │
│  │  12  13  14  15  16  17  18                 │   │
│  │              [消防检查] ← 可拖拽               │   │
│  │  19  20  21  22  23  24  25                 │   │
│  │      [卫生检查] ← 可拖拽                      │   │
│  │  26  27  28  29  30  31                     │   │
│  │      [开学检查]                              │   │
│  └─────────────────────────────────────────────┘   │
│                                                      │
│  === 列表编辑模式 ===                                 │
│                                                      │
│  ┌─────────────────────────────────────────────┐   │
│  │ ☐ 全选  已选择: 0个                          │   │
│  │                                              │   │
│  │ 📁 一月 (26个)                               │   │
│  │   ☐ [01-15] 消防安全检查  [📅]  [↑] [↓]     │   │
│  │   ☐ [01-20] 卫生保健检查  [📅]  [↑] [↓]     │   │
│  │   ☐ [01-25] 教学质量检查  [📅]  [↑] [↓]     │   │
│  │                                              │   │
│  │ 批量操作：                                    │   │
│  │ [延后 __ 天]  [提前 __ 天]  [移到月份 ▼]     │   │
│  └─────────────────────────────────────────────┘   │
│                                                      │
│              [取消]  [保存所有更改]                   │
└──────────────────────────────────────────────────────┘
```

**特点**：
- 🎨 两种模式可切换
- 📅 日历模式：直观拖拽
- 📋 列表模式：批量操作
- ⚡ 灵活切换，各取所长

---

## 🔧 推荐实现方案

### 我推荐：**混合方案**

**理由**：

1. **日历拖拽模式** - 适合单个调整
   - 园长："3月15号的检查改到3月20号"
   - 操作：拖拽卡片即可

2. **列表编辑模式** - 适合批量调整
   - 园长："1月的所有检查都延后一周"
   - 操作：选中1月的，点"延后7天"

3. **两种模式结合** - 覆盖所有场景
   - 小调整用日历拖拽
   - 大批量用列表操作

---

## 📍 按钮位置建议

### 建议位置：顶部操作区（推荐）⭐⭐⭐⭐⭐

```vue
<template #header-actions>
  <el-button type="primary" size="large" @click="handleGenerateYearlyPlan">
    <el-icon><Calendar /></el-icon>
    生成年度计划
  </el-button>
  
  <!-- 新增：调整计划时间按钮 -->
  <el-button type="warning" size="large" @click="openTimelineEditor">
    <el-icon><Edit /></el-icon>
    调整计划时间
  </el-button>
  
  <el-button type="success" size="large" @click="handleUploadDocument">
    <el-icon><Upload /></el-icon>
    上传检查文档
  </el-button>
  
  <el-button type="info" size="large" @click="handlePrintYearlyReport">
    <el-icon><Printer /></el-icon>
    打印年度报告
  </el-button>
</template>
```

**优点**：
- ✅ 位置醒目，园长容易找到
- ✅ 与"生成年度计划"功能呼应（一个生成，一个调整）
- ✅ 核心功能都在顶部
- ✅ 橙色按钮，视觉区分

### 备选位置：Timeline卡片右上角

```vue
<div class="header-actions">
  <!-- 调整按钮 -->
  <el-button size="small" @click="openTimelineEditor">
    <el-icon><Edit /></el-icon>
    调整时间
  </el-button>
  
  <!-- 原有的搜索、跳转、年份选择等 -->
  <el-input v-model="searchKeyword" ... />
  <el-button>本月检查</el-button>
  <el-select>年份</el-select>
</div>
```

**优点**：
- ✅ 靠近时间轴，操作关联性强
- ✅ 不占用顶部空间

**缺点**：
- ⚠️ 可能被忽略（按钮较小）

---

## 💡 具体实现方案

### 核心组件：InspectionTimelineEditor.vue

**组件结构**：

```vue
<template>
  <el-dialog
    v-model="visible"
    title="📅 检查计划时间调整"
    width="1200px"
    :close-on-click-modal="false"
    fullscreen
  >
    <!-- 模式切换 -->
    <div class="editor-header">
      <el-radio-group v-model="editorMode">
        <el-radio-button label="calendar">
          <el-icon><Calendar /></el-icon>
          日历拖拽模式
        </el-radio-button>
        <el-radio-button label="list">
          <el-icon><List /></el-icon>
          列表编辑模式
        </el-radio-button>
      </el-radio-group>

      <div class="header-info">
        <el-tag v-if="hasChanges" type="warning">
          有 {{ changedPlans.length }} 个计划已修改
        </el-tag>
      </div>
    </div>

    <!-- 日历拖拽模式 -->
    <div v-if="editorMode === 'calendar'" class="calendar-editor">
      <div class="month-navigator">
        <el-button @click="previousMonth">◀ 上月</el-button>
        <span class="current-month">{{ currentMonthLabel }}</span>
        <el-button @click="nextMonth">下月 ▶</el-button>
      </div>

      <!-- 日历网格 -->
      <div class="calendar-grid">
        <div class="weekday-header">
          <div>日</div><div>一</div><div>二</div>
          <div>三</div><div>四</div><div>五</div><div>六</div>
        </div>

        <div class="calendar-body">
          <div
            v-for="day in calendarDays"
            :key="day.date"
            class="calendar-day"
            :class="{ 
              'current-month': day.isCurrentMonth,
              'has-plan': day.plans.length > 0,
              'drop-target': isDragging
            }"
            @drop="handleDrop($event, day.date)"
            @dragover="handleDragOver"
          >
            <div class="day-number">{{ day.dayNumber }}</div>
            
            <!-- 检查计划卡片（可拖拽） -->
            <div
              v-for="plan in day.plans"
              :key="plan.id"
              class="plan-card draggable"
              :draggable="true"
              @dragstart="handleDragStart($event, plan)"
              @dragend="handleDragEnd"
            >
              <div class="plan-name">{{ plan.inspectionType?.name }}</div>
              <el-tag :type="getStatusTagType(plan.status)" size="small">
                {{ getStatusLabel(plan.status) }}
              </el-tag>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 列表编辑模式 -->
    <div v-else class="list-editor">
      <div class="batch-toolbar">
        <el-checkbox v-model="selectAll" @change="handleSelectAll">
          全选
        </el-checkbox>
        <span class="selected-info">已选择: {{ selectedPlans.length }} 个</span>
        
        <div class="batch-actions">
          <el-input-number 
            v-model="batchDays" 
            :min="1" 
            :max="365"
            size="small"
            style="width: 100px;"
          />
          <el-button 
            size="small" 
            @click="batchDelay"
            :disabled="selectedPlans.length === 0"
          >
            延后 N 天
          </el-button>
          <el-button 
            size="small" 
            @click="batchAdvance"
            :disabled="selectedPlans.length === 0"
          >
            提前 N 天
          </el-button>
          <el-select 
            v-model="batchTargetMonth" 
            placeholder="移到月份"
            size="small"
            style="width: 120px;"
          >
            <el-option 
              v-for="m in 12" 
              :key="m" 
              :label="`${m}月`" 
              :value="m"
            />
          </el-select>
          <el-button 
            size="small" 
            type="primary"
            @click="batchMoveToMonth"
            :disabled="selectedPlans.length === 0 || !batchTargetMonth"
          >
            应用
          </el-button>
        </div>
      </div>

      <!-- 树形列表 -->
      <el-tree
        :data="treeData"
        node-key="id"
        :props="{ label: 'label', children: 'children' }"
        show-checkbox
        @check="handleTreeCheck"
      >
        <template #default="{ node, data }">
          <div class="tree-node">
            <!-- 月份节点 -->
            <div v-if="data.type === 'month'" class="month-node">
              <span class="month-label">{{ data.label }}</span>
              <el-tag size="small">{{ data.count }}个检查</el-tag>
            </div>

            <!-- 检查计划节点 -->
            <div v-else class="plan-node">
              <span class="plan-date">[{{ data.planDate }}]</span>
              <span class="plan-name">{{ data.name }}</span>
              <el-tag :type="data.statusType" size="small">
                {{ data.statusLabel }}
              </el-tag>
              
              <!-- 日期编辑 -->
              <el-date-picker
                v-model="data.newDate"
                type="date"
                size="small"
                placeholder="新日期"
                @change="handleDateChange(data)"
                style="width: 140px; margin-left: 12px;"
              />
              
              <!-- 移动顺序 -->
              <el-button-group size="small" style="margin-left: 8px;">
                <el-button @click="moveUp(data)" :disabled="!canMoveUp(data)">
                  <el-icon><ArrowUp /></el-icon>
                </el-button>
                <el-button @click="moveDown(data)" :disabled="!canMoveDown(data)">
                  <el-icon><ArrowDown /></el-icon>
                </el-button>
              </el-button-group>
            </div>
          </div>
        </template>
      </el-tree>
    </div>

    <!-- 底部操作 -->
    <template #footer>
      <div class="editor-footer">
        <div class="footer-left">
          <el-button @click="resetChanges" :disabled="!hasChanges">
            重置更改
          </el-button>
          <span v-if="hasChanges" class="change-hint">
            * 已修改 {{ changedPlans.length }} 个计划
          </span>
        </div>
        <div class="footer-right">
          <el-button @click="handleClose">取消</el-button>
          <el-button 
            type="primary" 
            @click="saveChanges"
            :disabled="!hasChanges"
            :loading="saving"
          >
            保存所有更改
          </el-button>
        </div>
      </div>
    </template>
  </el-dialog>
</template>

<script setup lang="ts">
import { ref, computed, watch } from 'vue';
import { ElMessage, ElMessageBox } from 'element-plus';
import { Calendar, List, Edit, ArrowUp, ArrowDown } from '@element-plus/icons-vue';

// ... 完整实现见下文
</script>
```

---

## 🎯 推荐实现方式

我建议采用**混合方案**，原因如下：

### 1. 满足不同场景需求

**场景A**: 调整单个日期（小调整）
- 使用：日历拖拽模式
- 操作：拖拽卡片到新日期
- 优势：直观、快速

**场景B**: 批量调整多个日期（大调整）
- 使用：列表编辑模式
- 操作：勾选多个，批量延后/提前
- 优势：高效、精确

### 2. 用户体验最佳

**新手用户**：
- 先用日历拖拽（直观易懂）
- 看到效果后产生信任

**熟练用户**：
- 切换到列表模式
- 快速批量操作

### 3. 技术实现可行

**日历拖拽**：
```typescript
// 使用HTML5 Drag & Drop API
const handleDragStart = (event: DragEvent, plan: any) => {
  event.dataTransfer!.effectAllowed = 'move';
  event.dataTransfer!.setData('planId', plan.id.toString());
  draggingPlan.value = plan;
};

const handleDrop = (event: DragEvent, targetDate: string) => {
  event.preventDefault();
  const planId = event.dataTransfer!.getData('planId');
  const plan = plans.value.find(p => p.id === parseInt(planId));
  
  if (plan) {
    // 更新日期
    plan.planDate = targetDate;
    // 标记为已修改
    markAsChanged(plan);
  }
};
```

**列表批量**：
```typescript
// 批量延后
const batchDelay = () => {
  selectedPlans.value.forEach(plan => {
    const date = new Date(plan.planDate);
    date.setDate(date.getDate() + batchDays.value);
    plan.planDate = date.toISOString().split('T')[0];
    markAsChanged(plan);
  });
};
```

---

## 🎨 按钮设计

### 推荐方案：顶部主操作区

**按钮组布局**：

```vue
<template #header-actions>
  <el-button-group>
    <!-- 第一组：计划管理 -->
    <el-button type="primary" size="large" @click="handleGenerateYearlyPlan">
      <el-icon><Calendar /></el-icon>
      生成年度计划
    </el-button>
    <el-button type="warning" size="large" @click="openTimelineEditor">
      <el-icon><Edit /></el-icon>
      调整计划时间
    </el-button>
  </el-button-group>

  <el-button-group>
    <!-- 第二组：文档和报告 -->
    <el-button type="success" size="large" @click="handleUploadDocument">
      <el-icon><Upload /></el-icon>
      上传检查文档
    </el-button>
    <el-button type="info" size="large" @click="handlePrintYearlyReport">
      <el-icon><Printer /></el-icon>
      打印年度报告
    </el-button>
  </el-button-group>
</template>
```

**视觉效果**：
```
┌──────────────────────────────────────────────────┐
│ 检查中心                                          │
│ 全年检查计划一目了然，智能提醒不遗漏               │
│                                                  │
│ [生成年度计划] [调整计划时间]                      │
│                   ↑                              │
│                新增按钮                           │
│                                                  │
│ [上传检查文档] [打印年度报告]                      │
└──────────────────────────────────────────────────┘
```

**按钮分组逻辑**：
- 第一组：计划相关（生成、调整）
- 第二组：文档相关（上传、打印）

---

## 🔄 用户操作流程

### 流程1: 日历拖拽调整

```
1. 园长点击"调整计划时间"按钮
   ↓
2. 打开全屏对话框
   ↓
3. 默认显示"日历拖拽模式"
   ↓
4. 显示当前月份（1月）的日历
   ↓
5. 园长看到1月15日有"消防安全检查"卡片
   ↓
6. 园长拖拽该卡片
   ↓
7. 拖到1月20日的格子上
   ↓
8. 释放鼠标
   ↓
9. 卡片移动到1月20日
   ↓
10. 系统标记该计划已修改（显示橙色标记）
    ↓
11. 园长继续调整其他检查（或切换月份）
    ↓
12. 调整完成，点击"保存所有更改"
    ↓
13. 系统批量更新所有修改的计划
    ↓
14. 显示成功提示："已保存3个计划的时间调整"
    ↓
15. 关闭对话框，时间轴刷新显示新日期
```

**用时**: 约2分钟（调整3-5个计划）

### 流程2: 列表批量调整

```
1. 园长点击"调整计划时间"按钮
   ↓
2. 打开对话框，切换到"列表编辑模式"
   ↓
3. 展开"一月"文件夹，显示26个检查
   ↓
4. 勾选需要调整的检查（例如5个）
   ↓
5. 在"批量操作"区域：
   - 输入延后天数：7
   - 点击"延后 7 天"按钮
   ↓
6. 系统自动计算新日期：
   - 1月15日 → 1月22日
   - 1月20日 → 1月27日
   - ...
   ↓
7. 列表中显示新日期（橙色标记）
   ↓
8. 园长确认无误，点击"保存所有更改"
   ↓
9. 系统批量更新
   ↓
10. 时间轴刷新
```

**用时**: 约1分钟（批量调整5-10个计划）

---

## 💻 技术实现要点

### 1. 拖拽功能

```typescript
// 拖拽状态
const isDragging = ref(false);
const draggingPlan = ref<any>(null);

// 开始拖拽
const handleDragStart = (event: DragEvent, plan: any) => {
  isDragging.value = true;
  draggingPlan.value = plan;
  event.dataTransfer!.effectAllowed = 'move';
  event.dataTransfer!.setData('planId', plan.id.toString());
  
  // 设置拖拽效果
  const dragElement = event.target as HTMLElement;
  dragElement.style.opacity = '0.5';
};

// 拖拽结束
const handleDragEnd = (event: DragEvent) => {
  isDragging.value = false;
  draggingPlan.value = null;
  
  const dragElement = event.target as HTMLElement;
  dragElement.style.opacity = '1';
};

// 允许放置
const handleDragOver = (event: DragEvent) => {
  event.preventDefault();
  event.dataTransfer!.dropEffect = 'move';
};

// 放置
const handleDrop = (event: DragEvent, targetDate: string) => {
  event.preventDefault();
  
  if (draggingPlan.value) {
    const oldDate = draggingPlan.value.planDate;
    const newDate = targetDate;
    
    // 更新日期
    draggingPlan.value.planDate = newDate;
    
    // 标记为已修改
    markAsChanged(draggingPlan.value.id, oldDate, newDate);
    
    ElMessage.success(`已将检查从 ${oldDate} 移动到 ${newDate}`);
  }
};
```

### 2. 日历数据生成

```typescript
// 生成日历天数（包含上月尾和下月初）
const calendarDays = computed(() => {
  const year = currentYear.value;
  const month = currentMonth.value;
  
  // 获取当月第一天和最后一天
  const firstDay = new Date(year, month - 1, 1);
  const lastDay = new Date(year, month, 0);
  
  // 获取第一天是星期几（0=周日）
  const firstDayOfWeek = firstDay.getDay();
  
  // 计算需要显示的天数
  const days = [];
  
  // 上月的天数（补齐）
  for (let i = firstDayOfWeek - 1; i >= 0; i--) {
    const date = new Date(year, month - 1, -i);
    days.push({
      date: formatDate(date),
      dayNumber: date.getDate(),
      isCurrentMonth: false,
      plans: getPlansForDate(formatDate(date))
    });
  }
  
  // 当月的天数
  for (let day = 1; day <= lastDay.getDate(); day++) {
    const date = new Date(year, month - 1, day);
    days.push({
      date: formatDate(date),
      dayNumber: day,
      isCurrentMonth: true,
      plans: getPlansForDate(formatDate(date))
    });
  }
  
  // 下月的天数（补齐到42天，6周）
  const remainingDays = 42 - days.length;
  for (let day = 1; day <= remainingDays; day++) {
    const date = new Date(year, month, day);
    days.push({
      date: formatDate(date),
      dayNumber: day,
      isCurrentMonth: false,
      plans: getPlansForDate(formatDate(date))
    });
  }
  
  return days;
});
```

### 3. 树形数据生成

```typescript
// 按月份分组的树形数据
const treeData = computed(() => {
  const months = Array.from({ length: 12 }, (_, i) => i + 1);
  
  return months.map(month => {
    const monthPlans = plans.value.filter(plan => {
      const planMonth = new Date(plan.planDate).getMonth() + 1;
      return planMonth === month;
    });
    
    return {
      id: `month-${month}`,
      label: `${month}月`,
      type: 'month',
      count: monthPlans.length,
      children: monthPlans.map(plan => ({
        id: `plan-${plan.id}`,
        type: 'plan',
        planId: plan.id,
        planDate: plan.planDate,
        newDate: plan.planDate, // 编辑后的新日期
        name: plan.inspectionType?.name,
        statusType: getStatusTagType(plan.status),
        statusLabel: getStatusLabel(plan.status),
        _plan: plan // 保存完整数据
      }))
    };
  });
});
```

### 4. 批量操作

```typescript
// 批量延后
const batchDelay = () => {
  const days = batchDays.value;
  
  selectedPlans.value.forEach(planNode => {
    const plan = planNode._plan;
    const oldDate = new Date(plan.planDate);
    const newDate = new Date(oldDate);
    newDate.setDate(newDate.getDate() + days);
    
    plan.planDate = formatDate(newDate);
    planNode.newDate = plan.planDate;
    
    markAsChanged(plan.id, formatDate(oldDate), plan.planDate);
  });
  
  ElMessage.success(`已将 ${selectedPlans.value.length} 个检查延后 ${days} 天`);
};

// 批量移到指定月份
const batchMoveToMonth = () => {
  const targetMonth = batchTargetMonth.value;
  
  selectedPlans.value.forEach(planNode => {
    const plan = planNode._plan;
    const oldDate = new Date(plan.planDate);
    const newDate = new Date(oldDate);
    newDate.setMonth(targetMonth - 1);
    
    // 如果新月份的天数不够，调整到月底
    if (newDate.getMonth() !== targetMonth - 1) {
      newDate.setDate(0); // 设为上月最后一天
    }
    
    plan.planDate = formatDate(newDate);
    planNode.newDate = plan.planDate;
    
    markAsChanged(plan.id, formatDate(oldDate), plan.planDate);
  });
  
  ElMessage.success(`已将 ${selectedPlans.value.length} 个检查移动到 ${targetMonth} 月`);
};
```

### 5. 保存更改

```typescript
// 保存所有更改
const saveChanges = async () => {
  if (changedPlans.value.length === 0) {
    ElMessage.warning('没有需要保存的更改');
    return;
  }

  try {
    saving.value = true;
    
    // 批量更新API调用
    for (const change of changedPlans.value) {
      await request.put(`/inspection/plans/${change.planId}`, {
        planDate: change.newDate
      });
    }
    
    ElMessage.success(`成功保存 ${changedPlans.value.length} 个计划的时间调整`);
    
    // 清空修改记录
    changedPlans.value = [];
    
    // 触发刷新
    emit('success');
    handleClose();
  } catch (error) {
    console.error('保存失败:', error);
    ElMessage.error('保存失败，请重试');
  } finally {
    saving.value = false;
  }
};
```

---

## 📐 样式设计

### 日历拖拽模式样式

```scss
.calendar-editor {
  .calendar-grid {
    .calendar-day {
      min-height: 100px;
      border: 1px solid #dcdfe6;
      padding: 4px;
      position: relative;
      
      &.drop-target {
        background: #ecf5ff;
        border-color: #409eff;
        border-width: 2px;
      }
      
      &.has-plan {
        background: #f0f9ff;
      }
      
      .plan-card {
        background: white;
        border: 1px solid #409eff;
        border-radius: 4px;
        padding: 6px;
        margin-bottom: 4px;
        cursor: move;
        
        &:hover {
          box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        
        &.dragging {
          opacity: 0.5;
        }
      }
    }
  }
}
```

### 列表编辑模式样式

```scss
.list-editor {
  .batch-toolbar {
    padding: 16px;
    background: #f5f7fa;
    border-radius: 4px;
    margin-bottom: 16px;
    
    .batch-actions {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-top: 12px;
    }
  }
  
  .tree-node {
    display: flex;
    align-items: center;
    width: 100%;
    
    .plan-node {
      display: flex;
      align-items: center;
      gap: 12px;
      
      .plan-date {
        color: #409eff;
        font-weight: bold;
      }
    }
  }
}
```

---

## 🎯 使用场景示例

### 示例1: 调整单个检查日期

**需求**: 3月15日的保教质量检查改到4月5日

**操作**：
```
1. 点击"调整计划时间"
2. 选择"日历拖拽模式"
3. 切换到3月
4. 找到15日的"保教质量检查"卡片
5. 拖拽到4月5日
6. 系统提示："已将检查从 2025-03-15 移动到 2025-04-05"
7. 点击"保存所有更改"
8. 时间轴刷新，检查出现在4月5日
```

**用时**: 约30秒

### 示例2: 批量延后一周

**需求**: 1月的所有检查延后一周

**操作**：
```
1. 点击"调整计划时间"
2. 切换到"列表编辑模式"
3. 展开"一月"
4. 点击"全选"（或勾选部分）
5. 在批量操作区输入：7
6. 点击"延后 7 天"
7. 所有日期自动+7天
8. 点击"保存所有更改"
9. 完成
```

**用时**: 约20秒

### 示例3: 移动到其他月份

**需求**: 把2月的2个检查移到3月

**操作**：
```
1. 打开时间编辑器
2. 列表模式
3. 展开"二月"
4. 勾选2个检查
5. 选择"移到月份": 3月
6. 点击"应用"
7. 检查自动移到3月（保持原来的日期号）
8. 保存
```

**用时**: 约15秒

---

## ✅ 功能优势

### 对比手动调整

| 方式 | 操作步骤 | 用时 | 易错性 |
|------|---------|------|-------|
| 手动编辑 | 逐个打开→修改日期→保存 | 5分钟/个 | 高 |
| 日历拖拽 | 拖拽卡片即可 | 30秒/个 | 低 |
| 批量操作 | 勾选→输入天数→应用 | 20秒/批 | 极低 |

**效率提升**: **90%+**

### 避免错误

**常见错误**：
- ❌ 日期冲突（同一天多个检查）
- ❌ 跨年错误（12月延后到次年1月）
- ❌ 周末检查（应避免周末）

**系统保护**：
```typescript
// 检测日期冲突
const checkDateConflict = (date: string) => {
  const plansOnDate = plans.value.filter(p => p.planDate === date);
  if (plansOnDate.length > 3) {
    ElMessage.warning('该日期已有3个检查，建议分散');
  }
};

// 检测周末
const checkWeekend = (date: string) => {
  const day = new Date(date).getDay();
  if (day === 0 || day === 6) {
    ElMessageBox.confirm(
      '该日期是周末，确定要安排检查吗？',
      '提示'
    );
  }
};
```

---

## 📊 开发工作量评估

### 工作量预估

| 任务 | 预计时间 | 优先级 |
|------|---------|-------|
| 设计UI界面 | 30分钟 | 高 |
| 实现日历拖拽 | 2小时 | 高 |
| 实现列表编辑 | 1.5小时 | 高 |
| 批量操作逻辑 | 1小时 | 中 |
| 冲突检测 | 1小时 | 中 |
| 样式美化 | 1小时 | 低 |
| 测试调试 | 1小时 | 高 |

**总计**: 约**8小时**

### 依赖库

可选依赖：
- `vuedraggable` - Vue拖拽库（推荐）
- `vue3-draggable-resizable` - 可拖拽调整大小
- 或使用原生HTML5 Drag & Drop API

---

## 🎯 最终建议

### 我的推荐

**方案**: 混合方案（日历拖拽 + 列表编辑）  
**按钮位置**: 顶部操作区，"生成年度计划"旁边  
**按钮文字**: "调整计划时间" 或 "时间编辑器"  
**按钮图标**: Edit（编辑图标）  
**按钮颜色**: Warning（橙色）- 表示修改操作  

### 按钮位置代码

```vue
<template #header-actions>
  <el-button type="primary" size="large" @click="handleGenerateYearlyPlan">
    <el-icon><Calendar /></el-icon>
    生成年度计划
  </el-button>
  
  <!-- 新增：时间编辑器 -->
  <el-button type="warning" size="large" @click="openTimelineEditor">
    <el-icon><Edit /></el-icon>
    调整计划时间
  </el-button>
  
  <el-button type="success" size="large" @click="handleUploadDocument">
    <el-icon><Upload /></el-icon>
    上传检查文档
  </el-button>
  
  <el-button type="info" size="large" @click="handlePrintYearlyReport">
    <el-icon><Printer /></el-icon>
    打印年度报告
  </el-button>
</template>
```

### 视觉效果

```
┌────────────────────────────────────────────────────┐
│ 检查中心                                            │
│ 全年检查计划一目了然，智能提醒不遗漏                 │
│                                                    │
│ [📅 生成年度计划] [✏️ 调整计划时间] [📤 上传文档] [🖨️ 打印报告] │
│        ↑                ↑                          │
│      蓝色            新增橙色                        │
│   创建功能          调整功能                         │
└────────────────────────────────────────────────────┘
```

**设计理念**：
- 📅 生成计划（蓝色）+ ✏️ 调整计划（橙色）= 计划管理组
- 📤 上传文档（绿色）+ 🖨️ 打印报告（蓝色）= 文档管理组

---

## 💡 需要我立即实现吗？

我已经为您准备好了完整的设计方案。如果您确认这个方案，我可以立即开始开发：

**开发内容**：
1. ✅ InspectionTimelineEditor.vue 组件（约800行）
2. ✅ 日历拖拽功能
3. ✅ 列表编辑功能
4. ✅ 批量操作功能
5. ✅ 冲突检测
6. ✅ 集成到督查中心主页

**预计时间**: 约2小时

需要我现在开始实现吗？或者您对设计方案有其他想法？

