# è¥é”€åŠŸèƒ½æµ‹è¯•å¥—ä»¶

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„è¥é”€åŠŸèƒ½æµ‹è¯•å¥—ä»¶ï¼Œä¸ºå¹¼å„¿å›­ç®¡ç†ç³»ç»Ÿçš„è¥é”€æ¨¡å—æä¾›å…¨é¢çš„æµ‹è¯•è¦†ç›–ã€‚

## ğŸ“‹ æµ‹è¯•è¦†ç›–èŒƒå›´

### ğŸ¯ æµ‹è¯•åŠŸèƒ½æ¨¡å—
- **å›¢è´­ç³»ç»Ÿ** - å›¢è´­åˆ›å»ºã€å‚ä¸ã€ç®¡ç†ã€çŠ¶æ€æµè½¬
- **ç§¯æ”’æ´»åŠ¨** - ç§¯æ”’åŠ©åŠ›ã€è¿›åº¦è®¡ç®—ã€å¥–åŠ±å‘æ”¾ã€é˜²ä½œå¼Šæœºåˆ¶
- **é˜¶æ¢¯å¥–åŠ±** - å¤šå±‚çº§å¥–åŠ±ã€è·å¥–è®°å½•ã€å¥–åŠ±ä½¿ç”¨ã€ç»Ÿè®¡åŠŸèƒ½
- **æ”¯ä»˜ç³»ç»Ÿ** - çº¿ä¸Šæ”¯ä»˜ã€çº¿ä¸‹æ”¯ä»˜ã€è®¢å•ç®¡ç†ã€æ”¯ä»˜ç¡®è®¤
- **è¥é”€æµç¨‹** - å®Œæ•´çš„ä¸šåŠ¡æµç¨‹é›†æˆæµ‹è¯•

### ğŸ§ª æµ‹è¯•ç±»å‹
- **å•å…ƒæµ‹è¯•** - ç‹¬ç«‹åŠŸèƒ½æ¨¡å—æµ‹è¯•
- **é›†æˆæµ‹è¯•** - è·¨æ¨¡å—ä¸šåŠ¡æµç¨‹æµ‹è¯•
- **ç«¯åˆ°ç«¯æµ‹è¯•** - å®Œæ•´ç”¨æˆ·æ—…ç¨‹æ¨¡æ‹Ÿ

### ğŸ” æµ‹è¯•åœºæ™¯
- **æ­£å¸¸åœºæ™¯** - æ ‡å‡†ä¸šåŠ¡æµç¨‹éªŒè¯
- **å¼‚å¸¸åœºæ™¯** - é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶
- **è¾¹ç¼˜åœºæ™¯** - æé™å€¼å’Œç‰¹æ®Šæƒ…å†µ
- **æ€§èƒ½æµ‹è¯•** - å“åº”æ—¶é—´å’Œå¹¶å‘å¤„ç†
- **å¯ç”¨æ€§æµ‹è¯•** - ä¸åŒè®¾å¤‡å’Œå±å¹•å°ºå¯¸

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
marketing-tests/
â”œâ”€â”€ config/                    # æµ‹è¯•é…ç½®
â”‚   â””â”€â”€ test-config.js        # æµ‹è¯•ç¯å¢ƒå’Œæ•°æ®é…ç½®
â”œâ”€â”€ utils/                     # æµ‹è¯•å·¥å…·
â”‚   â”œâ”€â”€ api-client.js         # APIå®¢æˆ·ç«¯å°è£…
â”‚   â”œâ”€â”€ test-helpers.js       # æµ‹è¯•è¾…åŠ©å‡½æ•°
â”‚   â””â”€â”€ test-runner.js        # æµ‹è¯•è¿è¡Œå™¨
â”œâ”€â”€ scripts/                   # æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ setup.js             # æµ‹è¯•æ•°æ®è®¾ç½®
â”‚   â””â”€â”€ cleanup.js           # æµ‹è¯•æ•°æ®æ¸…ç†
â”œâ”€â”€ unit/                      # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ group-buy.test.js    # å›¢è´­åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ collect-activity.test.js # ç§¯æ”’æ´»åŠ¨æµ‹è¯•
â”‚   â”œâ”€â”€ tiered-reward.test.js # é˜¶æ¢¯å¥–åŠ±æµ‹è¯•
â”‚   â””â”€â”€ payment.test.js      # æ”¯ä»˜åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ integration/               # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ marketing-workflow.test.js # è¥é”€æµç¨‹é›†æˆæµ‹è¯•
â”œâ”€â”€ e2e/                      # ç«¯åˆ°ç«¯æµ‹è¯•
â”‚   â””â”€â”€ full-user-journey.test.js # å®Œæ•´ç”¨æˆ·æ—…ç¨‹æµ‹è¯•
â”œâ”€â”€ reports/                  # æµ‹è¯•æŠ¥å‘Š (è¿è¡Œæ—¶ç”Ÿæˆ)
â”œâ”€â”€ coverage/                 # æµ‹è¯•è¦†ç›–ç‡ (è¿è¡Œæ—¶ç”Ÿæˆ)
â”œâ”€â”€ temp/                     # ä¸´æ—¶æ–‡ä»¶ (è¿è¡Œæ—¶ç”Ÿæˆ)
â”œâ”€â”€ package.json             # é¡¹ç›®ä¾èµ–å’Œè„šæœ¬
â”œâ”€â”€ jest.config.js           # Jestæµ‹è¯•é…ç½®
â”œâ”€â”€ jest.setup.js            # Jestç¯å¢ƒè®¾ç½®
â””â”€â”€ README.md                # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚
- Node.js >= 18.0.0
- npm >= 8.0.0
- MySQL >= 8.0 (ç”¨äºæ•°æ®åº“æµ‹è¯•)

### 2. å®‰è£…ä¾èµ–
```bash
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡
åˆ›å»º `.env` æ–‡ä»¶æˆ–è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
# APIé…ç½®
API_BASE_URL=http://localhost:3000
API_TIMEOUT=30000

# æ•°æ®åº“é…ç½®
TEST_DATABASE_URL=mysql://username:password@localhost:3306/database_name

# æµ‹è¯•é…ç½®
TEST_ENVIRONMENT=test
LOG_LEVEL=info
```

### 4. è¿è¡Œæµ‹è¯•

#### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
npm test
```

#### è¿è¡Œç‰¹å®šç±»å‹æµ‹è¯•
```bash
# å•å…ƒæµ‹è¯•
npm run test:unit

# é›†æˆæµ‹è¯•
npm run test:integration

# ç«¯åˆ°ç«¯æµ‹è¯•
npm run test:e2e
```

#### ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
```bash
npm run test:coverage
```

#### å¿«é€Ÿæµ‹è¯• (è·³è¿‡æ•°æ®è®¾ç½®å’Œæ¸…ç†)
```bash
npm run test:quick
```

## ğŸ“– è¯¦ç»†ä½¿ç”¨è¯´æ˜

### æµ‹è¯•é…ç½®

ç¼–è¾‘ `config/test-config.js` æ¥è‡ªå®šä¹‰æµ‹è¯•ç¯å¢ƒï¼š

```javascript
module.exports = {
  // APIé…ç½®
  api: {
    baseUrl: 'http://localhost:3000',
    timeout: 30000
  },

  // æµ‹è¯•ç”¨æˆ·
  users: {
    admin: {
      email: 'admin@test.com',
      password: 'admin123'
    },
    parent1: {
      email: 'parent1@test.com',
      password: 'parent123'
    }
  },

  // è¥é”€æµ‹è¯•åœºæ™¯
  scenarios: {
    groupBuy: {
      minParticipants: 5,
      maxParticipants: 20
    },
    collectActivity: {
      targetCount: 20,
      rewardType: 'discount'
    }
  }
};
```

### æµ‹è¯•æ•°æ®ç®¡ç†

#### è®¾ç½®æµ‹è¯•æ•°æ®
```bash
node scripts/setup.js
```

#### æ¸…ç†æµ‹è¯•æ•°æ®
```bash
node scripts/cleanup.js          # æ ‡å‡†æ¸…ç†
node scripts/cleanup.js --full   # å®Œæ•´æ¸…ç†
node scripts/cleanup.js --quick  # å¿«é€Ÿæ¸…ç†
```

### è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
```bash
# è¿è¡Œç‰¹å®šçš„å•å…ƒæµ‹è¯•
npx jest unit/group-buy.test.js --verbose

# è¿è¡Œç‰¹å®šçš„é›†æˆæµ‹è¯•
npx jest integration/marketing-workflow.test.js --verbose

# è¿è¡Œç‰¹å®šçš„ç«¯åˆ°ç«¯æµ‹è¯•
npx jest e2e/full-user-journey.test.js --verbose --timeout=60000
```

### æµ‹è¯•è¿è¡Œå™¨é€‰é¡¹
```bash
# ä½¿ç”¨æµ‹è¯•è¿è¡Œå™¨
node utils/test-runner.js                    # è¿è¡Œå®Œæ•´å¥—ä»¶
node utils/test-runner.js --unit-only       # ä»…å•å…ƒæµ‹è¯•
node utils/test-runner.js --skip-cleanup    # è·³è¿‡æ¸…ç†
node utils/test-runner.js --skip-setup      # è·³è¿‡æ•°æ®è®¾ç½®
```

## ğŸ§ª æµ‹è¯•è¯¦è§£

### å•å…ƒæµ‹è¯•

å•å…ƒæµ‹è¯•é’ˆå¯¹å„ä¸ªåŠŸèƒ½æ¨¡å—è¿›è¡Œç‹¬ç«‹æµ‹è¯•ï¼š

#### å›¢è´­åŠŸèƒ½æµ‹è¯•
- å›¢è´­åˆ›å»ºå’ŒéªŒè¯
- å‚ä¸è€…ç®¡ç†å’ŒçŠ¶æ€æ›´æ–°
- å›¢è´­æˆåŠŸ/å¤±è´¥æ¡ä»¶
- å¹¶å‘å‚ä¸å’Œè¾¹ç•Œæ¡ä»¶

#### ç§¯æ”’æ´»åŠ¨æµ‹è¯•
- ç§¯æ”’ç ç”Ÿæˆå’Œç®¡ç†
- åŠ©åŠ›åŠŸèƒ½å’Œé˜²ä½œå¼Š
- è¿›åº¦è®¡ç®—å’Œå®Œæˆæ¡ä»¶
- å¥–åŠ±å‘æ”¾å’Œä½¿ç”¨

#### é˜¶æ¢¯å¥–åŠ±æµ‹è¯•
- å¤šå±‚çº§å¥–åŠ±åˆ›å»º
- è·å¥–è®°å½•ç®¡ç†
- å¥–åŠ±ä½¿ç”¨å’Œè¿‡æœŸå¤„ç†
- ç»Ÿè®¡æ•°æ®å’ŒæŠ¥å‘Š

#### æ”¯ä»˜åŠŸèƒ½æµ‹è¯•
- è®¢å•åˆ›å»ºå’Œç®¡ç†
- æ”¯ä»˜æ–¹å¼å¤„ç†
- æ”¯ä»˜ç¡®è®¤å’Œå›è°ƒ
- é€€æ¬¾å’Œå–æ¶ˆæµç¨‹

### é›†æˆæµ‹è¯•

é›†æˆæµ‹è¯•éªŒè¯è·¨æ¨¡å—çš„ä¸šåŠ¡æµç¨‹ï¼š

- æ´»åŠ¨åˆ›å»º â†’ å›¢è´­è®¾ç½® â†’ ç”¨æˆ·å‚ä¸ â†’ æ”¯ä»˜ç¡®è®¤ â†’ å¥–åŠ±å‘æ”¾
- ç§¯æ”’æ´»åŠ¨åˆ›å»º â†’ åŠ©åŠ›åˆ†äº« â†’ ç›®æ ‡è¾¾æˆ â†’ å¥–åŠ±é¢†å–
- è¥é”€æ´»åŠ¨å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†

### ç«¯åˆ°ç«¯æµ‹è¯•

ä½¿ç”¨Playwrightè¿›è¡Œæµè§ˆå™¨è‡ªåŠ¨åŒ–æµ‹è¯•ï¼š

- ç”¨æˆ·ç™»å½•å’Œæƒé™éªŒè¯
- æ´»åŠ¨æµè§ˆå’Œå‚ä¸æµç¨‹
- æ”¯ä»˜å’Œè®¢å•ç®¡ç†
- å¥–åŠ±æŸ¥çœ‹å’Œä½¿ç”¨
- ä¸åŒè®¾å¤‡å’Œå±å¹•å°ºå¯¸é€‚é…

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### è¦†ç›–ç‡æŠ¥å‘Š
æµ‹è¯•å®Œæˆåï¼Œè¦†ç›–ç‡æŠ¥å‘Šä¼šç”Ÿæˆåœ¨ `coverage/` ç›®å½•ä¸‹ï¼š
- `coverage/unit/` - å•å…ƒæµ‹è¯•è¦†ç›–ç‡
- `coverage/integration/` - é›†æˆæµ‹è¯•è¦†ç›–ç‡
- `coverage/lcov-report/` - HTMLæ ¼å¼æŠ¥å‘Š

### æµ‹è¯•æŠ¥å‘Š
è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šä¼šç”Ÿæˆåœ¨ `reports/` ç›®å½•ä¸‹ï¼š
- `test-report.json` - è¯¦ç»†çš„JSONæ ¼å¼æŠ¥å‘Š
- åŒ…å«æµ‹è¯•ç»“æœã€æ€§èƒ½æ•°æ®ã€é”™è¯¯ä¿¡æ¯ç­‰

### æŸ¥çœ‹æŠ¥å‘Š
```bash
# æ‰“å¼€HTMLè¦†ç›–ç‡æŠ¥å‘Š
open coverage/lcov-report/index.html

# æŸ¥çœ‹æµ‹è¯•æ‘˜è¦
cat reports/test-report.json | jq '.summary'
```

## ğŸ”§ è‡ªå®šä¹‰æµ‹è¯•

### æ·»åŠ æ–°æµ‹è¯•

1. **åˆ›å»ºæµ‹è¯•æ–‡ä»¶**
   ```bash
   # å•å…ƒæµ‹è¯•
   touch unit/new-feature.test.js

   # é›†æˆæµ‹è¯•
   touch integration/new-workflow.test.js

   # ç«¯åˆ°ç«¯æµ‹è¯•
   touch e2e/new-journey.test.js
   ```

2. **ç¼–å†™æµ‹è¯•ä»£ç **
   ```javascript
   const { ApiClient, TestHelpers } = require('../utils');

   describe('æ–°åŠŸèƒ½æµ‹è¯•', () => {
     let apiClient;
     let testData;

     beforeAll(async () => {
       apiClient = new ApiClient();
       testData = await TestHelpers.createBaseTestData(apiClient);
     });

     test('åº”è¯¥æ­£ç¡®æ‰§è¡Œæ–°åŠŸèƒ½', async () => {
       const response = await apiClient.newFeatureCall();
       TestHelpers.validateApiResponse(response);
       expect(response.success).toBe(true);
     });
   });
   ```

3. **æ›´æ–°é…ç½®**
   - åœ¨ `test-config.js` ä¸­æ·»åŠ æ–°çš„æµ‹è¯•æ•°æ®
   - æ›´æ–° `package.json` ä¸­çš„æµ‹è¯•è„šæœ¬ï¼ˆå¦‚éœ€è¦ï¼‰

### è‡ªå®šä¹‰æ–­è¨€

åœ¨ `utils/test-helpers.js` ä¸­æ·»åŠ è‡ªå®šä¹‰éªŒè¯å‡½æ•°ï¼š

```javascript
module.exports = {
  // ç°æœ‰å‡½æ•°...

  validateNewFeature(response, expectedFields) {
    TestHelpers.validateApiResponse(response, expectedFields);
    // æ·»åŠ ç‰¹å®šéªŒè¯é€»è¾‘
  }
};
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æµ‹è¯•ç¯å¢ƒé—®é¢˜
```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬
node --version  # åº”è¯¥ >= 18.0.0

# é‡æ–°å®‰è£…ä¾èµ–
rm -rf node_modules package-lock.json
npm install
```

#### 2. æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -u username -p database_name

# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo $TEST_DATABASE_URL
```

#### 3. APIè¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥APIæœåŠ¡çŠ¶æ€
curl http://localhost:3000/api/health

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :3000
```

#### 4. æµ‹è¯•è¶…æ—¶é—®é¢˜
```bash
# å¢åŠ æµ‹è¯•è¶…æ—¶æ—¶é—´
npx jest --testTimeout=10000

# è°ƒæ•´ç‰¹å®šæµ‹è¯•çš„è¶…æ—¶
test('é•¿æ—¶é—´è¿è¡Œæµ‹è¯•', async () => {
  // æµ‹è¯•ä»£ç 
}, 30000); // 30ç§’è¶…æ—¶
```

### è°ƒè¯•æµ‹è¯•

#### è°ƒè¯•æ¨¡å¼
```bash
# ä½¿ç”¨Node.jsè°ƒè¯•å™¨
node --inspect-brk node_modules/.bin/jest --runInBand

# VSCodeè°ƒè¯•é…ç½®
{
  "type": "node",
  "request": "launch",
  "name": "Jest Tests",
  "program": "${workspaceFolder}/node_modules/.bin/jest",
  "args": ["--runInBand"],
  "console": "integratedTerminal",
  "internalConsoleOptions": "neverOpen"
}
```

#### æ—¥å¿—è¾“å‡º
```bash
# è¯¦ç»†è¾“å‡º
npm test -- --verbose

# åªæ˜¾ç¤ºå¤±è´¥æµ‹è¯•çš„è¯¦ç»†ä¿¡æ¯
npm test -- --verbose=false
```

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

### é¢„æœŸæ€§èƒ½æŒ‡æ ‡
- **APIå“åº”æ—¶é—´**: < 2000ms
- **æ•°æ®åº“æŸ¥è¯¢**: < 500ms
- **é¡µé¢åŠ è½½**: < 5000ms
- **å¹¶å‘å¤„ç†**: 100+ è¯·æ±‚/ç§’

### æ€§èƒ½æµ‹è¯•
```bash
# è¿è¡Œæ€§èƒ½æµ‹è¯•
npm run test:performance

# ç›‘æ§èµ„æºä½¿ç”¨
npm run test:monitor
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

### æäº¤æµ‹è¯•ä»£ç 
1. éµå¾ªç°æœ‰çš„æµ‹è¯•ç»“æ„å’Œå‘½åè§„èŒƒ
2. ç¡®ä¿æµ‹è¯•è¦†ç›–ç‡å’Œè´¨é‡
3. æ·»åŠ å¿…è¦çš„æ–‡æ¡£å’Œæ³¨é‡Š
4. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿é€šè¿‡

### ä»£ç è§„èŒƒ
- ä½¿ç”¨ESLintå’ŒPrettieræ ¼å¼åŒ–ä»£ç 
- éµå¾ªJestæœ€ä½³å®è·µ
- ç¼–å†™æ¸…æ™°çš„æµ‹è¯•æè¿°å’Œæ–­è¨€æ¶ˆæ¯

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](../LICENSE) æ–‡ä»¶ã€‚

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥ç°æœ‰çš„GitHub Issues
3. åˆ›å»ºæ–°çš„Issueå¹¶è¯¦ç»†æè¿°é—®é¢˜

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æµ‹è¯•å¥—ä»¶ï¼Œå¯ä»¥ç‹¬ç«‹äºä¸»é¡¹ç›®è¿è¡Œã€‚è¯·ç¡®ä¿åœ¨è¿è¡Œæµ‹è¯•å‰ï¼Œç›¸å…³çš„APIæœåŠ¡å’Œæ•°æ®åº“éƒ½å·²æ­£ç¡®é…ç½®å’Œå¯åŠ¨ã€‚