# 百度AI人脸识别开通配置完整指南

> **适用场景：** 幼儿园相册照片智能识别  
> **预计时间：** 15-20分钟  
> **费用：** 个人认证免费，每月50,000次免费调用

---

## 📋 开通流程总览

```
第1步：注册百度账号（3分钟）
   ↓
第2步：实名认证（5分钟）
   ↓
第3步：创建应用（3分钟）
   ↓
第4步：获取API密钥（2分钟）
   ↓
第5步：配置到项目（2分钟）
   ↓
第6步：测试验证（5分钟）
```

**总耗时：约20分钟**

---

## 🎯 第1步：注册百度账号

### 1.1 访问百度AI开放平台

**直达链接：** https://ai.baidu.com/

或者百度搜索：**百度AI开放平台**

### 1.2 点击右上角【登录/注册】

页面右上角会显示：
```
┌─────────────────────────────────────┐
│  [登录] / [注册]                     │
└─────────────────────────────────────┘
```

### 1.3 注册方式选择（推荐已有百度账号）

```
┌─────────────────────────────────────────┐
│  注册方式选择                            │
├─────────────────────────────────────────┤
│  方式1：已有百度账号 ⭐推荐              │
│    - 如果有百度网盘、贴吧账号，直接登录  │
│    - 自动关联，无需重新注册              │
│                                          │
│  方式2：手机号注册                       │
│    - 输入手机号                          │
│    - 接收验证码                          │
│    - 设置密码                            │
│                                          │
│  方式3：邮箱注册                         │
│    - 输入邮箱                            │
│    - 接收验证码                          │
│    - 设置密码                            │
│                                          │
│  方式4：微信/QQ快捷登录                  │
│    - 扫码授权                            │
│    - 自动创建账号                        │
└─────────────────────────────────────────┘
```

### 1.4 手机号注册详细步骤（如果没有百度账号）

**步骤1：** 点击【注册】

**步骤2：** 填写信息
```
┌────────────────────────────────────┐
│  手机号：[13812345678]             │
│                                     │
│  [获取验证码]                       │
│  验证码：[______]                   │
│                                     │
│  密码：[**********]                 │
│  （8-20位，含字母+数字）            │
│                                     │
│  ☑️ 我已阅读并同意《百度用户协议》 │
│                                     │
│  [立即注册]                         │
└────────────────────────────────────┘
```

**步骤3：** 点击【获取验证码】

**步骤4：** 输入手机收到的6位验证码

**步骤5：** 设置密码（建议：字母+数字+符号，如 `Baidu@2025`）

**步骤6：** 勾选协议，点击【立即注册】

✅ **注册成功！自动登录**

**⏱️ 耗时：约3分钟**

---

## 🆔 第2步：实名认证（必须！）

### 2.1 为什么需要实名认证？

⚠️ **不实名无法创建应用！** 实名后才能：
- ✅ 创建人脸识别应用
- ✅ 获取API密钥
- ✅ 调用人脸识别接口
- ✅ 领取免费额度

### 2.2 进入实名认证页面

**方式1：注册后自动弹窗**
```
注册成功后，会自动提示：
┌────────────────────────────────────┐
│  您还未实名认证                     │
│  实名后可创建应用，调用API          │
│                                     │
│  [立即认证] [稍后再说]              │
└────────────────────────────────────┘

点击【立即认证】
```

**方式2：从控制台进入**
```
登录后 → 右上角头像 → 账号中心 → 实名认证
```

**方式3：直达链接**
https://ai.baidu.com/tech/face/update

### 2.3 选择认证类型

```
┌─────────────────────────────────────────────┐
│  个人认证（推荐，5分钟搞定）⭐               │
├─────────────────────────────────────────────┤
│  需要准备：                                  │
│  ✓ 身份证（正反面照片）                     │
│  ✓ 手机号（接收验证码）                     │
│                                              │
│  认证流程：                                  │
│  1. 填写真实姓名和身份证号                  │
│  2. 上传身份证正面照                        │
│  3. 上传身份证反面照                        │
│  4. 手机验证码验证                          │
│  5. 等待审核（1-5分钟）✅                   │
│                                              │
│  免费额度：                                  │
│  ✅ 人脸检测：50,000次/月                   │
│  ✅ 人脸搜索：50,000次/月                   │
│  ✅ 人脸注册：50,000次/月                   │
└─────────────────────────────────────────────┘

┌─────────────────────────────────────────────┐
│  企业认证（可选，需营业执照）                │
├─────────────────────────────────────────────┤
│  需要准备：                                  │
│  ✓ 营业执照扫描件                           │
│  ✓ 企业对公账户                             │
│  ✓ 法人身份证                               │
│                                              │
│  优势：                                      │
│  ✓ 更高配额（200,000次/月）                 │
│  ✓ QPS更高（10次/秒 vs 2次/秒）             │
│  ✓ 可开发票                                 │
│                                              │
│  认证流程：                                  │
│  1. 上传营业执照                            │
│  2. 填写企业信息                            │
│  3. 对公打款验证（1-3天）                   │
│  4. 人工审核（1-3天）                       │
└─────────────────────────────────────────────┘
```

### 2.4 个人认证详细步骤

**步骤1：** 选择「个人认证」

**步骤2：** 填写基本信息
```
┌────────────────────────────────────┐
│  真实姓名：[张三]                   │
│  （必须与身份证一致）               │
│                                     │
│  证件类型：[居民身份证 ▼]          │
│                                     │
│  证件号码：[110101199001011234]     │
│                                     │
│  手机号码：[13812345678]            │
│  （用于接收审核结果）               │
└────────────────────────────────────┘
```

**步骤3：** 上传身份证照片
```
点击「上传身份证正面」
→ 选择照片（拍照或相册）
→ 确认上传

点击「上传身份证反面」
→ 选择照片
→ 确认上传

⚠️ 照片要求：
- 格式：JPG、PNG、BMP
- 大小：< 4MB
- 清晰度：能看清所有文字
- 完整性：四角完整，无遮挡
- 光线：无反光、无阴影
```

**步骤4：** 手机验证
```
点击【获取验证码】
→ 手机收到6位验证码
→ 输入验证码
→ 点击【提交认证】
```

**步骤5：** 等待审核
```
审核时间：
  个人认证：1-5分钟（工作时间）
  企业认证：1-3个工作日

审核结果通知：
  ✅ 短信通知
  ✅ 站内信
  ✅ 邮件通知

审核通过后，页面显示：
┌────────────────────────────────────┐
│  ✅ 认证成功！                      │
│  您已完成个人实名认证               │
│  现在可以创建应用了                 │
│                                     │
│  [立即创建应用]                     │
└────────────────────────────────────┘
```

**✅ 实名认证完成！**

**⏱️ 耗时：约5-10分钟**

---

## 📱 第3步：创建应用

### 3.1 进入人脸识别控制台

**方式1：认证成功后直接点击**
- 点击【立即创建应用】

**方式2：从控制台进入**
- 登录 https://ai.baidu.com/
- 点击【控制台】
- 左侧菜单 → 人脸识别

**方式3：直达链接**
https://console.bce.baidu.com/ai/#/ai/face/overview/index

### 3.2 点击【创建应用】

进入人脸识别控制台后：

```
┌────────────────────────────────────────┐
│  人脸识别应用列表                       │
├────────────────────────────────────────┤
│  暂无应用                               │
│                                         │
│  [+ 创建应用]                           │
└────────────────────────────────────────┘
```

点击【创建应用】按钮

### 3.3 填写应用信息

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  📝 应用配置（重要！）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 应用名称
   ┌────────────────────────────────────┐
   │ kyyup-kindergarten-face ⭐推荐      │
   │                                     │
   │ 规则：                              │
   │ - 2-50个字符                        │
   │ - 支持中文、字母、数字、下划线      │
   │ - 便于识别管理                      │
   │                                     │
   │ 其他建议：                          │
   │ - 智慧幼儿园相册                    │
   │ - kyyup-photo-recognition           │
   │ - 幼儿园人脸识别系统                │
   └────────────────────────────────────┘

2. 应用类型
   ┌────────────────────────────────────┐
   │ ◉ 人脸识别 ⭐必选                   │
   │ ○ 人脸对比                          │
   │ ○ 人脸活体检测                      │
   │                                     │
   │ 说明：我们需要的是「人脸识别」      │
   └────────────────────────────────────┘

3. 接口选择（重要！）
   ┌────────────────────────────────────┐
   │ ☑️ 人脸检测 ⭐必选                  │
   │   （检测照片中是否有人脸）          │
   │                                     │
   │ ☑️ 人脸搜索 ⭐必选                  │
   │   （在人脸库中搜索匹配的人）        │
   │                                     │
   │ ☑️ 人脸注册 ⭐必选                  │
   │   （将学生照片注册到人脸库）        │
   │                                     │
   │ ☑️ 人脸更新 ⭐必选                  │
   │   （更新学生照片）                  │
   │                                     │
   │ ☑️ 人脸删除 ⭐必选                  │
   │   （删除毕业学生）                  │
   │                                     │
   │ ☐ 人脸对比（可选，不需要）          │
   │ ☐ 活体检测（可选，不需要）          │
   └────────────────────────────────────┘

4. 应用归属
   ┌────────────────────────────────────┐
   │ ◉ 个人 ⭐推荐（个人认证选这个）     │
   │ ○ 企业（企业认证选这个）            │
   └────────────────────────────────────┘

5. 应用描述（可选）
   ┌────────────────────────────────────┐
   │ 智慧幼儿园相册系统，自动识别照片中  │
   │ 的学生并分发到对应家长相册          │
   └────────────────────────────────────┘

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### 3.4 确认创建

```
确认配置信息：
┌────────────────────────────────────┐
│ 应用名称：kyyup-kindergarten-face   │
│ 应用类型：人脸识别                  │
│ 接口权限：                          │
│   ✓ 人脸检测                        │
│   ✓ 人脸搜索                        │
│   ✓ 人脸注册                        │
│   ✓ 人脸更新                        │
│   ✓ 人脸删除                        │
│ 应用归属：个人                      │
└────────────────────────────────────┘

点击【立即创建】
```

### 3.5 创建成功

```
┌──────────────────────────────────────┐
│  ✅ 应用创建成功！                    │
│                                       │
│  应用名称：kyyup-kindergarten-face    │
│  创建时间：2025-11-04 15:30:00       │
│  状态：正常                           │
│                                       │
│  [查看密钥] [管理应用]                │
└──────────────────────────────────────┘
```

✅ **应用创建完成！**

**⏱️ 耗时：约3分钟**

---

## 🔑 第4步：获取API密钥

### 4.1 什么是API密钥？

```
API密钥 = 访问凭证（账号密码）

包含两部分：
├─ API Key：类似用户名（可公开）
└─ Secret Key：类似密码（必须保密！）

用途：
- 后端程序通过API Key访问百度AI
- 人脸检测/搜索/注册都需要
```

### 4.2 查看API密钥

**方式1：创建应用后立即查看**
- 创建成功后，点击【查看密钥】

**方式2：从应用列表查看**
```
人脸识别控制台 
→ 应用列表 
→ 找到 kyyup-kindergarten-face
→ 点击【管理】
→ 查看「API Key」和「Secret Key」
```

**方式3：直达链接**
https://console.bce.baidu.com/ai/#/ai/face/app/list

### 4.3 密钥信息展示

创建成功后，会显示：

```
┌──────────────────────────────────────────┐
│  应用详情 - kyyup-kindergarten-face       │
├──────────────────────────────────────────┤
│  App ID：                                 │
│  12345678                                 │
│  [复制]                                   │
│                                           │
│  API Key：                                │
│  aBcDeFgHiJkLmNoPqRsTuVwXyZ123456        │
│  [复制] [显示]                            │
│                                           │
│  Secret Key：                             │
│  XyZ987654321aBcDeFgHiJkLmNoPqRsT        │
│  [复制] [显示]                            │
│                                           │
│  创建时间：2025-11-04 15:30:00           │
│  状态：正常                               │
│  每日调用量：0 / 50,000 ⭐               │
└──────────────────────────────────────────┘
```

### 4.4 保存密钥（重要！）

**重要操作：**
```
1. ✅ 点击 API Key 旁的【复制】
   → 粘贴到记事本

2. ✅ 点击 Secret Key 旁的【复制】
   → 粘贴到记事本

3. ✅ 保存到安全的地方
   - 密码管理器（推荐）
   - 本地加密文件
   - 私密笔记

4. ❌ 不要做：
   - 提交到Git
   - 分享给他人
   - 硬编码到前端
   - 公开发布
```

**示例保存格式：**
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  百度AI人脸识别 - API密钥
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

应用名称：kyyup-kindergarten-face
创建时间：2025-11-04

App ID：12345678
API Key：aBcDeFgHiJkLmNoPqRsTuVwXyZ123456
Secret Key：XyZ987654321aBcDeFgHiJkLmNoPqRsT

免费额度：50,000次/月
QPS限制：2次/秒（个人）

⚠️ 此文件包含敏感信息，请妥善保管！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

✅ **API密钥获取完成！**

**⏱️ 耗时：约2分钟**

---

## ⚙️ 第5步：配置到项目

### 5.1 找到.env文件

```bash
cd /home/zhgue/kyyupgame/k.yyup.com/server
ls -la .env
```

如果文件不存在，创建：
```bash
cp .env.example .env
```

### 5.2 添加百度AI配置

用文本编辑器打开`.env`，添加以下内容：

```bash
# ==================== 百度AI配置 ====================
# 百度AI人脸识别（从第4步获取）
BAIDU_FACE_API_KEY=aBcDeFgHiJkLmNoPqRsTuVwXyZ123456
BAIDU_FACE_SECRET_KEY=XyZ987654321aBcDeFgHiJkLmNoPqRsT

# 人脸库组ID（可自定义）
BAIDU_FACE_GROUP_ID=kyyup_kindergarten_students

# QPS限制（个人2，企业10）
BAIDU_FACE_QPS_LIMIT=2
```

### 5.3 完整的.env配置示例

```bash
# ==================== 数据库配置 ====================
DB_HOST=dbconn.sealoshzh.site
DB_PORT=43906
DB_USER=root
DB_PASSWORD=pwk5ls7j
DB_NAME=kargerdensales

# ==================== OSS配置（阿里云）====================
OSS_ACCESS_KEY_ID=LTAI5tFkG3mE8uX7RhNp2vQs
OSS_ACCESS_KEY_SECRET=3KxxxYYY7HHH8MMM9NNN5PPP6QQQ
OSS_BUCKET=kyyup-photos
OSS_REGION=oss-cn-beijing
OSS_ENDPOINT=oss-cn-beijing.aliyuncs.com
OSS_PATH_PREFIX=kindergarten/

# ==================== 百度AI配置 ====================
# ✅ 第4步获取的API密钥
BAIDU_FACE_API_KEY=aBcDeFgHiJkLmNoPqRsTuVwXyZ123456
BAIDU_FACE_SECRET_KEY=XyZ987654321aBcDeFgHiJkLmNoPqRsT

# 人脸库组ID
BAIDU_FACE_GROUP_ID=kyyup_kindergarten_students

# QPS限制（个人2次/秒，企业10次/秒）
BAIDU_FACE_QPS_LIMIT=2
```

### 5.4 保存配置

```bash
# 保存.env文件（Ctrl+S）

# 验证配置是否正确
cat .env | grep BAIDU

# 应该看到：
# BAIDU_FACE_API_KEY=aBcDeFgHiJkLmNoPqRsTuVwXyZ123456
# BAIDU_FACE_SECRET_KEY=XyZ987654321aBcDeFgHiJkLmNoPqRsT
# BAIDU_FACE_GROUP_ID=kyyup_kindergarten_students
# BAIDU_FACE_QPS_LIMIT=2
```

### 5.5 检查.gitignore（重要！）

```bash
# 确保.env不会被提交到Git
cat .gitignore | grep .env

# 如果没有，添加：
echo ".env" >> .gitignore
```

**⏱️ 耗时：约2分钟**

---

## ✅ 第6步：测试验证

### 6.1 重启后端服务

```bash
cd /home/zhgue/kyyupgame/k.yyup.com/server

# 杀死旧进程
pkill -f "tsx.*app.ts"

# 启动新进程
npm run dev > /tmp/backend-baidu-test.log 2>&1 &

# 等待5秒
sleep 5

# 查看启动日志，确认百度AI初始化成功
tail -50 /tmp/backend-baidu-test.log | grep -E "百度|Baidu|BAIDU|face"
```

应该看到：
```
✅ 百度AI服务已初始化
✅ 人脸库组ID: kyyup_kindergarten_students
```

### 6.2 测试人脸检测（在线工具）

**方式1：使用百度在线调试工具** ⭐推荐

访问：https://ai.baidu.com/ai-doc/FACE/yk37c1u4t

```
步骤：
1. 点击【在线调试】
2. 选择「人脸检测」
3. 上传一张学生照片（或使用示例图片）
4. 输入您的 API Key 和 Secret Key
5. 点击【发送请求】
6. 查看返回结果：
   ✅ 成功：显示人脸位置、年龄、性别等
   ❌ 失败：检查密钥是否正确
```

**方式2：使用curl命令测试**

```bash
# 创建测试脚本
cat > /tmp/test-baidu-face.sh << 'EOF'
#!/bin/bash

# 配置（替换为您的真实密钥）
API_KEY="aBcDeFgHiJkLmNoPqRsTuVwXyZ123456"
SECRET_KEY="XyZ987654321aBcDeFgHiJkLmNoPqRsT"

# 获取Access Token
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "步骤1：获取Access Token"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

ACCESS_TOKEN=$(curl -s -X POST \
  "https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id=${API_KEY}&client_secret=${SECRET_KEY}" \
  | grep -o '"access_token":"[^"]*"' \
  | sed 's/"access_token":"\(.*\)"/\1/')

if [ -z "$ACCESS_TOKEN" ]; then
  echo "❌ 获取Access Token失败！"
  echo "请检查API Key和Secret Key是否正确"
  exit 1
fi

echo "✅ Access Token获取成功！"
echo "Token: ${ACCESS_TOKEN:0:20}..."
echo ""

# 测试人脸检测
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "步骤2：测试人脸检测"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

# 使用百度提供的示例图片URL
IMAGE_URL="https://ai.bdstatic.com/file/4D9F3CD6A1F54D9DAF8B5C5DFB0F4A4A"

RESPONSE=$(curl -s -X POST \
  "https://aip.baidubce.com/rest/2.0/face/v3/detect?access_token=${ACCESS_TOKEN}" \
  -H 'Content-Type: application/json' \
  -d "{
    \"image\": \"${IMAGE_URL}\",
    \"image_type\": \"URL\",
    \"face_field\": \"age,gender,beauty,expression\"
  }")

echo "$RESPONSE" | python3 -m json.tool

# 检查结果
if echo "$RESPONSE" | grep -q '"error_code":0'; then
  echo ""
  echo "✅ 人脸检测成功！"
  echo "百度AI配置正确，可以正常使用！"
else
  echo ""
  echo "❌ 人脸检测失败！"
  echo "错误信息："
  echo "$RESPONSE"
fi

EOF

chmod +x /tmp/test-baidu-face.sh
```

运行测试：
```bash
# 编辑脚本，替换为您的真实密钥
nano /tmp/test-baidu-face.sh

# 运行测试
/tmp/test-baidu-face.sh
```

成功的输出示例：
```json
{
  "error_code": 0,
  "error_msg": "SUCCESS",
  "log_id": 1234567890,
  "timestamp": 1699123456,
  "cached": 0,
  "result": {
    "face_num": 1,
    "face_list": [
      {
        "face_token": "abc123...",
        "location": {
          "left": 100,
          "top": 50,
          "width": 200,
          "height": 200,
          "rotation": 0
        },
        "age": 5.5,
        "gender": {
          "type": "male",
          "probability": 0.98
        },
        "expression": {
          "type": "smile",
          "probability": 0.95
        }
      }
    ]
  }
}

✅ 人脸检测成功！
百度AI配置正确，可以正常使用！
```

### 6.3 测试项目集成

**步骤1：** 检查后端服务状态
```bash
tail -f /tmp/backend-baidu-test.log
```

**步骤2：** 测试创建人脸库（可选）
```bash
# 我们的代码会自动创建，也可以手动测试
curl -X POST http://localhost:3000/api/photos/face-group \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**步骤3：** 查看百度控制台
```
访问：https://console.bce.baidu.com/ai/#/ai/face/overview/index
→ 点击「人脸库管理」
→ 应该能看到：kyyup_kindergarten_students（如果已创建）
```

**⏱️ 耗时：约5分钟**

---

## 📊 查看使用量和配额

### 7.1 查看调用量

**访问控制台：**
https://console.bce.baidu.com/ai/#/ai/face/overview/index

```
控制台首页会显示：
┌────────────────────────────────────┐
│  今日调用量                         │
│  ────────────────────────────────  │
│  人脸检测：125 / 50,000            │
│  人脸搜索：68 / 50,000             │
│  人脸注册：12 / 50,000             │
│                                     │
│  剩余免费额度：49,795次            │
└────────────────────────────────────┘
```

### 7.2 查看历史调用记录

```
控制台 → 统计分析 → 调用统计

可以查看：
- 每日调用量趋势图
- 接口调用分布
- 成功率统计
- 错误码分析
```

### 7.3 设置用量预警

```
控制台 → 应用管理 → kyyup-kindergarten-face → 设置

配置预警：
┌────────────────────────────────────┐
│ 日调用量预警：                      │
│ 当调用量达到 [40000] 次时          │
│ 发送短信/邮件通知                   │
│                                     │
│ ☑️ 短信通知                         │
│ ☑️ 邮件通知                         │
│ ☐ 站内信                            │
└────────────────────────────────────┘
```

---

## 💰 费用说明

### 8.1 免费额度（个人认证）

```
┌──────────────┬────────────┬────────────┐
│  接口名称    │ 免费额度   │ 超出价格   │
├──────────────┼────────────┼────────────┤
│ 人脸检测     │ 50,000次/月│ 0.001元/次 │
│ 人脸搜索     │ 50,000次/月│ 0.003元/次 │
│ 人脸注册     │ 50,000次/月│ 0.003元/次 │
│ 人脸对比     │ 50,000次/月│ 0.001元/次 │
│ 人脸更新     │ 50,000次/月│ 0.003元/次 │
│ 人脸删除     │ 50,000次/月│ 免费       │
└──────────────┴────────────┴────────────┘

🎁 新用户福利：
  首年赠送100万次调用（仅限企业认证）
```

### 8.2 实际使用量估算

```
500学生幼儿园，每月使用场景：

教师上传照片：
  - 每月1500张照片
  - 人脸检测：1500次
  - 人脸搜索：4500次（平均3个孩子/张）
  - 人脸注册：50次（新生入学）
  ─────────────────────────────────────
  月调用量：6050次

家长更换头像：
  - 人脸更新：约100次/月
  - 人脸删除：约10次/月（毕业）
  ─────────────────────────────────────
  月调用量：110次

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  总调用量：约6160次/月
  免费额度：50,000次/月
  剩余额度：43,840次 ✅ 完全够用！
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💰 费用：0元/月（在免费额度内）
```

### 8.3 超出费用计算

```
假设调用量达到60,000次/月（超出10,000次）：

超出部分：
  人脸检测：2000次 × 0.001元 = 2元
  人脸搜索：8000次 × 0.003元 = 24元
  ─────────────────────────────────────
  超出费用：26元/月

💡 实际上，幼儿园场景很难超过免费额度
```

---

## 🔐 安全注意事项

### 1. API密钥安全

```
❌ 不要做：
- 提交到Git仓库
- 分享给他人
- 硬编码到前端代码
- 公开发布到网络
- 存储在数据库中

✅ 应该做：
- 只存储在.env文件中
- .env加入.gitignore
- 使用环境变量
- 定期更换（建议每6个月）
- 使用密码管理器保存备份
```

### 2. 人脸库安全

```
✅ 推荐配置：
- 使用独立的人脸库组（kyyup_kindergarten_students）
- 定期清理毕业学生
- 做好数据备份

❌ 禁止操作：
- 不要将多个幼儿园混在一个组
- 不要使用公共测试组
```

### 3. QPS限制（请求频率）

```
个人认证：2次/秒
企业认证：10次/秒

超出限制会返回：
{
  "error_code": 18,
  "error_msg": "Open api qps request limit reached"
}

我们的代码已实现：
✅ 请求队列
✅ 自动限流
✅ 错误重试
```

---

## 📞 常见问题FAQ

### Q1：API Key和Secret Key忘记了怎么办？

**答：** 可以在控制台重新查看

```
步骤：
1. 登录 https://console.bce.baidu.com/ai/
2. 人脸识别 → 应用列表
3. 找到应用 → 点击【管理】
4. 查看密钥（点击【显示】）
5. 重新复制保存
```

### Q2：创建应用时提示"未实名认证"？

**答：** 必须先完成实名认证

```
解决：
1. 访问 https://ai.baidu.com/tech/face/update
2. 完成个人实名认证
3. 等待审核通过（1-5分钟）
4. 重新创建应用
```

### Q3：人脸检测提示"image format error"？

**答：** 图片格式或大小不符合要求

```
图片要求：
- 格式：JPG、PNG、BMP
- 大小：< 10MB
- 分辨率：最小48×48像素
- Base64编码：不超过10MB

解决：
✅ 使用我们的代码自动压缩
✅ 或手动转换图片格式
```

### Q4：人脸搜索返回"user not found"？

**答：** 学生还未注册到人脸库

```
检查：
1. 学生是否已入学？
2. 是否已上传学生照片？
3. 照片是否已注册到人脸库？

解决：
→ 教师端 → 学生管理 → 上传学生照片
→ 系统会自动注册到人脸库
```

### Q5：调用失败，返回错误码110？

**答：** Access Token过期

```
错误信息：
{
  "error_code": 110,
  "error_msg": "Access token invalid or no longer valid"
}

解决：
✅ 我们的代码会自动刷新Token
✅ 如果持续失败，检查API Key是否正确
```

### Q6：费用突然增加很多？

**答：** 可能被盗用或配置错误

```
紧急处理：
1. 立即登录百度控制台
2. 查看调用统计（是否异常）
3. 检查代码是否有死循环
4. 暂时禁用应用
5. 重置API Key

预防措施：
✅ 设置调用量预警
✅ API Key不要泄露
✅ 定期查看调用记录
✅ 代码中实现错误处理
```

---

## 🎉 开通完成标志

当您完成所有配置后，应该能看到：

### 百度控制台
```
应用列表：
┌────────────────────────────────────┐
│ kyyup-kindergarten-face             │
│ 状态：正常                          │
│ 今日调用：0 / 50,000               │
│ API Key：aBcD...                    │
│ Secret Key：XyZ9...（已隐藏）      │
└────────────────────────────────────┘
```

### 后端日志
```bash
tail -f /tmp/backend-baidu-test.log

显示：
✅ 百度AI服务已初始化
✅ 人脸库组ID: kyyup_kindergarten_students
✅ Access Token获取成功
```

### 在线测试
```
访问：https://ai.baidu.com/ai-doc/FACE/yk37c1u4t
→ 在线调试
→ 输入您的API Key和Secret Key
→ 上传测试图片
→ 发送请求
→ ✅ 返回人脸信息
```

---

## 📋 配置后检查命令

```bash
# 检查.env配置
cd /home/zhgue/kyyupgame/k.yyup.com/server
grep "BAIDU_" .env

# 应该看到：
BAIDU_FACE_API_KEY=aBcDeFgHiJkLmNoPqRsTuVwXyZ123456
BAIDU_FACE_SECRET_KEY=XyZ987654321aBcDeFgHiJkLmNoPqRsT
BAIDU_FACE_GROUP_ID=kyyup_kindergarten_students
BAIDU_FACE_QPS_LIMIT=2

# 检查后端是否识别配置
tail -50 /tmp/backend-baidu-test.log | grep -i baidu

# 应该看到：
✅ 百度AI服务已初始化
```

---

## 🎯 推荐开通顺序

### 最佳方案：分步开通

```
第1天：开通阿里云OSS
  ✅ 注册阿里云账号
  ✅ 实名认证
  ✅ 创建OSS Bucket
  ✅ 配置.env
  ✅ 测试照片上传
  ─────────────────────────────────────
  耗时：30分钟
  状态：可以存储照片，但无法识别

第2天：开通百度AI
  ✅ 注册百度账号
  ✅ 实名认证
  ✅ 创建人脸识别应用
  ✅ 配置.env
  ✅ 测试人脸检测
  ─────────────────────────────────────
  耗时：20分钟
  状态：✅ 完整功能可用！

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
总耗时：50分钟
总费用：105元/年（阿里OSS）+ 0元（百度AI免费）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

## 🔗 所有链接汇总

```
1. 百度AI首页
   https://ai.baidu.com/

2. 注册/登录
   https://ai.baidu.com/

3. 实名认证
   https://ai.baidu.com/tech/face/update

4. 人脸识别控制台
   https://console.bce.baidu.com/ai/#/ai/face/overview/index

5. 应用管理
   https://console.bce.baidu.com/ai/#/ai/face/app/list

6. 在线调试工具
   https://ai.baidu.com/ai-doc/FACE/yk37c1u4t

7. API文档
   https://ai.baidu.com/ai-doc/FACE/yk37c1u4t

8. 技术论坛
   https://ai.baidu.com/forum

9. 常见问题
   https://ai.baidu.com/ai-doc/FACE/Fk37c1rt0

10. 价格说明
    https://ai.baidu.com/ai-doc/FACE/4k37c1u50
```

---

## ✅ 验收标准

完成所有步骤后，应该达到：

```
□ 能登录百度AI控制台
□ 能看到创建的应用
□ .env配置文件已更新
□ 后端启动显示「百度AI服务已初始化」
□ 在线调试工具测试成功
□ curl命令测试返回正确结果
□ 控制台能看到调用统计
```

---

## 🆘 遇到问题怎么办？

1. **查看官方文档：** https://ai.baidu.com/ai-doc/FACE/yk37c1u4t
2. **访问技术论坛：** https://ai.baidu.com/forum
3. **联系在线客服：** 控制台右下角【在线客服】
4. **查看错误码文档：** https://ai.baidu.com/ai-doc/FACE/Fk37c1rt0
5. **告诉我具体错误信息，我来帮您解决！**

---

**开通完成时间：约20分钟**  
**下一步：** 配置完成后告诉我，我帮您一起测试！

---

## 📱 手机App操作（可选）

如果您想用手机管理：

```
1. 下载「百度APP」
   - iOS：App Store搜索「百度」
   - Android：应用商店搜索「百度」

2. 登录账号

3. 功能有限：
   ✅ 查看调用统计
   ✅ 接收预警通知
   ❌ 不能创建应用
   ❌ 不能调试接口

💡 建议：用电脑端操作
```

---

## 🎁 额外福利

### 百度AI其他免费服务（可选）

既然您已经注册了百度AI，还可以免费使用：

```
✅ 图像识别
   - 物体识别：50,000次/月
   - 场景识别：50,000次/月
   
✅ 文字识别OCR
   - 通用文字识别：50,000次/月
   - 身份证识别：500次/月
   
✅ 语音识别
   - 语音转文字：50,000次/月
   
✅ 自然语言处理
   - 情感分析：50,000次/月
   - 关键词提取：50,000次/月

💡 可能用到的场景：
- 识别幼儿园活动海报（图像识别）
- 识别学生证件（OCR）
- 语音评语转文字（语音识别）
```

访问：https://ai.baidu.com/tech

---

**祝您开通顺利！如有问题随时告诉我！** 🎉





