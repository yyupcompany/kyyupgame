# ç”¨æˆ·ç™»å½•åè®¿é—®ç§Ÿæˆ·æ•°æ®åº“çš„å®Œæ•´æœºåˆ¶åˆ†æ

## ğŸ“‹ æ¦‚è¿°

ç»Ÿä¸€è®¤è¯ç³»ç»Ÿé€šè¿‡**ä¸‰å±‚éš”ç¦»æœºåˆ¶**ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®å¯¹åº”ç§Ÿæˆ·çš„æ•°æ®åº“ï¼š
1. **åŸŸåè¯†åˆ«å±‚** - ä»HTTP Hostå¤´è¯†åˆ«ç§Ÿæˆ·
2. **æ•°æ®åº“è¿æ¥å±‚** - ä¸ºæ¯ä¸ªç§Ÿæˆ·å»ºç«‹ç‹¬ç«‹è¿æ¥
3. **TokenéªŒè¯å±‚** - éªŒè¯ç”¨æˆ·èº«ä»½å’Œæƒé™

---

## ğŸ”„ å®Œæ•´çš„ç™»å½•å’Œæ•°æ®è®¿é—®é“¾è·¯

### **ç¬¬ä¸€é˜¶æ®µï¼šç™»å½•è¯·æ±‚å¤„ç†**

#### æ­¥éª¤1ï¸âƒ£ï¼šç§Ÿæˆ·è¯†åˆ«ä¸­é—´ä»¶ï¼ˆtenantResolverMiddlewareï¼‰

```typescript
// æ–‡ä»¶ï¼šk.yyup.com/server/src/middlewares/tenant-resolver.middleware.ts

// 1. ä»HTTP Hostå¤´è·å–åŸŸå
const domain = req.get('Host') || req.hostname;
// ä¾‹å¦‚ï¼šk001.yyup.cc:3000

// 2. æå–ç§Ÿæˆ·ä»£ç 
const tenantCode = extractTenantCode(domain);
// ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼š/^(k\d+)\.yyup\.cc$/
// ç»“æœï¼šk001

// 3. éªŒè¯ç§Ÿæˆ·æ˜¯å¦å­˜åœ¨
const tenantInfo = await validateTenant(tenantCode);

// 4. å»ºç«‹ç§Ÿæˆ·æ•°æ®åº“è¿æ¥
req.tenantDb = await tenantDatabaseService.getTenantConnection(tenantCode);
// è¿æ¥åˆ°ï¼štenant_k001 æ•°æ®åº“

// 5. è®¾ç½®ç§Ÿæˆ·ä¿¡æ¯åˆ°è¯·æ±‚å¯¹è±¡
req.tenant = {
  code: tenantCode,           // k001
  domain: domain,             // k001.yyup.cc
  databaseName: `tenant_${tenantCode}`  // tenant_k001
};
```

**å…³é”®ç‚¹ï¼š**
- âœ… ç§Ÿæˆ·ä»£ç ä»**åŸŸåè‡ªåŠ¨æå–**ï¼Œä¸ä¾èµ–ç”¨æˆ·è¾“å…¥
- âœ… æ¯ä¸ªç§Ÿæˆ·æœ‰**ç‹¬ç«‹çš„æ•°æ®åº“è¿æ¥**
- âœ… è¿æ¥ä¿¡æ¯å­˜å‚¨åœ¨ `req.tenantDb` ä¸­

---

#### æ­¥éª¤2ï¸âƒ£ï¼šç»Ÿä¸€è®¤è¯ä¸­é—´ä»¶ï¼ˆauthenticateWithUnifiedAuthï¼‰

```typescript
// æ–‡ä»¶ï¼šk.yyup.com/server/src/middlewares/auth.middleware.ts

// 1. è°ƒç”¨ç»Ÿä¸€è®¤è¯ç³»ç»ŸéªŒè¯ç”¨æˆ·
const authResult = await adminIntegrationService.authenticateUser(phone, password);
// è°ƒç”¨ï¼šPOST http://localhost:4001/api/auth/login
// è¿”å›ï¼š{ globalUserId, token, user: {...} }

const { user: globalUser, token } = authResult.data;

// 2. ä½¿ç”¨ç§Ÿæˆ·æ•°æ®åº“è¿æ¥æŸ¥è¯¢ç”¨æˆ·
let sequelizeInstance = req.tenantDb;  // ä½¿ç”¨ç§Ÿæˆ·æ•°æ®åº“ï¼

// 3. åœ¨ç§Ÿæˆ·æ•°æ®åº“ä¸­æŸ¥æ‰¾ç”¨æˆ·
const [userRows] = await sequelizeInstance.query(`
  SELECT u.id, u.username, u.email, u.real_name, u.phone, u.status, u.global_user_id
  FROM users u
  WHERE u.global_user_id = ? AND u.status = 'active'
  LIMIT 1
`, {
  replacements: [globalUser.id]
});

// 4. å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»º
if (userRows.length === 0) {
  await sequelizeInstance.query(`
    INSERT INTO users (
      global_user_id, username, email, real_name, phone,
      auth_source, status, role, created_at, updated_at
    ) VALUES (?, ?, ?, ?, ?, 'unified', 'active', 'parent', NOW(), NOW())
  `, {
    replacements: [
      globalUser.id,
      globalUser.username || globalUser.phone,
      globalUser.email || '',
      globalUser.realName || 'ç”¨æˆ·',
      globalUser.phone || ''
    ]
  });
}

// 5. è·å–ç”¨æˆ·è§’è‰²
const [roleRows] = await sequelizeInstance.query(`
  SELECT r.code as role_code, r.name as role_name
  FROM user_roles ur
  INNER JOIN roles r ON ur.role_id = r.id
  WHERE ur.user_id = ?
  LIMIT 1
`, {
  replacements: [tenantUser.id]
});

// 6. æ„å»ºç”¨æˆ·å¯¹è±¡
const userObject = {
  id: tenantUser.id,                    // ç§Ÿæˆ·ç”¨æˆ·ID
  globalUserId: tenantUser.global_user_id,  // å…¨å±€ç”¨æˆ·ID
  tenantCode: req.tenant.code,          // k001
  tenantDatabaseName: req.tenant.databaseName,  // tenant_k001
  role: userRole?.role_code || 'parent',
  // ... å…¶ä»–å­—æ®µ
};

req.user = userObject;

// 7. è¿”å›ç™»å½•å“åº”
res.json({
  success: true,
  data: {
    token,
    user: userObject,
    tenantInfo: {
      tenantCode: 'k001',
      tenantName: 'ç§Ÿæˆ·k001'
    }
  }
});
```

**å…³é”®ç‚¹ï¼š**
- âœ… ç»Ÿä¸€è®¤è¯ç³»ç»ŸéªŒè¯**å…¨å±€ç”¨æˆ·èº«ä»½**
- âœ… ç§Ÿæˆ·ç³»ç»Ÿåœ¨**ç§Ÿæˆ·æ•°æ®åº“**ä¸­æŸ¥æ‰¾ç”¨æˆ·
- âœ… è‡ªåŠ¨åˆ›å»ºç§Ÿæˆ·å†…ç”¨æˆ·ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- âœ… ç”¨æˆ·å¯¹è±¡åŒ…å«**ç§Ÿæˆ·ä¿¡æ¯**

---

### **ç¬¬äºŒé˜¶æ®µï¼šåç»­APIè¯·æ±‚å¤„ç†**

#### æ­¥éª¤3ï¸âƒ£ï¼šTokenéªŒè¯ä¸­é—´ä»¶ï¼ˆverifyTokenï¼‰

```typescript
// æ–‡ä»¶ï¼šk.yyup.com/server/src/middlewares/auth.middleware.ts

// 1. ä»Authorizationå¤´è·å–token
const authHeader = req.headers.authorization;
const token = authHeader.substring(7);  // ç§»é™¤ "Bearer "

// 2. è°ƒç”¨ç»Ÿä¸€è®¤è¯ç³»ç»ŸéªŒè¯token
const verifyResult = await adminIntegrationService.verifyToken(token);
// è°ƒç”¨ï¼šPOST http://localhost:4001/api/v1/auth/verify-token
// è¿”å›ï¼š{ success: true, data: { user: { id, phone, ... } } }

const { user: globalUser } = verifyResult.data;

// 3. é€‰æ‹©æ•°æ®åº“è¿æ¥
let sequelizeInstance = sequelize;  // é»˜è®¤æ•°æ®åº“
if (req.tenant && req.tenantDb) {
  sequelizeInstance = req.tenantDb;  // ä½¿ç”¨ç§Ÿæˆ·æ•°æ®åº“
  console.log('[è®¤è¯] ä½¿ç”¨ç§Ÿæˆ·æ•°æ®åº“:', req.tenant.databaseName);
}

// 4. åœ¨ç§Ÿæˆ·æ•°æ®åº“ä¸­æŸ¥æ‰¾ç”¨æˆ·
const [userRows] = await sequelizeInstance.query(`
  SELECT u.id, u.username, u.email, u.real_name, u.phone, u.status, u.global_user_id
  FROM users u
  WHERE u.global_user_id = ? AND u.status = 'active'
  LIMIT 1
`, {
  replacements: [globalUser.id]
});

// 5. æ„å»ºç”¨æˆ·å¯¹è±¡
const userObject = {
  id: tenantUser.id,
  globalUserId: tenantUser.global_user_id,
  tenantCode: req.tenant.code,
  tenantDatabaseName: req.tenant.databaseName,
  // ... å…¶ä»–å­—æ®µ
};

req.user = userObject;
next();
```

**å…³é”®ç‚¹ï¼š**
- âœ… Tokenåœ¨**ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ**éªŒè¯
- âœ… ç”¨æˆ·æ•°æ®åœ¨**ç§Ÿæˆ·æ•°æ®åº“**æŸ¥è¯¢
- âœ… ç§Ÿæˆ·ä¿¡æ¯ä»**è¯·æ±‚å¯¹è±¡**è·å–

---

## ğŸ” ä¸‰å±‚éš”ç¦»æœºåˆ¶è¯¦è§£

### **ç¬¬1å±‚ï¼šåŸŸåè¯†åˆ«éš”ç¦»**

```
è¯·æ±‚URL: k001.yyup.cc/api/users
         â†“
æå–Hostå¤´: k001.yyup.cc
         â†“
æ­£åˆ™åŒ¹é…: /^(k\d+)\.yyup\.cc$/
         â†“
æå–ç§Ÿæˆ·ä»£ç : k001
         â†“
éªŒè¯ç§Ÿæˆ·å­˜åœ¨: âœ…
         â†“
è®¾ç½®req.tenant.code = 'k001'
```

**éš”ç¦»æ•ˆæœï¼š**
- ä¸åŒåŸŸåè‡ªåŠ¨è¯†åˆ«ä¸ºä¸åŒç§Ÿæˆ·
- æ— æ³•é€šè¿‡URLå‚æ•°ä¼ªé€ ç§Ÿæˆ·ä»£ç 
- åŸŸåä¸ç§Ÿæˆ·ä¸€ä¸€å¯¹åº”

---

### **ç¬¬2å±‚ï¼šæ•°æ®åº“è¿æ¥éš”ç¦»**

```typescript
// ç§Ÿæˆ·æ•°æ®åº“æœåŠ¡
class TenantDatabaseService {
  private connections: Map<string, Sequelize> = new Map();
  
  async getTenantConnection(tenantCode: string): Promise<Sequelize> {
    const connectionKey = `tenant_${tenantCode}`;
    
    // æ£€æŸ¥è¿æ¥æ˜¯å¦å·²å­˜åœ¨
    if (this.connections.has(connectionKey)) {
      return this.connections.get(connectionKey)!;
    }
    
    // åˆ›å»ºæ–°è¿æ¥
    const connection = new Sequelize({
      host: 'localhost',
      port: 3306,
      username: 'root',
      password: 'xxx',
      database: `tenant_${tenantCode}`,  // å…³é”®ï¼šä¸åŒç§Ÿæˆ·ä¸åŒæ•°æ®åº“
      dialect: 'mysql'
    });
    
    this.connections.set(connectionKey, connection);
    return connection;
  }
}
```

**éš”ç¦»æ•ˆæœï¼š**
- æ¯ä¸ªç§Ÿæˆ·æœ‰**ç‹¬ç«‹çš„æ•°æ®åº“**
- è¿æ¥æ± ç®¡ç†ï¼Œé¿å…é‡å¤åˆ›å»º
- æ•°æ®åº“åç§°ä¸ç§Ÿæˆ·ä»£ç ç»‘å®š

---

### **ç¬¬3å±‚ï¼šTokenéªŒè¯éš”ç¦»**

```
TokenéªŒè¯æµç¨‹ï¼š
1. å‰ç«¯å‘é€token
   â†“
2. ç§Ÿæˆ·ç³»ç»Ÿè°ƒç”¨ç»Ÿä¸€è®¤è¯ç³»ç»ŸéªŒè¯
   â†“
3. ç»Ÿä¸€è®¤è¯ç³»ç»Ÿè¿”å›globalUserId
   â†“
4. ç§Ÿæˆ·ç³»ç»Ÿä½¿ç”¨globalUserIdåœ¨ç§Ÿæˆ·æ•°æ®åº“æŸ¥è¯¢
   â†“
5. ç¡®ä¿ç”¨æˆ·å­˜åœ¨äºè¯¥ç§Ÿæˆ·
   â†“
6. å…è®¸è®¿é—®è¯¥ç§Ÿæˆ·æ•°æ®
```

**éš”ç¦»æ•ˆæœï¼š**
- Tokenç”±**ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ**ç­¾å‘å’ŒéªŒè¯
- ç”¨æˆ·èº«ä»½ä¸ç§Ÿæˆ·ç»‘å®š
- æ— æ³•è·¨ç§Ÿæˆ·è®¿é—®

---

## ğŸ“Š æ•°æ®æµå‘å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç™»å½•è¯·æ±‚                                                 â”‚
â”‚ POST k001.yyup.cc/api/auth/login                            â”‚
â”‚ { phone: "18611141133", password: "xxx" }                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ ç§Ÿæˆ·è¯†åˆ«ä¸­é—´ä»¶                                            â”‚
â”‚ - ä»Hostå¤´æå–: k001                                         â”‚
â”‚ - å»ºç«‹è¿æ¥: tenant_k001                                      â”‚
â”‚ - è®¾ç½®req.tenant, req.tenantDb                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ ç»Ÿä¸€è®¤è¯ä¸­é—´ä»¶                                            â”‚
â”‚ - è°ƒç”¨ç»Ÿä¸€è®¤è¯ç³»ç»ŸéªŒè¯                                       â”‚
â”‚ - è·å¾—globalUserId                                          â”‚
â”‚ - åœ¨ç§Ÿæˆ·æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·                                       â”‚
â”‚ - è‡ªåŠ¨åˆ›å»ºç§Ÿæˆ·ç”¨æˆ·ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰                             â”‚
â”‚ - è¿”å›token + ç”¨æˆ·ä¿¡æ¯                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç™»å½•æˆåŠŸå“åº”                                                 â”‚
â”‚ {                                                           â”‚
â”‚   token: "xxx",                                             â”‚
â”‚   user: {                                                   â”‚
â”‚     id: 123,                                                â”‚
â”‚     globalUserId: "global_xxx",                             â”‚
â”‚     tenantCode: "k001",                                     â”‚
â”‚     tenantDatabaseName: "tenant_k001"                       â”‚
â”‚   }                                                         â”‚
â”‚ }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åç»­APIè¯·æ±‚                                                  â”‚
â”‚ GET k001.yyup.cc/api/users                                  â”‚
â”‚ Authorization: Bearer token                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£ ç§Ÿæˆ·è¯†åˆ«ä¸­é—´ä»¶ï¼ˆå†æ¬¡æ‰§è¡Œï¼‰                                â”‚
â”‚ - ä»Hostå¤´æå–: k001                                         â”‚
â”‚ - å»ºç«‹è¿æ¥: tenant_k001                                      â”‚
â”‚ - è®¾ç½®req.tenant, req.tenantDb                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£ TokenéªŒè¯ä¸­é—´ä»¶                                           â”‚
â”‚ - è°ƒç”¨ç»Ÿä¸€è®¤è¯ç³»ç»ŸéªŒè¯token                                  â”‚
â”‚ - è·å¾—globalUserId                                          â”‚
â”‚ - åœ¨ç§Ÿæˆ·æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·                                       â”‚
â”‚ - è®¾ç½®req.user                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£ ä¸šåŠ¡é€»è¾‘å¤„ç†                                              â”‚
â”‚ - ä½¿ç”¨req.tenantDbæ‰§è¡ŒæŸ¥è¯¢                                   â”‚
â”‚ - æ‰€æœ‰æŸ¥è¯¢éƒ½åœ¨tenant_k001æ•°æ®åº“ä¸­æ‰§è¡Œ                        â”‚
â”‚ - è¿”å›æ•°æ®ç»™å‰ç«¯                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›¡ï¸ å®‰å…¨ä¿éšœ

### **1. åŸŸåéªŒè¯**
- ç§Ÿæˆ·ä»£ç ä»åŸŸåæå–ï¼Œæ— æ³•ä¼ªé€ 
- ä¸åŒç§Ÿæˆ·è®¿é—®ä¸åŒåŸŸå

### **2. æ•°æ®åº“éš”ç¦»**
- æ¯ä¸ªç§Ÿæˆ·ç‹¬ç«‹æ•°æ®åº“
- ç‰©ç†éš”ç¦»ï¼Œæ— æ³•è·¨åº“è®¿é—®

### **3. TokenéªŒè¯**
- Tokenç”±ç»Ÿä¸€è®¤è¯ç³»ç»Ÿç­¾å‘
- æ¯ä¸ªè¯·æ±‚éƒ½éªŒè¯tokenæœ‰æ•ˆæ€§

### **4. ç”¨æˆ·ç»‘å®š**
- ç”¨æˆ·ä¸ç§Ÿæˆ·ç»‘å®šå…³ç³»å­˜å‚¨åœ¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ
- æ— æ³•è·¨ç§Ÿæˆ·è®¿é—®

---

## âœ… éªŒè¯æœºåˆ¶

### **ç™»å½•æ—¶çš„éªŒè¯**
1. âœ… åŸŸåè¯†åˆ« â†’ ç¡®å®šç§Ÿæˆ·
2. âœ… ç»Ÿä¸€è®¤è¯ â†’ éªŒè¯ç”¨æˆ·èº«ä»½
3. âœ… ç§Ÿæˆ·æ•°æ®åº“ â†’ æŸ¥è¯¢ç”¨æˆ·
4. âœ… è§’è‰²æƒé™ â†’ è·å–ç”¨æˆ·æƒé™

### **APIè¯·æ±‚æ—¶çš„éªŒè¯**
1. âœ… åŸŸåè¯†åˆ« â†’ ç¡®å®šç§Ÿæˆ·
2. âœ… TokenéªŒè¯ â†’ éªŒè¯ç”¨æˆ·èº«ä»½
3. âœ… ç§Ÿæˆ·æ•°æ®åº“ â†’ æŸ¥è¯¢ç”¨æˆ·
4. âœ… æƒé™æ£€æŸ¥ â†’ éªŒè¯æ“ä½œæƒé™

---

## ğŸ“ æ€»ç»“

**ç»Ÿä¸€è®¤è¯ç³»ç»Ÿç¡®ä¿ç”¨æˆ·è®¿é—®æ­£ç¡®ç§Ÿæˆ·æ•°æ®åº“çš„æœºåˆ¶ï¼š**

| é˜¶æ®µ | æœºåˆ¶ | ä½œç”¨ |
|------|------|------|
| **è¯·æ±‚åˆ°è¾¾** | ç§Ÿæˆ·è¯†åˆ«ä¸­é—´ä»¶ | ä»åŸŸåè¯†åˆ«ç§Ÿæˆ·ï¼Œå»ºç«‹æ•°æ®åº“è¿æ¥ |
| **ç™»å½•éªŒè¯** | ç»Ÿä¸€è®¤è¯ä¸­é—´ä»¶ | éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œåœ¨ç§Ÿæˆ·æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ· |
| **TokenéªŒè¯** | TokenéªŒè¯ä¸­é—´ä»¶ | éªŒè¯tokenæœ‰æ•ˆæ€§ï¼Œåœ¨ç§Ÿæˆ·æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ· |
| **æ•°æ®è®¿é—®** | ä¸šåŠ¡é€»è¾‘ | ä½¿ç”¨ç§Ÿæˆ·æ•°æ®åº“è¿æ¥æ‰§è¡ŒæŸ¥è¯¢ |

**æ ¸å¿ƒåŸç†ï¼š**
- ğŸ”‘ **åŸŸå â†’ ç§Ÿæˆ·ä»£ç ** â†’ æ•°æ®åº“è¿æ¥
- ğŸ”‘ **Token â†’ globalUserId** â†’ ç§Ÿæˆ·ç”¨æˆ·ID
- ğŸ”‘ **æ¯ä¸ªè¯·æ±‚éƒ½ç»è¿‡ç§Ÿæˆ·è¯†åˆ«** â†’ ç¡®ä¿æ•°æ®éš”ç¦»

